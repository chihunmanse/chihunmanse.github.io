<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-blockchain/how-ethereum-works/consensus-finality">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">4. Consensus and Finality | Chihun&#x27;s Dev Blog</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://chihunmanse.github.io/img/m.png"><meta data-rh="true" name="twitter:image" content="https://chihunmanse.github.io/img/m.png"><meta data-rh="true" property="og:url" content="https://chihunmanse.github.io/blockchain/how-ethereum-works/consensus-finality"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="4. Consensus and Finality | Chihun&#x27;s Dev Blog"><meta data-rh="true" name="description" content="How Ethereum achieves consensus and finality through PoS, validators, attestations, and the Gasper protocol"><meta data-rh="true" property="og:description" content="How Ethereum achieves consensus and finality through PoS, validators, attestations, and the Gasper protocol"><meta data-rh="true" name="keywords" content="Ethereum,consensus,PoS,PoW,validator,finality,attestation,Gasper,LMD-GHOST,Casper FFG,slashing"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://chihunmanse.github.io/blockchain/how-ethereum-works/consensus-finality"><link data-rh="true" rel="alternate" href="https://chihunmanse.github.io/blockchain/how-ethereum-works/consensus-finality" hreflang="en"><link data-rh="true" rel="alternate" href="https://chihunmanse.github.io/blockchain/how-ethereum-works/consensus-finality" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.5b6de4da.css">
<link rel="preload" href="/assets/js/runtime~main.5eace082.js" as="script">
<link rel="preload" href="/assets/js/main.4ff0f8e6.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">Chihun&#x27;s Dev Blog</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/tags">Tags</a><a href="https://github.com/chihunmanse" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><b>Chihun&#x27;s Dev Blog</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Home</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/datastructure-algorithm">DataStructure &amp; Algorithm</a><button aria-label="Toggle the collapsible sidebar category &#x27;DataStructure &amp; Algorithm&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/backend">Backend</a><button aria-label="Toggle the collapsible sidebar category &#x27;Backend&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/devops">DevOps</a><button aria-label="Toggle the collapsible sidebar category &#x27;DevOps&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/blockchain">BlockChain</a><button aria-label="Toggle the collapsible sidebar category &#x27;BlockChain&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/blockchain/upgradeable-contract">Upgradeable Contract</a><button aria-label="Toggle the collapsible sidebar category &#x27;Upgradeable Contract&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blockchain/contract-error-handling">Contract Error Handling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blockchain/storage-layout">Solidity Storage Layout</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/blockchain/defi">DeFi</a><button aria-label="Toggle the collapsible sidebar category &#x27;DeFi&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/blockchain/cryptography">Cryptography</a><button aria-label="Toggle the collapsible sidebar category &#x27;Cryptography&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/blockchain/how-ethereum-works">How Ethereum Works</a><button aria-label="Toggle the collapsible sidebar category &#x27;How Ethereum Works&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/blockchain/how-ethereum-works/architecture-overview">1. Ethereum Architecture Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/blockchain/how-ethereum-works/transaction-lifecycle">2. Transaction Lifecycle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/blockchain/how-ethereum-works/block-execution-state">3. Block Execution and State Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/blockchain/how-ethereum-works/consensus-finality">4. Consensus and Finality</a></li></ul></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/blockchain"><span itemprop="name">BlockChain</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/blockchain/how-ethereum-works"><span itemprop="name">How Ethereum Works</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">4. Consensus and Finality</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>4. Consensus and Finality</h1><p><a href="/blockchain/how-ethereum-works/block-execution-state">이전 글</a>에서 트랜잭션이 EVM에서 실행되어 상태가 변경되는 과정을 살펴보았다. 그런데 각 노드가 독립적으로 트랜잭션을 실행한다면, 어떻게 모든 노드가 동일한 상태에 도달할 수 있을까? 이 글에서는 이더리움의 합의 메커니즘을 분석한다. The Merge 이전의 PoW부터 현재의 PoS까지, 블록이 어떻게 체인에 확정되는지 살펴본다.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="합의의-필요성">합의의 필요성<a href="#합의의-필요성" class="hash-link" aria-label="Direct link to 합의의 필요성" title="Direct link to 합의의 필요성">​</a></h2><p>분산 시스템에서 합의(Consensus)란 여러 노드가 단일한 상태에 동의하는 과정이다. 블록체인에서는 &quot;어떤 트랜잭션을 어떤 순서로 실행할 것인가&quot;에 대한 합의가 필요하다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="비잔틴-장애-허용-bft">비잔틴 장애 허용 (BFT)<a href="#비잔틴-장애-허용-bft" class="hash-link" aria-label="Direct link to 비잔틴 장애 허용 (BFT)" title="Direct link to 비잔틴 장애 허용 (BFT)">​</a></h3><p>분산 시스템에서는 노드가 실패하거나 악의적으로 행동할 수 있다. 비잔틴 장군 문제(Byzantine Generals Problem)는 이런 상황에서 정직한 노드들이 어떻게 합의에 도달할 수 있는지를 다룬다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│                      Byzantine Generals Problem                         │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└─────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      General A                General B                General C</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    (Commander)               (Honest)                 (Traitor)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         │                        │                        │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         ├──── &quot;Attack&quot; ─────────►│                        │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         ├──── &quot;Attack&quot; ───────────────────────────────────►</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         │                        │                        │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         │                        │◄─── &quot;Retreat&quot; ─────────┤</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         │                        │                        │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         │                   ┌────┴────┐                   │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         │                   │ What to │                   │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         │                   │ decide? │                   │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         │                   └─────────┘                   │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - 정직한 노드는 동일한 결정에 도달해야 한다.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - 악의적 노드가 있어도 시스템이 동작해야 한다.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - 전통적 BFT: 노드의 1/3 미만이 악의적일 때 합의 가능</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>이더리움의 합의 메커니즘은 네트워크에 악의적인 참여자가 있더라도 정직한 노드들이 동일한 블록체인 상태에 합의할 수 있도록 설계되었다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="합의-메커니즘의-두-가지-역할">합의 메커니즘의 두 가지 역할<a href="#합의-메커니즘의-두-가지-역할" class="hash-link" aria-label="Direct link to 합의 메커니즘의 두 가지 역할" title="Direct link to 합의 메커니즘의 두 가지 역할">​</a></h3><p>블록체인의 합의 메커니즘은 두 가지 핵심 문제를 해결한다.</p><ol><li><strong>Sybil Resistance:</strong> 누가 블록을 제안할 자격이 있는가?<ul><li>PoW: 계산 능력(해시파워)을 증명한 자</li><li>PoS: 담보(스테이크)를 예치한 자</li></ul></li><li><strong>Chain Selection:</strong> 여러 체인 중 어떤 것이 정당한 체인인가?<ul><li>PoW: 가장 많은 작업이 투입된 체인 (Longest Chain Rule)</li><li>PoS: 가장 많은 지지를 받은 체인 (LMD-GHOST + Casper FFG)</li></ul></li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="pow-the-merge-이전">PoW: The Merge 이전<a href="#pow-the-merge-이전" class="hash-link" aria-label="Direct link to PoW: The Merge 이전" title="Direct link to PoW: The Merge 이전">​</a></h2><p>2022년 9월 The Merge 이전까지 이더리움은 작업 증명(Proof of Work)을 사용했다. PoW의 핵심 아이디어는 &quot;계산 비용을 지불해야만 블록을 생성할 수 있다&quot;는 것이다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ethash-알고리즘">Ethash 알고리즘<a href="#ethash-알고리즘" class="hash-link" aria-label="Direct link to Ethash 알고리즘" title="Direct link to Ethash 알고리즘">​</a></h3><p>이더리움의 PoW 알고리즘인 Ethash는 ASIC 저항성을 목표로 설계되었다. 비트코인의 SHA-256과 달리, 대량의 메모리 접근이 필요하여 전용 채굴 칩(ASIC) 개발이 어렵도록 했다.</p><p>Ethash 채굴 흐름은 다음과 같다. 먼저 seed로 16MB 캐시를 만들고, 캐시에서 약 1GB 크기의 DAG를 생성한다. DAG는 에폭마다 갱신된다. 채굴자는 블록 헤더와 nonce를 조합해 DAG 데이터를 섞고 해시를 계산한 뒤, 결과가 난이도 목표(target)보다 작은지 확인한다. 조건을 만족하면 블록이 채굴되고, 실패하면 nonce를 바꿔 반복한다.</p><p>DAG(Directed Acyclic Graph)는 약 1GB 크기의 데이터셋으로, 채굴 시 빈번하게 접근해야 한다. 이 메모리 요구사항이 ASIC 개발을 어렵게 만들었지만, 결국 Ethash ASIC도 등장했다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="난이도-조정">난이도 조정<a href="#난이도-조정" class="hash-link" aria-label="Direct link to 난이도 조정" title="Direct link to 난이도 조정">​</a></h3><p>이더리움은 평균 블록 시간을 약 13-14초로 유지하기 위해 난이도를 동적으로 조정했다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">난이도 조정 공식 (간략화):</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if 블록 시간 &lt; 10초:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      난이도 증가</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  elif 블록 시간 &gt; 20초:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      난이도 감소</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  else:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      유지</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The Merge를 앞두고 &quot;Difficulty Bomb&quot;이 도입되어 난이도가 급격히 증가하도록 설계되었다. 이는 PoS 전환을 강제하기 위한 장치였다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="longest-chain-rule">Longest Chain Rule<a href="#longest-chain-rule" class="hash-link" aria-label="Direct link to Longest Chain Rule" title="Direct link to Longest Chain Rule">​</a></h3><p>PoW에서 정당한 체인은 &quot;가장 많은 작업이 투입된 체인&quot;이다. 실제로는 누적 난이도(Total Difficulty)가 가장 높은 체인을 선택한다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│                          Longest Chain Rule                             │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└─────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Block 100 ─── Block 101 ─── Block 102 ─── Block 103    ◄── 정당한 체인</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    │                                         (더 긴 체인)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    └──────── Block 102&#x27;                 ◄── 고아 블록</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                                              (orphaned)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - 동시에 여러 블록이 발견되면 일시적으로 포크 발생</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - 더 긴 체인이 형성되면 짧은 체인의 블록은 고아가 됨</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - 고아 블록의 트랜잭션은 무효화되고 mempool로 돌아감</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="확률적-finality">확률적 Finality<a href="#확률적-finality" class="hash-link" aria-label="Direct link to 확률적 Finality" title="Direct link to 확률적 Finality">​</a></h3><p>PoW에서는 블록이 &quot;확정&quot;되지 않는다. 대신 블록 위에 더 많은 블록이 쌓일수록 되돌리기가 어려워진다. 이를 확률적 finality라고 한다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Block 100에 대한 재구성(reorg) 확률:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Confirmations    재구성 확률</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ─────────────────────────────</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       1           ~10%</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       6           ~0.1%</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      12           ~0.001%</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      30           사실상 불가능</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  * 6 confirmations (약 1분)가 일반적인 기준</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  * 거래소는 보통 12-30 confirmations 요구</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>그러나 이론적으로는 충분한 해시파워가 있다면 언제든 체인을 재구성할 수 있다. 이것이 PoW의 근본적 한계이다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="uncle-ommer-blocks">Uncle (Ommer) Blocks<a href="#uncle-ommer-blocks" class="hash-link" aria-label="Direct link to Uncle (Ommer) Blocks" title="Direct link to Uncle (Ommer) Blocks">​</a></h3><p>이더리움 PoW에서는 거의 동시에 발견된 블록 중 정당한 체인에 포함되지 못한 블록을 &quot;Uncle&quot; 또는 &quot;Ommer&quot; 블록이라고 불렀다. 완전히 버리지 않고 부분 보상을 제공하여 마이너의 수익을 안정화했다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Main Chain:    Block N ─────────── Block N+1 ─────────── Block N+2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  │                    │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  │                    └── uncles: [Uncle A]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Uncle Block:   Uncle A (동시에 채굴되었으나 메인 체인에 포함 안 됨)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">보상:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - 메인 블록 채굴자: 2 ETH + Uncle 포함 보상</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - Uncle 블록 채굴자: (8 - 거리) / 8 × 2 ETH</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>PoS 전환 후 Uncle 개념은 사라졌다. Slot 기반 시스템에서는 각 slot에 하나의 블록만 제안되기 때문이다.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="pos로의-전환">PoS로의 전환<a href="#pos로의-전환" class="hash-link" aria-label="Direct link to PoS로의 전환" title="Direct link to PoS로의 전환">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="왜-pos인가">왜 PoS인가?<a href="#왜-pos인가" class="hash-link" aria-label="Direct link to 왜 PoS인가?" title="Direct link to 왜 PoS인가?">​</a></h3><p>PoW에서 PoS로 전환한 이유는 다음과 같다.</p><ul><li><strong>에너지 효율성:</strong> PoW는 막대한 전력을 소비한다. 이더리움의 PoS 전환으로 에너지 소비가 99.95% 감소했다.</li><li><strong>탈중앙화:</strong> PoW에서는 대규모 채굴 시설이 유리하여 중앙화 경향이 있었다. PoS에서는 32 ETH만 있으면 누구나 validator가 될 수 있다.</li><li><strong>경제적 보안:</strong> PoW는 공격자가 장비와 전기를 투입해 해시파워를 확보하면 되며, 공격 후에도 장비를 되팔 수 있어 비용 회수가 가능하다. 반면 PoS는 공격에 사용한 스테이크가 직접 슬래싱되므로 비용이 즉시 확정되고 회수하기 어렵다.</li><li><strong>Finality:</strong> PoW의 확률적 finality와 달리, PoS는 결정론적 finality를 제공한다. 약 13분 후 블록은 되돌릴 수 없다.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="the-merge">The Merge<a href="#the-merge" class="hash-link" aria-label="Direct link to The Merge" title="Direct link to The Merge">​</a></h3><p>2022년 9월 15일, 이더리움은 Execution Layer(기존 PoW 체인)와 Consensus Layer(Beacon Chain)를 병합했다. 이를 &quot;The Merge&quot;라고 한다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│                              The Merge                                  │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└─────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Before The Merge:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    PoW Chain                      Beacon Chain (PoS)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    (Execution)                    (Consensus)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ┌─────────────┐                ┌─────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  │ Transactions│                │ Validators      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  │ + Mining    │                │ + Attestations  │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  │ + Consensus │                │ (no execution)  │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  └─────────────┘                └─────────────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        │                              │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        │         The Merge            │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        └──────────────┬───────────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       ▼</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  After The Merge:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         Execution Layer          Consensus Layer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       ┌─────────────────┐      ┌─────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       │ Transactions    │◄────►│ Validators      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       │ EVM Execution   │      │ Block Proposal  │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       │ State Management│      │ Attestations    │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       └─────────────────┘      │ Finality        │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           (geth, etc.)         └─────────────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                 (Prysm, Lighthouse, etc.)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The Merge의 핵심은 합의 로직을 Execution Layer에서 Consensus Layer로 이전한 것이다. 트랜잭션 실행과 상태 관리는 여전히 Execution Layer가 담당하지만, &quot;어떤 블록이 정당한가&quot;의 결정은 Consensus Layer가 한다.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="validator">Validator<a href="#validator" class="hash-link" aria-label="Direct link to Validator" title="Direct link to Validator">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="validator가-되는-방법">Validator가 되는 방법<a href="#validator가-되는-방법" class="hash-link" aria-label="Direct link to Validator가 되는 방법" title="Direct link to Validator가 되는 방법">​</a></h3><p>validator가 되려면 32 ETH를 Beacon Chain의 deposit contract에 예치해야 한다.</p><ol><li><strong>예치:</strong> 사용자가 32 ETH를 Deposit Contract에 전송한다. (<code>0x00000000219ab540356cbb839cbe05303d7705fa</code>)</li><li><strong>감지:</strong> Beacon Chain이 예치를 감지하고 validator를 대기열(Pending Queue)에 넣는다.</li><li><strong>활성화:</strong> epoch 경계에서 대기열이 처리되며 Active Validator로 전환된다.</li></ol><p>deposit 후 바로 활성화되지 않는다. 보안을 위해 대기열(activation queue)이 존재하며, epoch당 활성화되는 validator 수가 제한된다. 2025년 기준 약 106만 개의 validator가 활동 중이며, 약 3,500만 ETH(전체 공급량의 약 29%)가 스테이킹되어 있다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="validator-상태-전이">Validator 상태 전이<a href="#validator-상태-전이" class="hash-link" aria-label="Direct link to Validator 상태 전이" title="Direct link to Validator 상태 전이">​</a></h3><p>Validator 상태 전이는 다음 흐름으로 이해할 수 있다.</p><ol><li><strong>Deposit → Pending</strong><br>32 ETH를 예치하면 validator는 Pending 상태로 들어가며, 활성화 대기열에 놓인다.</li><li><strong>Pending → Active</strong><br>activation이 되면 Active로 전환되고 블록 제안과 attestation을 수행한다.</li><li><strong>Active 이후의 분기</strong>  <ul><li><strong>Voluntary exit:</strong> 자발적으로 나가면 Exiting으로 이동  </li><li><strong>Slashed:</strong> 규칙 위반 시 Exiting으로 이동  </li><li><strong>Ejected:</strong> 잔액이 16 ETH 미만이면 강제 종료되어 Exiting으로 이동</li></ul></li><li><strong>Exiting → Withdrawable</strong><br>exit queue를 거친 뒤 출금 가능한 상태로 전환된다.</li><li><strong>Reactivate (재예치)</strong><br>출금 이후 다시 예치하면 새로운 validator로 등록되어 흐름이 반복된다.</li></ol><ul><li><strong>Active:</strong> 정상적으로 의무를 수행하는 상태. 블록 제안과 attestation에 참여한다.</li><li><strong>Slashed:</strong> 프로토콜 위반(double voting, surround voting) 시 강제 퇴출. 스테이크의 일부가 소각된다.</li><li><strong>Exited:</strong> 자발적 탈퇴 또는 잔액 부족으로 퇴출. exit queue를 거쳐 출금 가능 상태가 된다.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="validator-책임과-보상">Validator 책임과 보상<a href="#validator-책임과-보상" class="hash-link" aria-label="Direct link to Validator 책임과 보상" title="Direct link to Validator 책임과 보상">​</a></h3><p>validator는 두 가지 주요 역할을 수행한다.</p><ol><li><strong>블록 제안 (Proposing):</strong> 선정되면 새 블록을 제안</li><li><strong>증명 (Attesting):</strong> 다른 validator가 제안한 블록에 투표</li></ol><table><thead><tr><th>역할</th><th>보상</th><th>패널티</th></tr></thead><tbody><tr><td>Block Proposal</td><td>~0.02 ETH/block</td><td>누락 시 기회 손실</td></tr><tr><td>Attestation</td><td>~0.000014 ETH/slot</td><td>누락 시 동일 금액</td></tr><tr><td>Sync Committee</td><td>추가 보상</td><td>누락 시 패널티</td></tr><tr><td>Slashable 위반</td><td>-</td><td>최소 1/32 소각</td></tr></tbody></table><ul><li>2025년 기준 연간 수익률(APR): 약 2.9-3%</li><li>수익률은 총 스테이킹 양에 반비례</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="시간-단위-slot과-epoch">시간 단위: Slot과 Epoch<a href="#시간-단위-slot과-epoch" class="hash-link" aria-label="Direct link to 시간 단위: Slot과 Epoch" title="Direct link to 시간 단위: Slot과 Epoch">​</a></h2><p>PoS 이더리움은 시간을 slot과 epoch으로 나눈다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="slot">Slot<a href="#slot" class="hash-link" aria-label="Direct link to Slot" title="Direct link to Slot">​</a></h3><p><strong>Slot</strong>은 12초 단위의 시간이다. 각 slot에서 한 명의 validator가 블록을 제안할 기회를 갖는다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│                            Slot Timeline                                │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└─────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Slot N                          Slot N+1                      Slot N+2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  │◄──────── 12 seconds ────────►│◄──────── 12 seconds ───────►│</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  │                               │                              │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  t=0   t=4      t=8     t=12    t=0                            t=0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  │     │        │        │       │                              │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ▼     ▼        ▼        ▼       ▼                              ▼</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌───┬───────┬─────────┬─────┐   ┌───┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│ P │   A   │    Ag   │ Pr  │   │ P │ ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└───┴───────┴─────────┴─────┘   └───┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">P: Block Proposal (0-4초)  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A: Attestations 수집 (4-8초)  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Ag: Aggregation (8-12초)  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Pr: 다음 slot 준비</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li>Proposer가 블록 제안 (0-4초)</li><li>Committee 멤버들이 attestation 생성 (4-8초)</li><li>Aggregator가 attestation을 집계 (8-12초)</li></ol><p>모든 slot에서 블록이 생성되는 것은 아니다. Proposer가 오프라인이거나 네트워크 지연이 있으면 slot이 비어 있을 수 있다(missed slot).</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="epoch">Epoch<a href="#epoch" class="hash-link" aria-label="Direct link to Epoch" title="Direct link to Epoch">​</a></h3><p><strong>Epoch</strong>은 32개의 slot으로 구성되며, 약 6.4분이다. Epoch 경계에서 중요한 작업들이 수행된다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│                           Epoch Structure                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└─────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Epoch N                                                    Epoch N+1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ├─────────────────────────────────────────────────────────┼─────────────</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  │  Slot 0 │ Slot 1 │ ... │ Slot 31 │                      │  Slot 0 │...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  │         │        │     │         │                      │         │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  └─────────┴────────┴─────┴─────────┘                      └─────────┴───</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="epoch-경계에서-수행되는-작업">Epoch 경계에서 수행되는 작업<a href="#epoch-경계에서-수행되는-작업" class="hash-link" aria-label="Direct link to Epoch 경계에서 수행되는 작업" title="Direct link to Epoch 경계에서 수행되는 작업">​</a></h4><ol><li>Justification/Finalization 체크</li><li>Validator 보상/패널티 정산</li><li>Validator 활성화/퇴출 처리</li><li>RANDAO 믹싱 (다음 epoch proposer 선정용)</li><li>Sync Committee 교체 (256 epoch마다) </li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="committee">Committee<a href="#committee" class="hash-link" aria-label="Direct link to Committee" title="Direct link to Committee">​</a></h3><p>각 slot에는 <strong>committee</strong>가 배정된다. Committee는 해당 slot의 블록에 attestation을 제출할 validator 그룹이다.</p><p>Committee 배정 흐름은 다음과 같다. Epoch N의 전체 active validator(약 106만 명)를 RANDAO로 셔플한 뒤, 각 slot에 committee를 배정한다. 각 slot에는 여러 committee가 배정되고, 전체적으로 slot당 약 3.1만 명 수준이 참여한다.</p><ul><li>각 validator는 epoch당 정확히 1번 attestation 의무</li><li>Committee 배정은 RANDAO로 결정되어 예측 불가능</li><li>최소 128명의 committee 크기 보장 (보안상 필요)</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="블록-제안-proposing">블록 제안 (Proposing)<a href="#블록-제안-proposing" class="hash-link" aria-label="Direct link to 블록 제안 (Proposing)" title="Direct link to 블록 제안 (Proposing)">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="proposer-선정">Proposer 선정<a href="#proposer-선정" class="hash-link" aria-label="Direct link to Proposer 선정" title="Direct link to Proposer 선정">​</a></h3><p>각 slot의 proposer는 RANDAO(RANdom DAO)를 통해 결정된다. RANDAO는 모든 validator가 기여하는 의사난수 생성 메커니즘이다.</p><p>RANDAO 메커니즘은 다음과 같이 동작한다.</p><ol><li><strong>Reveal 포함:</strong> 각 proposer는 블록에 RANDAO reveal을 포함한다. reveal은 <code>BLS_sign(epoch, validator_private_key)</code>로 생성된다.</li><li><strong>Mix 계산:</strong> Epoch N의 mix는 이전 mix에 각 reveal의 해시를 XOR해 계산한다.<br><code>randao_mix[N] = randao_mix[N-1] XOR hash(reveal_0) XOR ... XOR hash(reveal_31)</code></li><li><strong>Proposer 선정:</strong> <code>seed = hash(randao_mix || slot)</code>을 만들고,<br><code>proposer_index = seed mod active_validator_count</code>로 선택한다.<br>실제로는 effective balance로 가중치가 적용된다.</li></ol><p>RANDAO는 완벽한 난수는 아니다. 마지막 proposer는 자신의 reveal을 공개할지 선택하여 결과에 약간의 영향을 줄 수 있다. 그러나 이 영향력은 제한적이며, 미래의 VDF(Verifiable Delay Function) 도입으로 해결될 예정이다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="블록-빌딩과-mev-boost">블록 빌딩과 MEV-Boost<a href="#블록-빌딩과-mev-boost" class="hash-link" aria-label="Direct link to 블록 빌딩과 MEV-Boost" title="Direct link to 블록 빌딩과 MEV-Boost">​</a></h3><p>proposer로 선정되면 블록을 구성해야 한다. 현재 대부분의 validator는 MEV-Boost를 통해 전문 블록 빌더에게 블록 구성을 위임한다.</p><p>MEV-Boost 유무에 따른 블록 빌딩 흐름은 다음과 같다.</p><ol><li><strong>MEV-Boost 없이 (로컬 빌딩)</strong><br>Validator(=Proposer)가 로컬 EL(txpool)에서 트랜잭션을 선택해 블록을 만들고 직접 제안한다.</li><li><strong>MEV-Boost 사용 (PBS)</strong><br>Searcher가 번들(bundles)을 만들고, Builder가 이를 조합해 블록을 구성한다.<br>Relay가 Builder의 블록을 중계하고, Validator는 가장 높은 bid를 선택해 서명/제안한다.</li></ol><p>PBS(Proposer-Builder Separation)의 역할은 다음과 같다.</p><ul><li><strong>Proposer:</strong> 최고 bid의 블록을 선택하고 서명</li><li><strong>Builder:</strong> MEV를 추출해 수익 최적화된 블록 구성</li><li><strong>Relay:</strong> Builder와 Proposer 사이의 신뢰 계층</li></ul><p>MEV-Boost는 약 90%의 이더리움 블록에서 사용된다. Proposer는 블록 내용을 모른 채(blind) 가장 높은 bid를 선택하고, 서명 후에야 블록 내용이 공개된다.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="증명-attestation">증명 (Attestation)<a href="#증명-attestation" class="hash-link" aria-label="Direct link to 증명 (Attestation)" title="Direct link to 증명 (Attestation)">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="attestation이란">Attestation이란<a href="#attestation이란" class="hash-link" aria-label="Direct link to Attestation이란" title="Direct link to Attestation이란">​</a></h3><p><strong>Attestation</strong>은 validator가 체인의 현재 상태에 대해 투표하는 것이다. 각 attestation은 세 가지 정보를 담는다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│                         Attestation Structure                           │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└─────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Attestation = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    slot:              투표 대상 slot,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    beacon_block_root: 체인의 head로 보는 블록 해시,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    source: {          Casper FFG source checkpoint</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      epoch:  N-1,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      root:   justified 블록 해시</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    target: {          Casper FFG target checkpoint</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      epoch:  N,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      root:   현재 epoch의 첫 slot 블록 해시</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    aggregation_bits:  committee 멤버 비트맵,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    signature:         BLS 서명</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Attestation의 세 가지 투표.</p><ol><li>Head vote (LMD-GHOST용): &quot;현재 체인의 head는 이 블록이다&quot;에 대한 투표</li><li>Source vote (Casper FFG용): &quot;이 source checkpoint가 이미 justified 상태다&quot;에 대한 투표</li><li>Target vote (Casper FFG용): &quot;이 target checkpoint를 다음으로 justify하자&quot;에 대한 투표</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="aggregation">Aggregation<a href="#aggregation" class="hash-link" aria-label="Direct link to Aggregation" title="Direct link to Aggregation">​</a></h3><p>수십만 개의 개별 attestation을 처리하는 것은 비효율적이다. 같은 내용에 투표한 attestation은 하나로 합쳐진다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│                        Attestation Aggregation                          │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└─────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Committee: [V0, V1, V2, V3, V4, V5, V6, V7]  (8명 예시)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  개별 Attestation:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    V0: sig_0, bits=[1,0,0,0,0,0,0,0]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    V1: sig_1, bits=[0,1,0,0,0,0,0,0]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    V3: sig_3, bits=[0,0,0,1,0,0,0,0]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    V5: sig_5, bits=[0,0,0,0,0,1,0,0]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    (같은 head, source, target에 투표한 경우)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Aggregated Attestation:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    aggregate_sig = BLS_aggregate(sig_0, sig_1, sig_3, sig_5)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    bits = [1,1,0,1,0,1,0,0]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>BLS 서명의 특성상 여러 서명을 하나로 합칠 수 있음</li><li>블록에 포함되는 데이터 양 대폭 감소</li><li>각 committee에서 16명의 aggregator가 선정됨</li></ul><p>BLS(Boneh-Lynn-Shacham) 서명은 aggregation이 가능한 서명 방식이다. 이 특성 덕분에 수십만 validator의 투표를 효율적으로 처리할 수 있다.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="fork-choice-lmd-ghost">Fork Choice: LMD-GHOST<a href="#fork-choice-lmd-ghost" class="hash-link" aria-label="Direct link to Fork Choice: LMD-GHOST" title="Direct link to Fork Choice: LMD-GHOST">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="lmd-ghost-알고리즘">LMD-GHOST 알고리즘<a href="#lmd-ghost-알고리즘" class="hash-link" aria-label="Direct link to LMD-GHOST 알고리즘" title="Direct link to LMD-GHOST 알고리즘">​</a></h3><p><strong>LMD-GHOST</strong>(Latest Message Driven Greedy Heaviest Observed SubTree)는 가장 많은 지지를 받은 fork를 선택하는 알고리즘이다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│                          LMD-GHOST Example                              │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└─────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  각 validator의 최신(Latest) attestation만 고려:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    Block A (genesis)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    weight: 100</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           ┌───────────┴───────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           │                       │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Block B                 Block C</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        weight: 60              weight: 40</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           │                       │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Block D                 Block E</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        weight: 55              weight: 35</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Block F</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        weight: 55</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Fork choice 과정:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  1. Root(A)에서 시작</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  2. 자식 중 weight가 높은 쪽 선택: B(60) &gt; C(40) → B 선택</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  3. B의 자식: D만 있음 → D 선택</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  4. D의 자식: F만 있음 → F 선택</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  5. Head = Block F</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;LMD&quot; = Latest Message Driven</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - 각 validator당 가장 최신 attestation만 카운트</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - 같은 validator의 이전 투표는 무시</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="greedy와-subtree">Greedy와 Subtree<a href="#greedy와-subtree" class="hash-link" aria-label="Direct link to Greedy와 Subtree" title="Direct link to Greedy와 Subtree">​</a></h3><p>&quot;Greedy&quot;는 매 단계에서 지역 최적을 선택한다는 의미이다. &quot;Subtree&quot;는 블록 자체뿐 아니라 그 하위의 모든 블록에 대한 투표를 합산한다는 의미이다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│                         Subtree Weight Calculation                      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└─────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Block B                           Block C</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           │                                 │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     ┌─────┴─────┐                     ┌─────┴─────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │           │                     │           │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Block D     Block E               Block F     Block G</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  votes:20    votes:15              votes:30    votes:10</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Block B의 subtree weight = votes(B) + votes(D) + votes(E)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                           = 25 + 20 + 15 = 60</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Block C의 subtree weight = votes(C) + votes(F) + votes(G)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                           = 5 + 30 + 10 = 45</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  → Block B의 subtree가 더 무거우므로 B 선택</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>정리하면, LMD-GHOST는 <strong>루트에서 시작해 각 단계마다 subtree weight가 가장 큰 자식으로 내려가며</strong> 더 이상 내려갈 수 없을 때의 블록을 <strong>head</strong>로 결정한다. 이 head가 현재 네트워크가 따라갈 체인의 끝이며, 다음 블록 제안과 attestation은 이 head를 기준으로 이루어진다.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="finality-casper-ffg">Finality: Casper FFG<a href="#finality-casper-ffg" class="hash-link" aria-label="Direct link to Finality: Casper FFG" title="Direct link to Finality: Casper FFG">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="checkpoint와-justification">Checkpoint와 Justification<a href="#checkpoint와-justification" class="hash-link" aria-label="Direct link to Checkpoint와 Justification" title="Direct link to Checkpoint와 Justification">​</a></h3><p>LMD-GHOST만으로는 finality가 없다. 새로운 attestation이 들어오면 fork choice가 바뀔 수 있다. <strong>Casper FFG</strong>는 checkpoint 기반의 finality를 제공한다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│                         Casper FFG Checkpoints                          │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└─────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Epoch N-2         Epoch N-1         Epoch N           Epoch N+1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ────┬─────────────────┬─────────────────┬─────────────────┬────</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │                 │                 │                 │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ▼                 ▼                 ▼                 ▼</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Checkpoint         Checkpoint       Checkpoint       Checkpoint</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   (block at         (block at        (block at        (block at</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    slot 0)           slot 0)          slot 0)          slot 0)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Checkpoint = 각 epoch의 첫 번째 slot에 있는 블록 (또는 가장 가까운 조상)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Justification:</strong> checkpoint가 총 스테이크의 2/3 이상의 지지를 받으면 &quot;justified&quot; 상태가 된다.</p><p><strong>Finalization:</strong> justified checkpoint가 다음 epoch에서도 2/3 이상의 지지를 받으면 &quot;finalized&quot; 상태가 된다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│                    Justification and Finalization                       │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└─────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Epoch N-2          Epoch N-1          Epoch N           Epoch N+1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                  │                  │                  │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     ▼                  ▼                  ▼                  ▼</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ┌──────┐          ┌──────┐          ┌──────┐          ┌──────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  │  CP  │──────────│  CP  │──────────│  CP  │──────────│  CP  │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  └──────┘  2/3+    └──────┘  2/3+    └──────┘  2/3+    └──────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  finalized ◄────── justified ◄────── justified         target</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Finality 달성 과정:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  1. Epoch N: CP(N-1)이 2/3 투표 → CP(N-1) justified</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  2. Epoch N+1: CP(N)이 2/3 투표 → CP(N) justified</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                  → CP(N-1) finalized!</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - Finalized 블록은 절대 되돌릴 수 없음</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - 되돌리려면 1/3 이상의 스테이크가 slashing 당해야 함</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - 일반적으로 2 epoch (약 13분) 후 finality 달성</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="gasper--lmd-ghost--casper-ffg">Gasper = LMD-GHOST + Casper FFG<a href="#gasper--lmd-ghost--casper-ffg" class="hash-link" aria-label="Direct link to Gasper = LMD-GHOST + Casper FFG" title="Direct link to Gasper = LMD-GHOST + Casper FFG">​</a></h3><p>이더리움의 합의 프로토콜은 <strong>Gasper</strong>라고 불린다. LMD-GHOST로 실시간 fork choice를 하고, Casper FFG(Friendly Finality Gadget)로 finality를 확보한다.</p><p>Gasper는 LMD-GHOST와 Casper FFG를 결합한 합의 구조이다.</p><ul><li><strong>LMD-GHOST (Fork Choice):</strong> 매 slot마다 head를 결정하며, 최신 attestation을 기반으로 빠른 블록 확인(optimistic confirmation)을 제공한다.</li><li><strong>Casper FFG (Finality):</strong> Epoch 경계에서 checkpoint를 finalize한다. 2/3 supermajority가 필요하며, 되돌릴 수 없는 확정성을 제공한다.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="finality-지연">Finality 지연<a href="#finality-지연" class="hash-link" aria-label="Direct link to Finality 지연" title="Direct link to Finality 지연">​</a></h3><p>네트워크 파티션이나 대규모 validator 오프라인 시 finality가 지연될 수 있다. 이 경우 <strong>inactivity leak</strong>이 발동한다.</p><ul><li>Finality가 4 epoch 이상 지연되면 Inactivity Leak가 발동한다.</li><li>오프라인 validator의 스테이크를 점진적으로 줄여 온라인 validator의 상대적 지분을 높인다.</li><li>결국 2/3 supermajority를 회복해 finality를 재개한다.</li><li>목적은 1/3 이상이 오프라인이어도 체인이 멈추지 않게 하고, 오프라인이 길어질수록 더 큰 페널티를 부과하는 데 있다.</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="slashing">Slashing<a href="#slashing" class="hash-link" aria-label="Direct link to Slashing" title="Direct link to Slashing">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="slashable-offense">Slashable Offense<a href="#slashable-offense" class="hash-link" aria-label="Direct link to Slashable Offense" title="Direct link to Slashable Offense">​</a></h3><p>validator가 프로토콜을 위반하면 스테이크의 일부가 소각된다. 이를 <strong>slashing</strong>이라고 한다.</p><ol><li><strong>Double Voting (Proposer):</strong> 같은 slot에 서로 다른 블록을 제안<ul><li>예: Slot 100에서 Block A와 Block B를 모두 서명</li></ul></li><li><strong>Double Voting (Attester):</strong> 같은 epoch에 서로 다른 target에 투표<ul><li>예: Attestation 1은 Checkpoint A, Attestation 2는 Checkpoint B</li></ul></li><li><strong>Surround Voting:</strong> 기존 투표를 시간 범위로 “감싸는” 투표<ul><li>예: (source=5, target=10) 이후 (source=4, target=11) 투표</li><li>또는 그 반대의 경우도 위반으로 간주</li></ul></li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="slashing-페널티">Slashing 페널티<a href="#slashing-페널티" class="hash-link" aria-label="Direct link to Slashing 페널티" title="Direct link to Slashing 페널티">​</a></h3><p>slashing 당한 validator는 세 가지 페널티를 받는다.</p><ol><li><strong>Initial Penalty (즉시)</strong><ul><li>유효 잔액의 1/32 소각</li><li>32 ETH 기준: ~1 ETH</li></ul></li><li><strong>Correlation Penalty (36일 후)</strong><ul><li>같은 기간 slashing된 다른 validator 수에 비례</li><li>최악의 경우 전체 잔액 소각 가능</li><li>공식: <code>(slashed_validators / total_validators) × 3 × balance</code></li></ul></li><li><strong>퇴출 지연</strong><ul><li>약 36일간 validator로 활동 불가</li><li>이 기간 동안 보상 없음, inactivity penalty 적용</li></ul></li></ol><p>Correlation Penalty의 의도는 다음과 같다.</p><ul><li>단일 실수: 작은 페널티</li><li>조직적 공격: 매우 큰 페널티</li><li>클라이언트 버그로 인한 대량 slashing도 큰 페널티 → 클라이언트 다양성 유도</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="whistleblower-보상">Whistleblower 보상<a href="#whistleblower-보상" class="hash-link" aria-label="Direct link to Whistleblower 보상" title="Direct link to Whistleblower 보상">​</a></h3><p>slashing 증거를 제출한 validator(whistleblower)는 보상을 받는다.</p><ul><li>slashed validator의 초기 페널티 중 일부</li><li>Proposer도 일부 보상 (블록에 slashing 포함)</li></ul><p>이 인센티브 구조로 네트워크가 위반 행위를 자체적으로 감시하고, 악의적 행위의 발각 확률을 증가시키는 효과를 얻을 수 있다.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="engine-api">Engine API<a href="#engine-api" class="hash-link" aria-label="Direct link to Engine API" title="Direct link to Engine API">​</a></h2><p><a href="/blockchain/how-ethereum-works/architecture-overview">첫 번째 글</a>에서 Engine API를 간략히 소개했다. 여기서는 합의 과정에서의 실제 통신 흐름을 살펴본다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="주요-메서드">주요 메서드<a href="#주요-메서드" class="hash-link" aria-label="Direct link to 주요 메서드" title="Direct link to 주요 메서드">​</a></h3><p>Engine API의 핵심 메서드는 다음과 같다.</p><ol><li><strong>engine_forkchoiceUpdatedV3</strong><br>CL → EL: &quot;현재 head/safe/finalized는 이것이다.&quot;<br>블록 빌딩을 요청할 때는 <code>payloadAttributes</code>(timestamp, prevRandao, feeRecipient, withdrawals 등)를 함께 보낸다.</li><li><strong>engine_getPayloadV3</strong><br>CL → EL: &quot;준비된 블록을 달라.&quot;<br>EL → CL: <code>ExecutionPayload</code>를 반환한다.</li><li><strong>engine_newPayloadV3</strong><br>CL → EL: &quot;이 블록을 검증해달라.&quot;<br>EL은 블록을 실행하고 <code>VALID/INVALID/SYNCING</code> 결과를 돌려준다.</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="블록-제안-시퀀스">블록 제안 시퀀스<a href="#블록-제안-시퀀스" class="hash-link" aria-label="Direct link to 블록 제안 시퀀스" title="Direct link to 블록 제안 시퀀스">​</a></h3><p>validator가 proposer로 선정되었을 때의 통신 흐름이다.</p><ol><li>CL이 <code>forkchoiceUpdated</code>를 보내고 <code>payloadAttributes</code>로 블록 빌딩을 요청한다.</li><li>EL이 블록 빌딩을 시작하고 <code>payloadId</code>를 반환한다.</li><li>CL이 <code>getPayload(payloadId)</code>를 호출해 <code>ExecutionPayload</code>를 받는다.</li><li>CL이 <code>ExecutionPayload</code>를 포함한 BeaconBlock을 구성한다.</li><li>블록을 서명하고 네트워크에 브로드캐스트한다.</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="블록-검증-시퀀스">블록 검증 시퀀스<a href="#블록-검증-시퀀스" class="hash-link" aria-label="Direct link to 블록 검증 시퀀스" title="Direct link to 블록 검증 시퀀스">​</a></h3><p>다른 validator가 제안한 블록을 받았을 때의 흐름이다.</p><ol><li>CL이 네트워크에서 새 블록을 받고 합의 레벨 검증(서명, slot, proposer 등)을 한다.</li><li>CL이 <code>newPayload(ExecutionPayload)</code>로 EL에 실행 검증을 요청한다.</li><li>EL이 트랜잭션 실행과 stateRoot 검증을 수행하고 <code>VALID/INVALID</code>를 반환한다.</li><li>CL이 <code>forkchoiceUpdated</code>로 새 head를 EL에 반영한다.</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="optimistic-sync">Optimistic Sync<a href="#optimistic-sync" class="hash-link" aria-label="Direct link to Optimistic Sync" title="Direct link to Optimistic Sync">​</a></h3><p>Execution Layer가 아직 동기화 중일 때, Consensus Layer는 <strong>optimistic sync</strong> 모드로 동작할 수 있다. EL 검증 없이 CL 합의를 따라가다가, EL 동기화가 완료되면 검증을 수행한다.</p><ul><li>CL이 EL보다 빠르게 동기화된다.</li><li>EL이 <code>SYNCING</code>을 반환하면 CL은 블록을 일단 수용한다.</li><li>해당 블록을 finalized로 취급하지는 않는다.</li><li>EL 동기화가 끝나면 전체 검증을 수행한다.</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="네트워크-업그레이드-히스토리">네트워크 업그레이드 히스토리<a href="#네트워크-업그레이드-히스토리" class="hash-link" aria-label="Direct link to 네트워크 업그레이드 히스토리" title="Direct link to 네트워크 업그레이드 히스토리">​</a></h2><p>이더리움은 정기적인 하드포크를 통해 프로토콜을 업그레이드해왔다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="주요-하드포크">주요 하드포크<a href="#주요-하드포크" class="hash-link" aria-label="Direct link to 주요 하드포크" title="Direct link to 주요 하드포크">​</a></h3><table><thead><tr><th>시기</th><th>업그레이드</th><th>주요 내용</th></tr></thead><tbody><tr><td>2015.07</td><td>Frontier</td><td>이더리움 메인넷 런칭</td></tr><tr><td>2016.03</td><td>Homestead</td><td>첫 번째 계획된 업그레이드</td></tr><tr><td>2016.07</td><td>DAO Fork</td><td>The DAO 해킹 대응 (논쟁적)</td></tr><tr><td>2017.10</td><td>Byzantium</td><td>zk-SNARKs 지원, 난이도 조정</td></tr><tr><td>2019.02</td><td>Constantinople</td><td>가스비 최적화, CREATE2</td></tr><tr><td>2019.12</td><td>Istanbul</td><td>CHAINID opcode, 가스비 조정</td></tr><tr><td>2021.04</td><td>Berlin</td><td>EIP-2929 (가스비 조정), EIP-2930 (Access List)</td></tr><tr><td>2021.08</td><td>London</td><td>EIP-1559 (수수료 메커니즘 개편)</td></tr><tr><td>2022.09</td><td>Paris (Merge)</td><td>PoW → PoS 전환</td></tr><tr><td>2023.04</td><td>Shanghai/Capella</td><td>Validator 출금 활성화</td></tr><tr><td>2024.03</td><td>Dencun</td><td>EIP-4844 (Blob transactions)</td></tr></tbody></table><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="eip-1559의-영향">EIP-1559의 영향<a href="#eip-1559의-영향" class="hash-link" aria-label="Direct link to EIP-1559의 영향" title="Direct link to EIP-1559의 영향">​</a></h3><p>London 업그레이드의 EIP-1559는 수수료 메커니즘을 근본적으로 바꿨다.</p><ul><li><strong>Before (First-price auction):</strong><ul><li>gasPrice를 높게 설정할수록 우선 처리</li><li>모든 수수료가 miner에게</li><li>가격 변동성 높음</li></ul></li><li><strong>After (EIP-1559):</strong><ul><li>baseFee: 프로토콜이 결정하고 소각</li><li>priorityFee: 사용자가 설정하고 validator에게 지급</li><li>baseFee가 블록 사용량에 따라 자동 조정</li><li>수수료 예측 용이, ETH 공급량 감소 효과</li></ul></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="향후-로드맵">향후 로드맵<a href="#향후-로드맵" class="hash-link" aria-label="Direct link to 향후 로드맵" title="Direct link to 향후 로드맵">​</a></h3><ul><li><strong>Pectra (2025년 5월 완료):</strong><ul><li>EIP-7702: EOA가 스마트 컨트랙트 코드를 임시 실행 가능</li><li>EIP-7251: MaxEB 증가 (32 ETH → 2048 ETH), validator 통합 가능</li><li>EIP-7691: Blob 처리량 2배 증가 (블록당 평균 3개 → 6개)</li></ul></li><li><strong>Fusaka (2025년 12월 완료):</strong><ul><li>PeerDAS: P2P 데이터 가용성 샘플링으로 Danksharding의 첫 단계 구현</li><li>블록 가스 한도 60M으로 증가, L2 수수료 40-60% 절감</li><li>EOF(EVM Object Format)는 복잡성 우려로 제외됨</li></ul></li><li><strong>Glamsterdam / Hegota (2026년 예정):</strong><ul><li>Glamsterdam: ePBS, access list 최적화, 가스 재조정</li><li>Hegota: Verkle Trees 도입으로 stateless client 가능</li><li>MPT → Verkle Trie 전환으로 상태 증명 크기 최대 90% 감소</li></ul></li><li><strong>Single Slot Finality (SSF):</strong><ul><li>현재: 2 epoch (~13분) finality</li><li>목표: 1 slot (12초) finality</li><li>기술적 도전 과제 다수</li></ul></li><li><strong>Danksharding:</strong><ul><li>EIP-4844의 완전한 형태</li><li>데이터 가용성 대폭 확장</li><li>L2 비용 추가 절감</li></ul></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="정리">정리<a href="#정리" class="hash-link" aria-label="Direct link to 정리" title="Direct link to 정리">​</a></h2><p>이 글에서는 이더리움의 합의 메커니즘을 살펴보았다.</p><ol><li><strong>PoW에서 PoS로:</strong> The Merge를 통해 에너지 효율적이고 경제적으로 안전한 합의 메커니즘으로 전환했다.</li><li><strong>Gasper 프로토콜:</strong> LMD-GHOST로 빠른 블록 확인을, Casper FFG로 결정론적 finality를 제공한다.</li><li><strong>Validator의 역할:</strong> 32 ETH를 스테이킹하고, 블록 제안과 attestation을 통해 네트워크 보안에 기여한다. 프로토콜 위반 시 slashing으로 경제적 페널티를 받는다.</li><li><strong>Engine API:</strong> Execution Layer와 Consensus Layer가 분리되어 통신하며, 이 구조가 클라이언트 다양성을 가능하게 한다.</li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="참조">참조<a href="#참조" class="hash-link" aria-label="Direct link to 참조" title="Direct link to 참조">​</a></h2><ul><li><a href="https://ethereum.org/developers/docs/consensus-mechanisms/pos/" target="_blank" rel="noopener noreferrer">Ethereum.org - Proof of Stake</a></li><li><a href="https://ethereum.org/roadmap/merge/" target="_blank" rel="noopener noreferrer">Ethereum.org - The Merge</a></li><li><a href="https://arxiv.org/abs/2003.03052" target="_blank" rel="noopener noreferrer">Gasper Paper (Combining GHOST and Casper)</a></li><li><a href="https://github.com/ethereum/consensus-specs" target="_blank" rel="noopener noreferrer">Ethereum Consensus Specs</a></li><li><a href="https://github.com/ethereum/execution-apis/tree/main/src/engine" target="_blank" rel="noopener noreferrer">Engine API Specification</a></li><li><a href="https://ethereum.org/developers/docs/consensus-mechanisms/pos/attestations/" target="_blank" rel="noopener noreferrer">Ethereum.org - Attestations</a></li><li><a href="https://ethereum.org/developers/docs/consensus-mechanisms/pos/rewards-and-penalties/" target="_blank" rel="noopener noreferrer">Ethereum.org - Rewards and Penalties</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/ethereum">Ethereum</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/consensus">Consensus</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blockchain/how-ethereum-works/block-execution-state"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">3. Block Execution and State Management</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#합의의-필요성" class="table-of-contents__link toc-highlight">합의의 필요성</a><ul><li><a href="#비잔틴-장애-허용-bft" class="table-of-contents__link toc-highlight">비잔틴 장애 허용 (BFT)</a></li><li><a href="#합의-메커니즘의-두-가지-역할" class="table-of-contents__link toc-highlight">합의 메커니즘의 두 가지 역할</a></li></ul></li><li><a href="#pow-the-merge-이전" class="table-of-contents__link toc-highlight">PoW: The Merge 이전</a><ul><li><a href="#ethash-알고리즘" class="table-of-contents__link toc-highlight">Ethash 알고리즘</a></li><li><a href="#난이도-조정" class="table-of-contents__link toc-highlight">난이도 조정</a></li><li><a href="#longest-chain-rule" class="table-of-contents__link toc-highlight">Longest Chain Rule</a></li><li><a href="#확률적-finality" class="table-of-contents__link toc-highlight">확률적 Finality</a></li><li><a href="#uncle-ommer-blocks" class="table-of-contents__link toc-highlight">Uncle (Ommer) Blocks</a></li></ul></li><li><a href="#pos로의-전환" class="table-of-contents__link toc-highlight">PoS로의 전환</a><ul><li><a href="#왜-pos인가" class="table-of-contents__link toc-highlight">왜 PoS인가?</a></li><li><a href="#the-merge" class="table-of-contents__link toc-highlight">The Merge</a></li></ul></li><li><a href="#validator" class="table-of-contents__link toc-highlight">Validator</a><ul><li><a href="#validator가-되는-방법" class="table-of-contents__link toc-highlight">Validator가 되는 방법</a></li><li><a href="#validator-상태-전이" class="table-of-contents__link toc-highlight">Validator 상태 전이</a></li><li><a href="#validator-책임과-보상" class="table-of-contents__link toc-highlight">Validator 책임과 보상</a></li></ul></li><li><a href="#시간-단위-slot과-epoch" class="table-of-contents__link toc-highlight">시간 단위: Slot과 Epoch</a><ul><li><a href="#slot" class="table-of-contents__link toc-highlight">Slot</a></li><li><a href="#epoch" class="table-of-contents__link toc-highlight">Epoch</a></li><li><a href="#committee" class="table-of-contents__link toc-highlight">Committee</a></li></ul></li><li><a href="#블록-제안-proposing" class="table-of-contents__link toc-highlight">블록 제안 (Proposing)</a><ul><li><a href="#proposer-선정" class="table-of-contents__link toc-highlight">Proposer 선정</a></li><li><a href="#블록-빌딩과-mev-boost" class="table-of-contents__link toc-highlight">블록 빌딩과 MEV-Boost</a></li></ul></li><li><a href="#증명-attestation" class="table-of-contents__link toc-highlight">증명 (Attestation)</a><ul><li><a href="#attestation이란" class="table-of-contents__link toc-highlight">Attestation이란</a></li><li><a href="#aggregation" class="table-of-contents__link toc-highlight">Aggregation</a></li></ul></li><li><a href="#fork-choice-lmd-ghost" class="table-of-contents__link toc-highlight">Fork Choice: LMD-GHOST</a><ul><li><a href="#lmd-ghost-알고리즘" class="table-of-contents__link toc-highlight">LMD-GHOST 알고리즘</a></li><li><a href="#greedy와-subtree" class="table-of-contents__link toc-highlight">Greedy와 Subtree</a></li></ul></li><li><a href="#finality-casper-ffg" class="table-of-contents__link toc-highlight">Finality: Casper FFG</a><ul><li><a href="#checkpoint와-justification" class="table-of-contents__link toc-highlight">Checkpoint와 Justification</a></li><li><a href="#gasper--lmd-ghost--casper-ffg" class="table-of-contents__link toc-highlight">Gasper = LMD-GHOST + Casper FFG</a></li><li><a href="#finality-지연" class="table-of-contents__link toc-highlight">Finality 지연</a></li></ul></li><li><a href="#slashing" class="table-of-contents__link toc-highlight">Slashing</a><ul><li><a href="#slashable-offense" class="table-of-contents__link toc-highlight">Slashable Offense</a></li><li><a href="#slashing-페널티" class="table-of-contents__link toc-highlight">Slashing 페널티</a></li><li><a href="#whistleblower-보상" class="table-of-contents__link toc-highlight">Whistleblower 보상</a></li></ul></li><li><a href="#engine-api" class="table-of-contents__link toc-highlight">Engine API</a><ul><li><a href="#주요-메서드" class="table-of-contents__link toc-highlight">주요 메서드</a></li><li><a href="#블록-제안-시퀀스" class="table-of-contents__link toc-highlight">블록 제안 시퀀스</a></li><li><a href="#블록-검증-시퀀스" class="table-of-contents__link toc-highlight">블록 검증 시퀀스</a></li><li><a href="#optimistic-sync" class="table-of-contents__link toc-highlight">Optimistic Sync</a></li></ul></li><li><a href="#네트워크-업그레이드-히스토리" class="table-of-contents__link toc-highlight">네트워크 업그레이드 히스토리</a><ul><li><a href="#주요-하드포크" class="table-of-contents__link toc-highlight">주요 하드포크</a></li><li><a href="#eip-1559의-영향" class="table-of-contents__link toc-highlight">EIP-1559의 영향</a></li><li><a href="#향후-로드맵" class="table-of-contents__link toc-highlight">향후 로드맵</a></li></ul></li><li><a href="#정리" class="table-of-contents__link toc-highlight">정리</a></li><li><a href="#참조" class="table-of-contents__link toc-highlight">참조</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.5eace082.js"></script>
<script src="/assets/js/main.4ff0f8e6.js"></script>
</body>
</html>