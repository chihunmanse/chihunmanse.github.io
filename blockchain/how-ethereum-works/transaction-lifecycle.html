<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-blockchain/how-ethereum-works/transaction-lifecycle">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">2. Transaction Lifecycle | Chihun&#x27;s Dev Blog</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://chihunmanse.github.io/img/m.png"><meta data-rh="true" name="twitter:image" content="https://chihunmanse.github.io/img/m.png"><meta data-rh="true" property="og:url" content="https://chihunmanse.github.io/blockchain/how-ethereum-works/transaction-lifecycle"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="2. Transaction Lifecycle | Chihun&#x27;s Dev Blog"><meta data-rh="true" name="description" content="How Ethereum transactions are created, signed, encoded with RLP, and propagated through the P2P network to the mempool"><meta data-rh="true" property="og:description" content="How Ethereum transactions are created, signed, encoded with RLP, and propagated through the P2P network to the mempool"><meta data-rh="true" name="keywords" content="Ethereum,geth,transaction,ECDSA,RLP,devp2p,mempool,txpool,EIP-1559,EIP-4844"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://chihunmanse.github.io/blockchain/how-ethereum-works/transaction-lifecycle"><link data-rh="true" rel="alternate" href="https://chihunmanse.github.io/blockchain/how-ethereum-works/transaction-lifecycle" hreflang="en"><link data-rh="true" rel="alternate" href="https://chihunmanse.github.io/blockchain/how-ethereum-works/transaction-lifecycle" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.5b6de4da.css">
<link rel="preload" href="/assets/js/runtime~main.5eace082.js" as="script">
<link rel="preload" href="/assets/js/main.4ff0f8e6.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">Chihun&#x27;s Dev Blog</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/tags">Tags</a><a href="https://github.com/chihunmanse" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><b>Chihun&#x27;s Dev Blog</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Home</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/datastructure-algorithm">DataStructure &amp; Algorithm</a><button aria-label="Toggle the collapsible sidebar category &#x27;DataStructure &amp; Algorithm&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/backend">Backend</a><button aria-label="Toggle the collapsible sidebar category &#x27;Backend&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/devops">DevOps</a><button aria-label="Toggle the collapsible sidebar category &#x27;DevOps&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/blockchain">BlockChain</a><button aria-label="Toggle the collapsible sidebar category &#x27;BlockChain&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/blockchain/upgradeable-contract">Upgradeable Contract</a><button aria-label="Toggle the collapsible sidebar category &#x27;Upgradeable Contract&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blockchain/contract-error-handling">Contract Error Handling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blockchain/storage-layout">Solidity Storage Layout</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/blockchain/defi">DeFi</a><button aria-label="Toggle the collapsible sidebar category &#x27;DeFi&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/blockchain/cryptography">Cryptography</a><button aria-label="Toggle the collapsible sidebar category &#x27;Cryptography&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/blockchain/how-ethereum-works">How Ethereum Works</a><button aria-label="Toggle the collapsible sidebar category &#x27;How Ethereum Works&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/blockchain/how-ethereum-works/architecture-overview">1. Ethereum Architecture Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/blockchain/how-ethereum-works/transaction-lifecycle">2. Transaction Lifecycle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/blockchain/how-ethereum-works/block-execution-state">3. Block Execution and State Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/blockchain/how-ethereum-works/consensus-finality">4. Consensus and Finality</a></li></ul></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/blockchain"><span itemprop="name">BlockChain</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/blockchain/how-ethereum-works"><span itemprop="name">How Ethereum Works</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">2. Transaction Lifecycle</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>2. Transaction Lifecycle</h1><p>사용자가 지갑에서 &quot;전송&quot; 버튼을 누르면, 트랜잭션이 생성되어 블록에 포함되기까지 여러 단계를 거친다. 이 글에서는 트랜잭션의 구조, 서명 과정, 직렬화, 네트워크 전파, 그리고 mempool의 동작 원리를 살펴본다.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="트랜잭션의-여정">트랜잭션의 여정<a href="#트랜잭션의-여정" class="hash-link" aria-label="Direct link to 트랜잭션의 여정" title="Direct link to 트랜잭션의 여정">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌──────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│                          Transaction Lifecycle                           │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└──────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌──────────────────────┐  ┌──────────────────────┐  ┌──────────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│      User Wallet     │  │     P2P Network      │  │       Mempool        │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├──────────────────────┤  ├──────────────────────┤  ├──────────────────────┤</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│ 1. Create            │  │ 4. Broadcast         │  │ 5. Validate &amp; Store  │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│ 2. Sign (ECDSA)      │  │ (gossip)             │  │ pending / queued     │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│ 3. Serialize (RLP)   │  │ Node A -&gt; B -&gt; C     │  │                      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│                      │  │ ...  ...  ...        │  │                      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└──────────────────────┘  └──────────────────────┘  └──────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>사용자가 트랜잭션을 생성하면, 지갑은 다음 과정을 거친다.</p><ol><li><strong>트랜잭션 생성:</strong> nonce, gas, to, value, data 등 필드 설정</li><li><strong>서명:</strong> ECDSA로 트랜잭션에 서명하여 소유권 증명</li><li><strong>직렬화:</strong> RLP 인코딩으로 바이트 배열 생성</li><li><strong>전파:</strong> P2P 네트워크를 통해 노드들에게 gossip</li><li><strong>저장:</strong> 각 노드의 mempool에 저장되어 블록 포함 대기</li></ol><p>이 과정을 이해하면 트랜잭션 실패 원인 분석, 가스 최적화, MEV 이해에 도움이 된다.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="트랜잭션-유형">트랜잭션 유형<a href="#트랜잭션-유형" class="hash-link" aria-label="Direct link to 트랜잭션 유형" title="Direct link to 트랜잭션 유형">​</a></h2><p>이더리움은 EIP-2718(Typed Transaction Envelope) 도입 이후 여러 트랜잭션 유형을 지원한다. 각 유형은 첫 번째 바이트로 구분된다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="type-0-legacy-transaction">Type 0: Legacy Transaction<a href="#type-0-legacy-transaction" class="hash-link" aria-label="Direct link to Type 0: Legacy Transaction" title="Direct link to Type 0: Legacy Transaction">​</a></h3><p>이더리움 초기부터 사용된 기본 형태이다. EIP-155 이전에는 replay attack에 취약했으나, chain ID 도입으로 해결되었다.</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">scripts/ethereum/transaction-types.ts</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> tx</span><span class="token operator">:</span><span class="token plain"> ethers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">TransactionRequest </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  to</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x70997970C51812dc3A010C7d01b50e0d17dc79C8&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  value</span><span class="token operator">:</span><span class="token plain"> ethers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">parseEther</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0.1&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  nonce</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  gasLimit</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">21000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  gasPrice</span><span class="token operator">:</span><span class="token plain"> ethers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">parseUnits</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;20&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;gwei&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  chainId</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// Mainnet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  data</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Legacy 트랜잭션의 가스 가격은 <code>gasPrice</code> 하나로 결정된다. 네트워크가 혼잡해지면 가스 가격을 높여 경쟁해야 했고, 이는 가격 변동성을 키웠다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="type-2-eip-1559-transaction">Type 2: EIP-1559 Transaction<a href="#type-2-eip-1559-transaction" class="hash-link" aria-label="Direct link to Type 2: EIP-1559 Transaction" title="Direct link to Type 2: EIP-1559 Transaction">​</a></h3><p>2021년 London 업그레이드에서 도입된 현재 표준 형식이다. 가스비를 <code>baseFee</code>와 <code>priorityFee</code>로 분리하여 수수료 예측성을 높였다.</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">scripts/ethereum/transaction-types.ts</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> tx</span><span class="token operator">:</span><span class="token plain"> ethers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">TransactionRequest </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  to</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x70997970C51812dc3A010C7d01b50e0d17dc79C8&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  value</span><span class="token operator">:</span><span class="token plain"> ethers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">parseEther</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0.1&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  nonce</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  gasLimit</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">21000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  maxFeePerGas</span><span class="token operator">:</span><span class="token plain"> ethers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">parseUnits</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;30&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;gwei&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  maxPriorityFeePerGas</span><span class="token operator">:</span><span class="token plain"> ethers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">parseUnits</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;2&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;gwei&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  chainId</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  data</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>가스비는 다음과 같이 계산된다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">effectiveFee = min(maxFeePerGas, baseFee + maxPriorityFeePerGas)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>예를 들어 <code>maxFeePerGas</code>가 30 gwei, <code>maxPriorityFeePerGas</code>가 2 gwei이고 현재 <code>baseFee</code>가 15 gwei라면, 실제 지불 가스비는 min(30, 15 + 2) = 17 gwei이다. 이 중 baseFee(15 gwei)는 소각되고, priorityFee(2 gwei)는 validator에게 지급된다.</p><p><code>maxFeePerGas</code>는 지불할 의사가 있는 최대 금액이므로, baseFee가 갑자기 올라도 트랜잭션이 실패하지 않는다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="type-1-access-list-transaction">Type 1: Access List Transaction<a href="#type-1-access-list-transaction" class="hash-link" aria-label="Direct link to Type 1: Access List Transaction" title="Direct link to Type 1: Access List Transaction">​</a></h3><p>EIP-2930에서 도입된 형식으로, 접근할 스토리지 슬롯을 미리 선언하여 가스를 절약할 수 있다.</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">scripts/ethereum/transaction-types.ts</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> tx</span><span class="token operator">:</span><span class="token plain"> ethers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">TransactionRequest </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  to</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x70997970C51812dc3A010C7d01b50e0d17dc79C8&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  value</span><span class="token operator">:</span><span class="token plain"> ethers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">parseEther</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0.1&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  nonce</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  gasLimit</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">50000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  gasPrice</span><span class="token operator">:</span><span class="token plain"> ethers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">parseUnits</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;20&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;gwei&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  chainId</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  accessList</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      address</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// WETH</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      storageKeys</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x0000000000000000000000000000000000000000000000000000000000000001&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>EIP-2929 이후 cold storage access(처음 접근)는 2100 gas, warm access(이미 접근한 슬롯)는 100 gas가 든다. access list에 미리 선언하면 cold access 비용을 줄일 수 있다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="type-3-blob-transaction-eip-4844">Type 3: Blob Transaction (EIP-4844)<a href="#type-3-blob-transaction-eip-4844" class="hash-link" aria-label="Direct link to Type 3: Blob Transaction (EIP-4844)" title="Direct link to Type 3: Blob Transaction (EIP-4844)">​</a></h3><p>2024년 Dencun 업그레이드에서 도입된 blob 트랜잭션은 L2 롤업의 데이터 가용성 비용을 획기적으로 낮춘다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Blob Transaction Fields:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - type: 3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - chainId, nonce, to, value, data (EIP-1559와 동일)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - maxFeePerGas, maxPriorityFeePerGas (EIP-1559와 동일)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - maxFeePerBlobGas: blob 공간에 대한 최대 수수료</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - blobVersionedHashes: blob 데이터에 대한 commitment</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Blob Specifications:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - 각 blob: 4096 field elements × 32 bytes = 128 KiB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - 트랜잭션당 최대 6개 blob</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - 블록당 목표 3개 blob</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - blob 데이터는 약 18일 후 pruning</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Blob은 별도의 가스 시장을 갖는다. calldata로 데이터를 올리는 것보다 10~100배 저렴하여, Dencun 업그레이드 이후 Base, Arbitrum 등 L2의 수수료가 크게 낮아졌다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="트랜잭션-유형-비교">트랜잭션 유형 비교<a href="#트랜잭션-유형-비교" class="hash-link" aria-label="Direct link to 트랜잭션 유형 비교" title="Direct link to 트랜잭션 유형 비교">​</a></h3><table><thead><tr><th>Type</th><th>이름</th><th>가스 필드</th><th>용도</th></tr></thead><tbody><tr><td>0</td><td>Legacy</td><td>gasPrice</td><td>기본 전송</td></tr><tr><td>1</td><td>Access List</td><td>gasPrice + accessList</td><td>스토리지 접근 최적화</td></tr><tr><td>2</td><td>EIP-1559</td><td>maxFee + maxPriorityFee</td><td>현재 표준</td></tr><tr><td>3</td><td>Blob</td><td>EIP-1559 + maxFeePerBlobGas</td><td>L2 데이터 포스팅</td></tr></tbody></table><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="트랜잭션-서명">트랜잭션 서명<a href="#트랜잭션-서명" class="hash-link" aria-label="Direct link to 트랜잭션 서명" title="Direct link to 트랜잭션 서명">​</a></h2><p>트랜잭션 서명은 &quot;이 트랜잭션이 해당 주소의 소유자가 보낸 것&quot;임을 증명한다. 이더리움은 secp256k1 곡선 위에서 ECDSA(Elliptic Curve Digital Signature Algorithm)를 사용한다.</p><p>ECDSA의 수학적 원리는 <a href="/blockchain/cryptography/ecdsa">이전 글</a>에서 자세히 다뤘으므로, 여기서는 트랜잭션 맥락에서의 서명 과정에 집중한다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="서명-과정">서명 과정<a href="#서명-과정" class="hash-link" aria-label="Direct link to 서명 과정" title="Direct link to 서명 과정">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌───────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│                         Transaction Signing Process                       │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└───────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Step 1: Create Unsigned Transaction</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ┌────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  │ { chainId, nonce, maxPriorityFee,      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  │   maxFee, gasLimit, to, value, data,   │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  │   accessList }                         │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  └────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    ▼</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Step 2: Serialize &amp; Hash</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ┌────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  │ 0x02 || RLP([chainId, nonce, ...])     │ ─► keccak256 ─► Message Hash</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  └────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    ▼</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Step 3: ECDSA Sign</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ┌────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  │ sign(messageHash, privateKey)          │ ─► (v, r, s)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  └────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    ▼</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Step 4: Append Signature</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ┌────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  │ 0x02 || RLP([chainId, nonce, ...,      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  │              v, r, s])                 │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  └────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">scripts/ethereum/transaction-signing.ts</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// Create unsigned transaction</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> tx</span><span class="token operator">:</span><span class="token plain"> ethers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">TransactionRequest </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  to</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x70997970C51812dc3A010C7d01b50e0d17dc79C8&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  value</span><span class="token operator">:</span><span class="token plain"> ethers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">parseEther</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;1.0&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  nonce</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  gasLimit</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">21000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  maxFeePerGas</span><span class="token operator">:</span><span class="token plain"> ethers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">parseUnits</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;30&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;gwei&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  maxPriorityFeePerGas</span><span class="token operator">:</span><span class="token plain"> ethers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">parseUnits</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;2&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;gwei&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  chainId</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Sign the transaction</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> signedTx </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> wallet</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">signTransaction</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">tx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> parsed </span><span class="token operator">=</span><span class="token plain"> Transaction</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">from</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">signedTx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">Message Hash: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">${</span><span class="token template-string interpolation">parsed</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token template-string interpolation">unsignedHash</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// 0x92f8ea6d20e4198bca291b89f9aa67f52672bdba5a4d5017f83d96c93bdcfd5d</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> sig </span><span class="token operator">=</span><span class="token plain"> parsed</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">signature</span><span class="token operator">!</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">r: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">${</span><span class="token template-string interpolation">sig</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token template-string interpolation">r</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// 0xbd2ca7c862745e82596cacce0cfa91ae48aacf42672ee780de717878f8e93288</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">s: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">${</span><span class="token template-string interpolation">sig</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token template-string interpolation">s</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// 0x7ce519725313b047715c1d1dfa53a02c1210ff7402e7ea2d0cb5a4c80a47adba</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">v: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">${</span><span class="token template-string interpolation">sig</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token template-string interpolation">v</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// 28</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="v-r-s의-의미">v, r, s의 의미<a href="#v-r-s의-의미" class="hash-link" aria-label="Direct link to v, r, s의 의미" title="Direct link to v, r, s의 의미">​</a></h3><ul><li><strong>r:</strong> ECDSA 서명 과정에서 생성된 임의의 점 R의 x 좌표</li><li><strong>s:</strong> 서명 증명값 = k⁻¹ × (messageHash + r × privateKey) mod n</li><li><strong>v:</strong> recovery id (0 또는 1) + offset. 공개키 복구에 사용</li></ul><p>v 값은 트랜잭션 유형에 따라 다르게 해석된다.</p><ul><li>Legacy (pre-EIP-155): v = 27 또는 28</li><li>Legacy (EIP-155): v = chainId × 2 + 35 또는 36</li><li>EIP-1559: v = 0 또는 1 (yParity)</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="sender-복구-ecrecover">Sender 복구 (ecrecover)<a href="#sender-복구-ecrecover" class="hash-link" aria-label="Direct link to Sender 복구 (ecrecover)" title="Direct link to Sender 복구 (ecrecover)">​</a></h3><p>트랜잭션에는 <code>from</code> 필드가 없다. 대신 노드는 서명(v, r, s)과 메시지 해시로부터 sender 주소를 <strong>복구</strong>한다.</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">scripts/ethereum/transaction-signing.ts</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> messageHash </span><span class="token operator">=</span><span class="token plain"> parsed</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">unsignedHash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> signature </span><span class="token operator">=</span><span class="token plain"> parsed</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">signature</span><span class="token operator">!</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Recover sender address from signature</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> recoveredAddress </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">recoverAddress</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">messageHash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> signature</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">Original Address:  </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">${</span><span class="token template-string interpolation">wallet</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token template-string interpolation">address</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">Recovered Address: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">${</span><span class="token template-string interpolation">recoveredAddress</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">Match: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">${</span><span class="token template-string interpolation">wallet</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token template-string interpolation">address</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token template-string interpolation function" style="color:rgb(80, 250, 123)">toLowerCase</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation operator">===</span><span class="token template-string interpolation"> recoveredAddress</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token template-string interpolation function" style="color:rgb(80, 250, 123)">toLowerCase</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>이것이 가능한 이유는 ECDSA의 수학적 특성 때문이다. v 값을 이용해 두 개의 가능한 공개키 중 올바른 것을 선택하고, r과 s로부터 공개키를 역산한다. 공개키가 복구되면 keccak256 해시의 마지막 20바이트로 주소를 도출한다.</p><p>이 매커니즘을 통해 트랜잭션 크기가 줄어들고(from 필드 불필요), 개인키를 공개하지 않고도 소유권을 증명할 수 있으며, 누구나 트랜잭션의 sender를 검증할 수 있다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="chain-id와-replay-protection">Chain ID와 Replay Protection<a href="#chain-id와-replay-protection" class="hash-link" aria-label="Direct link to Chain ID와 Replay Protection" title="Direct link to Chain ID와 Replay Protection">​</a></h3><p>EIP-155 이전에는 같은 서명이 모든 체인에서 유효했다. 이는 replay attack의 위험을 만들었다. 예를 들어 메인넷에서 전송한 트랜잭션을 공격자가 테스트넷이나 다른 EVM 체인에서 재사용할 수 있었다.</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">scripts/ethereum/transaction-signing.ts</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// Sign same transaction for different chains</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> mainnetTx </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> wallet</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">signTransaction</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token operator">...</span><span class="token plain">baseTx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> chainId</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> sepoliaTx </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> wallet</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">signTransaction</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token operator">...</span><span class="token plain">baseTx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> chainId</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">11155111</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> mainnetParsed </span><span class="token operator">=</span><span class="token plain"> Transaction</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">from</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">mainnetTx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> sepoliaParsed </span><span class="token operator">=</span><span class="token plain"> Transaction</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">from</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">sepoliaTx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Mainnet (chainId: 1):&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">  Unsigned Hash: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">${</span><span class="token template-string interpolation">mainnetParsed</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token template-string interpolation">unsignedHash</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// 0x92f8ea6d20e4198bca291b89f9aa67f52672bdba5a4d5017f83d96c93bdcfd5d</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Sepolia (chainId: 11155111):&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">  Unsigned Hash: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">${</span><span class="token template-string interpolation">sepoliaParsed</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token template-string interpolation">unsignedHash</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// 0x2771327e597d921836ccc0363a72a1540fdf005ca6f707608e53cfba28428618</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>동일한 트랜잭션 내용이라도 chain ID가 다르면 메시지 해시가 달라진다. 따라서 서명도 완전히 달라지며, 한 체인의 서명은 다른 체인에서 무효하다.</p><p><strong>주요 Chain ID</strong></p><table><thead><tr><th>네트워크</th><th>Chain ID</th></tr></thead><tbody><tr><td>Mainnet</td><td>1</td></tr><tr><td>Sepolia</td><td>11155111</td></tr><tr><td>Arbitrum One</td><td>42161</td></tr><tr><td>Optimism</td><td>10</td></tr><tr><td>Base</td><td>8453</td></tr><tr><td>Polygon</td><td>137</td></tr></tbody></table><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="rlp-인코딩">RLP 인코딩<a href="#rlp-인코딩" class="hash-link" aria-label="Direct link to RLP 인코딩" title="Direct link to RLP 인코딩">​</a></h2><p>RLP(Recursive Length Prefix)는 이더리움이 데이터를 직렬화하는 표준 방식이다. 트랜잭션, 블록 헤더, 계정 상태, 머클 트라이 노드 등 Execution Layer의 거의 모든 데이터가 RLP로 인코딩된다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="rlp의-설계-원칙">RLP의 설계 원칙<a href="#rlp의-설계-원칙" class="hash-link" aria-label="Direct link to RLP의 설계 원칙" title="Direct link to RLP의 설계 원칙">​</a></h3><p>RLP는 의도적으로 단순하게 설계되었다.</p><ul><li><strong>두 가지 데이터 타입만 존재:</strong> 바이트 배열(string)과 리스트</li><li><strong>타입 정보 없음:</strong> 숫자인지 문자열인지 주소인지 구분하지 않음</li><li><strong>결정론적:</strong> 동일한 입력은 항상 동일한 출력</li><li><strong>컴팩트:</strong> 작은 데이터에 대한 오버헤드 최소화</li></ul><p>타입 정보가 없다는 것은 &quot;0x1234&quot;가 숫자 4660인지 바이트 배열 <!-- -->[0x12, 0x34]<!-- -->인지 RLP만 봐서는 알 수 없다는 의미이다. 해석은 애플리케이션(이더리움 프로토콜)이 담당한다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="인코딩-규칙">인코딩 규칙<a href="#인코딩-규칙" class="hash-link" aria-label="Direct link to 인코딩 규칙" title="Direct link to 인코딩 규칙">​</a></h3><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">scripts/ethereum/rlp-encoding.ts</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> encodeRlp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> decodeRlp </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;ethers&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Rule 1: Single byte [0x00, 0x7f] → itself</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// 0x42 encodes to 0x42</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Rule 2: String 0-55 bytes → 0x80 + length + string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> shortString </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;hello&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// 5 bytes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Prefix: 0x85 (0x80 + 5)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Output: 0x8568656c6c6f</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Rule 3: String &gt; 55 bytes → 0xb7 + len(length) + length + string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> longString </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;a&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">repeat</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Prefix: 0xb8 (0xb7 + 1), then 0x64 (100)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Output: 0xb864616161...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Rule 4: List 0-55 bytes payload → 0xc0 + payload length + items</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> list </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;cat&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;dog&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Payload: 0x83&quot;cat&quot; + 0x83&quot;dog&quot; = 8 bytes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Prefix: 0xc8 (0xc0 + 8)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Output: 0xc88363617483646f67</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Rule 5: List &gt; 55 bytes payload → 0xf7 + len(length) + length + items</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th>Prefix Range</th><th>타입</th><th>설명</th></tr></thead><tbody><tr><td>[0x00, 0x7f]</td><td>단일 바이트</td><td>자기 자신이 인코딩</td></tr><tr><td>[0x80, 0xb7]</td><td>문자열 (0-55 bytes)</td><td>0x80 + 길이</td></tr><tr><td>[0xb8, 0xbf]</td><td>문자열 (&gt;55 bytes)</td><td>0xb7 + 길이의길이 + 길이</td></tr><tr><td>[0xc0, 0xf7]</td><td>리스트 (0-55 bytes)</td><td>0xc0 + 페이로드길이</td></tr><tr><td>[0xf8, 0xff]</td><td>리스트 (&gt;55 bytes)</td><td>0xf7 + 길이의길이 + 길이</td></tr></tbody></table><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="트랜잭션-rlp-구조">트랜잭션 RLP 구조<a href="#트랜잭션-rlp-구조" class="hash-link" aria-label="Direct link to 트랜잭션 RLP 구조" title="Direct link to 트랜잭션 RLP 구조">​</a></h3><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Legacy (Type 0)</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">EIP-1559 (Type 2)</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">RLP([nonce, gasPrice, gasLimit, to, value, data, v, r, s])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">0x02 || RLP([chainId, nonce, maxPriorityFeePerGas, maxFeePerGas,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             gasLimit, to, value, data, accessList, v, r, s])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><p>EIP-1559 이후 트랜잭션은 타입 바이트(0x02)가 앞에 붙고, 그 뒤에 RLP 인코딩된 필드들이 온다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="raw-transaction-파싱">Raw Transaction 파싱<a href="#raw-transaction-파싱" class="hash-link" aria-label="Direct link to Raw Transaction 파싱" title="Direct link to Raw Transaction 파싱">​</a></h3><p>서명된 raw transaction을 분해하면 다음과 같다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Raw: 0x02f873010184773594008506fc23ac008252089470997970...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Breakdown:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  0x02          - Type 2 (EIP-1559)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  f873          - RLP list prefix (0xf8 + 0x73 bytes)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  01            - chainId (1)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  01            - nonce (1)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  84 77359400   - maxPriorityFeePerGas (2 gwei)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  85 06fc23ac00 - maxFeePerGas (30 gwei)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  82 5208       - gasLimit (21000)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  94 70997970...  - to address (20 bytes)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  88 0de0b6b3... - value</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  80            - data (empty)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  c0            - accessList (empty list)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  01            - v (yParity)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  a0 bd2ca7c8...  - r (32 bytes)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  a0 7ce51972...  - s (32 bytes)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Consensus Layer는 SSZ를 사용한다</div><div class="admonitionContent_S0QG"><p>RLP는 Execution Layer의 표준이다. <a href="/blockchain/how-ethereum-works/architecture-overview">이전 글</a>에서 설명했듯이 Consensus Layer는 별도의 직렬화 포맷인 SSZ(Simple Serialize)를 사용한다. SSZ는 고정 크기 타입을 지원하고 머클화(merkleization)에 최적화되어 있어 라이트 클라이언트 증명에 유리하다.</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="p2p-네트워크와-전파">P2P 네트워크와 전파<a href="#p2p-네트워크와-전파" class="hash-link" aria-label="Direct link to P2P 네트워크와 전파" title="Direct link to P2P 네트워크와 전파">​</a></h2><p>서명되고 직렬화된 트랜잭션은 네트워크로 전파되어야 한다. 이더리움의 P2P 네트워크는 devp2p 프로토콜을 기반으로 한다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="네트워크-아키텍처">네트워크 아키텍처<a href="#네트워크-아키텍처" class="hash-link" aria-label="Direct link to 네트워크 아키텍처" title="Direct link to 네트워크 아키텍처">​</a></h3><p><a href="/blockchain/how-ethereum-works/architecture-overview">이전 글</a>에서 설명했듯이, 이더리움 노드는 두 개의 독립적인 P2P 네트워크를 운영한다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌───────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│                           Ethereum P2P Networks                           │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├───────────────────────────────────┬───────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│        Execution Layer P2P        │        Consensus Layer P2P            │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├───────────────────────────────────┼───────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│  Protocol: devp2p (eth/68)        │  Protocol: libp2p                     │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│  Transport: TCP                   │  Transport: TCP                       │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│  Discovery: discv4/discv5         │  Discovery: discv5                    │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│                                   │                                       │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│  Messages:                        │  Topics:                              │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│  - Transactions                   │  - beacon_block                       │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│  - Block headers/bodies           │  - beacon_aggregate_and_proof         │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│  - State data (snap sync)         │  - voluntary_exit                     │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│                                   │  - proposer_slashing                  │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│                                   │  - attester_slashing                  │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└───────────────────────────────────┴───────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>트랜잭션 전파는 Execution Layer P2P 네트워크에서 일어난다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="노드-발견-discovery">노드 발견 (Discovery)<a href="#노드-발견-discovery" class="hash-link" aria-label="Direct link to 노드 발견 (Discovery)" title="Direct link to 노드 발견 (Discovery)">​</a></h3><p>새 노드가 네트워크에 참여하려면 먼저 다른 노드들을 찾아야 한다. 이더리움은 discv5 프로토콜을 사용한다.</p><ol><li><strong>Bootstrap nodes:</strong> 하드코딩된 초기 노드 목록으로 시작</li><li><strong>Kademlia DHT:</strong> 노드 ID 기반 분산 해시 테이블로 피어 탐색</li><li><strong>ENR (Ethereum Node Records):</strong> 노드의 공개키, IP, 포트, 지원 프로토콜 등 메타데이터</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="트랜잭션-gossip">트랜잭션 Gossip<a href="#트랜잭션-gossip" class="hash-link" aria-label="Direct link to 트랜잭션 Gossip" title="Direct link to 트랜잭션 Gossip">​</a></h3><p>트랜잭션은 gossip 프로토콜로 전파된다. 한 노드가 트랜잭션을 받으면 연결된 피어들에게 전달하고, 이 과정이 반복되어 네트워크 전체로 퍼진다.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="전파-흐름">전파 흐름<a href="#전파-흐름" class="hash-link" aria-label="Direct link to 전파 흐름" title="Direct link to 전파 흐름">​</a></h4><ol><li>사용자는 지갑에서 트랜잭션을 만들고, 보통 로컬 노드(JSON-RPC)로 전송한다.</li><li>노드는 기본 검증을 수행한 뒤 txpool에 넣고, 피어들에게 <strong>해시를 먼저 알린다</strong>.</li><li>피어는 해시를 보고 필요한 경우에만 <strong>본문을 요청</strong>한다.</li><li>본문을 받은 피어는 같은 과정을 반복해 네트워크로 확산시킨다.</li></ol><p>이더리움의 eth/66+ 프로토콜에서는 해시 알림(<code>NewPooledTransactionHashes</code>)과 본문 요청/응답(<code>GetPooledTransactions</code>/<code>PooledTransactions</code>)을 분리해 전파 비용을 줄인다.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="검증과-필터링">검증과 필터링<a href="#검증과-필터링" class="hash-link" aria-label="Direct link to 검증과 필터링" title="Direct link to 검증과 필터링">​</a></h4><p>모든 트랜잭션이 그대로 전파되는 것은 아니다. 노드는 다음을 확인하고 통과한 것만 받아들인다.</p><ul><li>서명 유효성, 체인 ID, 형식 검사</li><li>nonce와 잔액 조건(현재 상태 기준)</li><li>가스/수수료 필드의 합리성(최소 수수료, 크기 제한 등)</li></ul><p>검증에 실패한 트랜잭션은 전파되지 않는다. 스팸을 줄이기 위해 피어별 전파 속도 제한, 중복 제거, 유사 트랜잭션 우선순위 조정이 함께 동작한다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Node A receives tx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ├──► Node B ──► Node D ──► ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │        └──► Node E ──► ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    └──► Node C ──► Node F ──► ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             └──► Node G ──► ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>전파를 최적화하기 위해 다음 기법들이 사용된다.</p><ul><li><strong>Transaction Announcement:</strong> 전체 트랜잭션 대신 해시만 먼저 전송</li><li><strong>Deduplication:</strong> 이미 본 트랜잭션은 재전파하지 않음</li><li><strong>Square Root Propagation:</strong> √n 개의 피어에게만 전체 데이터 전송, 나머지는 해시만</li></ul><p>EIP-2976에서 타입별 트랜잭션 gossip을 표준화했다. 네트워크 메시지는 <code>TransactionType || TransactionPayload</code> 형식으로 전송된다.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="mempool-txpool">Mempool (txpool)<a href="#mempool-txpool" class="hash-link" aria-label="Direct link to Mempool (txpool)" title="Direct link to Mempool (txpool)">​</a></h2><p>Mempool(또는 txpool)은 아직 블록에 포함되지 않은 pending 트랜잭션들이 대기하는 공간이다. 각 노드는 자체 mempool을 운영하며, 이들이 합쳐져 &quot;글로벌 mempool&quot;을 형성한다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="pending-vs-queued">Pending vs Queued<a href="#pending-vs-queued" class="hash-link" aria-label="Direct link to Pending vs Queued" title="Direct link to Pending vs Queued">​</a></h3><p>geth의 txpool은 두 개의 큐를 갖는다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌───────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│                                  txpool                                   │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├───────────────────────────────────────┬───────────────────────────────────┤</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│                Pending                │               Queued              │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├───────────────────────────────────────┼───────────────────────────────────┤</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│  Ready to be included in block        │  Not yet ready                    │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│                                       │                                   │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│  Requirements:                        │  Reasons:                         │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│  - Valid signature                    │  - Nonce gap (missing previous tx)│</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│  - Nonce = account&#x27;s current nonce    │  - Nonce too far in future        │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│  - Sufficient balance for gas + val   │  - Balance insufficient           │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│  - Gas price meets minimum            │                                   │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│                                       │                                   │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│  Sorted by:                           │  Waiting for:                     │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│  - Effective gas price (descending)   │  - Gap to be filled               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│  - Nonce (ascending, per account)     │  - Balance to increase            │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└───────────────────────────────────────┴───────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Pending</strong>은 바로 블록에 포함될 수 있는 트랜잭션이다. nonce가 계정의 현재 nonce와 일치하고, 잔액이 충분해야 한다.</p><p><strong>Queued</strong>는 아직 실행 조건을 충족하지 못한 트랜잭션이다. 대표적인 원인은 nonce gap이다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Account nonce: 5</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Pending: tx(nonce=5), tx(nonce=6), tx(nonce=7)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Queued:  tx(nonce=10), tx(nonce=11)  ← nonce 8,9가 없어서 queued</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>nonce 8, 9인 트랜잭션이 도착하면 queued의 트랜잭션들이 pending으로 이동한다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="트랜잭션-정렬">트랜잭션 정렬<a href="#트랜잭션-정렬" class="hash-link" aria-label="Direct link to 트랜잭션 정렬" title="Direct link to 트랜잭션 정렬">​</a></h3><p>블록 빌더는 pending 트랜잭션 중에서 가스 수익을 최대화하는 방향으로 선택한다.</p><ol><li><strong>Effective gas price</strong> 내림차순 (EIP-1559의 경우 min(maxFee, baseFee + priorityFee))</li><li>같은 계정의 트랜잭션은 <strong>nonce</strong> 오름차순</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="트랜잭션-교체">트랜잭션 교체<a href="#트랜잭션-교체" class="hash-link" aria-label="Direct link to 트랜잭션 교체" title="Direct link to 트랜잭션 교체">​</a></h3><p>같은 nonce로 새 트랜잭션을 보내면 기존 트랜잭션을 <strong>교체</strong>할 수 있다. 단, 가스 가격이 기존보다 최소 10% 이상 높아야 한다.</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// Original transaction</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> tx1 </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  nonce</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  maxFeePerGas</span><span class="token operator">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">parseUnits</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;20&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;gwei&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  maxPriorityFeePerGas</span><span class="token operator">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">parseUnits</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;2&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;gwei&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Speed up: increase gas price by &gt; 10%</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> tx2 </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  nonce</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// Same nonce</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  maxFeePerGas</span><span class="token operator">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">parseUnits</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;25&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;gwei&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// +25%</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  maxPriorityFeePerGas</span><span class="token operator">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">parseUnits</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;3&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;gwei&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// +50%</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Cancel: send 0 ETH to self with higher gas</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> cancelTx </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  nonce</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// Same nonce</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  to</span><span class="token operator">:</span><span class="token plain"> myAddress</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// To self</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  value</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  maxFeePerGas</span><span class="token operator">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">parseUnits</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;25&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;gwei&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  maxPriorityFeePerGas</span><span class="token operator">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">parseUnits</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;3&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;gwei&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="eviction-정책">Eviction 정책<a href="#eviction-정책" class="hash-link" aria-label="Direct link to Eviction 정책" title="Direct link to Eviction 정책">​</a></h3><p>mempool은 무한정 트랜잭션을 보관할 수 없다. geth의 기본 설정은 다음과 같다.</p><ul><li><code>globalSlots</code>: 4096 (pending 트랜잭션 최대 개수)</li><li><code>globalQueue</code>: 1024 (queued 트랜잭션 최대 개수)</li><li><code>accountSlots</code>: 16 (계정당 pending 최대)</li><li><code>accountQueue</code>: 64 (계정당 queued 최대)</li><li><code>lifetime</code>: 3시간 (queued 트랜잭션 최대 보관 시간)</li></ul><p>풀이 가득 차면 가스 가격이 가장 낮은 트랜잭션부터 제거된다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="txpool-api">txpool API<a href="#txpool-api" class="hash-link" aria-label="Direct link to txpool API" title="Direct link to txpool API">​</a></h3><p>geth는 txpool 상태를 조회하는 RPC API를 제공한다.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Get txpool status</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> -X POST --data </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  &quot;jsonrpc&quot;:&quot;2.0&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  &quot;method&quot;:&quot;txpool_status&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  &quot;params&quot;:[],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  &quot;id&quot;:1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">}&#x27;</span><span class="token plain"> http://localhost:8545</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Response</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;pending&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x10&quot;</span><span class="token plain">,  // </span><span class="token number">16</span><span class="token plain"> pending txs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;queued&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x3&quot;</span><span class="token plain">     // </span><span class="token number">3</span><span class="token plain"> queued txs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Get detailed txpool content</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> -X POST --data </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  &quot;jsonrpc&quot;:&quot;2.0&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  &quot;method&quot;:&quot;txpool_content&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  &quot;params&quot;:[],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  &quot;id&quot;:1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">}&#x27;</span><span class="token plain"> http://localhost:8545</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="mev와-private-transaction">MEV와 Private Transaction<a href="#mev와-private-transaction" class="hash-link" aria-label="Direct link to MEV와 Private Transaction" title="Direct link to MEV와 Private Transaction">​</a></h2><p>Mempool은 공개되어 있다. 누구나 pending 트랜잭션을 볼 수 있고, 이는 MEV(Maximal Extractable Value) 추출의 기반이 된다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="mev란">MEV란<a href="#mev란" class="hash-link" aria-label="Direct link to MEV란" title="Direct link to MEV란">​</a></h3><p>MEV는 블록 생성자가 트랜잭션 순서를 조작하거나 자신의 트랜잭션을 삽입하여 얻을 수 있는 이익이다. 대표적인 전략으로는 front-running(큰 DEX 거래를 미리 알고 앞서 거래), back-running(큰 거래 직후 발생하는 가격 불균형 활용), sandwich attack(대상 거래의 앞뒤에 자신의 거래를 끼워넣기), liquidation(청산 가능한 포지션을 미리 감지하고 청산) 등이 있다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="flashbots와-mev-boost">Flashbots와 MEV-Boost<a href="#flashbots와-mev-boost" class="hash-link" aria-label="Direct link to Flashbots와 MEV-Boost" title="Direct link to Flashbots와 MEV-Boost">​</a></h3><p>Flashbots는 MEV로 인한 부작용을 줄이기 위해 번들 전송, 프라이빗 릴레이, 블록 빌딩 인프라를 제공하는 연구·개발 조직이다. 핵심은 공개 mempool 밖에서 번들/블록을 구성하고, 검증자에게 안전하게 전달하는 것이다.</p><p>MEV-Boost는 Flashbots가 공개한 소프트웨어 중 하나로, PoS 이더리움에서 validator가 외부 블록 빌더로부터 블록을 받아 선택하도록 만드는 PBS(Proposer-Builder Separation) 구현체다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌──────────────┐    ┌──────────────┐    ┌──────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   Searcher   │───►│   Builder    │───►│   Proposer   │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│  (MEV bot)   │    │ (builds blk) │    │ (validator)  │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└──────────────┘    └──────────────┘    └──────────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │                    │                    │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │  Bundle            │  Bid               │  Sign &amp; Propose</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │  (ordered txs)     │  (block + payment) │</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li><strong>Searcher:</strong> MEV 기회를 찾아 트랜잭션 번들 생성</li><li><strong>Builder:</strong> 여러 번들을 조합해 수익 극대화된 블록 생성</li><li><strong>Proposer:</strong> 가장 높은 bid의 블록 선택</li></ol><p>실제 흐름에서는 <strong>Relay</strong>가 추가된다. Builder는 Relay에 블록을 제출하고, Proposer(validator)는 MEV-Boost를 통해 여러 Relay에서 제안된 블록의 <strong>수익성 있는 헤더</strong>를 비교해 선택한다. 선택 후에만 블록 본문이 공개되므로, Proposer는 페이로드를 보기 전에는 내용을 알 수 없다(블라인드 빌딩).</p><ul><li><strong>Searcher → Builder:</strong> 번들 전달</li><li><strong>Builder → Relay:</strong> 블라인드 블록 제출 및 입찰</li><li><strong>Proposer(validator) → Relay:</strong> 최고 입찰 선택</li><li><strong>Relay → Proposer:</strong> 본문(payload) 공개 후 서명/제안</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="private-transaction">Private Transaction<a href="#private-transaction" class="hash-link" aria-label="Direct link to Private Transaction" title="Direct link to Private Transaction">​</a></h3><p>공개 mempool을 피해 트랜잭션을 전송하는 방법도 있다.</p><p>Flashbots Protect는 트랜잭션을 Flashbots의 private pool로 전송한다. front-running으로부터 보호되고, 추출된 MEV의 90%를 돌려받을 수 있다.</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// Using Flashbots Protect RPC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> provider </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">JsonRpcProvider</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;https://rpc.flashbots.net&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> provider</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">sendTransaction</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">signedTx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Private 전송은 공개 mempool에 노출되지 않지만, <strong>포함 보장</strong>이 있는 것은 아니다. 네트워크 혼잡이나 빌더 정책에 따라 지연되거나 제외될 수 있다.</p><p>2024년 11월, Flashbots는 BuilderNet을 출시했다. 이는 여러 빌더가 협력하여 블록을 생성하는 분산화된 빌딩 네트워크로, 중앙화된 빌더 의존을 줄이려는 시도이다.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>MEV와 L2</div><div class="admonitionContent_S0QG"><p>대부분의 고처리량 L2 체인(Arbitrum, Base, Optimism 등)은 sequencer가 트랜잭션 순서를 결정하므로, mempool이 private하다. 이는 front-running을 방지하지만, sequencer의 중앙화 문제를 야기한다.</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="정리">정리<a href="#정리" class="hash-link" aria-label="Direct link to 정리" title="Direct link to 정리">​</a></h2><p>트랜잭션의 생명주기를 요약하면 다음과 같다.</p><ol><li><strong>생성:</strong> nonce, gas, to, value, data 등 필드 설정</li><li><strong>서명:</strong> ECDSA로 서명하여 (v, r, s) 생성, sender는 서명에서 복구</li><li><strong>직렬화:</strong> RLP로 인코딩하여 raw transaction 생성</li><li><strong>전파:</strong> devp2p gossip으로 네트워크 전체에 전파</li><li><strong>저장:</strong> 각 노드의 mempool에서 블록 포함 대기</li><li><strong>선택:</strong> 블록 빌더가 가스 수익 기준으로 트랜잭션 선택</li></ol><p><a href="/blockchain/how-ethereum-works/block-execution-state">다음 글</a>에서는 mempool의 트랜잭션이 어떻게 블록에 포함되고, EVM에서 실행되어 상태가 변경되는지 살펴본다.</p><p>글에서 사용된 예시코드는 <a href="https://github.com/chihunmanse/crypto-examples/tree/main/solidity-examples/scripts/ethereum" target="_blank" rel="noopener noreferrer">crypto-examples/solidity-examples</a>에서 확인할 수 있다.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="참조">참조<a href="#참조" class="hash-link" aria-label="Direct link to 참조" title="Direct link to 참조">​</a></h2><ul><li><a href="https://ethereum.org/developers/docs/transactions/" target="_blank" rel="noopener noreferrer">Ethereum.org - Transactions</a></li><li><a href="https://ethereum.org/developers/docs/data-structures-and-encoding/rlp/" target="_blank" rel="noopener noreferrer">Ethereum.org - RLP Serialization</a></li><li><a href="https://eips.ethereum.org/EIPS/eip-155" target="_blank" rel="noopener noreferrer">EIP-155: Simple replay attack protection</a></li><li><a href="https://eips.ethereum.org/EIPS/eip-1559" target="_blank" rel="noopener noreferrer">EIP-1559: Fee market change</a></li><li><a href="https://eips.ethereum.org/EIPS/eip-2718" target="_blank" rel="noopener noreferrer">EIP-2718: Typed Transaction Envelope</a></li><li><a href="https://eips.ethereum.org/EIPS/eip-4844" target="_blank" rel="noopener noreferrer">EIP-4844: Shard Blob Transactions</a></li><li><a href="https://github.com/ethereum/devp2p" target="_blank" rel="noopener noreferrer">devp2p Specifications</a></li><li><a href="https://geth.ethereum.org/docs/interacting-with-geth/rpc/ns-txpool" target="_blank" rel="noopener noreferrer">geth txpool Namespace</a></li><li><a href="https://docs.flashbots.net/" target="_blank" rel="noopener noreferrer">Flashbots Documentation</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/ethereum">Ethereum</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/evm">EVM</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blockchain/how-ethereum-works/architecture-overview"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">1. Ethereum Architecture Overview</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blockchain/how-ethereum-works/block-execution-state"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">3. Block Execution and State Management</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#트랜잭션의-여정" class="table-of-contents__link toc-highlight">트랜잭션의 여정</a></li><li><a href="#트랜잭션-유형" class="table-of-contents__link toc-highlight">트랜잭션 유형</a><ul><li><a href="#type-0-legacy-transaction" class="table-of-contents__link toc-highlight">Type 0: Legacy Transaction</a></li><li><a href="#type-2-eip-1559-transaction" class="table-of-contents__link toc-highlight">Type 2: EIP-1559 Transaction</a></li><li><a href="#type-1-access-list-transaction" class="table-of-contents__link toc-highlight">Type 1: Access List Transaction</a></li><li><a href="#type-3-blob-transaction-eip-4844" class="table-of-contents__link toc-highlight">Type 3: Blob Transaction (EIP-4844)</a></li><li><a href="#트랜잭션-유형-비교" class="table-of-contents__link toc-highlight">트랜잭션 유형 비교</a></li></ul></li><li><a href="#트랜잭션-서명" class="table-of-contents__link toc-highlight">트랜잭션 서명</a><ul><li><a href="#서명-과정" class="table-of-contents__link toc-highlight">서명 과정</a></li><li><a href="#v-r-s의-의미" class="table-of-contents__link toc-highlight">v, r, s의 의미</a></li><li><a href="#sender-복구-ecrecover" class="table-of-contents__link toc-highlight">Sender 복구 (ecrecover)</a></li><li><a href="#chain-id와-replay-protection" class="table-of-contents__link toc-highlight">Chain ID와 Replay Protection</a></li></ul></li><li><a href="#rlp-인코딩" class="table-of-contents__link toc-highlight">RLP 인코딩</a><ul><li><a href="#rlp의-설계-원칙" class="table-of-contents__link toc-highlight">RLP의 설계 원칙</a></li><li><a href="#인코딩-규칙" class="table-of-contents__link toc-highlight">인코딩 규칙</a></li><li><a href="#트랜잭션-rlp-구조" class="table-of-contents__link toc-highlight">트랜잭션 RLP 구조</a></li><li><a href="#raw-transaction-파싱" class="table-of-contents__link toc-highlight">Raw Transaction 파싱</a></li></ul></li><li><a href="#p2p-네트워크와-전파" class="table-of-contents__link toc-highlight">P2P 네트워크와 전파</a><ul><li><a href="#네트워크-아키텍처" class="table-of-contents__link toc-highlight">네트워크 아키텍처</a></li><li><a href="#노드-발견-discovery" class="table-of-contents__link toc-highlight">노드 발견 (Discovery)</a></li><li><a href="#트랜잭션-gossip" class="table-of-contents__link toc-highlight">트랜잭션 Gossip</a></li></ul></li><li><a href="#mempool-txpool" class="table-of-contents__link toc-highlight">Mempool (txpool)</a><ul><li><a href="#pending-vs-queued" class="table-of-contents__link toc-highlight">Pending vs Queued</a></li><li><a href="#트랜잭션-정렬" class="table-of-contents__link toc-highlight">트랜잭션 정렬</a></li><li><a href="#트랜잭션-교체" class="table-of-contents__link toc-highlight">트랜잭션 교체</a></li><li><a href="#eviction-정책" class="table-of-contents__link toc-highlight">Eviction 정책</a></li><li><a href="#txpool-api" class="table-of-contents__link toc-highlight">txpool API</a></li></ul></li><li><a href="#mev와-private-transaction" class="table-of-contents__link toc-highlight">MEV와 Private Transaction</a><ul><li><a href="#mev란" class="table-of-contents__link toc-highlight">MEV란</a></li><li><a href="#flashbots와-mev-boost" class="table-of-contents__link toc-highlight">Flashbots와 MEV-Boost</a></li><li><a href="#private-transaction" class="table-of-contents__link toc-highlight">Private Transaction</a></li></ul></li><li><a href="#정리" class="table-of-contents__link toc-highlight">정리</a></li><li><a href="#참조" class="table-of-contents__link toc-highlight">참조</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.5eace082.js"></script>
<script src="/assets/js/main.4ff0f8e6.js"></script>
</body>
</html>