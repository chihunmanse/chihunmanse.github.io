<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-blockchain/how-ethereum-works/block-execution-state">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">3. Block Execution and State Management | Chihun&#x27;s Dev Blog</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://chihunmanse.github.io/img/m.png"><meta data-rh="true" name="twitter:image" content="https://chihunmanse.github.io/img/m.png"><meta data-rh="true" property="og:url" content="https://chihunmanse.github.io/blockchain/how-ethereum-works/block-execution-state"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="3. Block Execution and State Management | Chihun&#x27;s Dev Blog"><meta data-rh="true" name="description" content="How Ethereum executes transactions in the EVM, manages world state with Merkle Patricia Trie, and builds blocks"><meta data-rh="true" property="og:description" content="How Ethereum executes transactions in the EVM, manages world state with Merkle Patricia Trie, and builds blocks"><meta data-rh="true" name="keywords" content="Ethereum,geth,EVM,block,state,Merkle Patricia Trie,opcode,receipt,state root"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://chihunmanse.github.io/blockchain/how-ethereum-works/block-execution-state"><link data-rh="true" rel="alternate" href="https://chihunmanse.github.io/blockchain/how-ethereum-works/block-execution-state" hreflang="en"><link data-rh="true" rel="alternate" href="https://chihunmanse.github.io/blockchain/how-ethereum-works/block-execution-state" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.5b6de4da.css">
<link rel="preload" href="/assets/js/runtime~main.c5ba5f6c.js" as="script">
<link rel="preload" href="/assets/js/main.4ff0f8e6.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">Chihun&#x27;s Dev Blog</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/tags">Tags</a><a href="https://github.com/chihunmanse" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><b>Chihun&#x27;s Dev Blog</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Home</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/datastructure-algorithm">DataStructure &amp; Algorithm</a><button aria-label="Toggle the collapsible sidebar category &#x27;DataStructure &amp; Algorithm&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/backend">Backend</a><button aria-label="Toggle the collapsible sidebar category &#x27;Backend&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/devops">DevOps</a><button aria-label="Toggle the collapsible sidebar category &#x27;DevOps&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/blockchain">BlockChain</a><button aria-label="Toggle the collapsible sidebar category &#x27;BlockChain&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/blockchain/upgradeable-contract">Upgradeable Contract</a><button aria-label="Toggle the collapsible sidebar category &#x27;Upgradeable Contract&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blockchain/contract-error-handling">Contract Error Handling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/blockchain/storage-layout">Solidity Storage Layout</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/blockchain/defi">DeFi</a><button aria-label="Toggle the collapsible sidebar category &#x27;DeFi&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/blockchain/cryptography">Cryptography</a><button aria-label="Toggle the collapsible sidebar category &#x27;Cryptography&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/blockchain/how-ethereum-works">How Ethereum Works</a><button aria-label="Toggle the collapsible sidebar category &#x27;How Ethereum Works&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/blockchain/how-ethereum-works/architecture-overview">1. Ethereum Architecture Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/blockchain/how-ethereum-works/transaction-lifecycle">2. Transaction Lifecycle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/blockchain/how-ethereum-works/block-execution-state">3. Block Execution and State Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/blockchain/how-ethereum-works/consensus-finality">4. Consensus and Finality</a></li></ul></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/blockchain"><span itemprop="name">BlockChain</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/blockchain/how-ethereum-works"><span itemprop="name">How Ethereum Works</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">3. Block Execution and State Management</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>3. Block Execution and State Management</h1><p><a href="/blockchain/how-ethereum-works/transaction-lifecycle">이전 글</a>에서 트랜잭션이 생성되어 mempool에 도착하기까지의 과정을 살펴보았다. 이 글에서는 mempool의 트랜잭션이 블록에 포함되고, EVM에서 실행되어 이더리움의 상태(World State)가 어떻게 변경되는지 분석한다.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="트랜잭션-실행의-전체-흐름">트랜잭션 실행의 전체 흐름<a href="#트랜잭션-실행의-전체-흐름" class="hash-link" aria-label="Direct link to 트랜잭션 실행의 전체 흐름" title="Direct link to 트랜잭션 실행의 전체 흐름">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│                     Transaction Execution Overview                      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└─────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Mempool                    Block Builder                    EVM</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌──────────┐               ┌──────────────┐               ┌──────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│ pending  │  ──select──►  │   assemble   │  ──execute──► │  run tx  │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   txs    │               │    block     │               │   code   │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└──────────┘               └──────────────┘               └────┬─────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                ┌──────────────────────────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                ▼</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                          ┌──────────┐     ┌──────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                          │  update  │────►│  new stateRoot   │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                          │  state   │     │  in block header │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                          └──────────┘     └──────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>mempool에 있는 트랜잭션은 블록 빌더에 의해 선택되어 블록에 포함된다. 각 트랜잭션은 EVM에서 실행되고, 실행 결과로 이더리움의 상태가 변경된다. 변경된 상태의 루트 해시(stateRoot)가 블록 헤더에 포함되어 모든 노드가 동일한 상태에 합의하게 된다.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="블록-구조">블록 구조<a href="#블록-구조" class="hash-link" aria-label="Direct link to 블록 구조" title="Direct link to 블록 구조">​</a></h2><p>블록은 헤더(Header)와 바디(Body)로 구성된다. 헤더에는 블록의 메타데이터와 상태 증명을 위한 루트 해시들이, 바디에는 실제 트랜잭션 목록이 포함된다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="block-header">Block Header<a href="#block-header" class="hash-link" aria-label="Direct link to Block Header" title="Direct link to Block Header">​</a></h3><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td>parentHash</td><td>이전 블록 헤더의 keccak256 해시</td></tr><tr><td>ommersHash</td><td>엉클 블록 목록의 해시 (PoS 이후 빈 값)</td></tr><tr><td>beneficiary</td><td>수수료를 받을 주소 (fee recipient)</td></tr><tr><td>stateRoot</td><td>실행 후 World State Trie의 루트 해시</td></tr><tr><td>transactionsRoot</td><td>트랜잭션 목록의 MPT 루트 해시</td></tr><tr><td>receiptsRoot</td><td>Receipt 목록의 MPT 루트 해시</td></tr><tr><td>logsBloom</td><td>로그 검색용 bloom filter (256 bytes)</td></tr><tr><td>difficulty</td><td>채굴 난이도 (PoS 이후 0)</td></tr><tr><td>number</td><td>블록 번호</td></tr><tr><td>gasLimit</td><td>블록당 최대 가스 한도</td></tr><tr><td>gasUsed</td><td>블록 내 트랜잭션들이 사용한 총 가스</td></tr><tr><td>timestamp</td><td>블록 생성 시간 (Unix timestamp)</td></tr><tr><td>extraData</td><td>임의 데이터 (최대 32 bytes)</td></tr><tr><td>mixHash/prevRandao</td><td>PoW: 채굴 증명 / PoS: RANDAO 값</td></tr><tr><td>nonce</td><td>PoW: 채굴 nonce / PoS: 0</td></tr><tr><td>baseFeePerGas</td><td>EIP-1559 base fee</td></tr><tr><td>withdrawalsRoot</td><td>Validator 출금 목록의 루트 (Shanghai 이후)</td></tr><tr><td>blobGasUsed</td><td>Blob이 사용한 가스 (Dencun 이후)</td></tr><tr><td>excessBlobGas</td><td>초과 blob 가스 (blob base fee 계산용)</td></tr><tr><td>parentBeaconRoot</td><td>부모 비콘 블록 루트 (Dencun 이후)</td></tr></tbody></table><p>이 중 가장 중요한 필드는 <code>stateRoot</code>이다. 블록의 모든 트랜잭션을 순서대로 실행한 후의 최종 상태를 나타내는 해시이다. 이 값이 일치해야 모든 노드가 같은 상태에 합의했다고 볼 수 있다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="block-body">Block Body<a href="#block-body" class="hash-link" aria-label="Direct link to Block Body" title="Direct link to Block Body">​</a></h3><p>바디에는 트랜잭션 목록과 추가 데이터가 포함된다.</p><ul><li><strong>transactions:</strong> 블록에 포함된 트랜잭션 배열</li><li><strong>withdrawals:</strong> Validator 출금 목록 (Shanghai 이후)</li></ul><p>Dencun 이후에는 blob 데이터도 블록과 함께 전파되지만, blob은 블록 바디가 아닌 별도의 사이드카(sidecar)로 관리된다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="실제-블록-데이터-조회">실제 블록 데이터 조회<a href="#실제-블록-데이터-조회" class="hash-link" aria-label="Direct link to 실제 블록 데이터 조회" title="Direct link to 실제 블록 데이터 조회">​</a></h3><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">scripts/ethereum/block-execution.ts</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> provider </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">ethers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">JsonRpcProvider</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;https://eth.llamarpc.com&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> latestBlock </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> provider</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getBlock</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;latest&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Block Header Fields:&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">  number: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">${</span><span class="token template-string interpolation">latestBlock</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token template-string interpolation builtin" style="color:rgb(189, 147, 249)">number</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">  hash: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">${</span><span class="token template-string interpolation">latestBlock</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token template-string interpolation">hash</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">  parentHash: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">${</span><span class="token template-string interpolation">latestBlock</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token template-string interpolation">parentHash</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">  timestamp: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">${</span><span class="token template-string interpolation">latestBlock</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token template-string interpolation">timestamp</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Gas Information:&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">  gasLimit: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">${</span><span class="token template-string interpolation">latestBlock</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token template-string interpolation">gasLimit</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token template-string interpolation function" style="color:rgb(80, 250, 123)">toLocaleString</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">  gasUsed: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">${</span><span class="token template-string interpolation">latestBlock</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token template-string interpolation">gasUsed</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token template-string interpolation function" style="color:rgb(80, 250, 123)">toLocaleString</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">  baseFeePerGas: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">${</span><span class="token template-string interpolation">ethers</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token template-string interpolation function" style="color:rgb(80, 250, 123)">formatUnits</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token template-string interpolation">latestBlock</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token template-string interpolation">baseFeePerGas</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation string" style="color:rgb(255, 121, 198)">&quot;gwei&quot;</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token template-string string" style="color:rgb(255, 121, 198)"> gwei</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;State Roots:&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">  stateRoot: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">${</span><span class="token template-string interpolation">latestBlock</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token template-string interpolation">stateRoot</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">  receiptsRoot: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">${</span><span class="token template-string interpolation">latestBlock</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token template-string interpolation">receiptsRoot</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;PoS Fields:&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">  miner (fee recipient): </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">${</span><span class="token template-string interpolation">latestBlock</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token template-string interpolation">miner</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">  prevRandao: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">${</span><span class="token template-string interpolation">latestBlock</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token template-string interpolation">prevRandao</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="블록-빌딩">블록 빌딩<a href="#블록-빌딩" class="hash-link" aria-label="Direct link to 블록 빌딩" title="Direct link to 블록 빌딩">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="트랜잭션-선택">트랜잭션 선택<a href="#트랜잭션-선택" class="hash-link" aria-label="Direct link to 트랜잭션 선택" title="Direct link to 트랜잭션 선택">​</a></h3><p>블록 빌더는 mempool에서 트랜잭션을 선택하여 블록을 조립한다. 선택 기준은 다음과 같다.</p><ol><li><strong>Effective gas price 내림차순:</strong> 높은 수수료를 지불하는 트랜잭션 우선</li><li><strong>같은 계정의 트랜잭션은 nonce 순서 유지:</strong> nonce 3이 먼저 포함되어야 nonce 4가 실행 가능</li><li><strong>가스 한도 내 최대 수익:</strong> 블록 gasLimit(30M) 내에서 수수료 수익 최대화</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Block Gas Packing:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│                    Block (gasLimit: 30M)                   │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├────────────┬────────────┬────────────┬────────────┬────────┤</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   Tx 1     │   Tx 2     │   Tx 3     │   Tx 4     │ unused │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│  (500K)    │  (2.1M)    │  (800K)    │  (1.5M)    │ (25.1M)│</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│ priority:5 │ priority:4 │ priority:3 │ priority:2 │        │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└────────────┴────────────┴────────────┴────────────┴────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">               ◄──── higher priority first ────►</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="mev-boost와-pbs">MEV-Boost와 PBS<a href="#mev-boost와-pbs" class="hash-link" aria-label="Direct link to MEV-Boost와 PBS" title="Direct link to MEV-Boost와 PBS">​</a></h3><p><a href="/blockchain/how-ethereum-works/transaction-lifecycle#mev%EC%99%80-private-transaction">이전 글</a>에서 설명했듯이, 현재 대부분의 블록은 MEV-Boost를 통해 외부 블록 빌더가 구성한다. Validator(Proposer)는 직접 블록을 만들지 않고, 빌더들이 제안하는 블록 중 가장 높은 수익을 제공하는 블록을 선택한다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Block Building Flow:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  1. Validator에게 슬롯 할당</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  2. CL → EL: engine_forkchoiceUpdatedV3 (블록 빌딩 시작)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  3. EL: mempool에서 트랜잭션 선택, 블록 조립</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  4. CL → EL: engine_getPayloadV3 (완성된 블록 요청)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  5. Validator: 블록 서명 후 네트워크 전파</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>직접 블록을 빌딩하는 경우 위 흐름을 따르지만, MEV-Boost를 사용하면 빌더가 조립한 블록을 릴레이를 통해 받아온다.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="evm-아키텍처">EVM 아키텍처<a href="#evm-아키텍처" class="hash-link" aria-label="Direct link to EVM 아키텍처" title="Direct link to EVM 아키텍처">​</a></h2><p>EVM(Ethereum Virtual Machine)은 이더리움의 트랜잭션을 실행하는 가상 머신이다. 스택 기반의 단순한 구조로 설계되어 결정론적 실행을 보장한다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="스택-기반-머신">스택 기반 머신<a href="#스택-기반-머신" class="hash-link" aria-label="Direct link to 스택 기반 머신" title="Direct link to 스택 기반 머신">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">EVM Architecture:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌───────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│                            EVM Instance                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├───────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│  │    Stack    │  │   Memory    │  │   Storage   │  │   Context   │   │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│  │ (1024 deep) │  │ (volatile)  │  │ (permanent) │  │ (block, tx) │   │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│  │   256-bit   │  │ byte array  │  │  key-value  │  │             │   │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│                                                                       │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│  ┌─────────────────────────────────────────────────────────────────┐  │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│  │                       Program Counter                           │  │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│  │                  ─► [bytecode execution] ─►                     │  │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│  └─────────────────────────────────────────────────────────────────┘  │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└───────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>Stack:</strong> 256비트 워드, 최대 1024개. 모든 연산의 피연산자와 결과가 스택을 통해 전달된다.</li><li><strong>Program Counter:</strong> 현재 실행 중인 bytecode 위치를 가리킨다.</li><li><strong>Context:</strong> 현재 블록 정보(number, timestamp, baseFee), 트랜잭션 정보(origin, gasprice), 호출 정보(caller, value)를 제공한다.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="evm-context">EVM Context<a href="#evm-context" class="hash-link" aria-label="Direct link to EVM Context" title="Direct link to EVM Context">​</a></h3><p>EVM 실행 시 접근 가능한 컨텍스트 정보는 다음과 같다.</p><p><strong>Block Context:</strong></p><ul><li><code>BLOCKHASH</code>: 최근 256개 블록의 해시</li><li><code>COINBASE</code>: 블록 fee recipient</li><li><code>TIMESTAMP</code>: 블록 생성 시간</li><li><code>NUMBER</code>: 블록 번호</li><li><code>PREVRANDAO</code>: PoS RANDAO 값</li><li><code>GASLIMIT</code>: 블록 가스 한도</li><li><code>CHAINID</code>: 체인 ID</li><li><code>BASEFEE</code>: EIP-1559 base fee</li></ul><p><strong>Transaction Context:</strong></p><ul><li><code>ORIGIN</code>: 트랜잭션 최초 발신자 (EOA)</li><li><code>GASPRICE</code>: 트랜잭션의 effective gas price</li></ul><p><strong>Call Context:</strong></p><ul><li><code>CALLER</code>: 현재 호출자 (msg.sender)</li><li><code>CALLVALUE</code>: 전송된 ETH (msg.value)</li><li><code>CALLDATALOAD/SIZE/COPY</code>: 호출 데이터</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="메모리-모델">메모리 모델<a href="#메모리-모델" class="hash-link" aria-label="Direct link to 메모리 모델" title="Direct link to 메모리 모델">​</a></h2><p>EVM은 네 가지 데이터 저장 영역을 제공한다. 각 영역은 지속성과 가스 비용이 다르다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│                          EVM Memory Model                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├─────────────┬───────────────┬───────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   Region    │  Persistence  │                Gas Cost                   │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├─────────────┼───────────────┼───────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   Stack     │   Tx only     │  3 gas (PUSH/POP/DUP/SWAP)                │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   Memory    │   Tx only     │  3 gas + expansion cost                   │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   Storage   │   Permanent   │  100-22100 gas (SLOAD/SSTORE)             │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   Calldata  │   Tx only     │  Free to read (CALLDATALOAD)              │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└─────────────┴───────────────┴───────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="stack">Stack<a href="#stack" class="hash-link" aria-label="Direct link to Stack" title="Direct link to Stack">​</a></h3><p>스택은 가장 기본적인 연산 공간이다.</p><ul><li><strong>크기:</strong> 256비트 워드, 최대 1024개</li><li><strong>특성:</strong> LIFO(Last In, First Out), 모든 EVM 연산이 스택을 통해 이루어짐</li><li><strong>가스 비용:</strong> PUSH, POP, DUP, SWAP 등 스택 조작은 3 gas</li></ul><div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// Solidity 코드</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">uint256</span><span class="token plain"> result </span><span class="token operator">=</span><span class="token plain"> a </span><span class="token operator">+</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// 컴파일된 bytecode (간략화)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// PUSH a    (스택: [a])</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// PUSH b    (스택: [a, b])</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// ADD       (스택: [a+b])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="memory">Memory<a href="#memory" class="hash-link" aria-label="Direct link to Memory" title="Direct link to Memory">​</a></h3><p>메모리는 트랜잭션 실행 중 임시 데이터를 저장하는 바이트 배열이다.</p><ul><li><strong>크기:</strong> 동적 확장 가능, 초기 크기 0</li><li><strong>특성:</strong> 바이트 단위 접근, 32바이트 단위로 읽고 씀</li><li><strong>가스 비용:</strong> 기본 3 gas + 확장 비용</li></ul><p>메모리 확장 비용은 2차 함수로 증가한다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">memory_cost = (memory_size_word² / 512) + (3 × memory_size_word)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>이 설계는 무한한 메모리 사용을 방지한다. 작은 메모리는 저렴하지만, 큰 메모리는 급격히 비싸진다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="storage">Storage<a href="#storage" class="hash-link" aria-label="Direct link to Storage" title="Direct link to Storage">​</a></h3><p>스토리지는 컨트랙트의 영구 저장소이다.</p><ul><li><strong>구조:</strong> 256비트 키 → 256비트 값 매핑</li><li><strong>특성:</strong> 트랜잭션이 끝나도 유지됨</li><li><strong>가스 비용:</strong> EVM에서 가장 비쌈</li></ul><p><strong>EIP-2929 이후 가스 비용:</strong></p><table><thead><tr><th>작업</th><th>Cold Access</th><th>Warm Access</th></tr></thead><tbody><tr><td>SLOAD</td><td>2100 gas</td><td>100 gas</td></tr><tr><td>SSTORE (0→non-zero)</td><td>22100 gas</td><td>20000 gas</td></tr><tr><td>SSTORE (non-zero→non-zero)</td><td>5000 gas</td><td>2900 gas</td></tr><tr><td>SSTORE (non-zero→0)</td><td>5000 gas + 4800 refund</td><td>2900 gas + 4800 refund</td></tr></tbody></table><p>Cold access는 트랜잭션 내에서 해당 슬롯에 처음 접근할 때, warm access는 이미 접근한 슬롯에 다시 접근할 때 적용된다.</p><div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">contracts/ethereum/StateAccess.sol</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">/**</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"> * @notice Demonstrates cold vs warm storage access</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"> * @dev First SLOAD is cold (2100 gas), subsequent SLOADs are warm (100 gas)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">coldWarmAccess</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">external</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">view</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token builtin" style="color:rgb(189, 147, 249)">uint256</span><span class="token plain"> total</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// First access to value1: COLD (2100 gas)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  total </span><span class="token operator">=</span><span class="token plain"> value1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// Second access to value1: WARM (100 gas)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  total </span><span class="token operator">+=</span><span class="token plain"> value1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// First access to value2: COLD (2100 gas)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  total </span><span class="token operator">+=</span><span class="token plain"> value2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// Third access to value1: WARM (100 gas)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  total </span><span class="token operator">+=</span><span class="token plain"> value1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="calldata">Calldata<a href="#calldata" class="hash-link" aria-label="Direct link to Calldata" title="Direct link to Calldata">​</a></h3><p>Calldata는 트랜잭션과 함께 전달되는 읽기 전용 입력 데이터이다.</p><ul><li><strong>특성:</strong> 읽기 전용, 수정 불가</li><li><strong>가스 비용:</strong> 읽기 무료, 트랜잭션에 포함 시 4 gas/zero byte, 16 gas/non-zero byte</li></ul><p>Solidity에서 external 함수의 파라미터로 <code>calldata</code> 키워드를 사용하면 메모리에 복사하지 않고 직접 참조하여 가스를 절약할 수 있다.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="트랜잭션-실행-흐름">트랜잭션 실행 흐름<a href="#트랜잭션-실행-흐름" class="hash-link" aria-label="Direct link to 트랜잭션 실행 흐름" title="Direct link to 트랜잭션 실행 흐름">​</a></h2><p>트랜잭션이 EVM에서 실행되는 과정은 StateTransition이라고 부른다. 이 과정을 단계별로 살펴본다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│                       StateTransition Process                           │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└─────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  1. Pre-validation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     ├─ Check nonce matches account nonce</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     ├─ Verify signature and recover sender</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     └─ Check sender has enough balance for gas + value</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  2. Intrinsic Gas Deduction</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     ├─ Base cost: 21000 gas</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     ├─ Calldata: 4 gas/zero byte, 16 gas/non-zero byte</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     ├─ Contract creation: +32000 gas</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     └─ Access list: 2400/address + 1900/storage key</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  3. Gas Purchase</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     └─ Deduct maxFee × gasLimit from sender balance</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  4. EVM Execution</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     ├─ Contract Creation: deploy bytecode, run constructor</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     └─ Message Call: execute contract code with calldata</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  5. State Changes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     ├─ Apply storage modifications</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     ├─ Update account balances</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     └─ Create/delete accounts</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  6. Gas Refund</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     ├─ Refund unused gas: (gasLimit - gasUsed) × effectiveGasPrice</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     └─ Max refund: gasUsed / 5 (post-EIP-3529)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  7. Fee Distribution</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     ├─ baseFee × gasUsed → burned (EIP-1559)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     └─ priorityFee × gasUsed → block proposer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li><strong>사전 검증(Pre-validation):</strong> nonce가 계정의 현재 nonce와 일치하는지, 서명이 유효한지, 잔액이 가스비와 전송 금액을 감당할 수 있는지 확인한다.</li><li><strong>Intrinsic Gas 차감:</strong> 트랜잭션 자체의 기본 비용(21000 gas)과 calldata 비용, 컨트랙트 생성 비용 등을 계산한다.</li><li><strong>가스 구매:</strong> 발신자 잔액에서 maxFee × gasLimit만큼을 선차감한다.</li><li><strong>EVM 실행:</strong> 컨트랙트 생성이면 bytecode를 배포하고 constructor를 실행한다. 메시지 호출이면 대상 컨트랙트의 코드를 calldata와 함께 실행한다.</li><li><strong>상태 변경:</strong> 스토리지 수정, 계정 잔액 업데이트, 계정 생성/삭제 등을 적용한다.</li><li><strong>가스 환불:</strong> 사용하지 않은 가스를 발신자에게 돌려준다. 환불 상한은 gasUsed의 1/5이다.</li><li><strong>수수료 분배:</strong> baseFee는 소각되고, priorityFee는 블록 제안자에게 지급된다.</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="intrinsic-gas">Intrinsic Gas<a href="#intrinsic-gas" class="hash-link" aria-label="Direct link to Intrinsic Gas" title="Direct link to Intrinsic Gas">​</a></h3><p>모든 트랜잭션은 실행 전에 최소한의 가스(intrinsic gas)를 소모한다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">intrinsicGas = 21000                           // 기본 비용</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             + 4 × (zero bytes in calldata)    // 0x00 바이트</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             + 16 × (non-zero bytes in calldata)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             + 32000 (if contract creation)    // CREATE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             + 2400 × (addresses in access list)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             + 1900 × (storage keys in access list)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>단순 ETH 전송은 calldata가 비어있으므로 정확히 21000 gas가 든다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="contract-creation-vs-message-call">Contract Creation vs Message Call<a href="#contract-creation-vs-message-call" class="hash-link" aria-label="Direct link to Contract Creation vs Message Call" title="Direct link to Contract Creation vs Message Call">​</a></h3><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Contract Creation</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Message Call</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p>컨트랙트 생성 트랜잭션은 <code>to</code> 필드가 비어있다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">1. 새 컨트랙트 주소 계산</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   - CREATE: keccak256(rlp([sender, nonce]))[12:]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   - CREATE2: keccak256(0xff ++ sender ++ salt ++ keccak256(initCode))[12:]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2. 새 계정 생성 (nonce=1, balance=value)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">3. initCode 실행 (constructor)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">4. 반환된 bytecode를 code로 저장</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   - 코드 저장 비용: 200 gas × bytecode length</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">5. 실패 시 모든 상태 롤백 (가스는 소모)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>일반적인 컨트랙트 호출은 <code>to</code> 필드에 대상 주소가 있다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">1. 대상 주소의 코드 로드</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2. EVM 인스턴스 생성</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   - Stack, Memory 초기화</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   - Context 설정 (caller, value, calldata)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">3. Bytecode 실행</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   - Program Counter = 0부터 시작</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   - 각 opcode 실행, 가스 차감</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">4. 실행 종료</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   - RETURN: 정상 종료, 반환 데이터 전달</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   - REVERT: 상태 롤백, 반환 데이터 전달</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   - STOP: 정상 종료, 반환 데이터 없음</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   - INVALID/out-of-gas: 예외 종료</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="실패-시-동작">실패 시 동작<a href="#실패-시-동작" class="hash-link" aria-label="Direct link to 실패 시 동작" title="Direct link to 실패 시 동작">​</a></h3><p>트랜잭션 실행 중 오류가 발생하면 모든 상태 변경이 롤백된다. 단, 가스는 환불되지 않는다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">실패 케이스:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- Out of gas: 가스 부족</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- Invalid opcode: 알 수 없는 명령어</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- Stack underflow/overflow: 스택 범위 초과</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- REVERT: 명시적 롤백</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- Invalid jump destination: JUMPDEST가 아닌 위치로 점프</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">모든 경우:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- State changes: 롤백됨</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- Gas: 소모됨 (환불 없음)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- Receipt status: 0 (FAILED)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>이 설계는 스팸 공격을 방지한다. 실패해도 가스를 소모하므로, 공격자는 실패 트랜잭션을 대량 생성해도 비용을 지불해야 한다.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="주요-opcode">주요 Opcode<a href="#주요-opcode" class="hash-link" aria-label="Direct link to 주요 Opcode" title="Direct link to 주요 Opcode">​</a></h2><p>EVM은 약 140개의 opcode를 지원한다. 주요 opcode를 카테고리별로 살펴본다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="산술-및-비교-연산-3-gas">산술 및 비교 연산 (3 gas)<a href="#산술-및-비교-연산-3-gas" class="hash-link" aria-label="Direct link to 산술 및 비교 연산 (3 gas)" title="Direct link to 산술 및 비교 연산 (3 gas)">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ADD, SUB, MUL, DIV, MOD     - 기본 산술</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ADDMOD, MULMOD              - 모듈러 연산</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">EXP                         - 지수 (10 gas + 50 × byte_size)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">LT, GT, SLT, SGT, EQ        - 비교</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ISZERO                      - 0인지 확인</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">AND, OR, XOR, NOT           - 비트 연산</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SHL, SHR, SAR               - 시프트 (Constantinople 이후)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="스택-조작-3-gas">스택 조작 (3 gas)<a href="#스택-조작-3-gas" class="hash-link" aria-label="Direct link to 스택 조작 (3 gas)" title="Direct link to 스택 조작 (3 gas)">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">PUSH1 ~ PUSH32    - 1~32 바이트 값을 스택에 푸시</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">POP               - 스택 최상단 제거</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DUP1 ~ DUP16      - 스택 n번째 항목 복제</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SWAP1 ~ SWAP16    - 스택 최상단과 n번째 항목 교환</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="메모리-조작">메모리 조작<a href="#메모리-조작" class="hash-link" aria-label="Direct link to 메모리 조작" title="Direct link to 메모리 조작">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">MLOAD   (3+ gas)   - 메모리에서 32바이트 로드</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">MSTORE  (3+ gas)   - 메모리에 32바이트 저장</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">MSTORE8 (3+ gas)   - 메모리에 1바이트 저장</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">MSIZE   (2 gas)    - 현재 메모리 크기</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="스토리지-조작">스토리지 조작<a href="#스토리지-조작" class="hash-link" aria-label="Direct link to 스토리지 조작" title="Direct link to 스토리지 조작">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">SLOAD   (100/2100 gas)     - 스토리지에서 로드 (warm/cold)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SSTORE  (100~22100 gas)    - 스토리지에 저장 (상황에 따라 다름)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="컨트랙트-호출">컨트랙트 호출<a href="#컨트랙트-호출" class="hash-link" aria-label="Direct link to 컨트랙트 호출" title="Direct link to 컨트랙트 호출">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CALL          - 다른 컨트랙트 호출</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DELEGATECALL  - 호출자 컨텍스트로 다른 코드 실행</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">STATICCALL    - 읽기 전용 호출 (상태 변경 불가)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>DELEGATECALL은 proxy 패턴의 핵심이다. 호출된 코드가 호출자의 storage와 msg.sender를 사용한다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CALL vs DELEGATECALL:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Contract A calls Contract B via CALL:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - msg.sender in B = A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - storage access = B&#x27;s storage</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Contract A calls Contract B via DELEGATECALL:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - msg.sender in B = original sender (not A)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - storage access = A&#x27;s storage (!)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="컨트랙트-생성">컨트랙트 생성<a href="#컨트랙트-생성" class="hash-link" aria-label="Direct link to 컨트랙트 생성" title="Direct link to 컨트랙트 생성">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE   (32000+ gas)   - 새 컨트랙트 생성</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE2  (32000+ gas)   - deterministic 주소로 컨트랙트 생성</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>CREATE2의 주소는 배포 전에 계산할 수 있어, counterfactual deployment나 factory 패턴에 유용하다.</p><div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">contracts/ethereum/StateAccess.sol</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">/**</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"> * @notice Predict CREATE2 address before deployment</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">predictCreate2Address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token builtin" style="color:rgb(189, 147, 249)">bytes32</span><span class="token plain"> salt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">external</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">view</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token builtin" style="color:rgb(189, 147, 249)">address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token builtin" style="color:rgb(189, 147, 249)">bytes</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">memory</span><span class="token plain"> bytecode </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">SimpleStorage</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">creationCode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token builtin" style="color:rgb(189, 147, 249)">bytes32</span><span class="token plain"> hash </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">keccak256</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    abi</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">encodePacked</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token builtin" style="color:rgb(189, 147, 249)">bytes1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0xff</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> salt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">keccak256</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">bytecode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token builtin" style="color:rgb(189, 147, 249)">uint160</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token builtin" style="color:rgb(189, 147, 249)">uint256</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">hash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="이벤트-로깅">이벤트 로깅<a href="#이벤트-로깅" class="hash-link" aria-label="Direct link to 이벤트 로깅" title="Direct link to 이벤트 로깅">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">LOG0  (375 gas)         - 0개 indexed topic</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">LOG1  (750 gas)         - 1개 indexed topic</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">LOG2  (1125 gas)        - 2개 indexed topic</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">LOG3  (1500 gas)        - 3개 indexed topic</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">LOG4  (1875 gas)        - 4개 indexed topic</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+ 8 gas × data byte size</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="receipt와-로그">Receipt와 로그<a href="#receipt와-로그" class="hash-link" aria-label="Direct link to Receipt와 로그" title="Direct link to Receipt와 로그">​</a></h2><p>트랜잭션 실행 후 Receipt가 생성된다. Receipt는 실행 결과를 기록하며, 블록의 receiptsRoot 계산에 사용된다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="receipt-구조">Receipt 구조<a href="#receipt-구조" class="hash-link" aria-label="Direct link to Receipt 구조" title="Direct link to Receipt 구조">​</a></h3><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td>status</td><td>1 (성공) 또는 0 (실패)</td></tr><tr><td>cumulativeGas</td><td>블록 내 누적 가스 사용량</td></tr><tr><td>logsBloom</td><td>로그 검색용 bloom filter</td></tr><tr><td>logs</td><td>이벤트 로그 배열</td></tr></tbody></table><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="이벤트-로그">이벤트 로그<a href="#이벤트-로그" class="hash-link" aria-label="Direct link to 이벤트 로그" title="Direct link to 이벤트 로그">​</a></h3><p>이벤트 로그는 트랜잭션 실행 중 발생한 이벤트를 기록한다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Log Structure:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  address    - 이벤트를 발생시킨 컨트랙트 주소</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  topics[]   - 최대 4개의 32바이트 indexed 값</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">               topics[0] = keccak256(event signature)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">               topics[1~3] = indexed 파라미터</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  data       - non-indexed 파라미터 (ABI 인코딩)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">contracts/ethereum/StateAccess.sol</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// Events for demonstrating logs and topics</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">event</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">ValueSet</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token builtin" style="color:rgb(189, 147, 249)">address</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">indexed</span><span class="token plain"> setter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">uint256</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">indexed</span><span class="token plain"> slot</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">uint256</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">event</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Transfer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token builtin" style="color:rgb(189, 147, 249)">address</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">indexed</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">address</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">indexed</span><span class="token plain"> to</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">uint256</span><span class="token plain"> amount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">/**</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"> * @notice Emits multiple events with different topic counts</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">emitEvents</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token builtin" style="color:rgb(189, 147, 249)">uint256</span><span class="token plain"> amount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">external</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// 2 indexed params = 3 topics (1 event sig + 2 indexed)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">emit</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">ValueSet</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sender</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> amount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// 2 indexed params = 3 topics</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">emit</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Transfer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sender</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> amount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>emitEvents(100)</code> 호출 시 Transfer 이벤트의 로그 구조는 다음과 같다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">topics[0] = keccak256(&quot;Transfer(address,address,uint256)&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">topics[1] = msg.sender (indexed)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">topics[2] = address(this) (indexed)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">data      = abi.encode(100) (non-indexed)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>indexed 파라미터는 topics에 포함되어 빠른 검색이 가능하지만, 32바이트로 제한된다. non-indexed 파라미터는 data에 인코딩되어 크기 제한이 없지만, 검색이 느리다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="bloom-filter">Bloom Filter<a href="#bloom-filter" class="hash-link" aria-label="Direct link to Bloom Filter" title="Direct link to Bloom Filter">​</a></h3><p>블록의 logsBloom은 해당 블록에 특정 로그가 포함되어 있는지 빠르게 확인할 수 있는 확률적 자료구조이다.</p><ul><li><strong>크기:</strong> 2048 bits (256 bytes)</li><li><strong>False positive:</strong> 포함되지 않은 로그를 포함되었다고 응답할 수 있음</li><li><strong>False negative:</strong> 없음. 포함된 로그는 반드시 검출됨</li></ul><p>Light client가 특정 이벤트를 검색할 때, 모든 블록의 전체 로그를 확인하지 않고 bloom filter로 후보 블록을 먼저 필터링할 수 있다.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="이더리움-상태-구조">이더리움 상태 구조<a href="#이더리움-상태-구조" class="hash-link" aria-label="Direct link to 이더리움 상태 구조" title="Direct link to 이더리움 상태 구조">​</a></h2><p>이더리움의 상태는 모든 계정의 정보를 담고 있는 World State이다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="account-구조">Account 구조<a href="#account-구조" class="hash-link" aria-label="Direct link to Account 구조" title="Direct link to Account 구조">​</a></h3><p>Account Structure (RLP encoded in state trie):</p><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td>nonce</td><td>EOA: 전송한 트랜잭션 수</td></tr><tr><td></td><td>Contract: 생성한 컨트랙트 수</td></tr><tr><td>balance</td><td>Wei 잔액 (1 ETH = 10¹⁸ wei)</td></tr><tr><td>storageRoot</td><td>Storage Trie의 루트 해시</td></tr><tr><td></td><td>(EOA는 empty trie root)</td></tr><tr><td>codeHash</td><td>keccak256(bytecode)</td></tr><tr><td></td><td>(EOA는 keccak256(&quot;&quot;))</td></tr></tbody></table><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="eoa-vs-contract-account">EOA vs Contract Account<a href="#eoa-vs-contract-account" class="hash-link" aria-label="Direct link to EOA vs Contract Account" title="Direct link to EOA vs Contract Account">​</a></h3><table><thead><tr><th>EOA</th><th>Contract Account</th></tr></thead><tbody><tr><td>Private key로 제어</td><td>Code로 제어</td></tr><tr><td>트랜잭션 생성 가능</td><td>트랜잭션 생성 불가</td></tr><tr><td>codeHash = keccak256(&quot;&quot;)</td><td>codeHash = keccak256(code)</td></tr><tr><td>storageRoot = empty</td><td>storageRoot = storage trie</td></tr><tr><td>코드 없음</td><td>불변의 코드 보유</td></tr></tbody></table><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="merkle-patricia-trie-mpt">Merkle Patricia Trie (MPT)<a href="#merkle-patricia-trie-mpt" class="hash-link" aria-label="Direct link to Merkle Patricia Trie (MPT)" title="Direct link to Merkle Patricia Trie (MPT)">​</a></h2><p>이더리움은 상태를 Merkle Patricia Trie에 저장한다. MPT는 Merkle Tree와 Patricia Trie를 결합한 자료구조이다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="왜-mpt인가">왜 MPT인가<a href="#왜-mpt인가" class="hash-link" aria-label="Direct link to 왜 MPT인가" title="Direct link to 왜 MPT인가">​</a></h3><ol><li><strong>암호학적 증명:</strong> 루트 해시만으로 전체 데이터의 무결성 검증 가능</li><li><strong>효율적 업데이트:</strong> 변경된 경로만 업데이트 (O(log n))</li><li><strong>경로 압축:</strong> 공통 접두사를 압축하여 공간 효율성 향상</li><li><strong>증명 생성:</strong> Light client가 특정 데이터의 포함 여부를 검증 가능</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="노드-타입">노드 타입<a href="#노드-타입" class="hash-link" aria-label="Direct link to 노드 타입" title="Direct link to 노드 타입">​</a></h3><p>MPT는 세 가지 노드 타입으로 구성된다.</p><p>Node Types:</p><ol><li><strong>Leaf Node:</strong> <code>[encodedPath, value]</code><br>경로의 끝에 위치하며 실제 데이터를 저장한다.</li><li><strong>Extension Node:</strong> <code>[encodedPath, childHash]</code><br>공통 접두사를 압축하고 하나의 자식만 가진다.</li><li><strong>Branch Node:</strong> <code>[child0, child1, ..., child15, value]</code><br>16개 자식(hex digit별)을 가지며, 선택적으로 값을 저장한다.</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="state-trie-구조">State Trie 구조<a href="#state-trie-구조" class="hash-link" aria-label="Direct link to State Trie 구조" title="Direct link to State Trie 구조">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    ┌─────────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    │     State Root      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    │   (block header)    │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    └──────────┬──────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              ┌────────────────┼────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              ▼                ▼                ▼</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ┌──────────┐    ┌──────────┐    ┌──────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        │ Account  │    │ Account  │    │ Account  │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        │   (EOA)  │    │(Contract)│    │   ...    │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        └──────────┘    └────┬─────┘    └──────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                             │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    ┌────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    ▼</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              ┌───────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              │ Storage Trie  │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              │ (contract&#x27;s   │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              │  state vars)  │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              └───────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>State Trie:</strong> address → Account 매핑. 키는 <code>keccak256(address)</code>이며, 값은 해당 계정의 RLP 인코딩된 Account 구조다. 즉 stateRoot는 모든 계정 상태의 요약 해시다.</li><li><strong>Storage Trie:</strong> 각 컨트랙트마다 하나씩 존재한다. 슬롯 번호 → 값 매핑이며, 키는 <code>keccak256(slot)</code>이다. 배열/매핑 슬롯은 <code>keccak256(slot || key)</code> 규칙으로 계산되어 실제 저장 위치가 결정된다.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="proof-생성과-검증">Proof 생성과 검증<a href="#proof-생성과-검증" class="hash-link" aria-label="Direct link to Proof 생성과 검증" title="Direct link to Proof 생성과 검증">​</a></h3><p>Light client는 state root와 proof만으로 특정 계정의 상태를 검증할 수 있다.</p><p>Merkle Proof Verification은 다음 순서로 진행된다.</p><ol><li><strong>기준 확보:</strong> 검증된 블록 헤더에서 신뢰할 수 있는 state root를 확보한다.</li><li><strong>증명 수신:</strong> 루트에서 리프까지의 경로에 해당하는 노드 집합(머클 증명)을 받는다.</li><li><strong>해시 재계산:</strong> 리프부터 루트까지 각 노드의 해시를 다시 계산하고, 부모 노드가 참조한 해시와 일치하는지 확인한다.</li><li><strong>값 확인:</strong> 최종 리프 노드의 값이 요청한 데이터와 일치하는지 확인한다.</li><li><strong>판정:</strong> 일치하면 포함이 증명되고, 불일치하면 데이터가 없거나 변조된 것이다.</li></ol><p>이 메커니즘 덕분에 light client는 전체 상태(수 TB)를 저장하지 않고도 특정 데이터를 검증할 수 있다.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="상태-동기화">상태 동기화<a href="#상태-동기화" class="hash-link" aria-label="Direct link to 상태 동기화" title="Direct link to 상태 동기화">​</a></h2><p>새 노드가 네트워크에 참여할 때 현재 상태를 동기화해야 한다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="동기화-방식">동기화 방식<a href="#동기화-방식" class="hash-link" aria-label="Direct link to 동기화 방식" title="Direct link to 동기화 방식">​</a></h3><table><thead><tr><th>방식</th><th>설명</th><th>장단점</th></tr></thead><tbody><tr><td><strong>Full Sync</strong></td><td>제네시스부터 모든 블록 재실행</td><td>가장 완전하지만 가장 느림</td></tr><tr><td><strong>Snap Sync</strong></td><td>최근 상태 스냅샷 다운로드 후 최신 블록만 실행</td><td>빠른 시작, geth 기본값</td></tr><tr><td><strong>Light Sync</strong></td><td>헤더만 동기화, 필요시 proof 요청</td><td>최소 저장공간, 풀노드 의존</td></tr></tbody></table><p>Snap sync가 현재 대부분의 노드에서 사용된다. 최근 상태의 스냅샷을 다운로드하고 state root로 검증한 뒤, 이후 블록만 재실행한다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="archive-vs-full-node">Archive vs Full Node<a href="#archive-vs-full-node" class="hash-link" aria-label="Direct link to Archive vs Full Node" title="Direct link to Archive vs Full Node">​</a></h3><table><thead><tr><th>Full Node</th><th>Archive Node</th></tr></thead><tbody><tr><td>최근 128 블록 상태 유지</td><td>모든 역사적 상태 유지</td></tr><tr><td>오래된 상태 pruning</td><td>pruning 없음</td></tr><tr><td>~1 TB 스토리지</td><td>~15+ TB 스토리지</td></tr><tr><td>최근 상태 쿼리 가능</td><td>모든 블록의 상태 쿼리 가능</td></tr><tr><td>일반 사용자, 밸리데이터</td><td>블록 탐색기, 분석, 디버깅</td></tr></tbody></table><p>Full node에서 <code>eth_call</code>에 과거 블록 번호를 지정하면 &quot;missing trie node&quot; 에러가 발생할 수 있다. 과거 상태를 쿼리해야 한다면 archive node가 필요하다.</p><p>상태는 블록마다 증가하므로, 무한히 커지는 것을 방지하기 위해 오래된 상태를 삭제하는 pruning이 필요하다.
pruning은 디스크 공간을 절약하기 위해 최근 128개 블록의 상태만 유지하고 그 이전 상태는 삭제한다. 그 결과 과거 상태 쿼리는 불가능해진다.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Verkle Tree</div><div class="admonitionContent_S0QG"><p>이더리움은 MPT를 Verkle Tree로 전환하는 것을 계획하고 있다. Verkle Tree는 증명 크기가 훨씬 작아 light client 효율성이 크게 향상된다. Pectra 업그레이드 이후 단계적으로 도입될 예정이다.</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="정리">정리<a href="#정리" class="hash-link" aria-label="Direct link to 정리" title="Direct link to 정리">​</a></h2><p>트랜잭션 실행과 상태 관리의 전체 흐름을 요약한다.</p><ol><li><strong>블록 빌딩:</strong> mempool에서 트랜잭션 선택, effective gas price 순 정렬</li><li><strong>트랜잭션 실행:</strong> StateTransition 과정, 가스 선차감 → EVM 실행 → 상태 변경</li><li><strong>EVM:</strong> 스택 기반 머신, Stack/Memory/Storage/Calldata 메모리 모델</li><li><strong>상태 저장:</strong> World State는 MPT에 저장, state root가 블록 헤더에 포함</li><li><strong>Receipt:</strong> 실행 결과와 이벤트 로그 기록, receipts root로 검증</li></ol><p>이 과정을 통해 이더리움은 전 세계의 노드가 동일한 상태에 합의할 수 있다. state root가 일치하면 모든 노드가 같은 상태를 갖고 있음이 암호학적으로 보장된다.</p><p><a href="/blockchain/how-ethereum-works/consensus-finality">다음 글</a>에서는 이렇게 생성된 블록이 어떻게 네트워크에서 합의되고 최종 확정(finality)되는지 살펴본다.</p><p>글에서 사용된 예시코드는 <a href="https://github.com/chihunmanse/crypto-examples/tree/main/solidity-examples/scripts/ethereum" target="_blank" rel="noopener noreferrer">crypto-examples/solidity-examples</a>에서 확인할 수 있다.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="참조">참조<a href="#참조" class="hash-link" aria-label="Direct link to 참조" title="Direct link to 참조">​</a></h2><ul><li><a href="https://ethereum.org/developers/docs/blocks/" target="_blank" rel="noopener noreferrer">Ethereum.org - Blocks</a></li><li><a href="https://ethereum.org/developers/docs/evm/" target="_blank" rel="noopener noreferrer">Ethereum.org - EVM</a></li><li><a href="https://ethereum.org/developers/docs/gas/" target="_blank" rel="noopener noreferrer">Ethereum.org - Gas</a></li><li><a href="https://ethereum.github.io/yellowpaper/paper.pdf" target="_blank" rel="noopener noreferrer">Ethereum Yellow Paper</a></li><li><a href="https://www.evm.codes/" target="_blank" rel="noopener noreferrer">EVM Opcodes</a></li><li><a href="https://eips.ethereum.org/EIPS/eip-2929" target="_blank" rel="noopener noreferrer">EIP-2929: Gas cost increases for state access opcodes</a></li><li><a href="https://eips.ethereum.org/EIPS/eip-3529" target="_blank" rel="noopener noreferrer">EIP-3529: Reduction in refunds</a></li><li><a href="https://github.com/ethereum/go-ethereum/tree/master/core/vm" target="_blank" rel="noopener noreferrer">geth source: core/vm/</a></li><li><a href="https://github.com/ethereum/go-ethereum/tree/master/core/state" target="_blank" rel="noopener noreferrer">geth source: core/state/</a></li><li><a href="https://github.com/ethereum/go-ethereum/tree/master/trie" target="_blank" rel="noopener noreferrer">geth source: trie/</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/ethereum">Ethereum</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/evm">EVM</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blockchain/how-ethereum-works/transaction-lifecycle"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">2. Transaction Lifecycle</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blockchain/how-ethereum-works/consensus-finality"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">4. Consensus and Finality</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#트랜잭션-실행의-전체-흐름" class="table-of-contents__link toc-highlight">트랜잭션 실행의 전체 흐름</a></li><li><a href="#블록-구조" class="table-of-contents__link toc-highlight">블록 구조</a><ul><li><a href="#block-header" class="table-of-contents__link toc-highlight">Block Header</a></li><li><a href="#block-body" class="table-of-contents__link toc-highlight">Block Body</a></li><li><a href="#실제-블록-데이터-조회" class="table-of-contents__link toc-highlight">실제 블록 데이터 조회</a></li></ul></li><li><a href="#블록-빌딩" class="table-of-contents__link toc-highlight">블록 빌딩</a><ul><li><a href="#트랜잭션-선택" class="table-of-contents__link toc-highlight">트랜잭션 선택</a></li><li><a href="#mev-boost와-pbs" class="table-of-contents__link toc-highlight">MEV-Boost와 PBS</a></li></ul></li><li><a href="#evm-아키텍처" class="table-of-contents__link toc-highlight">EVM 아키텍처</a><ul><li><a href="#스택-기반-머신" class="table-of-contents__link toc-highlight">스택 기반 머신</a></li><li><a href="#evm-context" class="table-of-contents__link toc-highlight">EVM Context</a></li></ul></li><li><a href="#메모리-모델" class="table-of-contents__link toc-highlight">메모리 모델</a><ul><li><a href="#stack" class="table-of-contents__link toc-highlight">Stack</a></li><li><a href="#memory" class="table-of-contents__link toc-highlight">Memory</a></li><li><a href="#storage" class="table-of-contents__link toc-highlight">Storage</a></li><li><a href="#calldata" class="table-of-contents__link toc-highlight">Calldata</a></li></ul></li><li><a href="#트랜잭션-실행-흐름" class="table-of-contents__link toc-highlight">트랜잭션 실행 흐름</a><ul><li><a href="#intrinsic-gas" class="table-of-contents__link toc-highlight">Intrinsic Gas</a></li><li><a href="#contract-creation-vs-message-call" class="table-of-contents__link toc-highlight">Contract Creation vs Message Call</a></li><li><a href="#실패-시-동작" class="table-of-contents__link toc-highlight">실패 시 동작</a></li></ul></li><li><a href="#주요-opcode" class="table-of-contents__link toc-highlight">주요 Opcode</a><ul><li><a href="#산술-및-비교-연산-3-gas" class="table-of-contents__link toc-highlight">산술 및 비교 연산 (3 gas)</a></li><li><a href="#스택-조작-3-gas" class="table-of-contents__link toc-highlight">스택 조작 (3 gas)</a></li><li><a href="#메모리-조작" class="table-of-contents__link toc-highlight">메모리 조작</a></li><li><a href="#스토리지-조작" class="table-of-contents__link toc-highlight">스토리지 조작</a></li><li><a href="#컨트랙트-호출" class="table-of-contents__link toc-highlight">컨트랙트 호출</a></li><li><a href="#컨트랙트-생성" class="table-of-contents__link toc-highlight">컨트랙트 생성</a></li><li><a href="#이벤트-로깅" class="table-of-contents__link toc-highlight">이벤트 로깅</a></li></ul></li><li><a href="#receipt와-로그" class="table-of-contents__link toc-highlight">Receipt와 로그</a><ul><li><a href="#receipt-구조" class="table-of-contents__link toc-highlight">Receipt 구조</a></li><li><a href="#이벤트-로그" class="table-of-contents__link toc-highlight">이벤트 로그</a></li><li><a href="#bloom-filter" class="table-of-contents__link toc-highlight">Bloom Filter</a></li></ul></li><li><a href="#이더리움-상태-구조" class="table-of-contents__link toc-highlight">이더리움 상태 구조</a><ul><li><a href="#account-구조" class="table-of-contents__link toc-highlight">Account 구조</a></li><li><a href="#eoa-vs-contract-account" class="table-of-contents__link toc-highlight">EOA vs Contract Account</a></li></ul></li><li><a href="#merkle-patricia-trie-mpt" class="table-of-contents__link toc-highlight">Merkle Patricia Trie (MPT)</a><ul><li><a href="#왜-mpt인가" class="table-of-contents__link toc-highlight">왜 MPT인가</a></li><li><a href="#노드-타입" class="table-of-contents__link toc-highlight">노드 타입</a></li><li><a href="#state-trie-구조" class="table-of-contents__link toc-highlight">State Trie 구조</a></li><li><a href="#proof-생성과-검증" class="table-of-contents__link toc-highlight">Proof 생성과 검증</a></li></ul></li><li><a href="#상태-동기화" class="table-of-contents__link toc-highlight">상태 동기화</a><ul><li><a href="#동기화-방식" class="table-of-contents__link toc-highlight">동기화 방식</a></li><li><a href="#archive-vs-full-node" class="table-of-contents__link toc-highlight">Archive vs Full Node</a></li></ul></li><li><a href="#정리" class="table-of-contents__link toc-highlight">정리</a></li><li><a href="#참조" class="table-of-contents__link toc-highlight">참조</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.c5ba5f6c.js"></script>
<script src="/assets/js/main.4ff0f8e6.js"></script>
</body>
</html>