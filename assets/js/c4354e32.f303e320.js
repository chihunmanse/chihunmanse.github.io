"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[764],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>g});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=r.createContext({}),p=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return r.createElement(c.Provider,{value:t},e.children)},l="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},_=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),l=p(n),_=a,g=l["".concat(c,".").concat(_)]||l[_]||d[_]||o;return n?r.createElement(g,i(i({ref:t},u),{},{components:n})):r.createElement(g,i({ref:t},u))}));function g(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=_;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[l]="string"==typeof e?e:a,i[1]=s;for(var p=2;p<o;p++)i[p]=n[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}_.displayName="MDXCreateElement"},2316:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var r=n(7462),a=(n(7294),n(3905));const o={sidebar_position:1},i="LUSH Clone Project",s={unversionedId:"backend/project/project1",id:"backend/project/project1",title:"LUSH Clone Project",description:"\uae30\uac04: 2021-10-10 ~ 2021-10-29",source:"@site/docs/backend/project/project1.md",sourceDirName:"backend/project",slug:"/backend/project/project1",permalink:"/docs/backend/project/project1",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"backEnd",previous:{title:"Project",permalink:"/docs/category/project"},next:{title:"KREAM Clone Project",permalink:"/docs/backend/project/project2"}},c={},p=[{value:"End Point",id:"end-point",level:2},{value:"Code",id:"code",level:2},{value:"GET/products (\uc0c1\ud488 \ubaa9\ub85d \uc870\ud68c)",id:"getproducts-\uc0c1\ud488-\ubaa9\ub85d-\uc870\ud68c",level:3},{value:"GET/products/{int:product_id} (\uc0c1\ud488 \uc0c1\uc138)",id:"getproductsintproduct_id-\uc0c1\ud488-\uc0c1\uc138",level:3},{value:"GET/navigator/{int:category_id} (\ub124\ube44\uac8c\uc774\ud130)",id:"getnavigatorintcategory_id-\ub124\ube44\uac8c\uc774\ud130",level:3},{value:"POST/carts (\uc7a5\ubc14\uad6c\ub2c8 \uc0dd\uc131)",id:"postcarts-\uc7a5\ubc14\uad6c\ub2c8-\uc0dd\uc131",level:3},{value:"GET/carts (\uc7a5\ubc14\uad6c\ub2c8 \uc870\ud68c)",id:"getcarts-\uc7a5\ubc14\uad6c\ub2c8-\uc870\ud68c",level:3}],u={toc:p},l="wrapper";function d(e){let{components:t,...n}=e;return(0,a.kt)(l,(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"lush-clone-project"},"LUSH Clone Project"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\uae30\uac04: 2021-10-10 ~ 2021-10-29"),"\n",(0,a.kt)("strong",{parentName:"p"},"Stack: Python, Django, MySQL, DjangoORM")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("a",{parentName:"strong",href:"https://github.com/chihunmanse/LUSH-motive-Project"},"Github \ub9c1\ud06c"))),(0,a.kt)("h2",{id:"end-point"},"End Point"),(0,a.kt)("p",null,"\ud504\ub85c\uc81d\ud2b8\uc5d0\uc11c \uc0c1\ud488 \ubaa9\ub85d \uc870\ud68c API\uc640 \uc0c1\ud488 \uc0c1\uc138 \uc870\ud68c API, \uce74\ud14c\uace0\ub9ac \uc815\ubcf4 API, \uc7a5\ubc14\uad6c\ub2c8 \uc0c1\ud488 \ucd94\uac00, \uc218\uc815, \uc0ad\uc81c API\ub97c \ub9cc\ub4dc\ub294 \uc5ed\ud560\uc744 \ub2f4\ub2f9\ud588\ub2e4."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"GET/products (\uc0c1\ud488 \ubaa9\ub85d/ \ud544\ud130\ub9c1, \uc194\ud305)"),(0,a.kt)("li",{parentName:"ul"},"GET/products/{int:product_id} (\uc0c1\ud488 \uc0c1\uc138)"),(0,a.kt)("li",{parentName:"ul"},"GET/navigator/{int:category_id} (\ub124\ube44\uac8c\uc774\ud130)"),(0,a.kt)("li",{parentName:"ul"},"GET/category (\uce74\ud14c\uace0\ub9ac \ub9ac\uc2a4\ud2b8)"),(0,a.kt)("li",{parentName:"ul"},"POST/carts (\uc7a5\ubc14\uad6c\ub2c8 \uc0dd\uc131)"),(0,a.kt)("li",{parentName:"ul"},"GET/carts (\uc7a5\ubc14\uad6c\ub2c8 \uc870\ud68c)"),(0,a.kt)("li",{parentName:"ul"},"DEL/carts/{int:cart_id} (\uc7a5\ubc14\uad6c\ub2c8 \uc0ad\uc81c)"),(0,a.kt)("li",{parentName:"ul"},"PATCH/carts/{int:cart_id} (\uc7a5\ubc14\uad6c\ub2c8 \uc218\uc815)")),(0,a.kt)("h2",{id:"code"},"Code"),(0,a.kt)("h3",{id:"getproducts-\uc0c1\ud488-\ubaa9\ub85d-\uc870\ud68c"},"GET/products (\uc0c1\ud488 \ubaa9\ub85d \uc870\ud68c)"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"class ProductView(View) :\n    #@query_debugger\n    def get(self, request) :\n        try :\n            category_id = request.GET.get('category')\n            sort        = request.GET.get('sort')\n            search      = request.GET.get('search')\n            limit       = int(request.GET.get('limit', 0))\n            offset      = int(request.GET.get('offset', 0))\n\n            sort_by = {\n                'low_price'  : 'price',\n                'high_price' : '-price',\n                'recent'     : '-created_at',\n                'old'        : 'created_at',\n                'review'     : '-review_count',\n            }\n\n            products_filter = Q(deleted_at = None)\n            category_info   = {}\n\n            if category_id :\n                category = Category.objects.select_related('main_category').get(id = \n                category_id)\n                products_filter.add(Q(category = category) if category.main_category else \n                Q(category__main_category = category), Q.AND)\n\n                category_info = {\n                    'id'             : category.id,\n                    'name'           : category.name,\n                    'category_image' : category.image_url,\n                    'description'    : category.description,\n                }\n\n            if search :\n                products_filter.add(Q(name__icontains = \n                search)|Q(category__main_category__name = search)|Q(category__name = \n                search), Q.AND)\n        \n            products = \n            Product.objects.filter(products_filter).prefetch_related('tags').annotate(price \n            = Min('option__price'), review_count = Count('review'))\\\n                       .order_by(sort_by.get(sort, 'id'))\n\n            if limit :\n                limit    = offset + limit\n                products = products[offset : limit]\n\n            products_list = [{\n                'id'            : product.id,\n                'name'          : product.name,\n                'thumbnail_url' : product.thumbnail_url,\n                'price'         : product.price,\n                'tags'          : [tag.name for tag in product.tags.all()]\n            } for product in products]\n\n            products_count = len(products_list)\n\n            return JsonResponse({'category_info' : category_info, 'products_list' : \n            products_list, 'products_count' : products_count}, status = 200)\n        \n        except Category.DoesNotExist :\n            return JsonResponse({'message' : 'INVALID_CATEGORY_ID'}, status = 404)\n        \n        except Category.MultipleObjectsReturned :\n            return JsonResponse({'message' : 'MULTIPLE_CATEGORY_ERROR'}, status = 400)\n")),(0,a.kt)("p",null,"\uc0c1\ud488 \ud544\ud130\ub9c1\uc740 ",(0,a.kt)("inlineCode",{parentName:"p"},"Q()"),"\ub97c \ud65c\uc6a9\ud574\uc11c \uad6c\ud604\ud588\uace0 \uce74\ud14c\uace0\ub9ac\uc640 \uac80\uc0c9\uc5b4\ub97c \ud1b5\ud574 \ud560 \uc218 \uc788\ub2e4. "),(0,a.kt)("p",null,"\uba3c\uc800 \uce74\ud14c\uace0\ub9ac\ub85c \ud544\ud130\ub9c1 \ud560 \ub54c\ub294 \uc694\uccad\uc5d0\uc11c \uc5bb\uc740 \uce74\ud14c\uace0\ub9ac\uac00 \uba54\uc778 \uce74\ud14c\uace0\ub9ac\uc778\uc9c0 \uc11c\ube0c\uce74\ud14c\uace0\ub9ac\uc778\uc9c0 \uad6c\ubd84\ud574\uc8fc\uc5b4\uc57c \ud588\uae30 \ub54c\ubb38\uc5d0 (Category \ud14c\uc774\ube14\uc5d0 \uc140\ud504 \ucc38\uc870\ud558\ub294 ",(0,a.kt)("inlineCode",{parentName:"p"},"main_category"),"\uce7c\ub7fc \uac12\uc774 null\uc774\uba74 \uba54\uc778\uce74\ud14c\uace0\ub9ac, \ucc38\uc870\ud558\ub294 \uce74\ud14c\uace0\ub9ac\uac00 \uc788\uc73c\uba74 \uc11c\ube0c\uce74\ud14c\uace0\ub9ac) \ud544\ud130 \uc870\uac74\uc744 \ucd94\uac00\ud560 \ub54c \uc0bc\ud56d\uc5f0\uc0b0\uc790\ub97c \uc0ac\uc6a9\ud588\ub2e4."),(0,a.kt)("p",null,"\uac80\uc0c9\uc2dc\uc5d0\ub294 \uc0c1\ud488\uba85\uc5d0 \uac80\uc0c9\uc5b4\uac00 \ud3ec\ud568\ub418\uc5b4\uc788\uac70\ub098, \uac80\uc0c9\uc5b4\uac00 \uc11c\ube0c\uce74\ud14c\uace0\ub9ac\ub098 \uba54\uc778\uce74\ud14c\uace0\ub9ac\uc758 \uc774\ub984\uacfc \uc77c\uce58\ud588\uc744 \ub54c\ub97c \uc870\uac74\uc5d0 \ucd94\uac00\ud588\ub2e4. "),(0,a.kt)("p",null,"\uc0c1\ud488 \uc815\ub82c\uc740 \ub0ae\uc740 \uac00\uaca9\uc21c, \ub192\uc740 \uac00\uaca9\uc21c, \ucd5c\uc2e0\uc21c, \uc624\ub798\ub41c \uc21c, \ub9ac\ubdf0 \ub9ce\uc740 \uc21c\uc73c\ub85c \ud560 \uc218 \uc788\uace0 sort_by \ub515\uc154\ub108\ub9ac\ub97c \ub9cc\ub4e4\uc5b4 \ub193\uace0 \uc0c1\ud488 \ucffc\ub9ac\uc14b\uc744 \uc120\uc5b8\ud560 \ub54c \uc694\uccad\uc5d0\uc11c ",(0,a.kt)("inlineCode",{parentName:"p"},"sort")," \uac12\uc774 \ub4e4\uc5b4\uc654\ub2e4\uba74 order_by\uc5d0 sort_by \ub515\uc154\ub108\ub9ac\uc758 \ud574\ub2f9 \ud0a4\uc758 \uac12\uc744 \ubd88\ub7ec\uc624\uace0 \uc694\uccad\uc5d0 sort\uac00 \uc5c6\uac70\ub098 \uc798\ubabb\ub41c \ud0a4\ub85c \ub4e4\uc5b4\uc654\uc744 \ub54c\ub294 \uae30\ubcf8\uc801\uc73c\ub85c \uc0c1\ud488id\ub85c \uc815\ub82c\ub418\ub3c4\ub85d \ud588\ub2e4. \uc0c1\ud488\uac00\uaca9\uc740 \uc635\uc158 \ud14c\uc774\ube14\uc5d0 \uc788\uae30 \ub54c\ubb38\uc5d0 ",(0,a.kt)("inlineCode",{parentName:"p"},"annotate()"),"\ub97c \ud65c\uc6a9\ud574\uc11c \uc635\uc158 \uc911\uc5d0 \uac00\uc7a5 \ub0ae\uc740 \uac00\uaca9 ",(0,a.kt)("inlineCode",{parentName:"p"},"Min('option__price')"),"\ub4e4\uc744 ",(0,a.kt)("inlineCode",{parentName:"p"},"price"),"\ub77c\ub294 \uc774\ub984\uc73c\ub85c \ubd88\ub7ec\uc654\uace0 \ub9ac\ubdf0\ub3c4 \ub9c8\ucc2c\uac00\uc9c0\ub85c ",(0,a.kt)("inlineCode",{parentName:"p"},"annotate()"),"\ub97c \ud65c\uc6a9\ud574\uc11c ",(0,a.kt)("inlineCode",{parentName:"p"},"review_count"),"\ub77c\ub294 \uc774\ub984\uc73c\ub85c \ub9ac\ubdf0 \uc218\ub97c Count\ud558\uc5ec \ubd88\ub7ec\uc654\ub2e4."),(0,a.kt)("h3",{id:"getproductsintproduct_id-\uc0c1\ud488-\uc0c1\uc138"},"GET/products/{int:product_id} (\uc0c1\ud488 \uc0c1\uc138)"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"class ProductDetailView(View) :\n    #@query_debugger\n    def get(self, request, product_id) :\n        try :\n            if not Product.objects.filter(id = product_id).exists() :\n                return JsonResponse({'message' : 'INVALID_PRODUCT_ID'}, status = 404)\n        \n            product = Product.objects.prefetch_related(\n                     'option_set', 'tags', 'detailimage_set', Prefetch('review_set', \n                     queryset = Review.objects.filter(product = product_id).order_by('-\n                     created_at')))\n                     .select_related('category__main_category').annotate(rating_average =\n                      Avg('review__rating')).get(id = product_id)\n            \n            product_info = {\n                'id'                 : product.id,\n                'name'               : product.name,\n                'thumbnail_url'      : product.thumbnail_url,\n                'how_to'             : product.how_to,\n                'ingredients'        : product.ingredients,\n                'options'            : [{\n                    'option_id'      : option.id,\n                    'price'          : option.price,\n                    'size'           : option.size,\n                } for option in product.option_set.all()],\n                'tags'               : [tag.name for tag in product.tags.all()],\n                'main_category_name' : product.category.main_category.name,\n                'sub_category_name'  : product.category.name,\n                'detail_images'      : [image.image_url for image in\n                product.detailimage_set.all()],\n                'rating_average'     : round(product.rating_average, 1) if \n                product.rating_average else 0,\n                'review_count'       : product.review_set.count(),\n                'photo_review_count' : len([review.image_url for review in\n                product.review_set.all() if review.image_url]),\n                'photo_reviews'      : [{'review_id' : review.id, 'image_url' : \n                review.image_url} for review in product.review_set.all() if \n                review.image_url][:4]\n            }\n\n            return JsonResponse({'product_info' : product_info}, status = 200)\n        \n        except Product.DoesNotExist :\n            return JsonResponse({'message' : 'INVALID_PRODUCT_ID'}, status = 404)\n        \n        except Product.MultipleObjectsReturned :\n            return JsonResponse({'message' : 'MULTIPLE_PRODUCT_ERROR'}, status = 400)\n")),(0,a.kt)("p",null,"\uc0c1\ud488 \uc0c1\uc138 \uc815\ubcf4\uc5d0\ub294 \ub9ac\ubdf0 \ud3c9\uc810 \ud3c9\uade0\uac12\uacfc \ub9ac\ubdf0 \uc218, \ub9ac\ubdf0 \uc911\uc5d0 \uc774\ubbf8\uc9c0\uac00 \uc788\ub294 \ud3ec\ud1a0 \ub9ac\ubdf0 \uc218, \ucd5c\uc2e0\uc21c\uc73c\ub85c \uc815\ub82c\ub41c \ud3ec\ud1a0 \ub9ac\ubdf0\uc758 \uc774\ubbf8\uc9c0 \ucd5c\ub300 4\uac1c\uc758 \ub370\uc774\ud130\ub97c \ud568\uaed8 \ubcf4\ub0b4\uc8fc\uc5b4\uc57c \ud588\ub2e4. \ub9ac\ubdf0 \ud3c9\uc810\uc758 \ud3c9\uade0\uac12\uc740 ",(0,a.kt)("inlineCode",{parentName:"p"},"annotate()"),"\uc640 ",(0,a.kt)("inlineCode",{parentName:"p"},"Avg()"),"\ub97c \uc0ac\uc6a9\ud588\uace0 \uad6c\ud574\uc9c4 \ud3c9\uade0\uac12\uc744 \uc18c\uc218\uc810 1\uc790\ub9ac\uae4c\uc9c0 \ubc18\uc62c\ub9bc\ud558\uae30 \uc704\ud574 ",(0,a.kt)("inlineCode",{parentName:"p"},"round()"),"\ub97c \uc0ac\uc6a9\ud588\ub2e4. \ub9cc\uc57d \uc870\ud68c\ud558\ub824\ub294 \uc0c1\ud488\uc5d0 \ub9ac\ubdf0\uac00 \ud558\ub098\ub3c4 \ub2ec\ub9ac\uc9c0 \uc54a\uc558\ub2e4\uba74 ",(0,a.kt)("inlineCode",{parentName:"p"},"Avg('review__rating')"),"\uc740 None\uc744 \ubc18\ud658\ud558\uace0 ",(0,a.kt)("inlineCode",{parentName:"p"},"round()"),"\uc5d0 None\uc774 \ub4e4\uc5b4\uac00\uba74 TypeError\ub97c \ubc1c\uc0dd\uc2dc\ud0a4\uae30 \ub54c\ubb38\uc5d0 ",(0,a.kt)("inlineCode",{parentName:"p"},"review_average"),"\uc5d0 \uac12\uc774 \uc788\uc744 \ub54c\ub9cc ",(0,a.kt)("inlineCode",{parentName:"p"},"round()"),"\uc5d0 \ub123\uace0 None\uc774\uba74 0\uc774 \ub418\ub3c4\ub85d \ud588\ub2e4."),(0,a.kt)("p",null,"\uadf8\ub9ac\uace0 \ud3ec\ud1a0\ub9ac\ubdf0 \ub370\uc774\ud130\ub97c \ub2f4\uc744 \ub54c \ucd5c\uc2e0\uc21c\uc73c\ub85c \uc815\ub82c\uc2dc\ucf1c\uc11c \ub2f4\uc544\uc57c \ud588\ub294\ub370, "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"prefetch_related('option_set', 'tags', 'detailimage_set', 'review_set')\n\n'photo_reviews': [{'review_id' : review.id, 'image_url' : review.image_url} for review in product.review_set.all().order_by('-created_at') if review.image_url][:4]\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"prefetch_related")," \ud568\uc218\uc5d0 ",(0,a.kt)("inlineCode",{parentName:"p"},"'review_set'"),"\uc73c\ub85c\ub9cc \uc9c0\uc815\ud558\uace0 \uc544\ub798\uc5d0\uc11c \ub2e4\uc2dc \uc815\ub82c\uc2dc\ud0a4\uba74 "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"}," DEBUG (0.000) SELECT `reviews`.`id`, `reviews`.`user_id`, `reviews`.`product_id`, `reviews`.`content`, `reviews`.`rating`, `reviews`.`image_url`, `reviews`.`created_at`, `reviews`.`updated_at` FROM `reviews` WHERE `reviews`.`product_id` IN (19); args=(19,)\n\n DEBUG (0.001) SELECT `reviews`.`id`, `reviews`.`user_id`, `reviews`.`product_id`, `reviews`.`content`, `reviews`.`rating`, `reviews`.`image_url`, `reviews`.`created_at`, `reviews`.`updated_at` FROM `reviews` WHERE `reviews`.`product_id` = 19 ORDER BY `reviews`.`created_at` DESC; args=(19,)\n")),(0,a.kt)("p",null,"ORDER BY\ud558\ub294 \ucffc\ub9ac\uac00 \ub2e4\uc2dc \ub0a0\uc544\uac04\ub2e4."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"Product.objects.prefetch_related(\n                    'option_set', 'tags', 'detailimage_set', \n                    Prefetch('review_set',\n                    queryset = Review.objects.filter(product = product_id).order_by\n                             ('-created_at')))\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"Prefetch()"),"\ub97c \ud1b5\ud574\uc11c queryset\uc5d0 \ucd5c\uc2e0\uc21c\uc73c\ub85c \uc815\ub82c\ub41c \ub9ac\ubdf0 \ucffc\ub9ac\uc14b\uc73c\ub85c \uc9c1\uc811 \uc9c0\uc815\ud558\uace0 \uc0ac\uc6a9\ud558\uba74"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"}," DEBUG (0.000) SELECT `reviews`.`id`, `reviews`.`user_id`, `reviews`.`product_id`, `reviews`.`content`, `reviews`.`rating`, `reviews`.`image_url`, `reviews`.`created_at`, `reviews`.`updated_at` FROM `reviews` WHERE (`reviews`.`product_id` = 19 AND `reviews`.`product_id` IN (19)) ORDER BY `reviews`.`created_at` DESC; args=(19, 19)\n")),(0,a.kt)("p",null,"\uc774\ub807\uac8c \ud558\ub098\uc758 \ucffc\ub9ac\ub85c \ud569\uce60 \uc218 \uc788\uc5c8\ub2e4."),(0,a.kt)("h3",{id:"getnavigatorintcategory_id-\ub124\ube44\uac8c\uc774\ud130"},"GET/navigator/{int:category_id} (\ub124\ube44\uac8c\uc774\ud130)"),(0,a.kt)("p",null,"\ucc98\uc74c \ubaa8\ub378\uc5d0\ub294 \uc11c\ube0c\uce74\ud14c\uace0\ub9ac \ud14c\uc774\ube14\uc774 \ub530\ub85c \uc874\uc7ac\ud588\ub2e4. \uadf8\ub7f0\ub370 \ub7ec\uc26c \uc0ac\uc774\ud2b8\uc5d0\ub294 \uce74\ud14c\uace0\ub9ac\ub098 \uc11c\ube0c\uce74\ud14c\uace0\ub9ac\ub97c \ub204\ub97c \ub54c, \ubc30\ub108\uc774\ubbf8\uc9c0\uc640 \ud55c \uc904\uc758 \uc124\uba85 \ubb38\uad6c\uac00 \ub728\ub294\ub370 \uadf8\ub54c \uc0ac\uc6a9\ub418\ub294 \ub370\uc774\ud130\ub294 \uce74\ud14c\uace0\ub9ac\uc758 \uacc4\uce35\uacfc\ub294 \uc0c1\uad00\uc774 \uc5c6\uc5c8\ub2e4. \uadf8\ub7fc\uc5d0\ub3c4 \uce74\ud14c\uace0\ub9ac \uc815\ubcf4\ub97c \uc8fc\ub294 api\uc640 \uc11c\ube0c\uce74\ud14c\uace0\ub9ac \uc815\ubcf4\ub97c \uc8fc\ub294 api\ub97c \ub098\ub220\uc11c \ub9cc\ub4e4\uc5b4\uc57c \ud588\uace0 \uba58\ud1a0\ub2d8\uaed8\uc11c \ucc28\ub77c\ub9ac \uc11c\ube0c\uce74\ud14c\uace0\ub9ac \ud14c\uc774\ube14\uc744 \uc5c6\uc560\uace0 \uce74\ud14c\uace0\ub9ac \ud14c\uc774\ube14 \uc548\uc5d0\uc11c \uc140\ud504\ucc38\uc870\ud568\uc73c\ub85c\uc368 \uacc4\uce35\uc774 \uad6c\ubd84\ub418\ub3c4\ub85d \ud558\ub294\uac8c \uc5b4\ub5bb\ub0d0\ub294 \ud53c\ub4dc\ubc31\uc744 \uc8fc\uc154\uc11c \ubaa8\ub378\uc744 \uc218\uc815\ud588\ub2e4."),(0,a.kt)("p",null,"\ub355\ubd84\uc5d0 \uce74\ud14c\uace0\ub9ac id\ub9cc \uc788\uc73c\uba74 \uba54\uc778\uacfc \uc11c\ube0c \uc0c1\uad00\uc5c6\uc774 \ud574\ub2f9 \uce74\ud14c\uace0\ub9ac \uc815\ubcf4\ub97c \uc904 \uc218 \uc788\uac8c \ub410\uc9c0\ub9cc \uce74\ud14c\uace0\ub9ac \uacc4\uce35\uacfc \uad00\ub828\ub41c \ub370\uc774\ud130\uc5d0 \uc811\uadfc\ud560 \ub54c\ub294 \uc694\uccad\uc5d0\uc11c \ub4e4\uc5b4\uc628 \uce74\ud14c\uace0\ub9ac\uac00 \uba54\uc778\uc778\uc9c0 \uc11c\ube0c\uc778\uc9c0 \uad6c\ubd84\ud558\ub294 \uc791\uc5c5\uc744 \ud574\uc918\uc57c\ud558\ub294 \ub2e8\uc810\uc774 \uc788\uc5c8\ub2e4.  "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"class NavigatorView(View) :\n    def get(self, request, category_id) :\n        try :\n            if not Category.objects.filter(id = category_id).exists() :\n                return JsonResponse({'message' : 'INVALID_CATEGORY_ID'}, status = 404)\n         \n            category = Category.objects.select_related('main_category').get(id = \n            category_id)\n\n            if category.main_category == None :      \n                navigator_list = {\n                    'category_id'                 : category.id,\n                    'category_name'               : category.name,\n                    'category_products_count'     : \n                    Product.objects.filter(category__main_category = category).count(),\n                    'sub_categories'              : [{\n                    'sub_category_id'             : sub_category.id,\n                    'sub_category_name'           : sub_category.name,\n                    'sub_category_products_count' : sub_category.product_set.count()\n                    } for sub_category in \n                    category.sub_category.prefetch_related('product_set').all()]\n                }\n\n            else :\n                navigator_list = {\n                    'category_id'                 : category.main_category.id,\n                    'category_name'               : category.main_category.name,\n                    'category_products_count'     : \n                    Product.objects.filter(category__main_category = \n                    category.main_category).count(),\n                    'sub_categories'              : [{\n                    'sub_category_id'             : sub_category.id,\n                    'sub_category_name'           : sub_category.name,\n                    'sub_category_products_count' : sub_category.product_set.count()\n                    } for sub_category in \n                  category.main_category.sub_category.prefetch_related('product_set').all()]\n                }\n            \n            return JsonResponse({'navigator_list' : navigator_list}, status = 200)\n        \n        except Category.DoesNotExist :\n            return JsonResponse({'message' : 'INVALID_CATEGORY_ID'}, status = 404)\n        \n        except Category.MultipleObjectsReturned :\n            return JsonResponse({'message' : 'MULTIPLE_CATEGORY_ERROR'}, status = 400)\n\n")),(0,a.kt)("p",null,"\ub611\uac19\uc740 \uad6c\uc870\ub97c \uac00\uc9c4 \ub370\uc774\ud130\ub97c \uc0dd\uc131\ud558\uc9c0\ub9cc \uc694\uccad\uc5d0\uc11c \ub4e4\uc5b4\uc628 \uce74\ud14c\uace0\ub9ac id\uac00 \uba54\uc778\uc778\uc9c0 \uc11c\ube0c\uc778\uc9c0\uc5d0 \ub530\ub77c \uc811\uadfc\ud558\ub294 \ubc29\uc2dd\uc774 \ub2ec\ub790\uae30 \ub54c\ubb38\uc5d0 if else\ubb38\uc744 \uc0ac\uc6a9\ud588\uace0 \uacb0\uacfc\uc801\uc73c\ub85c \ubc18\ubcf5\ub418\ub294 \ucf54\ub4dc\uac00 \ub9ce\uace0 \uac00\ub3c5\uc131\ub3c4 \uc88b\uc9c0 \uc54a\uc558\ub2e4."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"class Navigator :\n    def __init__(self, category) :\n        self.category = category\n    \n    def get_category(self) :\n        category = self.category.main_category if self.category.main_category else \n        self.category\n        return category\n    \n    def gennerate_navigator_list(self) :\n        navigator_list = {\n            'category_id'                 : self.get_category().id,\n            'category_name'               : self.get_category().name,\n            'category_products_count'     : Product.objects.filter(category__main_category =\n            self.get_category()).count(),\n            'sub_categories'              : [{\n            'sub_category_id'             : sub_category.id,\n            'sub_category_name'           : sub_category.name,\n            'sub_category_products_count' : sub_category.product_set.count()\n            } for sub_category in \n            self.get_category().sub_category.prefetch_related('product_set').all()]\n            }\n\n        return navigator_list\n")),(0,a.kt)("p",null,"\uba58\ud1a0\ub2d8\uaed8\uc11c \ud074\ub798\uc2a4\ub97c \ub530\ub85c \ub9cc\ub4e4\uc5b4\uc11c \ub9ac\ud329\ud1a0\ub9c1 \ud574\ubcf4\uba74 \uc88b\uc744\uac70 \uac19\ub2e4\ub294 \ud53c\ub4dc\ubc31\uc744 \uc8fc\uc168\uace0 \uc5b4\uc124\ud504\uac8c\ub098\ub9c8 \uc9c4\ud589\ud574\ubcf4\uc558\ub2e4. \uc77c\ub2e8 \uce74\ud14c\uace0\ub9ac\uac00 \uba54\uc778\uc778\uc9c0 \uc11c\ube0c\uc778\uc9c0\uc5d0 \ub530\ub77c \ucf54\ub4dc\uac00 \ub450 \uac08\ub798\ub85c \ub098\ub258\uc5c8\uae30 \ub54c\ubb38\uc5d0, \uce74\ud14c\uace0\ub9ac\ub97c \ud074\ub798\uc2a4\uc758 \uc18d\uc131\uc73c\ub85c \ub9cc\ub4e4\uace0 \uce74\ud14c\uace0\ub9ac\ub97c \uad6c\ubd84\ud574\uc8fc\ub294 \ud568\uc218\uc640 \uadf8 \ud568\uc218\ub97c \uc0ac\uc6a9\ud574\uc11c \ud544\uc694\ud588\ub358 \ub370\uc774\ud130\ub97c \uc0dd\uc131\ud574\uc8fc\ub294 \ud568\uc218\ub97c \ub9cc\ub4e4\uc5c8\ub2e4."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"class NavigatorView(View) :\n    def get(self, request, category_id) :\n        try :\n            if not Category.objects.filter(id = category_id).exists() :\n                return JsonResponse({'message' : 'INVALID_CATEGORY_ID'}, status = 404)\n         \n            category       = Category.objects.select_related('main_category').get(id = \n            category_id)\n            navigator      = Navigator(category)\n            navigator_list = navigator.gennerate_navigator_list()\n            \n            return JsonResponse({'navigator_list' : navigator_list}, status = 200)\n        \n        except Category.DoesNotExist :\n            return JsonResponse({'message' : 'INVALID_CATEGORY_ID'}, status = 404)\n        \n        except Category.MultipleObjectsReturned :\n            return JsonResponse({'message' : 'MULTIPLE_CATEGORY_ERROR'}, status = 400)\n")),(0,a.kt)("p",null,"\uc2e4\uc81c \uc694\uccad\uc744 \ubc1b\ub294 \ud568\uc218\uc5d0\uc11c\ub294 \uce74\ud14c\uace0\ub9ac \uc815\ubcf4\ub9cc \uc5bb\uc5b4\uc11c \ub530\ub85c \ub9cc\ub4e0 \ud074\ub798\uc2a4\uc758 \uc778\uc2a4\ud134\uc2a4\ub97c \uc0dd\uc131\ud558\uace0 \ub370\uc774\ud130\ub97c \ub9cc\ub4e4\uc5b4\uc8fc\ub294 \ud074\ub798\uc2a4\uc758 \ud568\uc218\ub97c \uc2e4\ud589\ud558\uae30\ub9cc \ud558\uba74 \ub418\uc5c8\ub2e4. \uacb0\uacfc\uc801\uc73c\ub85c \ubc18\ubcf5\ub418\ub294 \ucf54\ub4dc\uac00 \uc904\uc5c8\uace0, \ub2e8\uc21c\ud558\uac8c \ub098\uc5f4\ub418\ub358 \ucf54\ub4dc\ub4e4\uc744 \ud544\uc694\ud55c \ub3d9\uc791\ub4e4\ub85c \ucabc\uac1c\uc5b4 \ubd80\ud488\ucc98\ub7fc \uc0ac\uc6a9\ud574\ubcfc \uc218 \uc788\ub358 \uacbd\ud5d8\uc774\uc5b4\uc11c \uae30\uc5b5\uc5d0 \ub0a8\ub294\ub2e4."),(0,a.kt)("h3",{id:"postcarts-\uc7a5\ubc14\uad6c\ub2c8-\uc0dd\uc131"},"POST/carts (\uc7a5\ubc14\uad6c\ub2c8 \uc0dd\uc131)"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"class CartView(View) :\n    @signin_decorator\n    def post(self, request):\n        try :\n            data      = json.loads(request.body)\n            user      = request.user\n            option_id = data['option_id']\n            quantity  = int(data['quantity'])\n\n            if not Option.objects.filter(id = option_id).exists():\n                return JsonResponse({'message' : 'INVALID_OPTION_ID'}, status = 404)\n               \n            cart, created = Cart.objects.get_or_create(\n                user = user,\n                option_id = option_id\n            )\n\n            cart.quantity += quantity\n            cart.save()\n\n            return JsonResponse({'message' : 'SUCCESS'}, status = 201)\n       \n        except JSONDecodeError:\n            return JsonResponse({'message' : 'JSON_DECODE_ERROR'}, status = 400)\n        \n        except KeyError:\n            return JsonResponse({'message' : \"KEY_ERROR\"}, status = 400)\n")),(0,a.kt)("p",null,"\uc7a5\ubc14\uad6c\ub2c8\uc5d0 \uc0c1\ud488\uc744 \ucd94\uac00\ud560 \ub54c\ub294 ",(0,a.kt)("inlineCode",{parentName:"p"},"get_or_create()"),"\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc7a5\ubc14\uad6c\ub2c8\uc5d0 \uc774\ubbf8 \uac19\uc740 \uc0c1\ud488\uc774 \ub2f4\uaca8\uc788\ub2e4\uba74 \uc218\ub7c9\ub9cc \ubcc0\uacbd\ud558\uace0, \uc5c6\ub2e4\uba74 \uc0c8\ub85c \uc0dd\uc131\ud560 \uc218 \uc788\ub3c4\ub85d \ud588\ub2e4. Cart \ud14c\uc774\ube14\uc5d0\uc11c ",(0,a.kt)("inlineCode",{parentName:"p"},"quantity")," \uce7c\ub7fc\uc5d0 default = 0 \uc73c\ub85c \uc9c0\uc815\ud574\uc92c\uae30 \ub54c\ubb38\uc5d0 \uc0dd\uc131\ud560 \ub54c ",(0,a.kt)("inlineCode",{parentName:"p"},"quantity"),"\ub294 0\uc73c\ub85c \uc0dd\uc131\ub418\uace0 \ud6c4\uc5d0 \uc694\uccad\uc5d0\uc11c \uc5bb\uc740 ",(0,a.kt)("inlineCode",{parentName:"p"},"quantity"),"\ub85c \ub370\uc774\ud130\ub97c \uc218\uc815\ud574\uc8fc\uc5c8\ub2e4. "),(0,a.kt)("h3",{id:"getcarts-\uc7a5\ubc14\uad6c\ub2c8-\uc870\ud68c"},"GET/carts (\uc7a5\ubc14\uad6c\ub2c8 \uc870\ud68c)"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"    @signin_decorator\n    def get(self, request):\n        FREE_SHIPPING = 30000\n        SHIPPING      = 2500\n        carts         = Cart.objects.filter(user = \n        request.user).select_related('option__product__category')\n\n        cart_list = [{\n            'cart_id'       : item.id,\n            'product_id'    : item.option.product.id,\n            'product_name'  : item.option.product.name,\n            'category_name' : item.option.product.category.name,\n            'size'          : item.option.size,\n            'quantity'      : item.quantity,\n            'product_price' : item.option.price,\n            'product_image' : item.option.product.thumbnail_url,\n            'price'         : int(item.option.price) * int(item.quantity)\n        }for item in carts]\n\n        total_price    = int(carts.aggregate(total = Sum(F('quantity')*F('option__price')))\n        ['total'] or 0)\n        total_quantity = len(cart_list)\n        shipping_price = 0 if total_price >= FREE_SHIPPING or total_price == 0 else SHIPPING\n        order_price    = total_price + shipping_price\n\n        return JsonResponse({\n            'cart_list'      : cart_list,\n            'total_price'    : total_price,\n            'total_quantity' : total_quantity,\n            'shipping'       : shipping_price,\n            'order_price'    : order_price,\n        }, status = 200)\n")),(0,a.kt)("p",null,"\uc7a5\ubc14\uad6c\ub2c8 \uc870\ud68c\uc5d0\uc11c\ub294 ",(0,a.kt)("inlineCode",{parentName:"p"},"aggregate()"),"\ub97c \ud65c\uc6a9\ud574\uc11c \uc7a5\ubc14\uad6c\ub2c8\uc5d0 \ub2f4\uae34 \uc0c1\ud488\ub4e4\uc758 \ucd1d \uac00\uaca9\uc744 \uad6c\ud560 \uc218 \uc788\uc5c8\ub2e4. \ub9cc\uc57d \uc7a5\ubc14\uad6c\ub2c8\uac00 \ube44\uc5b4\uc788\ub2e4\uba74 ",(0,a.kt)("inlineCode",{parentName:"p"},"Sum()"),"\uc740 None\uc744 \ubc18\ud658\ud560 \uac83\uc774\uae30 \ub54c\ubb38\uc5d0, ",(0,a.kt)("inlineCode",{parentName:"p"},"['total']"),"\uc758 \uac12\uc774 null\uc77c \uacbd\uc6b0 0\uc774 \ub418\ub3c4\ub85d \ud588\ub2e4. (",(0,a.kt)("inlineCode",{parentName:"p"},"aggregate()"),"\uac00 \ubc18\ud658\ub418\ub294 \ud615\ud0dc\ub294 \ub515\uc154\ub108\ub9ac\uc774\ubbc0\ub85c) "),(0,a.kt)("p",null,"\ubc30\uc1a1\ube44\ub294 ",(0,a.kt)("inlineCode",{parentName:"p"},"total_price"),"\uac00 3\ub9cc\uc6d0 \uc774\uc0c1\uc774\uac70\ub098 0\uc6d0\uc77c \ub54c\ub294 0\uc6d0\uc774 \ub418\uace0 3\ub9cc\uc6d0 \ubbf8\ub9cc\uc77c \ub54c\ub294 2500\uc6d0\uc774 \ub418\ub3c4\ub85d \ud588\ub2e4."))}d.isMDXComponent=!0}}]);