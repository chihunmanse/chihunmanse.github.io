"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[4156],{5680:(e,n,o)=>{o.d(n,{xA:()=>p,yg:()=>m});var a=o(6540);function t(e,n,o){return n in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o,e}function r(e,n){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),o.push.apply(o,a)}return o}function u(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?r(Object(o),!0).forEach((function(n){t(e,n,o[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(o,n))}))}return e}function i(e,n){if(null==e)return{};var o,a,t=function(e,n){if(null==e)return{};var o,a,t={},r=Object.keys(e);for(a=0;a<r.length;a++)o=r[a],n.indexOf(o)>=0||(t[o]=e[o]);return t}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)o=r[a],n.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(t[o]=e[o])}return t}var l=a.createContext({}),s=function(e){var n=a.useContext(l),o=n;return e&&(o="function"==typeof e?e(n):u(u({},n),e)),o},p=function(e){var n=s(e.components);return a.createElement(l.Provider,{value:n},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},y=a.forwardRef((function(e,n){var o=e.components,t=e.mdxType,r=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),c=s(o),y=t,m=c["".concat(l,".").concat(y)]||c[y]||d[y]||r;return o?a.createElement(m,u(u({ref:n},p),{},{components:o})):a.createElement(m,u({ref:n},p))}));function m(e,n){var o=arguments,t=n&&n.mdxType;if("string"==typeof e||t){var r=o.length,u=new Array(r);u[0]=y;var i={};for(var l in n)hasOwnProperty.call(n,l)&&(i[l]=n[l]);i.originalType=e,i[c]="string"==typeof e?e:t,u[1]=i;for(var s=2;s<r;s++)u[s]=o[s];return a.createElement.apply(null,u)}return a.createElement.apply(null,o)}y.displayName="MDXCreateElement"},9365:(e,n,o)=>{o.d(n,{A:()=>u});var a=o(6540),t=o(53);const r={tabItem:"tabItem_Ymn6"};function u(e){let{children:n,hidden:o,className:u}=e;return a.createElement("div",{role:"tabpanel",className:(0,t.A)(r.tabItem,u),hidden:o},n)}},1470:(e,n,o)=>{o.d(n,{A:()=>v});var a=o(8168),t=o(6540),r=o(53),u=o(3104),i=o(6347),l=o(7485),s=o(1682),p=o(9466);function c(e){return function(e){return t.Children.map(e,(e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:n,label:o,attributes:a,default:t}}=e;return{value:n,label:o,attributes:a,default:t}}))}function d(e){const{values:n,children:o}=e;return(0,t.useMemo)((()=>{const e=n??c(o);return function(e){const n=(0,s.X)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,o])}function y(e){let{value:n,tabValues:o}=e;return o.some((e=>e.value===n))}function m(e){let{queryString:n=!1,groupId:o}=e;const a=(0,i.W6)(),r=function(e){let{queryString:n=!1,groupId:o}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!o)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return o??null}({queryString:n,groupId:o});return[(0,l.aZ)(r),(0,t.useCallback)((e=>{if(!r)return;const n=new URLSearchParams(a.location.search);n.set(r,e),a.replace({...a.location,search:n.toString()})}),[r,a])]}function R(e){const{defaultValue:n,queryString:o=!1,groupId:a}=e,r=d(e),[u,i]=(0,t.useState)((()=>function(e){let{defaultValue:n,tabValues:o}=e;if(0===o.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!y({value:n,tabValues:o}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${o.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const a=o.find((e=>e.default))??o[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:n,tabValues:r}))),[l,s]=m({queryString:o,groupId:a}),[c,R]=function(e){let{groupId:n}=e;const o=function(e){return e?`docusaurus.tab.${e}`:null}(n),[a,r]=(0,p.Dv)(o);return[a,(0,t.useCallback)((e=>{o&&r.set(e)}),[o,r])]}({groupId:a}),g=(()=>{const e=l??c;return y({value:e,tabValues:r})?e:null})();(0,t.useLayoutEffect)((()=>{g&&i(g)}),[g]);return{selectedValue:u,selectValue:(0,t.useCallback)((e=>{if(!y({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);i(e),s(e),R(e)}),[s,R,r]),tabValues:r}}var g=o(2303);const T={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function C(e){let{className:n,block:o,selectedValue:i,selectValue:l,tabValues:s}=e;const p=[],{blockElementScrollPositionUntilNextRender:c}=(0,u.a_)(),d=e=>{const n=e.currentTarget,o=p.indexOf(n),a=s[o].value;a!==i&&(c(n),l(a))},y=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const o=p.indexOf(e.currentTarget)+1;n=p[o]??p[0];break}case"ArrowLeft":{const o=p.indexOf(e.currentTarget)-1;n=p[o]??p[p.length-1];break}}n?.focus()};return t.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":o},n)},s.map((e=>{let{value:n,label:o,attributes:u}=e;return t.createElement("li",(0,a.A)({role:"tab",tabIndex:i===n?0:-1,"aria-selected":i===n,key:n,ref:e=>p.push(e),onKeyDown:y,onClick:d},u,{className:(0,r.A)("tabs__item",T.tabItem,u?.className,{"tabs__item--active":i===n})}),o??n)})))}function E(e){let{lazy:n,children:o,selectedValue:a}=e;const r=(Array.isArray(o)?o:[o]).filter(Boolean);if(n){const e=r.find((e=>e.props.value===a));return e?(0,t.cloneElement)(e,{className:"margin-top--md"}):null}return t.createElement("div",{className:"margin-top--md"},r.map(((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==a}))))}function A(e){const n=R(e);return t.createElement("div",{className:(0,r.A)("tabs-container",T.tabList)},t.createElement(C,(0,a.A)({},e,n)),t.createElement(E,(0,a.A)({},e,n)))}function v(e){const n=(0,g.A)();return t.createElement(A,(0,a.A)({key:String(n)},e))}},6431:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>p,contentTitle:()=>l,default:()=>m,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var a=o(8168),t=(o(6540),o(5680)),r=o(1470),u=o(9365);const i={title:"3. Isolation Level",tags:["BackEnd","DataBase","MySQL","TypeORM","ConcurrencyControl","IsolationLevel"],sidebar_position:3},l="3. Isolation Level",s={unversionedId:"backend/database/concurrency-control/isolation-level",id:"backend/database/concurrency-control/isolation-level",title:"3. Isolation Level",description:"\ub370\uc774\ud130\ubca0\uc774\uc2a4\ub294 \ub2e4\uc218\uc758 \ud2b8\ub79c\uc7ad\uc158\uc774 \ub3d9\uc2dc\uc5d0 \uc2e4\ud589\ub420 \ub54c \ub370\uc774\ud130\uc758 \uc77c\uad00\uc131\uc744 \uc720\uc9c0\ud558\uae30 \uc704\ud574 \ub2e4\uc591\ud55c \ud2b8\ub79c\uc7ad\uc158 \uaca9\ub9ac \uc218\uc900\uc744 \uc0ac\uc6a9\ud55c\ub2e4. \uc774\ub7ec\ud55c \uaca9\ub9ac \uc218\uc900\uc740 \ud558\ub098\uc758 \ud2b8\ub79c\uc7ad\uc158\uc774 \ub2e4\ub978 \ub3d9\uc2dc \uc2e4\ud589 \ud2b8\ub79c\uc7ad\uc158\uc758 \uc791\uc5c5\uc73c\ub85c\ubd80\ud130 \uc5b4\ub290 \uc815\ub3c4\uae4c\uc9c0 \ub3c5\ub9bd\ub418\uc5b4 \uc788\ub294\uc9c0\ub97c \uc815\uc758\ud55c\ub2e4. \uaca9\ub9ac \uc218\uc900\uc774 \ub192\uc744\uc218\ub85d \ud2b8\ub79c\uc7ad\uc158 \uac04\uc758 \uac04\uc12d\uc774 \uc904\uc5b4\ub4e4\uc9c0\ub9cc, \uadf8\ub9cc\ud07c \uc131\ub2a5\uc5d0 \uc545\uc601\ud5a5\uc744 \ubbf8\uce60 \uc218 \uc788\ub2e4.",source:"@site/docs/02-backend/02-database/02-concurrency-control/03-isolation-level.mdx",sourceDirName:"02-backend/02-database/02-concurrency-control",slug:"/backend/database/concurrency-control/isolation-level",permalink:"/backend/database/concurrency-control/isolation-level",draft:!1,tags:[{label:"BackEnd",permalink:"/tags/back-end"},{label:"DataBase",permalink:"/tags/data-base"},{label:"MySQL",permalink:"/tags/my-sql"},{label:"TypeORM",permalink:"/tags/type-orm"},{label:"ConcurrencyControl",permalink:"/tags/concurrency-control"},{label:"IsolationLevel",permalink:"/tags/isolation-level"}],version:"current",sidebarPosition:3,frontMatter:{title:"3. Isolation Level",tags:["BackEnd","DataBase","MySQL","TypeORM","ConcurrencyControl","IsolationLevel"],sidebar_position:3},sidebar:"docs",previous:{title:"2. Lock",permalink:"/backend/database/concurrency-control/lock"},next:{title:"MySQL Master/Slave Replication",permalink:"/backend/database/mysql-replication"}},p={},c=[{value:"\ubd80\uc815\ud569 \ubb38\uc81c",id:"\ubd80\uc815\ud569-\ubb38\uc81c",level:2},{value:"Dirty Read",id:"dirty-read",level:3},{value:"Non-repeatable Read",id:"non-repeatable-read",level:3},{value:"Phantom Read",id:"phantom-read",level:3},{value:"Dirty Write",id:"dirty-write",level:3},{value:"Lost Update",id:"lost-update",level:3},{value:"Read Uncommitted",id:"read-uncommitted",level:2},{value:"Test With TypeORM",id:"test-with-typeorm",level:3},{value:"Dirty Read",id:"dirty-read-1",level:4},{value:"Read Committed",id:"read-committed",level:2},{value:"Test With TypeORM",id:"test-with-typeorm-1",level:3},{value:"Non-repeatable Read",id:"non-repeatable-read-1",level:4},{value:"Phantom Read",id:"phantom-read-1",level:4},{value:"Dirty Read \ubc29\uc9c0",id:"dirty-read-\ubc29\uc9c0",level:4},{value:"Repeatable Read",id:"repeatable-read",level:2},{value:"MySQL (InnoDB)\uc758 Repeatable Read",id:"mysql-innodb\uc758-repeatable-read",level:3},{value:"Consistent Read",id:"consistent-read",level:4},{value:"Record Lock",id:"record-lock",level:4},{value:"Gab Lock",id:"gab-lock",level:4},{value:"Next Key Lock",id:"next-key-lock",level:4},{value:"Test With TypeORM",id:"test-with-typeorm-2",level:3},{value:"Non-repeatable Read \ubc29\uc9c0",id:"non-repeatable-read-\ubc29\uc9c0",level:4},{value:"Phantom Read \ubc29\uc9c0",id:"phantom-read-\ubc29\uc9c0",level:4},{value:"Serializable",id:"serializable",level:2},{value:"MySQL (InnoDB)\uc758 Serializable",id:"mysql-innodb\uc758-serializable",level:3},{value:"Test With TypeORM",id:"test-with-typeorm-3",level:3}],d={toc:c},y="wrapper";function m(e){let{components:n,...o}=e;return(0,t.yg)(y,(0,a.A)({},d,o,{components:n,mdxType:"MDXLayout"}),(0,t.yg)("h1",{id:"3-isolation-level"},"3. Isolation Level"),(0,t.yg)("p",null,"\ub370\uc774\ud130\ubca0\uc774\uc2a4\ub294 \ub2e4\uc218\uc758 \ud2b8\ub79c\uc7ad\uc158\uc774 \ub3d9\uc2dc\uc5d0 \uc2e4\ud589\ub420 \ub54c \ub370\uc774\ud130\uc758 \uc77c\uad00\uc131\uc744 \uc720\uc9c0\ud558\uae30 \uc704\ud574 \ub2e4\uc591\ud55c \ud2b8\ub79c\uc7ad\uc158 \uaca9\ub9ac \uc218\uc900\uc744 \uc0ac\uc6a9\ud55c\ub2e4. \uc774\ub7ec\ud55c \uaca9\ub9ac \uc218\uc900\uc740 \ud558\ub098\uc758 \ud2b8\ub79c\uc7ad\uc158\uc774 \ub2e4\ub978 \ub3d9\uc2dc \uc2e4\ud589 \ud2b8\ub79c\uc7ad\uc158\uc758 \uc791\uc5c5\uc73c\ub85c\ubd80\ud130 \uc5b4\ub290 \uc815\ub3c4\uae4c\uc9c0 \ub3c5\ub9bd\ub418\uc5b4 \uc788\ub294\uc9c0\ub97c \uc815\uc758\ud55c\ub2e4. \uaca9\ub9ac \uc218\uc900\uc774 \ub192\uc744\uc218\ub85d \ud2b8\ub79c\uc7ad\uc158 \uac04\uc758 \uac04\uc12d\uc774 \uc904\uc5b4\ub4e4\uc9c0\ub9cc, \uadf8\ub9cc\ud07c \uc131\ub2a5\uc5d0 \uc545\uc601\ud5a5\uc744 \ubbf8\uce60 \uc218 \uc788\ub2e4."),(0,t.yg)("table",null,(0,t.yg)("thead",{parentName:"table"},(0,t.yg)("tr",{parentName:"thead"},(0,t.yg)("th",{parentName:"tr",align:null},"Isolation Level"),(0,t.yg)("th",{parentName:"tr",align:null},"Dirty Read"),(0,t.yg)("th",{parentName:"tr",align:null},"Non-repeatable Read"),(0,t.yg)("th",{parentName:"tr",align:null},"Phantom Read"))),(0,t.yg)("tbody",{parentName:"table"},(0,t.yg)("tr",{parentName:"tbody"},(0,t.yg)("td",{parentName:"tr",align:null},(0,t.yg)("strong",{parentName:"td"},"Read uncommitted")),(0,t.yg)("td",{parentName:"tr",align:null},"O"),(0,t.yg)("td",{parentName:"tr",align:null},"O"),(0,t.yg)("td",{parentName:"tr",align:null},"O")),(0,t.yg)("tr",{parentName:"tbody"},(0,t.yg)("td",{parentName:"tr",align:null},(0,t.yg)("strong",{parentName:"td"},"Read committed")),(0,t.yg)("td",{parentName:"tr",align:null},"X"),(0,t.yg)("td",{parentName:"tr",align:null},"O"),(0,t.yg)("td",{parentName:"tr",align:null},"O")),(0,t.yg)("tr",{parentName:"tbody"},(0,t.yg)("td",{parentName:"tr",align:null},(0,t.yg)("strong",{parentName:"td"},"Repeatable Read")),(0,t.yg)("td",{parentName:"tr",align:null},"X"),(0,t.yg)("td",{parentName:"tr",align:null},"X"),(0,t.yg)("td",{parentName:"tr",align:null},"O")),(0,t.yg)("tr",{parentName:"tbody"},(0,t.yg)("td",{parentName:"tr",align:null},(0,t.yg)("strong",{parentName:"td"},"Serializable")),(0,t.yg)("td",{parentName:"tr",align:null},"X"),(0,t.yg)("td",{parentName:"tr",align:null},"X"),(0,t.yg)("td",{parentName:"tr",align:null},"X")))),(0,t.yg)("p",null,"\uc8fc\uc694 RDBMS\ub294 SQL \ud45c\uc900\uc5d0 \uae30\ubc18\ud574\uc11c \uaca9\ub9ac \uc218\uc900\uc744 \uc815\uc758\ud558\uc9c0\ub9cc RDBMS\ub9c8\ub2e4 \uc81c\uacf5\ud558\ub294 \uaca9\ub9ac \uc218\uc900\uacfc \ub3d9\uc791 \ubc29\uc2dd\uc5d0\ub294 \ucc28\uc774\uac00 \uc788\uc744 \uc218 \uc788\ub2e4."),(0,t.yg)("h2",{id:"\ubd80\uc815\ud569-\ubb38\uc81c"},"\ubd80\uc815\ud569 \ubb38\uc81c"),(0,t.yg)("p",null,"SQL \ud45c\uc900\uc5d0\uc11c \uc815\uc758\ud558\ub294 3\uac00\uc9c0 \uc8fc\uc694 \ubd80\uc815\ud569 \ubb38\uc81c\ub294 \uc544\ub798\uc640 \uac19\ub2e4."),(0,t.yg)("h3",{id:"dirty-read"},"Dirty Read"),(0,t.yg)("p",null,"\ud2b8\ub79c\uc7ad\uc158\uc774 \uc544\uc9c1 \ucee4\ubc0b\ub418\uc9c0 \uc54a\uc740 \ub2e4\ub978 \ud2b8\ub79c\uc7ad\uc158\uc758 \ub370\uc774\ud130\ub97c \uc77d\uc744 \ub54c \ubc1c\uc0dd\ud55c\ub2e4. \uc774\ub85c \uc778\ud574 \ud2b8\ub79c\uc7ad\uc158\uc774 \ub864\ubc31\ub418\uba74 \uc798\ubabb\ub41c \ub370\uc774\ud130\ub97c \uae30\ubc18\uc73c\ub85c \uc791\uc5c5\uc774 \uc218\ud589\ub420 \uc218 \uc788\uc5b4 \ub370\uc774\ud130 \ubb34\uacb0\uc131\uc744 \uce68\ud574\ud560 \uc218 \uc788\ub2e4."),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre"},"x = 10, y = 20\nTi = x\uc5d0 y\ub97c \ub354\ud55c\ub2e4.\nTj = y\ub97c 70\uc73c\ub85c \ubc14\uafbc\ub2e4.\n\nTi read(x) => 10\nTj write(y = 70)\nTi read(y) => 70\nTi write(x = 80)\nTi commit\nTj abort : rollback(y = 20)\n")),(0,t.yg)("p",null,"Ti\ub294 \ucee4\ubc0b\ub418\uc9c0 \uc54a\uc740 y \ub370\uc774\ud130\ub97c \uc77d\uc5c8\uc9c0\ub9cc Tj\uac00 \ub864\ubc31\ub428\uc73c\ub85c\uc368 \ub370\uc774\ud130 \ubd80\uc815\ud569\uc774 \ubc1c\uc0dd\ud55c\ub2e4."),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre"},"x = 50, y = 50\nTi = x\uac00 y\uc5d0 40\uc744 \uc774\uccb4\ud55c\ub2e4.\nTj = x\uc640 y\ub97c \uc77d\ub294\ub2e4.\n\nTi read(x) => 50\nTi write(x = 10)\nTj read(x) => 10\nTj read(y) => 50\nTj commit\nTi read(y) => 50\nTi write(y = 90)\nTi commit\n")),(0,t.yg)("p",null,"\ub864\ubc31\uc774 \ubc1c\uc0dd\ud558\uc9c0 \uc54a\ub354\ub77c\ub3c4 Dirty Read\uac00 \ubc1c\uc0dd\ud560 \uc218 \uc788\ub2e4."),(0,t.yg)("h3",{id:"non-repeatable-read"},"Non-repeatable Read"),(0,t.yg)("p",null,"\ub3d9\uc77c\ud55c \ud2b8\ub79c\uc7ad\uc158 \ub0b4\uc5d0\uc11c \uac19\uc740 \ub370\uc774\ud130\ub97c \ub450 \ubc88 \uc77d\uc744 \ub54c \ub2e4\ub978 \uacb0\uacfc\uac00 \ub098\ud0c0\ub098\ub294 \uc0c1\ud669\uc744 \uc758\ubbf8\ud55c\ub2e4."),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre"},"x = 10\nTi = x\ub97c \ub450 \ubc88 \uc77d\ub294\ub2e4.\nTj = x\uc5d0 40\uc744 \ub354\ud55c\ub2e4.\n\nTi read(x) => 10\nTj read(x) => 10\nTj write(x = 50)\nTj commit\nTi read(x) => 50\nTi commit\n")),(0,t.yg)("p",null,"Ti\uc5d0\uc11c x\ub97c \ub450 \ubc88 \uc77d\ub294 \uc0ac\uc774\uc5d0 Tj\uc5d0 \uc758\ud574 x\uac00 \uc5c5\ub370\uc774\ud2b8\ub428\uc73c\ub85c\uc368 \ub2e4\ub978 \uac12\uc744 \uc77d\uac8c \ub41c\ub2e4."),(0,t.yg)("h3",{id:"phantom-read"},"Phantom Read"),(0,t.yg)("p",null,"\ud2b9\uc815 \ud2b8\ub79c\uc7ad\uc158\uc774 \ubc94\uc704 \uae30\ubc18\uc758 \ucffc\ub9ac\ub97c \ubc18\ubcf5 \uc2e4\ud589\ud560 \ub54c, \ucffc\ub9ac \uacb0\uacfc\uc5d0 \uc0c8\ub85c\uc6b4 \ub370\uc774\ud130\uac00 \ucd94\uac00\ub418\uac70\ub098 \uae30\uc874 \ub370\uc774\ud130\uac00 \uc0ad\uc81c\ub428\uc5d0 \ub530\ub77c \uacb0\uacfc\uac00 \ub2ec\ub77c\uc9c0\ub294 \ud604\uc0c1\uc774\ub2e4."),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre"},"t1(..., v = 10)\nTi = v\uac00 10\uc778 \ub370\uc774\ud130\ub97c \ub450 \ubc88 \uc77d\ub294\ub2e4.\nTj = v\uac00 10\uc778 \ub370\uc774\ud130 t2\ub97c \uc0c8\ub86d\uac8c \uc0bd\uc785\ud55c\ub2e4.\n\nTi read(v = 10) => t1\nTj write(t2.v = 10)\nTj commit\nTi read(v = 10) => t1, t2\nTi commit\n")),(0,t.yg)("p",null,"Ti\uac00 v=10 \uc870\uac74\uc73c\ub85c \ub450 \ubc88 \uc870\ud68c\ud560 \ub54c, \uc911\uac04\uc5d0 Tj\uc5d0 \uc758\ud574 \uc870\uac74\uc5d0 \ubd80\ud569\ud558\ub294 \ud589\uc774 \ucd94\uac00\ub418\uba74\uc11c \uacb0\uacfc\uac00 \ub2ec\ub77c\uc9c0\uac8c \ub41c\ub2e4."),(0,t.yg)("hr",null),(0,t.yg)("p",null,"SQL \ud45c\uc900\uc5d0\ub294 \uc815\uc758\ub418\uc9c0 \uc54a\uc558\uc9c0\ub9cc \uadf8 \uc678 \uc5ec\ub7ec\uac00\uc9c0 \ubd80\uc815\ud569 \ubb38\uc81c\ub4e4\uc774 \uc874\uc7ac\ud55c\ub2e4."),(0,t.yg)("h3",{id:"dirty-write"},"Dirty Write"),(0,t.yg)("p",null,"\ub450 \uac1c \uc774\uc0c1\uc758 \ud2b8\ub79c\uc7ad\uc158\uc774 \ub3d9\uc2dc\uc5d0 \uac19\uc740 \ub370\uc774\ud130\ub97c \uc218\uc815\ud558\ub294 \uc0c1\ud669\uc5d0\uc11c \ubc1c\uc0dd\ud55c\ub2e4. \uc544\uc9c1 \ucee4\ubc0b\ub418\uc9c0 \uc54a\uc740 \ub370\uc774\ud130\uac00 \ub2e4\ub978 \ud2b8\ub79c\uc7ad\uc158\uc5d0 \uc758\ud574 \uc218\uc815\ub418\uc5c8\uc744 \ub54c \ubc1c\uc0dd\ud558\uba70, \ud2b8\ub79c\uc7ad\uc158 \uc911 \ud558\ub098\uac00 \ub864\ubc31\ub420 \uacbd\uc6b0 \ub370\uc774\ud130\uc758 \uc77c\uad00\uc131\uc774 \uae68\uc9c8 \uc704\ud5d8\uc774 \uc788\ub2e4."),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre"},"x = 10\nTi = x\ub97c 20\uc73c\ub85c \ubc14\uafbc\ub2e4.\nTj = x\ub97c 100\uc73c\ub85c \ubc14\uafbc\ub2e4.\n\nTi write(x) => 20\nTj write(x) => 100\nTi abort\n")),(0,t.yg)("p",null,"Ti\uac00 x\ub97c \uc218\uc815\ud558\uace0 \uc544\uc9c1 \ucee4\ubc0b\ub418\uc9c0 \uc54a\uc740 \uc0c1\ud0dc\uc5d0\uc11c Tj\ub3c4 x\ub97c \uc218\uc815\ud55c\ub2e4. \ub9cc\uc57d Ti\uac00 \ub864\ubc31\ub41c\ub2e4\uba74, x\ub294 10\uc73c\ub85c \ub3cc\uc544\uac00\uc57c \ud558\uc9c0\ub9cc, Tj\uc5d0\uc11c x\ub97c 100\uc73c\ub85c \uc218\uc815\ud558\uc600\uae30 \ub54c\ubb38\uc5d0 \ub370\uc774\ud130\uc758 \uc77c\uad00\uc131\uc5d0 \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud560 \uc218 \uc788\ub2e4. \uacb0\uad6d Ti\uac00 \ub864\ubc31\ub41c \uc774\ud6c4, x\uc758 \uac12\uc774 \ubb34\uc5c7\uc774\uc5b4\uc57c \ud558\ub294\uc9c0 \ud63c\ub780\uc2a4\ub7ec\uc6b4 \uc0c1\ud669\uc774 \ubc1c\uc0dd\ud55c\ub2e4."),(0,t.yg)("h3",{id:"lost-update"},"Lost Update"),(0,t.yg)("p",null,"\ub450 \uac1c \uc774\uc0c1\uc758 \ud2b8\ub79c\uc7ad\uc158\uc774 \ub3d9\uc77c\ud55c \ub370\uc774\ud130\ub97c \uc218\uc815\ud558\ub294 \uc0c1\ud669\uc5d0\uc11c \ubc1c\uc0dd\ud55c\ub2e4. \ud2b8\ub79c\uc7ad\uc158\uc774 \uc11c\ub85c\uc758 \ubcc0\uacbd \uc0ac\ud56d\uc744 \ub36e\uc5b4\uc368\uc11c, \ub098\uc911\uc5d0 \ucee4\ubc0b\ub41c \ud2b8\ub79c\uc7ad\uc158\uc758 \uacb0\uacfc\ub9cc \ubc18\uc601\ub418\uace0 \uba3c\uc800 \ucee4\ubc0b\ub41c \ud2b8\ub79c\uc7ad\uc158\uc758 \uc5c5\ub370\uc774\ud2b8\ub294 \uc0ac\ub77c\uc9c0\ub294 \uc0c1\ud669\uc774\ub2e4."),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre"},"x = 100\nTi = x\uc5d0 50\uc744 \ub354\ud55c\ub2e4.\nTj = x\uc5d0 150\uc744 \ub354\ud55c\ub2e4.\n\nTi read(x) => 50\nTj read(x) => 50\nTj write(x = 200)\nTj commit\nTi write(x = 100)\nTi commit\n")),(0,t.yg)("p",null,"\ub3d9\uc2dc\uc5d0 x\ub97c \uc218\uc815\ud558\ub824\ub294 \uc0c1\ud669\uc5d0\uc11c Ti\uc758 \ucee4\ubc0b\uc5d0 \uc758\ud574 Tj\uc758 \uc5c5\ub370\uc774\ud2b8 \uc0ac\ud56d\uc740 \uc0ac\ub77c\uc9c0\uac8c \ub41c\ub2e4."),(0,t.yg)("h2",{id:"read-uncommitted"},"Read Uncommitted"),(0,t.yg)("p",null,"\uac00\uc7a5 \ub0ae\uc740 \uc218\uc900\uc758 \uaca9\ub9ac \uc218\uc900\uc73c\ub85c, \ub2e4\ub978 \ud2b8\ub79c\uc7ad\uc158\uc774 \uc544\uc9c1 \ucee4\ubc0b\ub418\uc9c0 \uc54a\uc740 \ub370\uc774\ud130\ub97c \uc77d\uc744 \uc218 \uc788\ub2e4. \uc774\ub85c \uc778\ud574 Dirty Read \ubb38\uc81c \ubc0f Non-repeatable Read, Phantom Read \ubb38\uc81c\uac00 \ubaa8\ub450 \ubc1c\uc0dd\ud560 \uc218 \uc788\ub2e4."),(0,t.yg)("h3",{id:"test-with-typeorm"},"Test With TypeORM"),(0,t.yg)("h4",{id:"dirty-read-1"},"Dirty Read"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-ts"},'it("should allow dirty read with READ UNCOMMITTED isolation level", async () => {\n  await couponRepository.save({ code: "COUPON_1" });\n\n  const queryRunner1 = dataSource.createQueryRunner();\n  await queryRunner1.connect();\n  await queryRunner1.startTransaction("READ UNCOMMITTED");\n\n  const queryRunner2 = dataSource.createQueryRunner();\n  await queryRunner2.connect();\n  await queryRunner2.startTransaction("READ UNCOMMITTED");\n\n  try {\n    // \ud2b8\ub79c\uc7ad\uc158 1\uc774 \ucfe0\ud3f0\uc744 \uc870\ud68c\ud558\uace0 \ubcc0\uacbd\n    const coupon1 = await queryRunner1.manager.findOne(Coupon, {\n      where: { code: "COUPON_1" },\n    });\n    if (coupon1) {\n      coupon1.isRedeemed = true;\n      await queryRunner1.manager.save(coupon1);\n    }\n\n    // \ud2b8\ub79c\uc7ad\uc158 2\uac00 \ud2b8\ub79c\uc7ad\uc158 1\uc758 \ucee4\ubc0b \uc804\uc5d0 \ub3d9\uc77c\ud55c \ucfe0\ud3f0\uc744 \uc870\ud68c\n    const coupon2 = await queryRunner2.manager.findOne(Coupon, {\n      where: { code: "COUPON_1" },\n    });\n\n    // \ud2b8\ub79c\uc7ad\uc158 1\uc774 \ub864\ubc31\ub428\n    await queryRunner1.rollbackTransaction();\n\n    // \ud2b8\ub79c\uc7ad\uc158 1\uc740 \ub864\ubc31\ub418\uc5c8\uc9c0\ub9cc \ud2b8\ub79c\uc7ad\uc158 2\ub294 \ud2b8\ub79c\uc7ad\uc158 1\uc758 \ubbf8\ucee4\ubc0b \uc0c1\ud0dc\uc758 \uc218\uc815\ub41c \ub370\uc774\ud130\ub97c \uc77d\uc74c\n    expect(coupon2.isRedeemed).toBe(true);\n\n    await queryRunner2.commitTransaction();\n  } finally {\n    await queryRunner1.release();\n    await queryRunner2.release();\n  }\n});\n')),(0,t.yg)("p",null,(0,t.yg)("strong",{parentName:"p"},"\uc2e4\ud589 \ucffc\ub9ac")),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-sql"},'-- \uaca9\ub9ac\uc218\uc900\uc774 READ UNCOMMITTED\ub85c \uc124\uc815\ub41c \ub450 \uac1c\uc758 \ud2b8\ub79c\uc7ad\uc158 \uc2dc\uc791\nSET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED\nSTART TRANSACTION\nSET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED\nSTART TRANSACTION\n\n-- \ud2b8\ub79c\uc7ad\uc158 1\uc758 \ucfe0\ud3f0 \uc870\ud68c (findOne)\nSELECT `Coupon`.`id` AS `Coupon_id`, `Coupon`.`code` AS `Coupon_code`, `Coupon`.`isRedeemed` AS `Coupon_isRedeemed`, `Coupon`.`user_id` AS `Coupon_user_id`, `Coupon`.`version` AS `Coupon_version` FROM `coupon` `Coupon` WHERE ((`Coupon`.`code` = ?)) LIMIT 1 -- PARAMETERS: ["COUPON_1"]\n\n-- \ud2b8\ub79c\uc7ad\uc158 1\uc758 \ucfe0\ud3f0 \uc5c5\ub370\uc774\ud2b8 (save)\nSELECT `Coupon`.`id` AS `Coupon_id`, `Coupon`.`code` AS `Coupon_code`, `Coupon`.`isRedeemed` AS `Coupon_isRedeemed`, `Coupon`.`user_id` AS `Coupon_user_id`, `Coupon`.`version` AS `Coupon_version` FROM `coupon` `Coupon` WHERE `Coupon`.`id` IN (?) -- PARAMETERS: [403]\nUPDATE `coupon` SET `isRedeemed` = ?, `version` = `version` + 1 WHERE `id` IN (?) -- PARAMETERS: [1,403]\nSELECT `Coupon`.`id` AS `Coupon_id`, `Coupon`.`version` AS `Coupon_version` FROM `coupon` `Coupon` WHERE `Coupon`.`id` = ? -- PARAMETERS: [403]\n\n-- \ud2b8\ub79c\uc7ad\uc158 1\uc774 \ucee4\ubc0b\ub418\uc9c0 \uc54a\uc740 \uc0c1\ud0dc\uc5d0\uc11c \ud2b8\ub79c\uc7ad\uc158 2\uac00 \ucfe0\ud3f0 \uc870\ud68c\nSELECT `Coupon`.`id` AS `Coupon_id`, `Coupon`.`code` AS `Coupon_code`, `Coupon`.`isRedeemed` AS `Coupon_isRedeemed`, `Coupon`.`user_id` AS `Coupon_user_id`, `Coupon`.`version` AS `Coupon_version` FROM `coupon` `Coupon` WHERE ((`Coupon`.`code` = ?)) LIMIT 1 -- PARAMETERS: ["COUPON_1"]\n\n-- \ud2b8\ub79c\uc7ad\uc158 1 \ub864\ubc31\nROLLBACK\n\n-- \ud2b8\ub79c\uc7ad\uc158 2 \ucee4\ubc0b\nCOMMIT\n')),(0,t.yg)("h2",{id:"read-committed"},"Read Committed"),(0,t.yg)("p",null,"\uc774 \uaca9\ub9ac \uc218\uc900\uc5d0\uc11c\ub294 \ud2b8\ub79c\uc7ad\uc158\uc774 \ucee4\ubc0b\ub41c \ub370\uc774\ud130\ub9cc \uc77d\uc744 \uc218 \uc788\ub2e4. \uc989, \ub2e4\ub978 \ud2b8\ub79c\uc7ad\uc158\uc774 \uc544\uc9c1 \ucee4\ubc0b\ub418\uc9c0 \uc54a\uc740 \ub370\uc774\ud130\ub97c \uc77d\ub294 \uac83\uc744 \ubc29\uc9c0\ud55c\ub2e4. \ub54c\ubb38\uc5d0 Dirty Read \ubb38\uc81c\ub294 \ubc29\uc9c0\ub418\uc9c0\ub9cc Non-repeatable Read \ubb38\uc81c\uc640 Phantom Read \ubb38\uc81c\ub294 \ubc1c\uc0dd\ud560 \uc218 \uc788\ub2e4."),(0,t.yg)("h3",{id:"test-with-typeorm-1"},"Test With TypeORM"),(0,t.yg)("h4",{id:"non-repeatable-read-1"},"Non-repeatable Read"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-ts"},'it("should allow non repeatable read with READ COMMITTED isolation level", async () => {\n  await couponRepository.save({\n    code: "COUPON_1",\n  });\n\n  const queryRunner1 = dataSource.createQueryRunner();\n  await queryRunner1.connect();\n  await queryRunner1.startTransaction("READ COMMITTED");\n\n  const queryRunner2 = dataSource.createQueryRunner();\n  await queryRunner2.connect();\n  await queryRunner2.startTransaction("READ COMMITTED");\n\n  try {\n    // \ud2b8\ub79c\uc7ad\uc158 1\uc774 \ucfe0\ud3f0\uc744 \uc870\ud68c\n    const coupon1Before = await queryRunner1.manager.findOne(Coupon, {\n      where: { code: "COUPON_1" },\n    });\n\n    // \ud2b8\ub79c\uc7ad\uc158 2\uac00 \ub3d9\uc77c\ud55c \ucfe0\ud3f0\uc744 \uc870\ud68c\ud558\uace0 \uc218\uc815\n    const coupon2 = await queryRunner2.manager.findOne(Coupon, {\n      where: { code: "COUPON_1" },\n    });\n\n    if (coupon2) {\n      coupon2.isRedeemed = true;\n      await queryRunner2.manager.save(coupon2);\n    }\n\n    // \ud2b8\ub79c\uc7ad\uc158 2\uac00 \ucee4\ubc0b\ub428\n    await queryRunner2.commitTransaction();\n\n    // \ud2b8\ub79c\uc7ad\uc158 1\uc774 \ub2e4\uc2dc \ucfe0\ud3f0\uc744 \uc870\ud68c (non-repeatable read \ubc1c\uc0dd)\n    const coupon1After = await queryRunner1.manager.findOne(Coupon, {\n      where: { code: "COUPON_1" },\n    });\n\n    expect(coupon1Before.isRedeemed).toBe(false); // \uccab \ubc88\uc9f8 \uc77d\uae30 \uacb0\uacfc\ub294 \uc218\uc815 \uc804 \uc0c1\ud0dc\n    expect(coupon1After.isRedeemed).toBe(true); // \ub450 \ubc88\uc9f8 \uc77d\uae30 \uacb0\uacfc\ub294 \uc218\uc815 \ud6c4 \uc0c1\ud0dc\n\n    await queryRunner1.commitTransaction();\n  } finally {\n    await queryRunner1.release();\n    await queryRunner2.release();\n  }\n});\n')),(0,t.yg)("p",null,(0,t.yg)("strong",{parentName:"p"},"\uc2e4\ud589 \ucffc\ub9ac")),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-sql"},'-- \uaca9\ub9ac\uc218\uc900\uc774 READ COMMITTED\ub85c \uc124\uc815\ub41c \ub450 \uac1c\uc758 \ud2b8\ub79c\uc7ad\uc158 \uc2dc\uc791\nSET TRANSACTION ISOLATION LEVEL READ COMMITTED\nSTART TRANSACTION\nSET TRANSACTION ISOLATION LEVEL READ COMMITTED\nSTART TRANSACTION\n\n-- \ud2b8\ub79c\uc7ad\uc158 1\uc758 \ucfe0\ud3f0 \uc870\ud68c (findOne)\nSELECT `Coupon`.`id` AS `Coupon_id`, `Coupon`.`code` AS `Coupon_code`, `Coupon`.`isRedeemed` AS `Coupon_isRedeemed`, `Coupon`.`user_id` AS `Coupon_user_id`, `Coupon`.`version` AS `Coupon_version` FROM `coupon` `Coupon` WHERE ((`Coupon`.`code` = ?)) LIMIT 1 -- PARAMETERS: ["COUPON_1"]\n\n-- \ud2b8\ub79c\uc7ad\uc158 2\uc758 \ucfe0\ud3f0 \uc870\ud68c (findOne)\nSELECT `Coupon`.`id` AS `Coupon_id`, `Coupon`.`code` AS `Coupon_code`, `Coupon`.`isRedeemed` AS `Coupon_isRedeemed`, `Coupon`.`user_id` AS `Coupon_user_id`, `Coupon`.`version` AS `Coupon_version` FROM `coupon` `Coupon` WHERE ((`Coupon`.`code` = ?)) LIMIT 1 -- PARAMETERS: ["COUPON_1"]\n\n-- \ud2b8\ub79c\uc7ad\uc158 2\uc758 \ucfe0\ud3f0 \uc5c5\ub370\uc774\ud2b8 (save)\nSELECT `Coupon`.`id` AS `Coupon_id`, `Coupon`.`code` AS `Coupon_code`, `Coupon`.`isRedeemed` AS `Coupon_isRedeemed`, `Coupon`.`user_id` AS `Coupon_user_id`, `Coupon`.`version` AS `Coupon_version` FROM `coupon` `Coupon` WHERE `Coupon`.`id` IN (?) -- PARAMETERS: [407]\nUPDATE `coupon` SET `isRedeemed` = ?, `version` = `version` + 1 WHERE `id` IN (?) -- PARAMETERS: [1,407]\nSELECT `Coupon`.`id` AS `Coupon_id`, `Coupon`.`version` AS `Coupon_version` FROM `coupon` `Coupon` WHERE `Coupon`.`id` = ? -- PARAMETERS: [407]\n\n-- \ud2b8\ub79c\uc7ad\uc158 2 \ucee4\ubc0b\nCOMMIT\n\n-- \ud2b8\ub79c\uc7ad\uc158 1\uc774 \ucfe0\ud3f0\uc744 \ub2e4\uc2dc \uc870\ud68c (findOne)\nSELECT `Coupon`.`id` AS `Coupon_id`, `Coupon`.`code` AS `Coupon_code`, `Coupon`.`isRedeemed` AS `Coupon_isRedeemed`, `Coupon`.`user_id` AS `Coupon_user_id`, `Coupon`.`version` AS `Coupon_version` FROM `coupon` `Coupon` WHERE ((`Coupon`.`code` = ?)) LIMIT 1 -- PARAMETERS: ["COUPON_1"]\n\n-- \ud2b8\ub79c\uc7ad\uc158 1 \ucee4\ubc0b\nCOMMIT\n')),(0,t.yg)("h4",{id:"phantom-read-1"},"Phantom Read"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-ts"},'it("should allow phantom read with READ COMMITTED isolation level", async () => {\n  await couponRepository.save({ code: "COUPON_1" });\n\n  const queryRunner1 = dataSource.createQueryRunner();\n  await queryRunner1.connect();\n  await queryRunner1.startTransaction("READ COMMITTED");\n\n  const queryRunner2 = dataSource.createQueryRunner();\n  await queryRunner2.connect();\n  await queryRunner2.startTransaction("READ COMMITTED");\n\n  try {\n    // \ud2b8\ub79c\uc7ad\uc158 1\uc774 isRedeemd\uac00 false\uc778 \ucfe0\ud3f0\uc744 \uc870\ud68c\n    const couponsBefore = await queryRunner1.manager.find(Coupon, {\n      where: { isRedeemed: false },\n    });\n\n    // \ud2b8\ub79c\uc7ad\uc158 2\uac00 \uc0c8\ub85c\uc6b4 \ucfe0\ud3f0\uc744 \ucd94\uac00\n    await queryRunner2.manager.insert(Coupon, {\n      code: "COUPON_2",\n    });\n    await queryRunner2.commitTransaction();\n\n    // \ud2b8\ub79c\uc7ad\uc158 1\uc774 \ub2e4\uc2dc isRedeemd\uac00 false\uc778 \ucfe0\ud3f0\uc744 \uc870\ud68c (phantom read \ubc1c\uc0dd)\n    const couponsAfter = await queryRunner1.manager.find(Coupon, {\n      where: { isRedeemed: false },\n    });\n\n    expect(couponsBefore.length).toBe(1);\n    expect(couponsAfter.length).toBe(2);\n\n    await queryRunner1.commitTransaction();\n  } finally {\n    await queryRunner2.release();\n    await queryRunner1.release();\n  }\n});\n')),(0,t.yg)("p",null,(0,t.yg)("strong",{parentName:"p"},"\uc2e4\ud589 \ucffc\ub9ac")),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-sql"},'-- \uaca9\ub9ac\uc218\uc900\uc774 READ COMMITTED\ub85c \uc124\uc815\ub41c \ub450 \uac1c\uc758 \ud2b8\ub79c\uc7ad\uc158 \uc2dc\uc791\nSET TRANSACTION ISOLATION LEVEL READ COMMITTED\nSTART TRANSACTION\nSET TRANSACTION ISOLATION LEVEL READ COMMITTED\nSTART TRANSACTION\n\n-- \ud2b8\ub79c\uc7ad\uc158 1\uc774 isRedeemd\uac00 false\uc778 \ucfe0\ud3f0\uc744 \uc870\ud68c (find)\nSELECT `Coupon`.`id` AS `Coupon_id`, `Coupon`.`code` AS `Coupon_code`, `Coupon`.`isRedeemed` AS `Coupon_isRedeemed`, `Coupon`.`user_id` AS `Coupon_user_id`, `Coupon`.`version` AS `Coupon_version` FROM `coupon` `Coupon` WHERE ((`Coupon`.`isRedeemed` = ?)) -- PARAMETERS: [false]\n\n-- \ud2b8\ub79c\uc7ad\uc158 2\uac00 \uc0c8\ub85c\uc6b4 \ucfe0\ud3f0\uc744 \ucd94\uac00 (insert)\nINSERT INTO `coupon`(`id`, `code`, `isRedeemed`, `user_id`, `version`) VALUES (DEFAULT, ?, DEFAULT, DEFAULT, 1) -- PARAMETERS: ["COUPON_2"]\nSELECT `Coupon`.`id` AS `Coupon_id`, `Coupon`.`isRedeemed` AS `Coupon_isRedeemed`, `Coupon`.`version` AS `Coupon_version` FROM `coupon` `Coupon` WHERE `Coupon`.`id` = ? -- PARAMETERS: [409]\n\n-- \ud2b8\ub79c\uc7ad\uc158 2 \ucee4\ubc0b\nCOMMIT\n\n-- \ud2b8\ub79c\uc7ad\uc158 1\uc774 \ub2e4\uc2dc isRedeemd\uac00 false\uc778 \ucfe0\ud3f0\uc744 \uc870\ud68c (find)\nSELECT `Coupon`.`id` AS `Coupon_id`, `Coupon`.`code` AS `Coupon_code`, `Coupon`.`isRedeemed` AS `Coupon_isRedeemed`, `Coupon`.`user_id` AS `Coupon_user_id`, `Coupon`.`version` AS `Coupon_version` FROM `coupon` `Coupon` WHERE ((`Coupon`.`isRedeemed` = ?)) -- PARAMETERS: [false]\n\n-- \ud2b8\ub79c\uc7ad\uc158 2 \ucee4\ubc0b\nCOMMIT\n')),(0,t.yg)("h4",{id:"dirty-read-\ubc29\uc9c0"},"Dirty Read \ubc29\uc9c0"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-ts"},'it("should prevent dirty read with READ COMMITTED isolation level", async () => {\n  await couponRepository.save({ code: "COUPON_1" });\n\n  const queryRunner1 = dataSource.createQueryRunner();\n  await queryRunner1.connect();\n  await queryRunner1.startTransaction("READ COMMITTED");\n\n  const queryRunner2 = dataSource.createQueryRunner();\n  await queryRunner2.connect();\n  await queryRunner2.startTransaction("READ COMMITTED");\n\n  try {\n    // \ud2b8\ub79c\uc7ad\uc158 1\uc774 \ucfe0\ud3f0\uc744 \uc870\ud68c\ud558\uace0 \ubcc0\uacbd\ud558\uc9c0\ub9cc \uc544\uc9c1 \ucee4\ubc0b\ud558\uc9c0 \uc54a\uc74c\n    const coupon1 = await queryRunner1.manager.findOne(Coupon, {\n      where: { code: "COUPON_1" },\n    });\n\n    if (coupon1) {\n      coupon1.isRedeemed = true;\n      await queryRunner1.manager.save(coupon1);\n    }\n\n    // \ud2b8\ub79c\uc7ad\uc158 2\uac00 \ub3d9\uc77c\ud55c \ucfe0\ud3f0\uc744 \uc870\ud68c, \ud2b8\ub79c\uc7ad\uc158 1\uc758 \ubcc0\uacbd\uc0ac\ud56d\uc774 \ubcf4\uc774\uc9c0 \uc54a\uc74c (Dirty Read\uac00 \ubc1c\uc0dd\ud558\uc9c0 \uc54a\uc74c)\n    const coupon2 = await queryRunner2.manager.findOne(Coupon, {\n      where: { code: "COUPON_1" },\n    });\n    expect(coupon2.isRedeemed).toBe(false); // \ucfe0\ud3f0\uc774 \ubcc0\uacbd\ub418\uc9c0 \uc54a\uc740 \uc0c1\ud0dc\uc5ec\uc57c \ud568\n\n    await queryRunner1.rollbackTransaction();\n    await queryRunner2.commitTransaction();\n  } finally {\n    await queryRunner1.release();\n    await queryRunner2.release();\n  }\n});\n')),(0,t.yg)("h2",{id:"repeatable-read"},"Repeatable Read"),(0,t.yg)("p",null,"\uc774 \uaca9\ub9ac \uc218\uc900\uc5d0\uc11c\ub294 \ud2b8\ub79c\uc7ad\uc158\uc774 \uc2dc\uc791\ub41c \uc2dc\uc810\uc758 \ub370\uc774\ud130 \uc0c1\ud0dc\ub97c \uae30\uc900\uc73c\ub85c \ub3d9\uc77c\ud55c \ucffc\ub9ac\ub97c \uc5ec\ub7ec \ubc88 \uc2e4\ud589\ud574\ub3c4 \uac19\uc740 \uacb0\uacfc\ub97c \ubc18\ud658\ud55c\ub2e4. SQL \ud45c\uc900\uc5d0\uc11c Repeatable Read\ub294 \uac1c\ubcc4 \ud589\uc758 \uc77c\uad00\uc131\ub9cc\uc744 \ubcf4\uc7a5\ud558\uace0 \ud2b8\ub79c\uc7ad\uc158 \uac04\uc758 \ub370\uc774\ud130 \uc0bd\uc785 \ubc0f \uc0ad\uc81c\uc5d0 \uc758\ud574 \ub370\uc774\ud130 \ubc94\uc704\uac00 \uc601\ud5a5\uc744 \ubc1b\uc744 \uc218 \uc788\ub294 \uc0c1\ud669\uc744 \uace0\ub824\ud558\uc9c0 \uc54a\ub294\ub2e4. \ub530\ub77c\uc11c Phantom Read \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud560 \uc218 \uc788\ub2e4."),(0,t.yg)("h3",{id:"mysql-innodb\uc758-repeatable-read"},"MySQL (InnoDB)\uc758 Repeatable Read"),(0,t.yg)("p",null,"MySQL\uc758 InnoDB \uc2a4\ud1a0\ub9ac\uc9c0 \uc5d4\uc9c4\uc758 Repeatable Read \uaca9\ub9ac \uc218\uc900\uc5d0\uc11c\ub294 SQL \ud45c\uc900\uacfc \ub2e4\ub974\uac8c \uc77c\ubc18\uc801\uc73c\ub85c Phantom Read\uac00 \ubc1c\uc0dd\ud558\uc9c0 \uc54a\ub294\ub2e4."),(0,t.yg)("blockquote",null,(0,t.yg)("p",{parentName:"blockquote"},"\ub3d9\uc77c\ud55c \ud2b8\ub79c\uc7ad\uc158 \ub0b4\uc5d0\uc11c\uc758 consistent read\ub294 \uccab \ubc88\uc9f8 \uc77d\uae30 \uc791\uc5c5\uc5d0\uc11c \uc124\uc815\ub41c \uc2a4\ub0c5\uc0f7\uc744 \uc77d\uc2b5\ub2c8\ub2e4. \uc989, \ub3d9\uc77c\ud55c \ud2b8\ub79c\uc7ad\uc158 \ub0b4\uc5d0\uc11c \uc5ec\ub7ec \ubc88\uc758 \uc77c\ubc18\uc801\uc778 (\uc7a0\uae08\uc744 \uac78\uc9c0 \uc54a\ub294) ",(0,t.yg)("strong",{parentName:"p"},"SELECT")," \ubb38\uc744 \uc2e4\ud589\ud558\ub354\ub77c\ub3c4, \uc774 ",(0,t.yg)("strong",{parentName:"p"},"SELECT")," \ubb38\ub4e4\uc740 \uc11c\ub85c \uc77c\uad00\ub41c \uacb0\uacfc\ub97c \ubc18\ud658\ud569\ub2c8\ub2e4. \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 ",(0,t.yg)("strong",{parentName:"p"},'Section 17.7.2.3, "Consistent Nonlocking Reads"'),"\ub97c \ucc38\uc870\ud558\uc138\uc694."),(0,t.yg)("p",{parentName:"blockquote"},(0,t.yg)("strong",{parentName:"p"},"FOR UPDATE")," \ub610\ub294 ",(0,t.yg)("strong",{parentName:"p"},"FOR SHARE"),"\uc640 \ud568\uaed8 \uc0ac\uc6a9\ud558\ub294 SELECT \ubb38, ",(0,t.yg)("strong",{parentName:"p"},"UPDATE"),", ",(0,t.yg)("strong",{parentName:"p"},"DELETE")," \ubb38\uacfc \uac19\uc740 \uc7a0\uae08\uc744 \uac70\ub294 \uc77d\uae30 \uc791\uc5c5\uc758 \uacbd\uc6b0, InnoDB\uac00 \uc7a0\uae08\uc744 \uac70\ub294 \ubc29\uc2dd\uc740 \ud574\ub2f9 \ubb38\uc774 \uace0\uc720 \uc778\ub371\uc2a4\uc640 \uace0\uc720\ud55c \uac80\uc0c9 \uc870\uac74\uc744 \uc0ac\uc6a9\ud558\ub294\uc9c0, \uc544\ub2c8\uba74 \ubc94\uc704 \ud0c0\uc785 \uac80\uc0c9 \uc870\uac74\uc744 \uc0ac\uc6a9\ud558\ub294\uc9c0\uc5d0 \ub530\ub77c \ub2e4\ub985\ub2c8\ub2e4."),(0,t.yg)("p",{parentName:"blockquote"},"\uace0\uc720 \uc778\ub371\uc2a4\uc640 \uace0\uc720\ud55c \uac80\uc0c9 \uc870\uac74\uc744 \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0, InnoDB\ub294 \ubc1c\uacac\ub41c \uc778\ub371\uc2a4 \ub808\ucf54\ub4dc\ub9cc \uc7a0\uadf8\uba70, \uadf8 \uc55e\uc758 \uac04\uaca9(gap)\uc740 \uc7a0\uadf8\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4."),(0,t.yg)("p",{parentName:"blockquote"},"\ub2e4\ub978 \uac80\uc0c9 \uc870\uac74\uc744 \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0, InnoDB\ub294 \uc778\ub371\uc2a4 \ubc94\uc704\ub97c \uc2a4\uce94\ud558\uba70 \uadf8 \ubc94\uc704 \ub0b4\uc758 \uac04\uaca9(gap)\uc73c\ub85c \ub2e4\ub978 \uc138\uc158\ub4e4\uc774 \uc0bd\uc785\uc744 \ud560 \uc218 \uc5c6\ub3c4\ub85d \ud558\uae30 \uc704\ud574 gap lock \ub610\ub294 next-key lock\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc778\ub371\uc2a4 \ubc94\uc704\ub97c \uc7a0\uae09\ub2c8\ub2e4."),(0,t.yg)("p",{parentName:"blockquote"},(0,t.yg)("a",{parentName:"p",href:"https://dev.mysql.com/doc/refman/8.0/en/innodb-transaction-isolation-levels.html"},"https://dev.mysql.com/doc/refman/8.0/en/innodb-transaction-isolation-levels.html"))),(0,t.yg)("h4",{id:"consistent-read"},"Consistent Read"),(0,t.yg)("blockquote",null,(0,t.yg)("p",{parentName:"blockquote"},"\ub2e4\ub978 \ud2b8\ub79c\uc7ad\uc158\uc774 \ub3d9\uc2dc\uc5d0 \uc2e4\ud589\ub418\ub294 \ub3d9\uc548 \uc218\ud589\ub41c \ubcc0\uacbd \uc0ac\ud56d\uacfc \uad00\uacc4\uc5c6\uc774 \ud2b9\uc815 \uc2dc\uc810\uc758 \ub370\uc774\ud130\ub97c \uae30\uc900\uc73c\ub85c \ucffc\ub9ac \uacb0\uacfc\ub97c \uc81c\uacf5\ud558\uae30 \uc704\ud574 \uc2a4\ub0c5\uc0f7 \uc815\ubcf4\ub97c \uc0ac\uc6a9\ud558\ub294 \uc77d\uae30 \uc791\uc5c5\uc785\ub2c8\ub2e4. \ub9cc\uc57d \ucffc\ub9ac\ub41c \ub370\uc774\ud130\uac00 \ub2e4\ub978 \ud2b8\ub79c\uc7ad\uc158\uc5d0 \uc758\ud574 \ubcc0\uacbd\ub41c \uacbd\uc6b0, \uc6d0\ub798 \ub370\uc774\ud130\ub294 undo log\uc758 \ub0b4\uc6a9\uc744 \uae30\ubc18\uc73c\ub85c \ubcf5\uc6d0\ub429\ub2c8\ub2e4. \uc774 \uae30\uc220\uc740 \ub2e4\ub978 \ud2b8\ub79c\uc7ad\uc158\uc774 \uc885\ub8cc\ub420 \ub54c\uae4c\uc9c0 \ub300\uae30\ud558\ub3c4\ub85d \ud558\ub294 \uc7a0\uae08 \uc774\uc288\ub97c \ud53c\ud558\uba74\uc11c \ub3d9\uc2dc\uc131\uc744 \ub192\uc774\ub294 \ub370 \uae30\uc5ec\ud569\ub2c8\ub2e4."),(0,t.yg)("p",{parentName:"blockquote"},(0,t.yg)("strong",{parentName:"p"},"REPEATABLE READ")," \uaca9\ub9ac \uc218\uc900\uc5d0\uc11c\ub294 \uc2a4\ub0c5\uc0f7\uc774 \uccab \ubc88\uc9f8 \uc77d\uae30 \uc791\uc5c5\uc774 \uc218\ud589\ub41c \uc2dc\uc810\uc744 \uae30\uc900\uc73c\ub85c \uc124\uc815\ub429\ub2c8\ub2e4. ",(0,t.yg)("strong",{parentName:"p"},"READ COMMITTED")," \uaca9\ub9ac \uc218\uc900\uc5d0\uc11c\ub294 \uac01 consistent read \uc791\uc5c5 \uc2dc\uc810\uc5d0 \uc2a4\ub0c5\uc0f7\uc774 \ub9ac\uc14b\ub429\ub2c8\ub2e4."),(0,t.yg)("p",{parentName:"blockquote"},"Consistent read\ub294 InnoDB\uac00 ",(0,t.yg)("strong",{parentName:"p"},"READ COMMITTED"),"\uc640 ",(0,t.yg)("strong",{parentName:"p"},"REPEATABLE READ")," \uaca9\ub9ac \uc218\uc900\uc5d0\uc11c ",(0,t.yg)("strong",{parentName:"p"},"SELECT")," \ubb38\uc744 \ucc98\ub9ac\ud558\ub294 \uae30\ubcf8 \ubaa8\ub4dc\uc785\ub2c8\ub2e4. Consistent read\ub294 \uc561\uc138\uc2a4\ud558\ub294 \ud14c\uc774\ube14\uc5d0 \ub300\ud574 \uc5b4\ub5a0\ud55c \uc7a0\uae08\ub3c4 \uc124\uc815\ud558\uc9c0 \uc54a\uc73c\ubbc0\ub85c, \ub2e4\ub978 \uc138\uc158\ub4e4\uc774 \uc774 \ud14c\uc774\ube14\uc744 \uc790\uc720\ub86d\uac8c \uc218\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,t.yg)("p",{parentName:"blockquote"},(0,t.yg)("a",{parentName:"p",href:"https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_consistent_read"},"https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_consistent_read"))),(0,t.yg)("p",null,"Read Committed \uaca9\ub9ac \uc218\uc900\uc5d0\uc11c\ub294 \uac01 consistent read \uc2dc\uc810\uc5d0 \uc2a4\ub0c5\uc0f7\uc744 \uacc4\uc18d \ub9cc\ub4dc\ub294 \ubc29\uc2dd\uc73c\ub85c \uc9c4\ud589\ub418\uae30 \ub54c\ubb38\uc5d0 Non-Repeatable Read \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud558\uc9c0\ub9cc Repeatable Read \uc218\uc900\uc5d0\uc11c\ub294 \uccab \ubc88\uc9f8 \uc77d\uae30 \uc791\uc5c5\uc774 \uc218\ud589\ub41c \uc2dc\uc810\uc73c\ub85c \uc2a4\ub0c5\uc0f7\uc774 \uc124\uc815\ub418\uae30 \ub54c\ubb38\uc5d0 \ub2e4\ub978 \ud2b8\ub79c\uc7ad\uc158\uc774 \ucee4\ubc0b\ud558\ub354\ub77c\ub3c4 \uc2a4\ub0c5\uc0f7\uc774 \ubcc0\uacbd\ub418\uc9c0 \uc54a\ub294\ub2e4. \ub530\ub77c\uc11c Non-Repeatable Read \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud558\uc9c0 \uc54a\ub294\ub2e4."),(0,t.yg)("h4",{id:"record-lock"},"Record Lock"),(0,t.yg)("blockquote",null,(0,t.yg)("p",{parentName:"blockquote"},"\uc778\ub371\uc2a4 \ub808\ucf54\ub4dc\uc5d0 \ub300\ud55c \uc7a0\uae08\uc744 \uc758\ubbf8\ud569\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4, ",(0,t.yg)("inlineCode",{parentName:"p"},"SELECT c1 FROM t WHERE c1 = 10 FOR UPDATE;"),"\ub294 \ub2e4\ub978 \ud2b8\ub79c\uc7ad\uc158\uc774 ",(0,t.yg)("inlineCode",{parentName:"p"},"t.c1"),"\uc758 \uac12\uc774 10\uc778 \ud589\uc744 \uc0bd\uc785, \uc5c5\ub370\uc774\ud2b8, \ub610\ub294 \uc0ad\uc81c\ud558\uc9c0 \ubabb\ud558\uac8c \ud569\ub2c8\ub2e4."),(0,t.yg)("p",{parentName:"blockquote"},(0,t.yg)("a",{parentName:"p",href:"https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_record_lock"},"https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_record_lock"))),(0,t.yg)("h4",{id:"gab-lock"},"Gab Lock"),(0,t.yg)("blockquote",null,(0,t.yg)("p",{parentName:"blockquote"},"\uc778\ub371\uc2a4 \ub808\ucf54\ub4dc \uc0ac\uc774\uc758 \uac04\uaca9(gap)\uc774\ub098 \uccab \ubc88\uc9f8 \uc778\ub371\uc2a4 \ub808\ucf54\ub4dc \uc774\uc804 \ub610\ub294 \ub9c8\uc9c0\ub9c9 \uc778\ub371\uc2a4 \ub808\ucf54\ub4dc \uc774\ud6c4\uc758 \uac04\uaca9\uc5d0 \uac78\ub9ac\ub294 \uc7a0\uae08\uc744 \ub9d0\ud569\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4, ",(0,t.yg)("inlineCode",{parentName:"p"},"SELECT c1 FROM t WHERE c1 BETWEEN 10 and 20 FOR UPDATE;"),"\ub294 \ub2e4\ub978 \ud2b8\ub79c\uc7ad\uc158\uc774 ",(0,t.yg)("inlineCode",{parentName:"p"},"t.c1")," \uceec\ub7fc\uc5d0 15\ub77c\ub294 \uac12\uc744 \uc0bd\uc785\ud558\ub294 \uac83\uc744 \ubc29\uc9c0\ud569\ub2c8\ub2e4. \uc774\ub294 \ud574\ub2f9 \uceec\ub7fc\uc5d0 \uc774\ubbf8 15\ub77c\ub294 \uac12\uc774 \uc874\uc7ac\ud558\ub4e0 \uc874\uc7ac\ud558\uc9c0 \uc54a\ub4e0 \uad00\uacc4\uc5c6\uc774, \ubc94\uc704 \ub0b4\uc758 \ubaa8\ub4e0 \uae30\uc874 \uac12\ub4e4 \uc0ac\uc774\uc758 \uac04\uaca9\uc774 \uc7a0\uaca8 \uc788\uae30 \ub54c\ubb38\uc785\ub2c8\ub2e4."),(0,t.yg)("p",{parentName:"blockquote"},"Gap lock\uc740 \uc131\ub2a5\uacfc \ub3d9\uc2dc\uc131(concurrency) \uc0ac\uc774\uc758 \uade0\ud615\uc744 \ub9de\ucd94\uae30 \uc704\ud55c \uc77c\ubd80\ub85c, \uc77c\ubd80 \ud2b8\ub79c\uc7ad\uc158 \uaca9\ub9ac \uc218\uc900\uc5d0\uc11c \uc0ac\uc6a9\ub418\uba70, \ub2e4\ub978 \uaca9\ub9ac \uc218\uc900\uc5d0\uc11c\ub294 \uc0ac\uc6a9\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4."),(0,t.yg)("p",{parentName:"blockquote"},(0,t.yg)("a",{parentName:"p",href:"https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_gap_lock"},"https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_gap_lock"))),(0,t.yg)("h4",{id:"next-key-lock"},"Next Key Lock"),(0,t.yg)("blockquote",null,(0,t.yg)("p",{parentName:"blockquote"},"\uc778\ub371\uc2a4 \ub808\ucf54\ub4dc\uc5d0 \ub300\ud55c ",(0,t.yg)("strong",{parentName:"p"},"record lock"),"\uacfc \uadf8 \uc778\ub371\uc2a4 \ub808\ucf54\ub4dc \uc55e\uc758 \uac04\uaca9\uc5d0 \ub300\ud55c ",(0,t.yg)("strong",{parentName:"p"},"gap lock"),"\uc744 \uacb0\ud569\ud55c \uac83\uc785\ub2c8\ub2e4."),(0,t.yg)("p",{parentName:"blockquote"},(0,t.yg)("a",{parentName:"p",href:"https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_next_key_lock"},"https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_next_key_lock"))),(0,t.yg)("p",null,"Repeatable Read \uaca9\ub9ac \uc218\uc900\uc5d0\uc11c \ubc94\uc704 \ud0c0\uc785 \uac80\uc0c9 \uc870\uac74\uc744 \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0, \ud574\ub2f9 \ubc94\uc704 \ub0b4\uc5d0 \ub2e4\ub978 \uc138\uc158\ub4e4\uc774 \uc0bd\uc785\uc744 \ud560 \uc218 \uc5c6\ub3c4\ub85d Gab Lock \ub610\ub294 Next Key Lock\uc744 \uc0ac\uc6a9\ud558\uae30 \ub54c\ubb38\uc5d0, Repeatable Read \uaca9\ub9ac \uc218\uc900\uc5d0\uc11c\ub3c4 Phantom Read\uac00 \ubc29\uc9c0\ub418\ub294 \uac83\uc774\ub2e4."),(0,t.yg)("h3",{id:"test-with-typeorm-2"},"Test With TypeORM"),(0,t.yg)("h4",{id:"non-repeatable-read-\ubc29\uc9c0"},"Non-repeatable Read \ubc29\uc9c0"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-ts"},'it("should prevent non-repeatable read with REPEATABLE READ isolation level", async () => {\n  await couponRepository.save({ code: "COUPON_1" });\n\n  const queryRunner1 = dataSource.createQueryRunner();\n  await queryRunner1.connect();\n  await queryRunner1.startTransaction("REPEATABLE READ");\n\n  const queryRunner2 = dataSource.createQueryRunner();\n  await queryRunner2.connect();\n  await queryRunner2.startTransaction("REPEATABLE READ");\n\n  try {\n    // \ud2b8\ub79c\uc7ad\uc158 1\uc774 \ucfe0\ud3f0\uc744 \uc870\ud68c\n    const coupon1Before = await queryRunner1.manager.findOne(Coupon, {\n      where: { code: "COUPON_1" },\n    });\n\n    // \ud2b8\ub79c\uc7ad\uc158 2\uac00 \ub3d9\uc77c\ud55c \ucfe0\ud3f0\uc744 \uc870\ud68c\ud558\uace0 \uc218\uc815\n    const coupon2 = await queryRunner2.manager.findOne(Coupon, {\n      where: { code: "COUPON_1" },\n    });\n\n    if (coupon2) {\n      coupon2.isRedeemed = true;\n      await queryRunner2.manager.save(coupon2);\n    }\n\n    // \ud2b8\ub79c\uc7ad\uc158 2\uac00 \ucee4\ubc0b\ub428\n    await queryRunner2.commitTransaction();\n\n    // \ud2b8\ub79c\uc7ad\uc158 1\uc774 \ub2e4\uc2dc \ucfe0\ud3f0\uc744 \uc870\ud68c (Non-repeatable Read \ubc1c\uc0dd\ud558\uc9c0 \uc54a\uc74c)\n    const coupon1After = await queryRunner1.manager.findOne(Coupon, {\n      where: { code: "COUPON_1" },\n    });\n\n    // \ucc98\uc74c \uc870\ud68c\ud55c \uc0c1\ud0dc\uc640 \ub3d9\uc77c\ud574\uc57c \ud568\n    expect(coupon1Before.isRedeemed).toBe(coupon1After.isRedeemed);\n\n    await queryRunner1.commitTransaction();\n  } finally {\n    await queryRunner2.release();\n    await queryRunner1.release();\n  }\n});\n')),(0,t.yg)("h4",{id:"phantom-read-\ubc29\uc9c0"},"Phantom Read \ubc29\uc9c0"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-ts"},'it("should prevent phantom read with REPEATABLE READ isolation level", async () => {\n  await couponRepository.save({ code: "COUPON_1" });\n\n  const queryRunner1 = dataSource.createQueryRunner();\n  await queryRunner1.connect();\n  await queryRunner1.startTransaction("REPEATABLE READ");\n\n  const queryRunner2 = dataSource.createQueryRunner();\n  await queryRunner2.connect();\n  await queryRunner2.startTransaction("REPEATABLE READ");\n\n  try {\n    // \ud2b8\ub79c\uc7ad\uc158 1\uc774 isRedeemd\uac00 false\uc778 \ucfe0\ud3f0\uc744 \uc870\ud68c\n    const couponsBefore = await queryRunner1.manager.find(Coupon, {\n      where: { isRedeemed: false },\n    });\n\n    // \ud2b8\ub79c\uc7ad\uc158 2\uac00 \uc0c8\ub85c\uc6b4 \ucfe0\ud3f0\uc744 \ucd94\uac00\n    await queryRunner2.manager.insert(Coupon, {\n      code: "COUPON_2",\n    });\n    await queryRunner2.commitTransaction();\n\n    // \ud2b8\ub79c\uc7ad\uc158 1\uc774 \ub2e4\uc2dc isRedeemd\uac00 false\uc778 \ucfe0\ud3f0\uc744 \uc870\ud68c (phantom read \ubc1c\uc0dd\ud558\uc9c0 \uc54a\uc74c)\n    const couponsAfter = await queryRunner1.manager.find(Coupon, {\n      where: { isRedeemed: false },\n    });\n\n    expect(couponsBefore.length).toBe(couponsAfter.length);\n\n    await queryRunner1.commitTransaction();\n  } finally {\n    await queryRunner2.release();\n    await queryRunner1.release();\n  }\n});\n')),(0,t.yg)("h2",{id:"serializable"},"Serializable"),(0,t.yg)("p",null,"\uac00\uc7a5 \ub192\uc740 \uaca9\ub9ac \uc218\uc900\uc73c\ub85c, \ud2b8\ub79c\uc7ad\uc158\uc774 \uc11c\ub85c \uc644\uc804\ud788 \ub3c5\ub9bd\uc801\uc73c\ub85c \uc2e4\ud589\ub418\uba70 \ud2b8\ub79c\uc7ad\uc158\uc774 \uc2e4\ud589\ub418\ub294 \ub3d9\uc548 \ub2e4\ub978 \ud2b8\ub79c\uc7ad\uc158\uc758 \uacb0\uacfc\uac00 \uc601\ud5a5\uc744 \ubbf8\uce58\uc9c0 \uc54a\ub3c4\ub85d \ubcf4\uc7a5\ud55c\ub2e4."),(0,t.yg)("h3",{id:"mysql-innodb\uc758-serializable"},"MySQL (InnoDB)\uc758 Serializable"),(0,t.yg)("blockquote",null,(0,t.yg)("p",{parentName:"blockquote"},"\uc774 \uc218\uc900\uc740 ",(0,t.yg)("strong",{parentName:"p"},"REPEATABLE READ"),"\uc640 \uc720\uc0ac\ud558\uc9c0\ub9cc, ",(0,t.yg)("strong",{parentName:"p"},"autocommit"),"\uc774 \ube44\ud65c\uc131\ud654\ub41c \uacbd\uc6b0 InnoDB\ub294 \ubaa8\ub4e0 \uc77c\ubc18 ",(0,t.yg)("strong",{parentName:"p"},"SELECT")," \ubb38\uc744 ",(0,t.yg)("strong",{parentName:"p"},"SELECT ... FOR SHARE"),"\ub85c \uc554\uc2dc\uc801\uc73c\ub85c \ubcc0\ud658\ud569\ub2c8\ub2e4. ",(0,t.yg)("strong",{parentName:"p"},"autocommit"),"\uc774 \ud65c\uc131\ud654\ub41c \uacbd\uc6b0, ",(0,t.yg)("strong",{parentName:"p"},"SELECT"),"\ub294 \uc790\uccb4 \ud2b8\ub79c\uc7ad\uc158\uc774\ubbc0\ub85c \uc77d\uae30 \uc804\uc6a9\uc73c\ub85c \uac04\uc8fc\ub418\uba70, \uc77c\uad00\ub41c(nonlocking) \uc77d\uae30\ub85c \uc218\ud589\ub420 \ub54c \uc9c1\ub82c\ud654\ub420 \uc218 \uc788\uc73c\uba70 \ub2e4\ub978 \ud2b8\ub79c\uc7ad\uc158\uc5d0 \ub300\ud574 \ucc28\ub2e8\ub420 \ud544\uc694\uac00 \uc5c6\uc2b5\ub2c8\ub2e4. (\ub2e4\ub978 \ud2b8\ub79c\uc7ad\uc158\uc774 \uc120\ud0dd\ub41c \ud589\uc744 \uc218\uc815\ud55c \uacbd\uc6b0\uc5d0\ub3c4 ",(0,t.yg)("strong",{parentName:"p"},"SELECT"),"\uac00 \ucc28\ub2e8\ub418\ub3c4\ub85d \ud558\ub824\uba74, ",(0,t.yg)("strong",{parentName:"p"},"autocommit"),"\uc744 \ube44\ud65c\uc131\ud654\ud574\uc57c \ud569\ub2c8\ub2e4.)"),(0,t.yg)("p",{parentName:"blockquote"},(0,t.yg)("a",{parentName:"p",href:"https://dev.mysql.com/doc/refman/8.0/en/innodb-transaction-isolation-levels.html"},"https://dev.mysql.com/doc/refman/8.0/en/innodb-transaction-isolation-levels.html"))),(0,t.yg)("p",null,"Serializable \uaca9\ub9ac \uc218\uc900\uc5d0\uc11c\ub294 \ubaa8\ub4e0 \uc77c\ubc18 SELECT \ubb38\uc5d0 \uacf5\uc720 \ub77d\uc744 \uac70\ub294 \ubc29\uc2dd\uc73c\ub85c Isolation\uc744 \ubcf4\uc7a5\ud55c\ub2e4."),(0,t.yg)("h3",{id:"test-with-typeorm-3"},"Test With TypeORM"),(0,t.yg)(r.A,{mdxType:"Tabs"},(0,t.yg)(u.A,{value:"coupon.service.ts",mdxType:"TabItem"},(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-ts"},"async assignCouponWithSerializableIsolation(userId: number): Promise<{\n  readCoupon?: Coupon;\n  saveCoupon?: Coupon;\n  error?: string;\n}> {\n  const queryRunner = this.dataSource.createQueryRunner();\n  await queryRunner.startTransaction('SERIALIZABLE');\n\n  let coupon;\n  let saveCoupon;\n  let error;\n\n  try {\n    coupon = await queryRunner.manager\n      .createQueryBuilder(Coupon, 'coupon')\n      .where('coupon.isRedeemed = :isRedeemed', { isRedeemed: false })\n      .orderBy('coupon.id', 'ASC')\n      .getOne();\n\n    if (!coupon) {\n      throw new Error('No available coupons');\n    }\n\n    coupon.isRedeemed = true;\n    coupon.userId = userId;\n\n    saveCoupon = await queryRunner.manager.save(coupon);\n\n    await queryRunner.commitTransaction();\n  } catch (e) {\n    await queryRunner.rollbackTransaction();\n    error = e.message;\n  } finally {\n    await queryRunner.release();\n\n    return {\n      readCoupon: coupon,\n      saveCoupon,\n      error,\n    };\n  }\n}\n"))),(0,t.yg)(u.A,{value:"coupon.isolation.spec.ts",mdxType:"TabItem"},(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-ts"},'it("should handle concurrent requests with SERIALIZABLE isolation level", async () => {\n  const user1 = await userRepository.save({ name: "user1" });\n  const user2 = await userRepository.save({ name: "user2" });\n  await couponRepository.save({ code: "COUPON_1" });\n\n  const result1Promise = couponService.assignCouponWithSerializableIsolation(\n    user1.id\n  );\n  const result2Promise = couponService.assignCouponWithSerializableIsolation(\n    user2.id\n  );\n\n  const [result1, result2] = await Promise.all([\n    result1Promise,\n    result2Promise,\n  ]);\n\n  // SELECT\uc5d0 \uacf5\uc720\ub77d\uc774 \uac78\ub9ac\uae30 \ub54c\ubb38\uc5d0 \ucfe0\ud3f0 \uc77d\uae30\ub294 \uac00\ub2a5\n  expect(result1.readCoupon.code).toBe("COUPON_1");\n  expect(result2.readCoupon.code).toBe("COUPON_1");\n  if (result1.saveCoupon) {\n    expect(result1.saveCoupon.code).toBe("COUPON_1");\n    expect(result1.saveCoupon.userId).toBe(user1.id);\n    expect(result2.saveCoupon).toBeUndefined();\n    expect(result2.error).toBe(\n      "Deadlock found when trying to get lock; try restarting transaction"\n    );\n  } else {\n    expect(result2.saveCoupon.code).toBe("COUPON_1");\n    expect(result2.saveCoupon.userId).toBe(user2.id);\n    expect(result1.saveCoupon).toBeUndefined();\n    expect(result1.error).toBe(\n      "Deadlock found when trying to get lock; try restarting transaction"\n    );\n  }\n});\n')))),(0,t.yg)("p",null,(0,t.yg)("strong",{parentName:"p"},"\uc2e4\ud589 \ucffc\ub9ac")),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-sql"},"-- \uaca9\ub9ac \uc218\uc900\uc774 SERIALIZABLE\ub85c \uc124\uc815\ub41c \ub450 \uac1c\uc758 \ud2b8\ub79c\uc7ad\uc158 \uc2dc\uc791\nSET TRANSACTION ISOLATION LEVEL SERIALIZABLE\nSET TRANSACTION ISOLATION LEVEL SERIALIZABLE\nSTART TRANSACTION\nSTART TRANSACTION\n\n-- \uccab \ubc88\uc9f8 \ud2b8\ub79c\uc7ad\uc158\uc5d0\uc11c \ucfe0\ud3f0 \uc870\ud68c (getOne, SERIALIZABLE \uc218\uc900\uc774\ubbc0\ub85c \uacf5\uc720 \ub77d\uc774 \uac78\ub9bc)\nSELECT `coupon`.`id` AS `coupon_id`, `coupon`.`code` AS `coupon_code`, `coupon`.`isRedeemed` AS `coupon_isRedeemed`, `coupon`.`user_id` AS `coupon_user_id`, `coupon`.`version` AS `coupon_version` FROM `coupon` `coupon` WHERE `coupon`.`isRedeemed` = ? ORDER BY `coupon`.`id` ASC -- PARAMETERS: [false]\n\n-- \ub450 \ubc88\uc9f8 \ud2b8\ub79c\uc7ad\uc158\uc5d0\uc11c\ub3c4 \ucfe0\ud3f0 \uc870\ud68c (getOne, SERIALIZABLE \uc218\uc900\uc774\ubbc0\ub85c \uacf5\uc720 \ub77d\uc774 \uac78\ub9bc)\nSELECT `coupon`.`id` AS `coupon_id`, `coupon`.`code` AS `coupon_code`, `coupon`.`isRedeemed` AS `coupon_isRedeemed`, `coupon`.`user_id` AS `coupon_user_id`, `coupon`.`version` AS `coupon_version` FROM `coupon` `coupon` WHERE `coupon`.`isRedeemed` = ? ORDER BY `coupon`.`id` ASC -- PARAMETERS: [false]\n\n-- \uc694\uccad 1,2\uc758 \uc870\ud68c \ucffc\ub9ac (save)\nSELECT `Coupon`.`id` AS `Coupon_id`, `Coupon`.`code` AS `Coupon_code`, `Coupon`.`isRedeemed` AS `Coupon_isRedeemed`, `Coupon`.`user_id` AS `Coupon_user_id`, `Coupon`.`version` AS `Coupon_version` FROM `coupon` `Coupon` WHERE `Coupon`.`id` IN (?) -- PARAMETERS: [521]\nSELECT `Coupon`.`id` AS `Coupon_id`, `Coupon`.`code` AS `Coupon_code`, `Coupon`.`isRedeemed` AS `Coupon_isRedeemed`, `Coupon`.`user_id` AS `Coupon_user_id`, `Coupon`.`version` AS `Coupon_version` FROM `coupon` `Coupon` WHERE `Coupon`.`id` IN (?) -- PARAMETERS: [521]\n\n-- \uccab \ubc88\uc9f8 \ud2b8\ub79c\uc7ad\uc158\uc5d0\uc11c \ucfe0\ud3f0 \uc5c5\ub370\uc774\ud2b8 (save), \uc5c5\ub370\uc774\ud2b8\ub97c \uc704\ud574\uc11c\ub294 \ubc30\ud0c0 \ub77d\uc744 \ud68d\ub4dd\ud574\uc57c\ud558\uc9c0\ub9cc \ub450 \ubc88\uc9f8 \ud2b8\ub79c\uc7ad\uc158\uc5d0\uc11c\ub3c4 \uacf5\uc720 \ub77d\uc774 \uac78\ub824\uc788\uae30 \ub54c\ubb38\uc5d0 \ud68d\ub4dd \ubd88\uac00\nUPDATE `coupon` SET `isRedeemed` = ?, `user_id` = ?, `version` = `version` + 1 WHERE `id` IN (?) -- PARAMETERS: [1,237,521]\n\n-- \ub450 \ubc88\uc9f8 \ud2b8\ub79c\uc7ad\uc158\uc5d0\uc11c \ucfe0\ud3f0 \uc5c5\ub370\uc774\ud2b8 (save), \uc5c5\ub370\uc774\ud2b8\ub97c \uc704\ud574\uc11c\ub294 \ubc30\ud0c0 \ub77d\uc744 \ud68d\ub4dd\ud574\uc57c\ud558\uc9c0\ub9cc \uccab \ubc88\uc9f8 \ud2b8\ub79c\uc7ad\uc158\uc5d0\uc11c \uacf5\uc720 \ub77d\uc774 \uac78\ub824\uc788\uae30 \ub54c\ubb38\uc5d0 \ud68d\ub4dd \ubd88\uac00\nUPDATE `coupon` SET `isRedeemed` = ?, `user_id` = ?, `version` = `version` + 1 WHERE `id` IN (?) -- PARAMETERS: [1,238,521]\n\n-- \ub450 \ud2b8\ub79c\uc7ad\uc158\uc5d0\uc11c \uc11c\ub85c \ubc30\ud0c0 \ub77d\uc744 \ud68d\ub4dd\ud558\uae30 \uc704\ud574 \ubb34\ud55c\ub300\uae30\ud558\uac8c \ub418\ubbc0\ub85c \ub370\ub4dc\ub77d \ubc1c\uc0dd \ud6c4 \ud558\ub098\uc758 \ud2b8\ub79c\uc7ad\uc158 \ub864\ubc31 \ucc98\ub9ac\nROLLBACK\n\n-- \ub370\ub4dc\ub77d \ud574\uc18c \ud6c4 \ub0a8\uc740 \ud2b8\ub79c\uc7ad\uc158 \uc870\ud68c \ucffc\ub9ac (save)\nSELECT `Coupon`.`id` AS `Coupon_id`, `Coupon`.`version` AS `Coupon_version` FROM `coupon` `Coupon` WHERE `Coupon`.`id` = ? -- PARAMETERS: [521]\n\n-- \ub370\ub4dc\ub77d \ud574\uc18c \ud6c4 \ub0a8\uc740 \ud2b8\ub79c\uc7ad\uc158 \ucee4\ubc0b\nCOMMIT\n")),(0,t.yg)("hr",null),(0,t.yg)("p",null,"\ud14c\uc2a4\ud2b8 \ud658\uacbd\uc758 DB\ub294 MySQL8.0\uc744 \uc0ac\uc6a9\ud558\uc600\ub2e4. \ud574\ub2f9 \uae00\uc5d0\uc11c \uc0ac\uc6a9\ub418\ub294 \uc608\uc2dc\ucf54\ub4dc\ub294 ",(0,t.yg)("a",{parentName:"p",href:"https://github.com/chihunmanse/concurrency-test"},"GitHub")," \uc5d0\uc11c\ub3c4 \ud655\uc778\ud560 \uc218 \uc788\ub2e4."),(0,t.yg)("p",null,(0,t.yg)("strong",{parentName:"p"},"\ucc38\uc870")),(0,t.yg)("p",null,(0,t.yg)("a",{parentName:"p",href:"https://www.youtube.com/watch?v=bLLarZTrebU&list=PLcXyemr8ZeoREWGhhZi5FZs6cvymjIBVe&index=17"},"https://www.youtube.com/watch?v=bLLarZTrebU&list=PLcXyemr8ZeoREWGhhZi5FZs6cvymjIBVe&index=17")),(0,t.yg)("p",null,(0,t.yg)("a",{parentName:"p",href:"https://brunch.co.kr/@jinyoungchoi95/5"},"https://brunch.co.kr/@jinyoungchoi95/5")),(0,t.yg)("p",null,(0,t.yg)("a",{parentName:"p",href:"https://dev.mysql.com/doc/refman/8.0/en/innodb-transaction-isolation-levels.html"},"https://dev.mysql.com/doc/refman/8.0/en/innodb-transaction-isolation-levels.html")))}m.isMDXComponent=!0}}]);