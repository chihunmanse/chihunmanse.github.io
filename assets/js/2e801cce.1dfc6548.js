"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9450],{6029:n=>{n.exports=JSON.parse('{"blogPosts":[{"id":"/2023/11/10/backend/kubernetes/garbage-collection","metadata":{"permalink":"/2023/11/10/backend/kubernetes/garbage-collection","source":"@site/blog/backend/kubernetes/2023-11-10-garbage-collection.md","title":"\uc6cc\ucee4\ub178\ub4dc \ub514\uc2a4\ud06c \uad00\ub9ac\ud558\uae30","description":"\uc6cc\ucee4\ub178\ub4dc \ub514\uc2a4\ud06c \uad00\ub9ac\ud558\uae30","date":"2023-11-10T00:00:00.000Z","formattedDate":"November 10, 2023","tags":[{"label":"BackEnd","permalink":"/tags/back-end"},{"label":"Kubernetes","permalink":"/tags/kubernetes"}],"readingTime":8.92,"hasTruncateMarker":true,"authors":[{"name":"Chihun Park","url":"https://github.com/chihunmanse","email":"chihunmanse@gmail.com","imageURL":"https://p.ipic.vip/o1ih3g.png","key":"chihun"}],"frontMatter":{"title":"\uc6cc\ucee4\ub178\ub4dc \ub514\uc2a4\ud06c \uad00\ub9ac\ud558\uae30","description":"\uc6cc\ucee4\ub178\ub4dc \ub514\uc2a4\ud06c \uad00\ub9ac\ud558\uae30","keywords":["docker","container","kubernetes","garbage-collection"],"tags":["BackEnd","Kubernetes"],"authors":"chihun"},"nextItem":{"title":"Docker \uae30\ubcf8 \uac1c\ub150 \uc815\ub9ac","permalink":"/2023/11/03/backend/docker/docker-basic"}},"content":"\ucd5c\uadfc \uc820\ud0a8\uc2a4 \uc11c\ubc84\uc758 \ub514\uc2a4\ud06c \uc6a9\ub7c9\uc774 \uadf8\ub3d9\uc548 \uc313\uc778 \ub3c4\ucee4 \uc774\ubbf8\uc9c0 \ubc0f \ube4c\ub4dc \uce90\uc2dc \ub370\uc774\ud130\ub4e4\ub85c \uac00\ub4dd \ucc28\uc11c \uc820\ud0a8\uc2a4\uc5d0\uc11c \ube4c\ub4dc\uac00 \uc81c\ub300\ub85c \ub418\uc9c0 \uc54a\ub294 \ubb38\uc81c\ub97c \uacaa\uc5c8\ub2e4.\\n\\n\ud574\ub2f9 \ubb38\uc81c\ub97c \uacaa\uace0 \ub098\uc11c, \ud604\uc7ac \uc0ac\uc6a9 \uc911\uc778 \ud150\uc13c\ud2b8 \ud074\ub77c\uc6b0\ub4dc TKE \ud074\ub7ec\uc2a4\ud130\uc758 \uc6cc\ucee4 \ub178\ub4dc\ub4e4\uc758 \ub514\uc2a4\ud06c \uc6a9\ub7c9\ub3c4 \ud655\uc778\ud574\ubcf4\uc558\ub2e4. \\n\\n\ud604\uc7ac \uc11c\ube44\uc2a4\uc5d0\uc11c\ub294 2\uac1c\uc758 \uc6cc\ucee4\ub178\ub4dc\ub97c \uc0ac\uc6a9\ud558\uace0 \uc788\ub294\ub370 \uadf8 \uc911 \ud558\ub098\uc758 \ub178\ub4dc \ub514\uc2a4\ud06c \uc6a9\ub7c9\uc774 80% \uac00\ub7c9 \ucc28 \uc788\uc5c8\ub2e4. \uc790\uc138\ud55c \uc0ac\uc6a9\ub7c9\uc744 \ud30c\uc545\ud558\uae30 \uc704\ud574 \ud574\ub2f9 \uc6cc\ucee4\ub178\ub4dc\uc5d0 \uc811\uc18d\ud558\uc5ec `df-h` \uba85\ub839\uc5b4\ub97c \uc2e4\ud589\ud574\ubcf4\uc558\ub2e4.\\n\\n![dfh](https://p.ipic.vip/d1deym.png)\\n\\n\x3c!--truncate--\x3e\\n\\n77GB\ub97c \uc0ac\uc6a9\ud558\uace0 \uc788\ub294 \uacbd\ub85c\uac00 `/run/containerd/io.containerd.runtime.v2.task/k8s.io/` \uc778 \uac83\uc744 \ubd24\uc744 \ub54c, \uc820\ud0a8\uc2a4 \uc11c\ubc84\uc640 \ub9c8\ucc2c\uac00\uc9c0\ub85c \uc774\ubbf8\uc9c0 \ubc0f \ucee8\ud14c\uc774\ub108 \ub370\uc774\ud130\uac00 \ub9ce\uc740 \uc6a9\ub7c9\uc744 \ucc28\uc9c0\ud558\uace0 \uc788\ub2e4\ub294 \uac83\uc744 \ucd94\uce21\ud560 \uc218 \uc788\uc5c8\ub2e4.\\n\\n\uc5ec\uae30\uc11c \ub9ce\uc740 \uc6a9\ub7c9\uc744 \ucc28\uc9c0\ud558\uace0 \uc788\ub294 \ub514\ub809\ud1a0\ub9ac\uc758 \uacbd\ub85c\uac00 `/var/lib/docker/overlay2/` \uac00 \uc544\ub2cc `/run/containerd/io.containerd.runtime.v2.task/k8s.io/` \uc778 \uc774\uc720\ub294 [\ucfe0\ubc84\ub124\ud2f0\uc2a4\uc5d0\uc11c\ub294 1.24 \ubc84\uc804\ubd80\ud130 \ucee8\ud14c\uc774\ub108 \ub7f0\ud0c0\uc784\uc73c\ub85c Dockershim\uc774 \uc544\ub2cc containerd\ub97c \uc0ac\uc6a9\ud558\uae30 \ub54c\ubb38\uc774\ub2e4.](https://kubernetes.io/ko/docs/setup/production-environment/container-runtimes)\\n(\ucfe0\ubc84\ub124\ud2f0\uc2a4\uac00 Docker \uc9c0\uc6d0\uc744 \uc911\ub2e8\ud558\uace0 containerd\ub97c \uc0ac\uc6a9\ud558\uac8c \ub41c \uc774\uc720\uc640 \ub9e5\ub77d\uc740 [\uc774 \uae00](https://www.linkedin.com/pulse/containerd%EB%8A%94-%EB%AC%B4%EC%97%87%EC%9D%B4%EA%B3%A0-%EC%99%9C-%EC%A4%91%EC%9A%94%ED%95%A0%EA%B9%8C-sean-lee/?originalSubdomain=kr)\uc5d0 \uc798 \uc124\uba85\ub418\uc5b4\uc788\ub2e4.)\\n\\n\uc6cc\ucee4\ub178\ub4dc\uc5d0\uc11c\ub294 containerd\ub97c \uc0ac\uc6a9\ud558\uace0 \uc788\uae30 \ub54c\ubb38\uc5d0, \ub9cc\uc57d \ud574\ub2f9 VM\uc5d0 \uc811\uc18d\ud574\uc11c \uc9c1\uc811 \ucee4\ub9e8\ub4dc\ub97c \uc2e4\ud589\ud558\uc5ec \uc0ac\uc6a9\ud558\uc9c0 \uc54a\ub294 \uc774\ubbf8\uc9c0 \ubc0f \ucee8\ud14c\uc774\ub108 \ub370\uc774\ud130\ub97c \uc81c\uac70\ud558\ub824\uba74 docker cli\uac00 \uc544\ub2cc ctr \ud639\uc740 nerdctl cli\ub97c \uc0ac\uc6a9\ud574\uc57c\ub9cc \ud55c\ub2e4.\\n\\nctr cli\ub97c \ud1b5\ud574 \uc811\uc18d \uc911\uc778 \uc6cc\ucee4\ub178\ub4dc\uc758 \uc774\ubbf8\uc9c0\ub97c \uc870\ud68c\ud558\ub824\uba74 k8s.io \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc758 \uc774\ubbf8\uc9c0\ub97c \uc870\ud68c\ud558\uc5ec\uc57c \ud55c\ub2e4.\\n\\n```shell\\n# ctr namespaces ls \\nNAME   LABELS\\nk8s.io\\n\\n# ctr -n k8s.io images ls \uc2e4\ud589\\n```\\n\\n## \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uac00\ube44\uc9c0 \ucf5c\ub809\uc158\\n\\n\ubb3c\ub860 \uc6cc\ucee4\ub178\ub4dc\uc5d0 \uc811\uc18d\ud558\uc5ec \uc9c1\uc811 \ub370\uc774\ud130\ub97c \uc815\ub9ac\ud560 \uc218\ub3c4 \uc788\uaca0\uc9c0\ub9cc, \uadf8\ub7ec\uba74 \ub514\uc2a4\ud06c \uc6a9\ub7c9\uc774 \ucc30 \ub54c\ub9c8\ub2e4 \ub9e4\ubc88 \uc218\ub3d9\uc73c\ub85c \ud574\ub2f9 \uc791\uc5c5\uc744 \uc9c4\ud589 \ud574\uc57c\ud558\uae30 \ub54c\ubb38\uc5d0 \uc790\ub3d9\ud654\ud560 \uc218 \uc788\ub294 \ubc29\ubc95\uc5d0 \ub300\ud574 \ucc3e\uc544\ubcf4\ub2e4\uac00 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uacf5\uc2dd \ubb38\uc11c\uc5d0\uc11c [garbage collection](https://kubernetes.io/docs/concepts/architecture/garbage-collection/)\uc5d0 \ub300\ud55c \ub0b4\uc6a9\uc744 \ubc1c\uacac\ud558\uc600\ub2e4.\\n\\n\ubb38\uc11c\uc5d0 \ub530\ub974\uba74, \uac00\ube44\uc9c0 \ucf5c\ub809\uc158\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uac00 \ud074\ub7ec\uc2a4\ud130 \ub9ac\uc18c\uc2a4\ub97c \uc815\ub9ac\ud558\ub294 \ub370 \uc0ac\uc6a9\ud558\ub294 \ub2e4\uc591\ud55c \uba54\ucee4\ub2c8\uc998\uc744 \ucd1d\uce6d\ud55c\ub2e4. \uac00\ube44\uc9c0 \ucf5c\ub809\uc158\uc744 \ud1b5\ud574 \uc815\ub9ac\ud560 \uc218 \uc788\ub294 \ub2e4\uc591\ud55c \ub9ac\uc18c\uc2a4 \uc911\uc5d0\ub294 \uc0ac\uc6a9\ub418\uc9c0 \uc54a\ub294 \ucee8\ud14c\uc774\ub108 \ubc0f \uc774\ubbf8\uc9c0\ub3c4 \ud3ec\ud568\ub418\uc5b4\uc788\ub2e4.\\n\\n### \uc0ac\uc6a9\ub418\uc9c0 \uc54a\ub294 \uc774\ubbf8\uc9c0 \uac00\ube44\uc9c0 \ucf5c\ub809\uc158\\n\\nkubelet\uc740 \uc0ac\uc6a9\ub418\uc9c0 \uc54a\ub294 \uc774\ubbf8\uc9c0\uc5d0 \ub300\ud574 5\ubd84 \ub9c8\ub2e4, \uc0ac\uc6a9\ub418\uc9c0 \uc54a\ub294 \ucee8\ud14c\uc774\ub108\uc5d0 \ub300\ud574 1\ubd84\ub9c8\ub2e4 \uac00\ube44\uc9c0 \ucf5c\ub809\uc158\uc744 \uc218\ud589\ud55c\ub2e4. \ub9cc\uc57d \uc678\ubd80\uc758 \uac00\ube44\uc9c0 \ucf5c\ub809\uc158 \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud558\uac8c \ub418\uba74 kubelet\uc758 \ub3d9\uc791\uc774 \uc911\ub2e8\ub418\uace0 \uc874\uc7ac\ud574\uc57c\ud558\ub294 \ucee8\ud14c\uc774\ub108\uac00 \uc81c\uac70\ub420 \uc218 \uc788\uc73c\ubbc0\ub85c \uad8c\uc7a5\ub418\uc9c0 \uc54a\ub294\ub2e4.\\n\\n**\uc774\ubbf8\uc9c0 \uac00\ube44\uc9c0 \ucf5c\ub809\uc158**\\n\\n\ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 [cadvisor](https://github.com/google/cadvisor/)\uc758 \ub3c4\uc6c0\uc744 \ubc1b\uc544 kubelet\uc758 \uc77c\ubd80\uc778 image manager\ub97c \ud1b5\ud574 \ubaa8\ub4e0 \uc774\ubbf8\uc9c0\uc758 \ub77c\uc774\ud504 \uc0ac\uc774\ud074\uc744 \uad00\ub9ac\ud55c\ub2e4. kubelet\uc740 \ub2e4\uc74c 2\uac00\uc9c0 \ub514\uc2a4\ud06c \uc0ac\uc6a9\ub7c9 \uc81c\ud55c\uc744 \uace0\ub824\ud558\uc5ec \uac00\ube44\uc9c0 \uc218\uc9d1 \uacb0\uc815\uc744 \ub0b4\ub9b0\ub2e4.\\n- HighThresholdPercent\\n    - \ub514\uc2a4\ud06c \uc0ac\uc6a9\ub7c9\uc774 HighThresholdPercent \uac12\uc744 \ucd08\uacfc\ud558\uba74 \uac00\ube44\uc9c0 \ucf5c\ub809\uc158\uc774 \ud2b8\ub9ac\uac70\ub418\uc5b4 \ub9c8\uc9c0\ub9c9\uc73c\ub85c \uc0ac\uc6a9\ub41c \uc2dc\uac04\uc744 \uae30\uc900\uc73c\ub85c \uac00\uc7a5 \uc624\ub798\ub41c \uc21c\uc73c\ub85c \uc774\ubbf8\uc9c0\ub97c \uc0ad\uc81c\ud55c\ub2e4.\\n- LowThresholdPercent\\n    - \uc704\uc5d0\uc11c \uac00\ube44\uc9c0 \ucf5c\ub809\uc158\uc774 \ud2b8\ub9ac\uac70\ub418\uba74, \ub514\uc2a4\ud06c \uc0ac\uc6a9\ub7c9\uc774 LowThresholdPercent \uac12\uc5d0 \ub3c4\ub2ec\ud560 \ub54c\uae4c\uc9c0 \uc774\ubbf8\uc9c0\ub97c \uc0ad\uc81c\ud55c\ub2e4.\\n\\nkubelet\uc758 \uc774\ubbf8\uc9c0 \uac00\ube44\uc9c0 \ucf5c\ub809\uc158 \uc124\uc815\uc744 \uc218\uc815\ud558\uae30 \uc704\ud574\uc11c\ub294 kubelet\uc744 \uc2e4\ud589\ud560 \ub54c \uad00\ub828 \uc635\uc158 \ud50c\ub798\uadf8\ub97c \uc9c0\uc815\ud574\uc57c\ud55c\ub2e4.\\n\\nhttps://kubernetes.io/docs/reference/command-line-tools-reference/kubelet/ \ubb38\uc11c\ub97c \ucc38\uace0\ud558\uba74 \uc124\uc815\ud560 \uc218 \uc788\ub294 \uc635\uc158\ub4e4\uc744 \ucc3e\uc744 \uc218 \uc788\ub2e4.\\n- `--image-gc-high-threshold int32`\\n    - \uac12(\ube44\uc728)\uc740 [0, 100] \ubc94\uc704 \ub0b4\uc5d0 \uc788\uc5b4\uc57c \ud55c\ub2e4. \uae30\ubcf8\uac12 : 85\\n- `--image-gc-low-threshold int32`\\n    - \uac12(\ube44\uc728)\uc740 [0, 100] \ubc94\uc704 \ub0b4\uc5d0 \uc788\uc5b4\uc57c \ud55c\ub2e4. \uae30\ubcf8\uac12 : 80\\n\\n`image-gc-high-threshold` \uc758 \uae30\ubcf8\uac12\uc740 85\uc774\uae30 \ub54c\ubb38\uc5d0 \ub514\uc2a4\ud06c \uc0ac\uc6a9\ub7c9\uc774 85%\ub97c \ucd08\uacfc\ud558\uba74 \uac00\ube44\uc9c0 \ucf5c\ub809\uc158\uc774 \uc218\ud589\ub418\uaca0\uc9c0\ub9cc \ub354 \ub0ae\uc740 \uc784\uacc4\uce58\ub97c \uc801\uc6a9\ud558\uae30 \uc704\ud574 \ud604\uc7ac \uc0ac\uc6a9 \uc911\uc778 TKE \ud074\ub7ec\uc2a4\ud130\uc758 \uc6cc\ucee4\ub178\ub4dc\uc5d0 \uad00\ub828 \uc124\uc815\uc744 \uc801\uc6a9\ud574\ubcf4\uc558\ub2e4.\\n\\nkubelet\uc758 systemd \uc720\ub2db \ud30c\uc77c\uc778 `/usr/lib/systemd/system/kubelet.service` \uc744 \ud655\uc778\ud574\ubcf4\uc558\ub2e4.\\n\\n```\\n[Unit]\\nDescription=kubelet\\n\\n[Service]\\nEnvironmentFile=-/etc/kubernetes/kubelet\\nExecStart=/usr/bin/kubelet ${ANONYMOUS_AUTH} ${AUTHENTICATION_TOKEN_WEBHOOK} ${AUTHORIZATION_MODE} ${CLIENT_CA_FILE} ${CLOUD_CONFIG} ${CLOUD_PROVIDER} ${CLUSTER_DNS} ${CLUSTER_DOMAIN} ${CONTAINER_RUNTIME} ${CONTAINER_RUNTIME_ENDPOINT} ${EVICTION_HARD} ${FAIL_SWAP_ON} ${HOSTNAME_OVERRIDE} ${KUBE_RESERVED} ${KUBECONFIG} ${MAX_PODS} ${PROVIDER_ID} ${REGISTER_SCHEDULABLE} ${REGISTER_WITH_TAINTS} ${RUNTIME_REQUEST_TIMEOUT} ${SERIALIZE_IMAGE_PULLS} ${V}\\nExecStartPost=-/bin/bash /etc/kubernetes/deny-tcp-port-10250.sh\\nRestart=always\\nRestartSec=10\\nLimitNOFILE=65536\\n\\n[Install]\\nWantedBy=multi-user.target\\n```\\n\\n\ub0b4\uc6a9\uc744 \uc0b4\ud3b4\ubcf4\uba74 kubelet\uc758 \uc2e4\ud589 \ud50c\ub798\uadf8\ub4e4\uc744 `/etc/kubernetes/kubelet` \uc5d0\uc11c \ubcc0\uc218\ub85c \ubc1b\uc544\uc624\ub294 \uac83\uc744 \uc54c \uc218 \uc788\ub2e4.\\n\\n`/etc/kubernetes/kubelet` \uc5d0\uc11c \uc774\ubbf8\uc9c0 \uac00\ube44\uc9c0 \ucf5c\ub809\uc158 \uad00\ub828 \ud50c\ub798\uadf8 \ubcc0\uc218\ub4e4\uc744 \ucd94\uac00\ud574\uc8fc\uc5c8\ub2e4.\\n\\n\ub9cc\uc57d \ub514\uc2a4\ud06c \uc6a9\ub7c9\uc774 70% \ucc28\uba74 60%\uac00 \ub420 \ub54c\uae4c\uc9c0 \uc0ac\uc6a9\ub418\uc9c0 \uc54a\ub294 \uc774\ubbf8\uc9c0\ub97c \uc81c\uac70\ud558\ub3c4\ub85d \uc124\uc815\ud558\uc600\ub2e4.\\n\\n```\\nIMAGE_GC_HIGH_THRESHOLD=\\"--image-gc-high-threshold=70\\"\\nIMAGE_GC_LOW_THRESHOLD=\\"--image-gc-low-threshold=60\\"\\n```\\n\\n\uadf8\ub9ac\uace0 \ub2e4\uc2dc `/usr/lib/systemd/system/kubelet.service` \uc5d0\uc11c ExecStart\uc5d0 \ucd94\uac00\ud55c \ubcc0\uc218\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud50c\ub798\uadf8\ub97c \uc9c0\uc815\ud574\uc8fc\uc5c8\ub2e4.\\n\\n```\\nExecStart=/usr/bin/kubelet ${IMAGE_GC_HIGH_THRESHOLD} ${IMAGE_GC_LOW_THRESHOLD} ${ANONYMOUS_AUTH} ${AUTHENTICATION_TOKEN_WEBHOOK} ${AUTHORIZATION_MODE} ${CLIENT_CA_FILE} ${CLOUD_CONFIG} ${CLOUD_PROVIDER} ${CLUSTER_DNS} ${CLUSTER_DOMAIN} ${CONTAINER_RUNTIME} ${CONTAINER_RUNTIME_ENDPOINT} ${EVICTION_HARD} ${FAIL_SWAP_ON} ${HOSTNAME_OVERRIDE} ${KUBE_RESERVED} ${KUBECONFIG} ${MAX_PODS} ${PROVIDER_ID} ${REGISTER_SCHEDULABLE} ${REGISTER_WITH_TAINTS} ${RUNTIME_REQUEST_TIMEOUT} ${SERIALIZE_IMAGE_PULLS} ${V}\\n```\\n\\nsystemd \uc720\ub2db \ud30c\uc77c\uc758 \ubcc0\uacbd \uc0ac\ud56d\uc744 \uc801\uc6a9\ud558\uae30 \uc704\ud574 `systemctl daemon-reload` \ucee4\ub9e8\ub4dc\ub97c \uc2e4\ud589\ud55c \ud6c4\uc5d0 `systemctl restart kubelet` \ucee4\ub9e8\ub4dc\ub97c \ud1b5\ud574 kubelet\uc744 \uc7ac\uc2dc\uc791\ud55c\ub2e4.\\n\\n`kubectl get node` \uba85\ub839\uc5b4\ub97c \ud1b5\ud574 kubelet\uc744 \uc7ac\uc2dc\uc791\ud55c \uc6cc\ucee4\ub178\ub4dc\uac00 \uc815\uc0c1\uc801\uc73c\ub85c \ub3d9\uc791\ud558\uace0 \uc788\ub294\uc9c0 \ud655\uc778\ud55c\ub2e4.\\n\\n\uc774\ubbf8\uc9c0 \uac00\ube44\uc9c0 \ucf5c\ub809\uc158\uc740 5\ubd84\ub9c8\ub2e4 \uc218\ud589\ub418\ubbc0\ub85c, \uc7ac\uc2dc\uc791 \ud6c4 \uc77c\uc815 \uc2dc\uac04\uc774 \uc9c0\ub09c \ud6c4\uc5d0 \uac00\ube44\uc9c0 \ucf5c\ub809\uc158\uc774 \uc81c\ub300\ub85c \uc218\ud589\ub418\ub294\uc9c0 \ud655\uc778\ud558\uae30 \uc704\ud574 \uc6cc\ucee4\ub178\ub4dc\uc5d0\uc11c `df -h` \ub85c \ub514\uc2a4\ud06c \uc0c1\ud0dc\ub97c \ud655\uc778\ud574\ubcf8\ub2e4.\\n\\n![\u1109\u1173\u110f\u1173\u1105\u1175\u11ab\u1109\u1163\u11ba 2023-10-18 \u110b\u1169\u1112\u116e 6.44.27](https://p.ipic.vip/rrugrr.png)\\n\\n\uc124\uc815\uc744 \uc801\uc6a9\ud558\uae30 \uc804\uc5d0 \ub178\ub4dc\uc758 \ub514\uc2a4\ud06c \uc0ac\uc6a9\ub7c9\uc740 80% \ub118\uac8c \ucc28 \uc788\uc5c8\uc9c0\ub9cc \ud604\uc7ac\ub294 \ub514\uc2a4\ud06c \uc0ac\uc6a9\ub7c9\uc774 40% \uc815\ub3c4\ub85c \uc904\uace0 `/run/containerd/io.containerd.runtime.v2.task/k8s.io/` \uc758 \uc6a9\ub7c9\uc774 \ub300\ud3ed \uc904\uc5b4\ub4e0 \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n\\n\uc880 \ub354 \uc815\ud655\ud558\uac8c \uac00\ube44\uc9c0 \ucf5c\ub809\uc158\uc774 \uc218\ud589 \ub410\ub294\uc9c0 \ud655\uc778\ud558\uae30 \uc704\ud574 `journalctl -u kubelet -n 100` \ucee4\ub9e8\ub4dc\ub97c \ud1b5\ud574 kubelet\uc758 \ucd5c\uc2e0 \ub85c\uadf8 100\uac1c\ub97c \uc870\ud68c\ud574\ubcf4\uc790.\\n\\n```\\nI1018 17:16:49.127741 2313004 image_gc_manager.go:312] \\"Disk usage on image filesystem is over the high threshold, trying to free bytes down to the low threshold\\" usage=82 highThre>\\nI1018 17:16:49.130385 2313004 image_gc_manager.go:389] \\"Removing image to free bytes\\" imageID=\\"sha256:047cf9fbdf261c42fec5d0db43e161b15ce7456f4cea37fdad98d8fae840079f\\" size=1042721>\\nI1018 17:16:49.159122 2313004 image_gc_manager.go:389] \\"Removing image to free bytes\\" imageID=\\"sha256:22f6921b0b710e16b011ca3bfb00b45037729cf7d0892ccb419586aa7e313c22\\" size=23963887\\nI1018 17:16:49.182128 2313004 image_gc_manager.go:389] \\"Removing image to free bytes\\" imageID=\\"sha256:09b1f1bf150850e55c1ba343af8fcd7d229006fe1b421b047b0d31f9db82a06e\\" size=1001151>\\nI1018 17:16:49.236277 2313004 image_gc_manager.go:389] \\"Removing image to free bytes\\" imageID=\\"sha256:e1317ccb493705380ee4deeac10682e09a8fd9c107ed0430bd4adcb0a01c9445\\" size=1052505>\\n```\\n\\n\ub85c\uadf8\uc758 \ub0b4\uc6a9\uc744 \ubcf4\uba74 image_gc_manager\uc5d0 \uc758\ud574 \ub514\uc2a4\ud06c \uc0ac\uc6a9\ub7c9(82%)\uc774 high threshold\ub97c \ucd08\uacfc\ud558\uc5ec low threshold\uae4c\uc9c0 \uc6a9\ub7c9\uc744 \ud655\ubcf4\ud55c\ub2e4\ub294 \uba54\uc2dc\uc9c0\uc640 \uc2e4\uc81c \uc0ad\uc81c\ub41c \uc774\ubbf8\uc9c0 \ub85c\uadf8\ub4e4\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4."},{"id":"/2023/11/03/backend/docker/docker-basic","metadata":{"permalink":"/2023/11/03/backend/docker/docker-basic","source":"@site/blog/backend/docker/2023-11-03-docker-basic.md","title":"Docker \uae30\ubcf8 \uac1c\ub150 \uc815\ub9ac","description":"Docker \uae30\ubcf8 \uac1c\ub150 \uc815\ub9ac","date":"2023-11-03T00:00:00.000Z","formattedDate":"November 3, 2023","tags":[{"label":"BackEnd","permalink":"/tags/back-end"},{"label":"Docker","permalink":"/tags/docker"}],"readingTime":22.635,"hasTruncateMarker":true,"authors":[{"name":"Chihun Park","url":"https://github.com/chihunmanse","email":"chihunmanse@gmail.com","imageURL":"https://p.ipic.vip/o1ih3g.png","key":"chihun"}],"frontMatter":{"title":"Docker \uae30\ubcf8 \uac1c\ub150 \uc815\ub9ac","description":"Docker \uae30\ubcf8 \uac1c\ub150 \uc815\ub9ac","keywords":["docker","container","kubernetes"],"tags":["BackEnd","Docker"],"authors":"chihun"},"prevItem":{"title":"\uc6cc\ucee4\ub178\ub4dc \ub514\uc2a4\ud06c \uad00\ub9ac\ud558\uae30","permalink":"/2023/11/10/backend/kubernetes/garbage-collection"},"nextItem":{"title":"Contract Error Handling","permalink":"/2023/09/10/blockchain/contract-errorhandling"}},"content":"\ud574\ub2f9 \uae00\uc740 [Docker & Kubernetes : \uc2e4\uc804 \uac00\uc774\ub4dc](https://www.udemy.com/course/docker-kubernetes-2022/) \uac15\uc758 \ub0b4\uc6a9\uc744 \ud1a0\ub300\ub85c \uc791\uc131\ub418\uc5c8\uc2b5\ub2c8\ub2e4.\\n\\n## \uc774\ubbf8\uc9c0 & \ucee8\ud14c\uc774\ub108\\n\\n### \ub3c4\ucee4\uc758 \uae30\ubcf8 \uac1c\ub150\\n**\ub3c4\ucee4\ub294 \ucee8\ud14c\uc774\ub108\ub97c \uc0dd\uc131\ud558\uace0 \uad00\ub9ac\ud558\uae30 \uc704\ud55c \ub3c4\uad6c\uc774\ub2e4.**\\n- \ucee8\ud14c\uc774\ub108\ub780 \ud45c\uc900\ud654\ub41c \uc18c\ud504\ud2b8\uc6e8\uc5b4 \uc720\ub2db\uc73c\ub85c, \ucf54\ub4dc\ub97c \uc2e4\ud589\ud558\ub294\ub370 \ud544\uc694\ud55c \uc885\uc18d\uc131\uacfc \ub3c4\uad6c\uacfc \ud3ec\ud568\ub41c \ucf54\ub4dc \ud328\ud0a4\uc9c0\uc774\ub2e4.\\n- \ub3d9\uc77c\ud55c \ucee8\ud14c\uc774\ub108\ub294 \uc5b4\ub514\uc11c \ub204\uac00 \uc2e4\ud589\ud558\ub4e0, \ub3d9\uc77c\ud55c \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \uc2e4\ud589 \ubc0f \ub3d9\uc791\uc744 \uc0dd\uc131\ud55c\ub2e4.\\n- \uc608\ub97c \ub4e4\uc5b4, Node.js \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uad6c\ucd95\ud558\ub294 \uacbd\uc6b0 \ub3c4\ucee4\ub85c \ube4c\ub4dc\ub41c \ucee8\ud14c\uc774\ub108\uc5d0\ub294 \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158 \uc18c\uc2a4 \ucf54\ub4dc \ubfd0\ub9cc \uc544\ub2c8\ub77c Node.js \ub7f0\ud0c0\uc784, \uadf8\ub9ac\uace0 \ucf54\ub4dc\ub97c \uc2e4\ud589\ud558\ub294 \ub370 \ud544\uc694\ud55c \uae30\ud0c0 \ub3c4\uad6c\uac00 \ud3ec\ud568\ub420 \uc218 \uc788\ub2e4.\\n  \ub3d9\uc77c\ud55c Node.js \ucf54\ub4dc\uc640 \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud558\ub294 \ucee8\ud14c\uc774\ub108\ub294 \ud56d\uc0c1 \ub3d9\uc77c\ud55c \ubc84\uc804\uc744 \uc0ac\uc6a9\ud558\ub294 Node.js \ub7f0\ud0c0\uc784\uc5d0\uc11c \ub3d9\uc77c\ud55c \ub3d9\uc791\uacfc \uacb0\uacfc\ub97c \uc81c\uacf5\ud55c\ub2e4\ub294 \uc774\uc810\uc774 \uc788\ub2e4.\\n- \ub3c4\ucee4\ub294 \uc774\ub7ec\ud55c \ucee8\ud14c\uc774\ub108\uc758 \uc0dd\uc131 \ubc0f \uad00\ub9ac\ub97c \uac04\uc18c\ud654\ud55c\ub2e4.\\n\\n**\ub3c4\ucee4(\ucee8\ud14c\uc774\ub108)\uac00 \ud544\uc694\ud55c \uc774\uc720** \\n- \ud504\ub85c\ub355\uc158 \ud658\uacbd\uacfc \ub611\uac19\uc740 \uac1c\ubc1c \ud658\uacbd\uc5d0\uc11c \uc0c8\ub85c \uac1c\ubc1c\ub418\ub294 \ucf54\ub4dc\ub97c \ube4c\ub4dc\ud558\uace0 \ud14c\uc2a4\ud2b8\ud560 \uc218 \uc788\ub2e4.\\n- \ud568\uaed8 \uac1c\ubc1c\ud558\ub294 \ud300\uc758 \uba64\ubc84\ub4e4\uc774 \uac19\uc740 \ud504\ub85c\uc81d\ud2b8\ub97c \uac1c\ubc1c\ud560 \ub54c \ub3d9\uc77c\ud658 \ud658\uacbd\uc744 \ubcf4\uc7a5\ud560 \uc218 \uc788\ub2e4.\\n- \uc791\uc5c5 \uc911\uc778 \ud504\ub85c\uc81d\ud2b8\uac00 \uc5ec\ub7ec \uac1c\uc778 \uacbd\uc6b0 \ud504\ub85c\uc81d\ud2b8 \ubcc4 \uac1c\ubc1c \ud658\uacbd\uc744 \uac04\ud3b8\ud558\uac8c \ubd84\ub9ac\ud560 \uc218 \uc788\ub2e4.\\n\\n\x3c!--truncate--\x3e\\n\\n### \ub3c4\ucee4\uc640 \uac00\uc0c1\uba38\uc2e0\uc758 \ucc28\uc774\uc810\\n\\n![\u1109\u1173\u110f\u1173\u1105\u1175\u11ab\u1109\u1163\u11ba 2023-10-21 \u110b\u1169\u1112\u116e 10.55.07](https://p.ipic.vip/hdvbxq.png)\\n\\n\uac00\uc0c1\uba38\uc2e0\uc73c\ub85c\ub3c4 \ucee8\ud14c\uc774\ub108\uc640 \ube44\uc2b7\ud55c \ub9e5\ub77d\uc758 \uc774\uc810\uc744 \uac00\uc838\uac08 \uc218 \uc788\ub2e4. \ud558\uc9c0\ub9cc \uac00\uc0c1\uba38\uc2e0\uc740 \uc2e4\uc81c\ub85c \uc6b0\ub9ac \uae30\uae30 \uc704\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \ub3c5\ub9bd\uc801\uc778 \ucef4\ud4e8\ud130\uc640 \uac19\uae30 \ub54c\ubb38\uc5d0 \uc624\ubc84\ud5e4\ub4dc\uac00 \ubc1c\uc0dd\ud55c\ub2e4.\\n\ubaa8\ub4e0 \uac00\uc0c1\uba38\uc2e0 \ud658\uacbd\uc5d0\uc11c \ub9ac\ub205\uc2a4 OS\ub97c \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0\ub77c\ub3c4, \ub9ac\ub205\uc2a4 OS\uac00 \ubaa8\ub4e0 \uac00\uc0c1\uba38\uc2e0\uc5d0 \ubcc4\ub3c4\ub85c \uc124\uce58 \ub3fc\uc57c\ud55c\ub2e4.\\n\\n**\uac00\uc0c1\uba38\uc2e0\uc758 \uc7a5\uc810**\\n- \ubd84\ub9ac\ub41c \ud658\uacbd\\n- \ud658\uacbd\ubcc4 \uad6c\uc131\uc774 \uac00\ub2a5\\n- \ud658\uacbd \uad6c\uc131\uc744 \uc548\uc815\uc801\uc73c\ub85c \uacf5\uc720 \uac00\ub2a5\\n\\n**\uac00\uc0c1\uba38\uc2e0\uc758 \ub2e8\uc810**\\n- \uc911\ubcf5 \ubcf5\uc81c\ub85c \uc778\ud55c \uacf5\uac04 \ub0ad\ube44\\n- \uc131\ub2a5 \uc800\ud558\\n- \ub2e4\ub978 \ucef4\ud4e8\ud130 \ubc0f \uc11c\ubc84\uc5d0\uc11c \ubcf5\uc81c\ud558\ub294 \uac83\uc774 \uae4c\ub2e4\ub85c\uc6b8 \uc218 \uc788\uc74c\\n- \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \ubc30\ud3ec\ud558\ub824\uba74 \uae30\uc874 \uc138\ud305\ud588\ub358 \uac00\uc0c1\uba38\uc2e0\uacfc \ub3d9\uc77c\ud55c \ubc29\uc2dd\uc73c\ub85c \ud504\ub85c\ub355\uc158 \uc11c\ubc84\uc758 \uac00\uc0c1\uba38\uc2e0\uc744 \uad6c\uc131\ud574\uc57c \ud55c\ub2e4.\\n\\n![\u1109\u1173\u110f\u1173\u1105\u1175\u11ab\u1109\u1163\u11ba 2023-10-21 \u110b\u1169\u1112\u116e 11.07.55](https://p.ipic.vip/foaqgx.png)\\n\\n\ub3c4\ucee4 \ucee8\ud14c\uc774\ub108\ub97c \uc0ac\uc6a9\ud558\uba74 \ud558\ub098\uc758 \uba38\uc2e0\uc5d0 \uc5ec\ub7ec \ub300\uc758 \uba38\uc2e0\uc744 \uc124\uce58\ud558\uc9c0 \uc54a\ub294\ub2e4. \ub300\uc2e0 \uc6b4\uc601 \uccb4\uc81c\ub97c \uae30\ubcf8\uc801\uc73c\ub85c \ub0b4\uc7ac\ud558\uace0 \uc788\uac70\ub098 \ucee8\ud14c\uc774\ub108 \uc5d0\ubbac\ub808\uc774\ud2b8\ub97c \uc9c0\uc6d0\ud558\ub294 \ub0b4\uc7a5 \ucee8\ud14c\uc774\ub108\ub97c \ud65c\uc6a9\ud55c\ub2e4. \uadf8\ub9ac\uace0 \uadf8 \uc704\uc5d0 \ub3c4\ucee4 \uc5d4\uc9c4\uc774\ub77c\ub294 \ub3c4\uad6c\ub97c \uc2e4\ud589\ud55c\ub2e4.\\n\\n\ucee8\ud14c\uc774\ub108\uc5d0\ub294 \ud504\ub85c\uc81d\ud2b8 \uc18c\uc2a4 \ucf54\ub4dc\uc640 \ucf54\ub4dc\ub97c \uc2e4\ud589\ud558\ub294 \ub370 \ud544\uc694\ud55c \ub3c4\uad6c\ub4e4\uc774 \ud3ec\ud568\ub418\uc5b4\uc788\uc9c0\ub9cc \ubd80\ud480\ub824\uc9c4 \uc6b4\uc601 \uccb4\uc81c\ub098 \uc911\ubcf5\ub418\ub294 \ucd94\uac00 \ub3c4\uad6c\ub4e4\uc740 \ud3ec\ud568\ub418\uc9c0 \uc54a\ub294\ub2e4.\\n\ub610 \ucee8\ud14c\uc774\ub108\ub294 \uad6c\uc131 \ud30c\uc77c\uc744 \uc0ac\uc6a9\ud558\uc5ec \ucee8\ud14c\uc774\ub108\ub97c \uad6c\uc131\ud558\uace0 \uadf8\uc5d0 \ub300\ud55c \uc124\uba85\uc744 \ud560 \uc218 \uc788\uae30 \ub54c\ubb38\uc5d0 \ub2e4\ub978 \uc0ac\ub78c\uc5d0\uac8c \ucee8\ud14c\uc774\ub108 \uad6c\uc131\uc744 \uacf5\uc720\ud558\uae30\uac00 \uc6a9\uc774\ud558\uace0 \ub2e4\ub978 \uc2dc\uc2a4\ud15c\uc5d0\uc11c \ub3d9\uc77c\ud55c \ucee8\ud14c\uc774\ub108\ub97c \uad6c\uc131\ud558\uace0 \uc2e4\ud589\ud558\ub294 \uac83\uc774 \uac00\uc0c1\uba38\uc2e0\uc5d0 \ube44\ud574 \ud3b8\ub9ac\ud558\ub2e4.\\n\\n**\ucee8\ud14c\uc774\ub108\uc758 \uc7a5\uc810**\\n- OS\uc5d0 \ubbf8\uce58\ub294 \uc601\ud5a5\uc774 \uc801\uace0, \ub514\uc2a4\ud06c \uacf5\uac04 \uc0ac\uc6a9\ub7c9\uc744 \ucd5c\uc18c\ud654\ud55c\ub2e4.\\n- \uad6c\uc131 \uacf5\uc720\uc640 \uc7ac\uad6c\ucd95 \ubc0f \ubc30\ud3ec\uac00 \uac04\ud3b8\ud558\ub2e4.\\n- \uc804\uccb4 \uba38\uc2e0\uc758 \ucea1\uc290\ud654 \ub300\uc2e0 \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158 \ubc0f \ud658\uacbd\uc758 \ucea1\uc290\ud654\ub97c \ud560 \uc218 \uc788\ub2e4.\\n\\n### \uc774\ubbf8\uc9c0\uc640 \ucee8\ud14c\uc774\ub108\\n\\n![\u1109\u1173\u110f\u1173\u1105\u1175\u11ab\u1109\u1163\u11ba 2023-10-22 \u110b\u1169\u1112\u116e 5.32.51](https://p.ipic.vip/5tdwv9.png)\\n\\n**\ub3c4\ucee4 \uc774\ubbf8\uc9c0\ub294 \ucee8\ud14c\uc774\ub108\uc758 \ud15c\ud50c\ub9bf / \ube14\ub8e8\ud504\ub9b0\ud2b8\uc774\ub2e4.**\\n- \uc774\ubbf8\uc9c0\ub294 \ucf54\ub4dc\uc640 \ucf54\ub4dc\ub97c \uc2e4\ud589\ud558\ub294\ub370 \ud544\uc694\ud55c \ub3c4\uad6c\ub97c \ud3ec\ud568\ud558\uace0 \uc788\ub2e4.\\n- \ucee8\ud14c\uc774\ub108\uac00 \uc2e4\ud589\ub418\uba70 \ucf54\ub4dc\ub97c \uc2e4\ud589\ud55c\ub2e4.\\n- \uc774\ubbf8\uc9c0\ub97c \uae30\ubc18\uc73c\ub85c \uc5ec\ub7ec \ucee8\ud14c\uc774\ub108\ub97c \ub9cc\ub4e4 \uc218 \uc788\ub2e4.\\n- \uc989 \uc774\ubbf8\uc9c0\ub780, \ubaa8\ub4e0 \uc124\uc815 \uba85\ub839 \ubc0f \ucf54\ub4dc\uac00 \ud3ec\ud568\ub41c \uacf5\uc720 \uac00\ub2a5\ud55c \ud328\ud0a4\uc9c0\uc774\ub2e4. \uadf8\ub9ac\uace0 \ucee8\ud14c\uc774\ub108\ub294 \uadf8\ub7ec\ud55c \uc774\ubbf8\uc9c0\uc758 \uad6c\uccb4\uc801\uc778 \uc2e4\ud589 \uc778\uc2a4\ud134\uc2a4\uc774\ub2e4.\\n\\n**\uc774\ubbf8\uc9c0\ub97c \uc0ac\uc6a9\ud558\ub294 \ubc29\uc2dd**\\n- \uc774\ubbf8\uc9c0\ub97c \uc0ac\uc6a9\ud558\ub294 \ubc29\uc2dd\uc740 \uae30\ubcf8\uc801\uc73c\ub85c \ub450 \uac00\uc9c0 \ubc29\uc2dd\uc774 \uc788\ub2e4.\\n  1. \uc774\ubbf8 \uc874\uc7ac\ud558\ub294 \uc774\ubbf8\uc9c0\ub97c \uc0ac\uc6a9\ud558\ub294 \ubc29\uc2dd (\uc608\ub97c \ub4e4\uc5b4 \ub3c4\ucee4 \ud5c8\ube0c\uc5d0 \uc874\uc7ac\ud558\ub294 Node\uc640 \uac19\uc740 \uc774\ubbf8\uc9c0)\\n  2. \uc874\uc7ac\ud558\ub294 \uc774\ubbf8\uc9c0\ub97c \uae30\ubc18\uc73c\ub85c Dockerfile\uc744 \ud1b5\ud574 \ucee4\uc2a4\ud140 \uc774\ubbf8\uc9c0\ub97c \uc0dd\uc131\ud558\uc5ec \uc0ac\uc6a9\ud558\ub294 \ubc29\uc2dd\\n\\n**\uc774\ubbf8\uc9c0\uc758 \ud2b9\uc131**\\n\\n![\u1109\u1173\u110f\u1173\u1105\u1175\u11ab\u1109\u1163\u11ba 2023-10-22 \u110b\u1169\u1112\u116e 5.51.10](https://p.ipic.vip/x6pm69.png)\\n\\n- \uc774\ubbf8\uc9c0\ub294 \uc77d\uae30 \uc804\uc6a9\uc774\ub2e4. (\ud55c \ubc88 \ube4c\ub4dc\ub418\uba74 \uc774\ubbf8\uc9c0\ub97c \ub2e4\uc2dc \ube4c\ub4dc\ud558\uc9c0 \uc54a\ub294 \ud55c \uc774\ubbf8\uc9c0\uc758 \ucf54\ub4dc\ub97c \ubcc0\uacbd\ud560 \uc218 \uc5c6\ub2e4.)\\n- CMD \uba85\ub839\uc740 \uc774\ubbf8\uc9c0\uac00 \ube4c\ub4dc\ub420 \ub54c \uc2e4\ud589\ub418\ub294 \uac83\uc774 \uc544\ub2c8\ub77c, \ud574\ub2f9 \uc774\ubbf8\uc9c0\ub97c \uae30\ubc18\uc73c\ub85c \ucee8\ud14c\uc774\ub108\uac00 \uc0dd\uc131\ub418\uace0 \uc2dc\uc791\ub420 \ub54c \uc2e4\ud589\ub418\ub294 \uba85\ub839\uc774\ub2e4.\\n- \uc774\ubbf8\uc9c0\ub294 \ub808\uc774\uc5b4 \uae30\ubc18 \uc544\ud0a4\ud14d\ucc98\ub97c \ub530\ub978\ub2e4.\\n  - \ub3c4\ucee4\ub294 \uc774\ubbf8\uc9c0\ub97c \ube4c\ub4dc\ud560 \ub54c\ub9c8\ub2e4 \ubaa8\ub4e0 \uba85\ub839 \uacb0\uacfc\ub97c \uce90\uc2dc\ud558\uace0, \uc774\ubbf8\uc9c0\ub97c \ub2e4\uc2dc \ube4c\ub4dc\ud560 \ub54c \uba85\ub839\uc744 \uc2e4\ud589\ud560 \ud544\uc694\uac00 \uc5c6\uc73c\uba74 \uce90\uc2dc\ub41c \uacb0\uacfc\ub97c \uc0ac\uc6a9\ud55c\ub2e4. \uc774\ubbf8\uc9c0\ub97c \ub2e4\uc2dc \ube4c\ub4dc\ud560 \ub54c \ubcc0\uacbd\ub41c \ubd80\ubd84\uc758 \uba85\ub839\uc744 \uc2dc\uc791\uc73c\ub85c \uadf8 \uc774\ud6c4\uc758 \ubaa8\ub4e0 \uba85\ub839\uc774 \uc7ac\ud3c9\uac00\ub41c\ub2e4. (\ub808\uc774\uc5b4 \ubcc0\uacbd \ud6c4\uc758 \ubaa8\ub4e0 \ub808\uc774\uc5b4)\\n    ```docker\\n    FROM node\\n    \\n    WORKDIR /app\\n    \\n    # \ud574\ub2f9 \ub808\uc774\uc5b4\ub97c \uba3c\uc800 \ub450\uc5b4 package.json\uc774 \ubc14\ub00c\uc9c0 \uc54a\uc558\uc744 \ub54c\ub294 npm install\uc744 \uc2e4\ud589\ud558\uc9c0 \uc54a\ub3c4\ub85d \ud560 \uc218 \uc788\ub2e4.\\n    COPY package.json /app \\n    \\n    RUN npm install\\n    \\n    COPY . /app\\n    \\n    EXPOSE 80\\n    \\n    CMD [\\"node\\", \\"server.js\\"]\\n    ```\\n  - \uc774\ubbf8\uc9c0\ub97c \uae30\ubc18\uc73c\ub85c \ucee8\ud14c\uc774\ub108\ub97c \uc2e4\ud589\ud558\uba74, \ucee8\ud14c\uc774\uc5b4\ub294 \uae30\ubcf8\uc801\uc73c\ub85c Dockerfile\uc5d0 \uc9c0\uc815\ud55c \uba85\ub839\uc744 \uc2e4\ud589\ud55c \uacb0\uacfc\ub85c \uc774\ubbf8\uc9c0 \uc704\uc5d0 \ubd80\uac00\uc801\uc778 \ub808\uc774\uc5b4\ub97c \ucd94\uac00\ud55c\ub2e4. \ucd5c\uc885 \uba85\ub839 \uc774\uc804\uc758 \ubaa8\ub4e0 \uba85\ub839\uc740 \uc774\ubbf8 \uc774\ubbf8\uc9c0\uc758 \uc77c\ubd80\uc774\uc9c0\ub9cc \ubcc4\ub3c4\uc758 \ub808\uc774\uc5b4\uc774\ub2e4. \uc544\ubb34 \uac83\ub3c4 \ubcc0\uacbd\ub418\uc9c0 \uc54a\uc73c\uba74 \uc774\ub7ec\ud55c \ub808\uc774\uc5b4\ub97c \uce90\uc2dc\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub2e4.\\n\\n**\ucee8\ud14c\uc774\ub108\uc758 \ud2b9\uc131**\\n\\n![\u1109\u1173\u110f\u1173\u1105\u1175\u11ab\u1109\u1163\u11ba 2023-10-22 \u110b\u1169\u1112\u116e 6.13.31](https://p.ipic.vip/1k92gc.png)\\n\\n- \ucee8\ud14c\uc774\ub108\ub294 \uc774\ubbf8\uc9c0\ub97c \uae30\ubc18\uc73c\ub85c \ud558\ub294 \uc2e4\ud589 \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158\uc774\ub2e4.\\n- \ucee8\ud14c\uc774\ub108\ub97c \uc2e4\ud589\ud588\uc744 \ub54c \uc774\ubbf8\uc9c0 \uc704\uc5d0 (\uc77d\uae30-\uc4f0\uae30\uac00 \uac00\ub2a5\ud55c) \ubd80\uac00\uc801\uc778 \ub808\uc774\uc5b4\uac00 \ucd94\uac00\ub41c\ub2e4. \uc989 \uc0c8\ub85c\uc6b4 \ucee8\ud14c\uc774\ub108\ub97c \uc2e4\ud589\ud588\uc744 \ub54c, \uc774\ubbf8\uc9c0\uc5d0\uc11c \ucf54\ub4dc\uc640 \ud658\uacbd\uc744 \uc0c8 \ucee8\ud14c\uc774\ub108\ub85c \ubaa8\ub450 \ubcf5\uc0ac\ud558\uc9c0 \uc54a\ub294\ub2e4. \ucee8\ud14c\uc774\ub108\ub294 \uc774\ubbf8\uc9c0\uc5d0 \uc800\uc7a5\ub41c \ud658\uacbd\uc744 \uc0ac\uc6a9\ud55c\ub2e4.\\n- \ubaa8\ub4e0 \ucee8\ud14c\uc774\ub108\ub294 \ub3c5\ub9bd\uc801\uc73c\ub85c \uc2e4\ud589\ub418\ubbc0\ub85c \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158 \uc0c1\ud0dc\ub098 \uae30\ub85d\ub41c \ub370\uc774\ud130\ub97c \uacf5\uc720\ud558\uc9c0 \uc54a\ub294\ub2e4.\\n\\n**\uc774\ubbf8\uc9c0\uc758 \uc774\ub984\uacfc \ud0dc\uadf8**\\n\\n![\u1109\u1173\u110f\u1173\u1105\u1175\u11ab\u1109\u1163\u11ba 2023-10-22 \u110b\u1169\u1112\u116e 9.01.35](https://p.ipic.vip/t93ymy.png)\\n\\n- \uc774\ubbf8\uc9c0\uc758 \ud0dc\uadf8\ub294 \uc774\ub984\uacfc \ud0dc\uadf8 \ub450 \ubd80\ubd84\uc73c\ub85c \uad6c\uc131\ub41c\ub2e4.\\n- \uc774\ub984\uc740 \uc774\ubbf8\uc9c0\uc758 \ub808\ud3ec\uc9c0\ud1a0\ub9ac\ub77c\uace0\ub3c4 \ud558\uba70, \uc5ec\ub7ec \uac1c\uc758 \ud2b9\uc815\ud654\ub41c \uc774\ubbf8\uc9c0 \uadf8\ub8f9\uc744 \ub9cc\ub4e4 \uc218 \uc788\ub2e4.\\n- \ud0dc\uadf8\ub294 \ud558\ub098\uc758 \uc774\ubbf8\uc9c0 \uadf8\ub8f9 \ub0b4\uc5d0\uc11c \ud2b9\uc815\ud654\ub41c \ubc84\uc804\uc744 \uc815\uc758\ud558\ub294\ub370 \uc0ac\uc6a9\ub41c\ub2e4.\\n\\n**\uc774\ubbf8\uc9c0 \uacf5\uc720 \ubc29\uc2dd**\\n\\n![\u1109\u1173\u110f\u1173\u1105\u1175\u11ab\u1109\u1163\u11ba 2023-10-22 \u110b\u1169\u1112\u116e 9.10.56](https://p.ipic.vip/it2qmu.png)\\n\\n- Dockerfile\uc744 \uacf5\uc720\ud560 \uc218\ub3c4 \uc788\uc9c0\ub9cc(\uc774 \uacbd\uc6b0 \uc18c\uc2a4\ucf54\ub4dc\ub3c4 \ud568\uaed8 \uacf5\uc720 \ub3fc\uc57c\ud558\uae30 \ub54c\ubb38\uc5d0) \uc77c\ubc18\uc801\uc73c\ub85c \uc774\ubbf8 \ube4c\ub4dc\ub41c \uc774\ubbf8\uc9c0\ub97c \uacf5\uc720\ud558\ub294 \ubc29\uc2dd\uc744 \uc0ac\uc6a9\ud55c\ub2e4.\\n- DockerHub\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc774\ubbf8\uc9c0\ub97c \uacf5\uc720\ud558\uac70\ub098, \ub2e4\ub978 \uc5ec\ub7ec \uacf5\uae09\uc790\ub4e4\uc774 \uc81c\uacf5\ud558\ub294 \uac1c\uc778 \ub808\uc9c0\uc2a4\ud2b8\ub9ac\ub97c \ud65c\uc6a9\ud558\uc5ec \uc774\ubbf8\uc9c0\ub97c \uacf5\uc720\ud560 \uc218 \uc788\ub2e4.\\n\\n**\uc774\ubbf8\uc9c0 & \ucee8\ud14c\uc774\ub108 \uad00\ub828 \uba85\ub839\uc5b4**\\n\\n- `docker build . ` : \ub3c4\ucee4\ud30c\uc77c\uc744 \uae30\ubc18\uc73c\ub85c \uc774\ubbf8\uc9c0\ub97c \ube4c\ub4dc\ud558\uace0 \uc0dd\uc131\ud55c\ub2e4.\\n  - `-t NAME:TAG` : \uc774\ubbf8\uc9c0\uc5d0 \uc774\ub984\uacfc \ud0dc\uadf8\ub97c \ud560\ub2f9\ud55c\ub2e4.\\n- `docker run IMAGE_NAME` : \uc774\ubbf8\uc9c0\ub97c \uae30\ubc18\uc73c\ub85c \uc0c8 \ucee8\ud14c\uc774\ub108\ub97c \uc0dd\uc131 \ubc0f \uc2dc\uc791\ud55c\ub2e4. (\ub610\ub294 \uc774\ubbf8\uc9c0 id \uc0ac\uc6a9)\\n  - `--name NAME` : \ucee8\ud14c\uc774\ub108\uc5d0 \uc774\ub984\uc744 \ud560\ub2f9\ud55c\ub2e4. \uc774 \uc774\ub984\uc740 \uc911\uc9c0 \ubc0f \uc81c\uac70 \ub4f1\uc5d0 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub2e4.\\n  - `-d` : \ucee8\ud14c\uc774\ub108\ub97c \ubd84\ub9ac \ubaa8\ub4dc(detached mode) \ub85c \uc2e4\ud589\ud55c\ub2e4. \ucee8\ud14c\uc774\ub108\uc758 \ucd9c\ub825\uc774 \ud45c\uc2dc\ub418\uc9c0 \uc54a\uace0, \uba85\ub839 \ud504\ub86c\ud504\ud2b8/\ud130\ubbf8\ub110\uc774 \ucee8\ud14c\uc774\ub108\uac00 \uc911\uc9c0\ub420 \ub54c\uae4c\uc9c0 \uae30\ub2e4\ub9ac\uc9c0 \uc54a\ub294\ub2e4.\\n  - `-it` : \ucee8\ud14c\uc774\ub108\ub97c \ub300\ud654\ud615 \ubaa8\ub4dc(interactive mode) \ub85c \uc2e4\ud589\ud55c\ub2e4. \ucee8\ud14c\uc774\ub108/\uc751\uc6a9\ud504\ub85c\uadf8\ub7a8\uc774 \uba85\ub839 \ud504\ub86c\ud504\ud2b8/\ud130\ubbf8\ub110\uc744 \ud1b5\ud574 \uc785\ub825\uc744 \ubc1b\uc744 \uc900\ube44\uac00 \ub41c\ub2e4. CTRL + C\ub85c \ucee8\ud14c\uc774\ub108\ub97c \uc911\uc9c0\ud560 \uc218 \uc788\ub2e4.\\n  - `--rm` : \ucee8\ud14c\uc774\ub108\uac00 \uc911\uc9c0\ub418\uba74 \uc790\ub3d9\uc73c\ub85c \uc81c\uac70\ud55c\ub2e4.\\n- `docker ps` : \uc2e4\ud589 \uc911\uc778 \ubaa8\ub4e0 \ucee8\ud14c\uc774\ub108\ub97c \ub098\uc5f4\ud55c\ub2e4.\\n  - `-a` : \uc911\uc9c0\ub41c \ucee8\ud14c\uc774\ub108\ub97c \ud3ec\ud568\ud55c \ubaa8\ub4e0 \ucee8\ud14c\uc774\ub108\ub97c \ub098\uc5f4\ud55c\ub2e4.\\n- `docker images` : \ub85c\uceec\uc5d0 \uc800\uc7a5\ub41c \ubaa8\ub4e0 \uc774\ubbf8\uc9c0\ub97c \ub098\uc5f4\ud55c\ub2e4.\\n- `docker rm CONTAINER` : \uc774\ub984\uc774 CONTAINER\uc778 \ucee8\ud14c\uc774\ub108\ub97c \uc81c\uac70\ud55c\ub2e4. (\ub610\ub294 \ucee8\ud14c\uc774\ub108 id \uc0ac\uc6a9 \uac00\ub2a5)\\n- `docker rmi IMAGE` : \uc774\ub984/id\ub85c \uc774\ubbf8\uc9c0\ub97c \uc81c\uac70\ud55c\ub2e4.\\n- `docker container prune` : \uc911\uc9c0\ub41c \ubaa8\ub4e0 \ucee8\ud14c\uc774\ub108\ub97c \uc81c\uac70\ud55c\ub2e4.\\n- `docker image prune` : dangling\ub41c (\ud0dc\uadf8\uac00 \uc5c6\ub294 \uc774\ubbf8\uc9c0)\ub97c \ubaa8\ub450 \uc81c\uac70\ud55c\ub2e4.\\n  -  `-a` : \ud604\uc7ac \ucee8\ud14c\uc774\ub108\uc5d0\uc11c \uc0ac\uc6a9\ud558\uace0 \uc788\uc9c0 \uc54a\uc740 \uc774\ubbf8\uc9c0\ub97c \ubaa8\ub450 \uc81c\uac70\ud55c\ub2e4.\\n- `docker push image` : \uc774\ubbf8\uc9c0\ub97c \ub3c4\ucee4\ud5c8\ube0c(\ub610\ub294 \ub2e4\ub978 \ub808\uc9c0\uc2a4\ud2b8\ub9ac)\ub85c \ud478\uc2dc\ud55c\ub2e4. \uc774\ubbf8\uc9c0 \uc774\ub984/\ud0dc\uadf8\uc5d0\ub294 \ub808\ud3ec\uc9c0\ud1a0\ub9ac \uc774\ub984/URL\uc774 \ud3ec\ud568\ub418\uc5b4\uc57c \ud55c\ub2e4.\\n- `docker pull image` : \ub3c4\ucee4\ud5c8\ube0c(\ub610\ub294 \ub2e4\ub978 \ub808\uc9c0\uc2a4\ud2b8\ub9ac)\uc5d0\uc11c \uc774\ubbf8\uc9c0\ub97c \uac00\uc838\uc628\ub2e4. `docker run image` \ub97c \uc2e4\ud589\ud588\uc744 \ub54c \uc774\ubbf8\uc9c0\ub97c \uac00\uc838\uc624\uc9c0 \uc54a\uc740 \uacbd\uc6b0 \uc790\ub3d9\uc73c\ub85c \uc218\ud589\ub41c\ub2e4.\\n\\n## \ub370\uc774\ud130 \uad00\ub9ac\\n\\n### \ub370\uc774\ud130\uc758 \uc885\ub958\\n\\n![\u1109\u1173\u110f\u1173\u1105\u1175\u11ab\u1109\u1163\u11ba 2023-10-22 \u110b\u1169\u1112\u116e 9.46.14](https://p.ipic.vip/invxho.png)\\n\\n\uc5b4\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc2e4\ud589\ud558\uace0 \uc6b4\uc601\ud558\ub294 \ub370 \ud544\uc694\ud55c \ub370\uc774\ud130\uc758 \uc885\ub958\ub294 \ud06c\uac8c 3\uac00\uc9c0\ub85c \ub098\ub20c \uc218 \uc788\ub2e4.\\n\\n1. \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158 \ub370\uc774\ud130 (\uc18c\uc2a4 \ucf54\ub4dc\uc640 \uc2e4\ud589 \ud658\uacbd)\\n   - \uc774\ubbf8\uc9c0 \ube4c\ub4dc \ub2e8\uacc4\uc5d0\uc11c \ubcf5\uc0ac\ub41c \uc774\ud6c4\ub85c \uace0\uc815\ub418\ubbc0\ub85c \uc218\uc815\ud558\ub824\uba74 \uc774\ubbf8\uc9c0\ub97c \uc7ac\ube4c\ub4dc\ud574\uc57c \ud55c\ub2e4.\\n   - \uc989 \uc77d\uae30 \uc804\uc6a9 \ub370\uc774\ud130\uc774\ub2e4.\\n2. \uc784\uc2dc \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158 \ub370\uc774\ud130 \\n   - \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \uc2e4\ud589\ub418\ub294 \ub3d9\uc548 \uc0dd\uc131\ub41c \ub370\uc774\ud130 \uc911\uc5d0 \uc601\uad6c\uc801\uc73c\ub85c \uc800\uc7a5\ud560 \ud544\uc694\uac00 \uc5c6\ub294 \uc784\uc2dc \ub370\uc774\ud130\\n   - \uba54\ubaa8\ub9ac \ubc0f \ud30c\uc77c\uc5d0 \uc800\uc7a5\ub418\uc9c0\ub9cc \ucee8\ud14c\uc774\ub108\uac00 \uc885\ub8cc \ub410\uc744 \ub54c \uc783\uc5b4\ub3c4 \uc0c1\uad00 \uc5c6\ub294 \ub370\uc774\ud130\\n   - \uc784\uc2dc \ub370\uc774\ud130\ub294 \uc77d\uace0-\uc4f0\uae30 \ub54c\ubb38\uc5d0 \uc774\ubbf8\uc9c0\uac00 \uc544\ub2cc \ucee8\ud14c\uc774\ub108\uc5d0 \uc800\uc7a5\ub41c\ub2e4. (\uc774\ubbf8\uc9c0\ub294 \uc77d\uae30 \uc804\uc6a9\uc774\uae30 \ub54c\ubb38\uc5d0)\\n3. \uc601\uad6c \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158 \ub370\uc774\ud130\\n   - \uc0ac\uc6a9\uc790 \uc815\ubcf4\ucc98\ub7fc \uc9c0\uc18d\ub418\uc5b4\uc57c\ud558\ub294 \ub370\uc774\ud130\\n   - \ud30c\uc77c \ubc0f \ub370\uc774\ud130\ubca0\uc774\uc2a4\uc5d0 \uc800\uc7a5\ub418\ub294 \ub370\uc774\ud130\\n   - \ucee8\ud14c\uc774\ub108\uac00 \uc81c\uac70\ub418\ub354\ub77c\ub3c4 \uadf8\ub300\ub85c \ubcf4\uc874\ub418\uc5b4\uc57c \ud55c\ub2e4.\\n\\n**\ucee8\ud14c\uc774\ub108 \ub370\uc774\ud130 \uad00\ub9ac\uc758 \ubb38\uc81c**\\n\\n\uc774\ubbf8\uc9c0 \uc704\uc5d0 \ub3c4\ucee4\uc5d0 \uc758\ud574 \ucd94\uac00\ub41c \ubd80\uac00(extra) \ub808\uc774\uc5b4\uc5d0\ub294 \uc774\ubbf8\uc9c0 \ubc0f \ud30c\uc77c \uc2dc\uc2a4\ud15c\uc744 \uc778\uc2dd\ud558\uba70 \ubcf5\uc0ac\ud558\uc9c0 \uc54a\uace0 \ud30c\uc77c \uc2dc\uc2a4\ud15c\uc744 \ubbf8\ub7ec\ub9c1\ud558\ub294 \ub85c\uc9c1\uc774 \uc788\ub2e4. \uc5ec\uae30\uc5d0\uc11c \ub3c4\ucee4\ub294 \uc77d\uae30-\uc4f0\uae30 \uad8c\ud55c\uc744 \uac00\uc9c0\uba70 \ud30c\uc77c\uc758 \uc2dc\uc2a4\ud15c\uc744 \uc870\uc791\ud560 \uc218 \uc788\ub2e4. \ub3c4\ucee4\ub294 \ucee8\ud14c\uc774\ub108\uc758 \ubcc0\uacbd \uc0ac\ud56d\uc744 \ucd94\uc801\ud558\uace0 \uc774\ubbf8\uc9c0\uc758 \ud30c\uc77c \uc2dc\uc2a4\ud15c\uc744 \uac00\uc838\uc640 \ucd5c\uc885 \ud30c\uc77c \uc2dc\uc2a4\ud15c\uc744 \ud30c\uc0dd\uc2dc\ucf1c \uc77d\uae30-\uc4f0\uae30 \ub808\uc774\uc5b4\uc5d0 \uc800\uc7a5\ub41c \ubcc0\uacbd \uc0ac\ud56d\uacfc \uacb0\ud569\uc2dc\ud0a8\ub2e4. \uadf8\ub7ec\ub098 \uc77d\uae30-\uc4f0\uae30 \ucee8\ud14c\uc774\ub108\ub97c \uc0ac\uc6a9\ud558\ub354\ub77c\ub3c4 \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \ub370\uc774\ud130\ub97c \uad00\ub9ac\ud568\uc5d0 \uc788\uc5b4 \ub450 \uac00\uc9c0 \ubb38\uc81c\uac00 \uc874\uc7ac\ud55c\ub2e4.\\n\\n1. \ucee8\ud14c\uc774\ub108\uc5d0 \uc4f0\uc5ec\uc9c4 \ub370\uc774\ud130\ub294 \uc9c0\uc18d\ub418\uc9c0 \uc54a\ub294\ub2e4. \ucee8\ud14c\uc774\ub108\ub97c \uc911\uc9c0\ud558\uace0 \uc81c\uac70\ud558\uba74 \ucee8\ud14c\uc774\ub108\uc5d0 \uae30\ub85d\ub41c \ubaa8\ub4e0 \ub370\uc774\ud130\uac00 \uc190\uc2e4\ub41c\ub2e4.\\n2. \ucee8\ud14c\uc774\ub108\uac00 \ud638\uc2a4\ud2b8 \ud30c\uc77c\uc2dc\uc2a4\ud15c\uacfc \uc0c1\ud638 \uc791\uc6a9\ud560 \uc218 \uc5c6\ub2e4. \ud638\uc2a4\ud2b8 \ud504\ub85c\uc81d\ud2b8 \ud3f4\ub354\uc5d0\uc11c \ubb34\uc5b8\uac00\ub97c \ubcc0\uacbd\ud558\ub354\ub77c\ub3c4 \uc2e4\ud589 \uc911\uc778 \ucee8\ud14c\uc774\ub108\uc5d0 \ud574\ub2f9 \ubcc0\uacbd \uc0ac\ud56d\uc774 \ubc18\uc601\ub418\uc9c0 \uc54a\ub294\ub2e4. (\uc774\ubbf8\uc9c0\ub97c \ub2e4\uc2dc \ube4c\ub4dc\ud558\uace0 \uc0c8 \ucee8\ud14c\uc774\ub108\ub97c \uc2dc\uc791\ud574\uc57c \ud55c\ub2e4.)\\n\\n### \ubcfc\ub968 & \ubc14\uc778\ub4dc\ub9c8\uc6b4\ud2b8\\n\\n![\u1109\u1173\u110f\u1173\u1105\u1175\u11ab\u1109\u1163\u11ba 2023-10-22 \u110b\u1169\u1112\u116e 10.02.33](https://p.ipic.vip/z302an.png)\\n\\n\ub3c4\ucee4\uc5d0\ub294 \ubcfc\ub968\uc774\ub77c\ub294 \ub0b4\uc7a5 \uae30\ub2a5\uc774 \uc788\ub2e4. \ubcfc\ub968\uc740 \ub3c4\ucee4\uac00 \uc778\uc2dd\ud558\ub294 \ud638\uc2a4\ud2b8 \uba38\uc2e0\uc5d0 \uc788\ub294 \ud3f4\ub354\ub85c\uc11c \ub3c4\ucee4 \ucee8\ud14c\uc774\ub108 \ub0b4\ubd80\uc758 \ud3f4\ub354\uc5d0 \ub9e4\ud551\ub41c\ub2e4.\\nDockerfile\uc758 `COPY` \uba85\ub839\uc740 \ubcf5\uc0ac\ud558\ub3c4\ub85d \uba85\ub839\ud55c \uacbd\ub85c\uc640 \ud30c\uc77c\uc758 \uc2a4\ub0c5\uc0f7\uc744 \ucde8\ud55c \ub2e4\uc74c \uc774\ub7ec\ud55c \ud30c\uc77c \ubc0f \ud3f4\ub354\ub97c \uc774\ubbf8\uc9c0\uc5d0 \ubcf5\uc0ac\ud558\ub294 \uac83\uc774 \uc804\ubd80\uc774\uae30 \ub54c\ubb38\uc5d0 \uc9c0\uc18d\uc801\uc778 \uad00\uacc4\ub098 \uc5f0\uacb0\uc774 \uc5c6\ub2e4. \\n\ud558\uc9c0\ub9cc \ubcfc\ub968\uc740 \ucee8\ud14c\uc774\ub108 \ub0b4\ubd80\uc758 \ud3f4\ub354\ub97c \ud638\uc2a4\ud2b8 \uba38\uc2e0 \uc0c1\uc758 \ucee8\ud14c\uc774\ub108 \uc678\ubd80 \ud3f4\ub354\uc5d0 \uc5f0\uacb0\ud560 \uc218 \uc788\ub2e4. \ubcfc\ub968\uc740 \ucee8\ud14c\uc774\ub108\uac00 \uc81c\uac70\ub418\uc5b4\ub3c4 \ub370\uc774\ud130\ub97c \uc720\uc9c0\ud560 \uc218 \uc788\ub2e4.\\n\\n\ubcfc\ub968\uc5d0\ub294 \ub450 \uac00\uc9c0 \uc720\ud615\uc774 \uc788\ub2e4.\\n\\n![\u1109\u1173\u110f\u1173\u1105\u1175\u11ab\u1109\u1163\u11ba 2023-10-29 \u110b\u1169\u1112\u116e 9.23.36](https://p.ipic.vip/27ezgk.png)\\n\\n- **\uc775\uba85(Anonymous) \ubcfc\ub968**\\n  - \ub2e8\uc77c \ucee8\ud14c\uc774\ub108\ub97c \uc704\ud574 \ub9cc\ub4e4\uc5b4\uc9c4\ub2e4.\\n  - \ucee8\ud14c\uc774\ub108\ub97c \uc2e4\ud589\ud560 \ub54c `--rm` \uba85\ub839\uc744 \ucd94\uac00\ud558\uc9c0 \uc54a\ub294 \ud55c \ucee8\ud14c\uc774\ub108\ub97c \uc885\ub8cc\ud558\uace0 \uc7ac\uc2dc\uc791\ud574\ub3c4 \uc720\uc9c0\ub41c\ub2e4. (\uc775\uba85 \ubcfc\ub968\uc774 \uc81c\uac70\ub418\uc9c0 \uc54a\ub354\ub77c\ub3c4 \ucee8\ud14c\uc774\ub108\ub97c \uc81c\uac70\ud558\uace0 \ub2e4\uc2dc \uc2dc\uc791\ud558\uba74 \uc0c8 \uc775\uba85 \ubcfc\ub968\uc774 \uc0dd\uc131\ub41c\ub2e4. `docker volume rm VOL_NAME` \ub610\ub294 `docker volume prune` \uc744 \ud1b5\ud574 \uc0ad\uc81c\ud560 \uc218 \uc788\ub2e4.)\\n  - \ucee8\ud14c\uc774\ub108 \uac04\uc5d0 \uacf5\uc720\ub420 \uc218 \uc5c6\ub2e4.\\n  - \uc775\uba85\uc774\ubbc0\ub85c \ub3d9\uc77c\ud55c \uc774\ubbf8\uc9c0\uc5d0\uc11c\ub3c4 \uc7ac\uc0ac\uc6a9\ud560 \uc218 \uc5c6\ub2e4.\\n  - \ub3c4\ucee4\ub294 \ud638\uc2a4\ud2b8 \uba38\uc2e0\uc5d0 \ud3f4\ub354/\uacbd\ub85c\ub97c \uc124\uc815\ud558\uba70, \uc815\ud655\ud55c \uc704\uce58\ub294 \uc0ac\uc6a9\uc790\uac00 \uc54c \uc218 \uc5c6\uc73c\uba70 \ub3c4\ucee4 \ubcfc\ub968 \uba85\ub839\uc744 \ud1b5\ud574\uc11c\ub9cc \uad00\ub9ac\ub41c\ub2e4.\\n\\n- **\uba85\uba85\ub41c(Named) \ubcfc\ub968**\\n  - \ud2b9\uc815 \ucee8\ud14c\uc774\ub108\uc5d0 \uc5f0\uacb0\ub418\uc9c0 \uc54a\uace0 \uc77c\ubc18\uc801\uc73c\ub85c \uc0dd\uc131\ub41c\ub2e4.\\n  - \ucee8\ud14c\uc774\ub108\uac00 \uc885\ub8cc \ubc0f \uc0ad\uc81c\ub418\uc5b4\ub3c4 \uc81c\uac70\ub418\uc9c0 \uc54a\uc73c\uba70 \ubcc4\ub3c4\uc758 Docker CLI\ub97c \ud1b5\ud574 \uc81c\uac70\ud560 \uc218 \uc788\ub2e4.\\n  - \ucee8\ud14c\uc774\ub108 \uac04 \uacf5\uc720\uac00 \uac00\ub2a5\ud558\ub2e4.\\n  - \ub3d9\uc77c\ud55c \ucee8\ud14c\uc774\ub108\uc5d0 \uc7ac\uc0ac\uc6a9\uc774 \uac00\ub2a5\ud558\ub2e4.\\n  - \ub3c4\ucee4\ub294 \ud638\uc2a4\ud2b8 \uba38\uc2e0\uc5d0 \ud3f4\ub354/\uacbd\ub85c\ub97c \uc124\uc815\ud558\uba70, \uc815\ud655\ud55c \uc704\uce58\ub294 \uc0ac\uc6a9\uc790\uac00 \uc54c \uc218 \uc5c6\uc73c\uba70 \ub3c4\ucee4 \ubcfc\ub968 \uba85\ub839\uc744 \ud1b5\ud574\uc11c\ub9cc \uad00\ub9ac\ub41c\ub2e4.\\n  - \uc9c0\uc18d\ub418\uc5b4\uc57c\ud558\uc9c0\ub9cc \ud638\uc2a4\ud2b8 \uba38\uc2e0\uc5d0 \uc758\ud574 \uc81c\uc5b4\ub420 \ud544\uc694 \uc5c6\ub294 \ub370\uc774\ud130\uc5d0 \uc720\uc6a9\ud558\ub2e4.\\n\\n**\ubc14\uc778\ub4dc\ub9c8\uc6b4\ud2b8**\\n\\n\ubc14\uc778\ub4dc \ub9c8\uc6b4\ud2b8\ub97c \uc0ac\uc6a9\ud558\uba74 \ud638\uc2a4\ud2b8 \uc2dc\uc2a4\ud15c\uc758 \ud30c\uc77c\uc774\ub098 \ub514\ub809\ud130\ub9ac\uac00 \ucee8\ud14c\uc774\ub108\uc5d0 \ub9c8\uc6b4\ud2b8\ub41c\ub2e4.\\n- \ud2b9\uc815 \ucee8\ud14c\uc774\ub108\uc5d0 \uc5f0\uacb0\ub418\uc9c0 \uc54a\uc740 \ud638\uc2a4\ud2b8 \ud30c\uc77c \uc2dc\uc2a4\ud15c\uc5d0 \uc704\uce58\ud55c\ub2e4.\\n- \ucee8\ud14c\uc774\ub108\uac00 \uc885\ub8cc \ubc0f \uc0ad\uc81c\ub418\uc5b4\ub3c4 \uc81c\uac70\ub418\uc9c0 \uc54a\uc73c\uba70 \ud638\uc2a4\ud2b8 fs\uc5d0\uc11c \uc81c\uac70\ud55c\ub2e4.\\n- \ucee8\ud14c\uc774\ub108 \uac04 \uacf5\uc720\uac00 \uac00\ub2a5\ud558\ub2e4.\\n- \ub3d9\uc77c\ud55c \ucee8\ud14c\uc774\ub108\uc5d0 \uc7ac\uc0ac\uc6a9\uc774 \uac00\ub2a5\ud558\ub2e4.\\n- \ud638\uc2a4\ud2b8 \uba38\uc2e0 \uc0c1\uc5d0 \ub9e4\ud551\ub420 \ucee8\ud14c\uc774\ub108\uc758 \uacbd\ub85c\ub97c \uc9c1\uc811 \uc124\uc815\ud558\uae30 \ub54c\ubb38\uc5d0 \uacbd\ub85c\ub97c \uc54c\uace0 \ud3b8\uc9d1\uc774 \uac00\ub2a5\ud558\ub2e4.\\n- \uc9c0\uc18d\ub418\uc5b4\uc57c\ud558\uace0 \ucee8\ud14c\uc774\ub108\uac00 \uc2e4\ud589\ub418\ub294 \ub3d9\uc548 \ubcc0\uacbd\ub420 \uc218 \uc788\ub294 \ub370\uc774\ud130\uc5d0 \uc720\uc6a9\ud558\ub2e4.\\n\\n\\n\\n**\ubcfc\ub968 & \ubc14\uc778\ub4dc\ub9c8\uc6b4\ud2b8 \uad00\ub828 \uba85\ub839\uc5b4**\\n\\n- `docker run -v /path/in/container IMAGE` : \ucee8\ud14c\uc774\ub108 \uc548\uc5d0 \uc775\uba85 \ubcfc\ub968\uc744 \uc0dd\uc131\ud55c\ub2e4.\\n- `docker run -v some-name:/path/in/container IMAGE` : \ucee8\ud14c\uc774\ub108 \ub0b4\uc5d0 \uba85\uba85\ub41c \ubcfc\ub968\uc744 \uc0dd\uc131\ud55c\ub2e4.\\n- `docker run -v /path/on/your/host/machine:path/in/container IMAGE` : \ubc14\uc778\ub4dc\ub9c8\uc6b4\ud2b8\ub97c \uc0dd\uc131\ud558\uace0 \ud638\uc2a4\ud2b8 \uba38\uc2e0\uc758 \ub85c\uceec \uacbd\ub85c\ub97c \ucee8\ud14c\uc774\ub108\uc758 \ud2b9\uc815 \uacbd\ub85c\uc5d0 \uc5f0\uacb0\ud55c\ub2e4.\\n- `docker volume ls` : \ud604\uc7ac \ud65c\uc131/\uc800\uc7a5\ub41c \ubaa8\ub4e0 \ubcfc\ub968\uc744 \ub098\uc5f4\ud55c\ub2e4.\\n- `docker volume create VOLUME_NAME` : VOLUME_NAME \uc774\ub77c\ub294 \uc774\ub984\uc758 \uc0c8 (\uba85\uba85\ub41c) \ubcfc\ub968\uc744 \uc0dd\uc131\ud55c\ub2e4. \uc77c\ubc18\uc801\uc73c\ub85c \ucee8\ud14c\uc774\ub108\ub97c \uc2e4\ud589\ud560 \ub54c \ubcfc\ub968\uc774 \uc874\uc7ac\ud558\uc9c0 \uc54a\ub294 \uacbd\uc6b0 \uc790\ub3d9\uc73c\ub85c \uc0dd\uc131\ub418\ubbc0\ub85c \uc774 \uc791\uc5c5\uc744 \uaf2d \uc218\ud589\ud560 \ud544\uc694\ub294 \uc5c6\ub2e4.\\n- `docker volume rm VOLUME_NAME` : \uc774\ub984(\ub610\ub294 ID)\ub85c \ubcfc\ub968\uc744 \uc81c\uac70\ud55c\ub2e4.\\n- `docker volume prune` : \uc0ac\uc6a9\ud558\uc9c0 \uc54a\ub294 \ubaa8\ub4e0 \ubcfc\ub968 (\ud604\uc7ac \uc2e4\ud589 \uc911\uc774\uac70\ub098 \uc911\uc9c0\ub41c \ucee8\ud14c\uc774\ub108\uc5d0 \uc5f0\uacb0\ub418\uc9c0 \uc54a\uc740 \ubcfc\ub968)\uc744 \uc81c\uac70\ud55c\ub2e4.\\n\\n### \ud658\uacbd\ubcc0\uc218 \ubc0f \uc778\uc218 \uc0ac\uc6a9\\n\\n![\u1109\u1173\u110f\u1173\u1105\u1175\u11ab\u1109\u1163\u11ba 2023-10-29 \u110b\u1169\u1112\u116e 9.45.23](https://p.ipic.vip/146jya.png)\\n\\n\ub3c4\ucee4\ub294 \ube4c\ub4dc \ud0c0\uc784\uc5d0\uc11c\uc758 \uc778\uc218\uc640 \ub7f0\ud0c0\uc784 \ud658\uacbd \ubcc0\uc218\ub97c \uc9c0\uc6d0\ud55c\ub2e4. Argument\ub97c \uc0ac\uc6a9\ud558\uc5ec Dockerfile\uc5d0\uc11c \uc720\uc5f0\ud55c \ub370\uc774\ud130 \ube44\ud2b8, \uc989 \ubcc0\uc218\ub97c \uc124\uc815\ud560 \uc218 \uc788\ub2e4. \ubc18\uba74 \ud658\uacbd\ubcc0\uc218\ub294 \uc2e4\ud589 \uc911\uc778 \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \uc804\uccb4 \ucf54\ub4dc\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub2e4.\\n\\n```docker\\nFROM node:14\\n\\nWORKDIR /app\\n\\nCOPY package.json .\\n\\nRUN npm install\\n\\nCOPY . .\\n\\n# ARG\ub97c \uc9c0\uc815\ud558\uc9c0 \uc54a\uc558\uc744 \ub54c \uae30\ubcf8 \uac12 80\\nARG DEFAULT_PORT=80\\n\\nENV PORT $DEFAULT_PORT\\n\\nEXPOSE $PORT\\n\\n# CMD \uba85\ub839\uc5d0\uc11c\ub294 ARG \uac12\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc5c6\ub2e4. (\ucee8\ud14c\uc774\ub108\uac00 \uc2dc\uc791\ub420 \ub54c \uc2e4\ud589\ub418\ub294 \ub7f0\ud0c0\uc784 \uba85\ub839\uc774\uae30 \ub54c\ubb38\uc5d0)\\nCMD [ \\"npm\\", \\"start\\" ]\\n```\\n\\n\\n\\n**\ud658\uacbd\ubcc0\uc218 \ubc0f \uc778\uc218 \uad00\ub828 \uba85\ub839\uc5b4**\\n\\n- `docker run --env (-e \ub85c \uc904\uc784 \uac00\ub2a5) ENV_NAME=ENV_VALUE` : \ud658\uacbd \ubcc0\uc218\ub97c \uc124\uc815\ud558\uc5ec \ucee8\ud14c\uc774\ub108 \uc2e4\ud589\\n  - `docker run --env-file /path/envfile` : \ud30c\uc77c\uc744 \ud1b5\ud574 \ud658\uacbd \ubcc0\uc218\ub97c \uc124\uc815\\n- `docker run --build-arg ARG_NAME=ARG_VALUE` : \uc778\uc218\ub97c \uc124\uc815\ud558\uc5ec \ucee8\ud14c\uc774\ub108 \uc2e4\ud589"},{"id":"/2023/09/10/blockchain/contract-errorhandling","metadata":{"permalink":"/2023/09/10/blockchain/contract-errorhandling","source":"@site/blog/blockchain/2023-09-10-contract-errorhandling.mdx","title":"Contract Error Handling","description":"error handling for contracts written in solidity.","date":"2023-09-10T00:00:00.000Z","formattedDate":"September 10, 2023","tags":[{"label":"BlockChain","permalink":"/tags/block-chain"},{"label":"Solidity","permalink":"/tags/solidity"}],"readingTime":46.82,"hasTruncateMarker":true,"authors":[{"name":"Chihun Park","url":"https://github.com/chihunmanse","email":"chihunmanse@gmail.com","imageURL":"https://p.ipic.vip/o1ih3g.png","key":"chihun"}],"frontMatter":{"title":"Contract Error Handling","description":"error handling for contracts written in solidity.","keywords":["solidity","ethereum","contract","blockchain","assert","revert"],"tags":["BlockChain","Solidity"],"authors":"chihun"},"prevItem":{"title":"Docker \uae30\ubcf8 \uac1c\ub150 \uc815\ub9ac","permalink":"/2023/11/03/backend/docker/docker-basic"},"nextItem":{"title":"Upgradeable Contract 2 - ERC1967, TransparentProxy, UUPS","permalink":"/2022/06/20/blockchain/upgradeable-contract2"}},"content":"import Tabs from \\"@theme/Tabs\\";\\nimport TabItem from \\"@theme/TabItem\\";\\n\\n\uba3c\uc800 Solidity \uc548\uc5d0\uc11c \uc5d0\ub7ec\ub97c \ucc98\ub9ac\ud560 \uc218 \uc788\ub294 \ubc29\uc2dd\ub4e4\uc5d0 \ub300\ud574 \uc54c\uc544\ubcf4\uc790. Solidity\uc5d0\uc11c \uc608\uc678\ub97c \ubc1c\uc0dd\uc2dc\ud0a4\ub294 \ubc29\uc2dd\uc740 \ud06c\uac8c **Assert**, **Require**, **Revert**\uac00 \uc788\ub2e4.\\n\\n\uc138 \uac00\uc9c0 \ubc29\uc2dd \ubaa8\ub450 \ud604\uc7ac \ud638\ucd9c \ubc0f \ubaa8\ub4e0 \ud558\uc704 \ud638\ucd9c\uc5d0\uc11c \uc77c\uc5b4\ub0ac\ub358 \uc0c1\ud0dc \ubcc0\uacbd \uc0ac\ud56d\ub4e4\uc744 \ucde8\uc18c\ud558\uace0 \ud638\ucd9c\uc790\uc5d0\uac8c \uc624\ub958 \ud50c\ub798\uadf8\ub97c \uc9c0\uc815\ud55c\ub2e4.\\n\\n\ub9cc\uc57d \ud558\uc704 \ud638\ucd9c\uc5d0\uc11c \uc608\uc678\uac00 \ubc1c\uc0dd\ud558\uba74, `try/catch` \uba85\ub839\ubb38 \uc548\uc5d0\uc11c \ubc1c\uacac\ub418\uc9c0 \uc54a\ub294 \ud55c \uc790\ub3d9\uc73c\ub85c \\"\ubc84\ube14\uc5c5\\" (\uc608\uc678\uac00 \ub2e4\uc2dc \ubc1c\uc0dd)\ub41c\ub2e4. \uc774\ub7ec\ud55c \uaddc\uce59\uc5d0 \ub300\ud55c \uc608\uc678\ub294 `call`, `delegatecall`, `staticcall` \uacfc \uac19\uc740 low-level \ud568\uc218\ub4e4\uc774\ub098 `send` \ud568\uc218\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud638\ucd9c \ud588\uc744 \ub54c \ubfd0\uc774\ub2e4. \uc774 \uacbd\uc6b0\uc5d0\ub294 \ud558\uc704 \ud638\ucd9c\uc5d0\uc11c \uc608\uc678\uac00 \ubc1c\uc0dd\ud558\ub354\ub77c\ub3c4 \uc608\uc678\uac00 \uc0c1\uc704 \ud638\ucd9c\ub85c \uc804\ub2ec\ub418\ub294 \ub300\uc2e0 \uccab\ubc88 \uc9f8 return \uac12\uc73c\ub85c false\uac00 \uc804\ub2ec\ub41c\ub2e4.\\n\\n## Assert\\n\\nAssert\ub294 \ucee8\ud2b8\ub799\ud2b8\uc758 \ub0b4\ubd80 \uc624\ub958\ub97c \ud14c\uc2a4\ud2b8\ud558\uace0 \ubd88\ubcc0\uc131\uc744 \ud655\uc778\ud558\ub294 \ub370\uc5d0\ub9cc \uc0ac\uc6a9\ud574\uc57c \ud55c\ub2e4. \uc989 \uc678\ubd80\uc758 \uc785\ub825\uc5d0 \ub530\ub77c \uc5b4\ub5a4 \uacbd\uc6b0\uc5d0\ub294 Assert \uc624\ub958\uac00 \ubc1c\uc0dd\ud558\uace0 \uc5b4\ub5a4 \uacbd\uc6b0\uc5d0\ub294 \uc624\ub958\uac00 \ubc1c\uc0dd\ud558\uc9c0 \uc54a\ub294 \uc77c\uc774 \uc0dd\uae30\uba74 \uc548 \ub41c\ub2e4. \uc774\ub7f0 \uc77c\uc774 \ubc1c\uc0dd\ud55c\ub2e4\ub294 \uac83\uc740 \ucee8\ud2b8\ub799\ud2b8\uc5d0 \uc218\uc815\ud574\uc57c \ud560 \ubc84\uadf8\uac00 \uc874\uc7ac\ud55c\ub2e4\ub294 \ub73b\uc774\ub2e4.\\n\\n\ub610 \ud55c \uac00\uc9c0 \uc720\uc758\ud574\uc57c\ud560 \uc810\uc740, `assert` \ud568\uc218\ub97c \ud1b5\ud574 \uc0dd\uc131\ub418\ub294 \uc624\ub958\ub294 Solidity \ubc84\uc804\uc5d0 \ub530\ub77c \ucc28\uc774\uac00 \uc788\ub2e4\ub294 \uac83\uc774\ub2e4.\\n\\n### 0.8 \ubc84\uc804 \uc774\uc804\\n\\n0.4.22 ~ 0.7.x \ubc84\uc804\uc5d0\uc11c\ub294 `assert` \ud568\uc218\ub97c \uc0ac\uc6a9\ud588\uc744 \ub54c \uc0ac\uc6a9\ub418\ub294 opcode\ub294 `INVALID` \uc774\ub2e4.\\n\\n[INVALID opcode](https://www.evm.codes/#fe?fork=shanghai)\uc5d0 \ub300\ud55c \uc815\ubcf4\ub97c \uc0b4\ud3b4\ubcf4\uc790.\\n\\n```\\n\uc2a4\ud0dd \ub9e4\uac1c\ubcc0\uc218\uac00 0,0\uc778 REVERT (Byzantium \ud3ec\ud06c \uc774\ud6c4)\uc640 \ub3d9\uc77c \ud558\uc9c0\ub9cc \ud604\uc7ac \ucee8\ud14d\uc2a4\ud2b8\uc5d0 \uc81c\uacf5\ub41c \ubaa8\ub4e0 \uac00\uc2a4\uac00 \uc18c\ube44\ub41c\ub2e4\ub294 \uc810\ub9cc \ub2e4\ub985\ub2c8\ub2e4.\\n```\\n\\n\uc989 Solidity 0.8 \ubc84\uc804 \uc774\uc804\uc5d0\ub294 `assert` \ud568\uc218\ub97c \ud1b5\ud574 \uc624\ub958\uac00 \uc0dd\uc131\ub418\ub354\ub77c\ub3c4 \ud2b8\ub79c\uc7ad\uc158\uc758 \uac00\uc2a4\uac00 \ud658\ubd88\ub418\uc9c0 \uc54a\ub294\ub2e4. \ub610 `REVERT(0,0)` \uc640 \ub3d9\uc77c\ud558\uae30 \ub54c\ubb38\uc5d0 \ucee8\ud2b8\ub799\ud2b8 \uc678\ubd80\uc5d0\uc11c\ub294 \uc5b4\ub5a4 \uc774\uc720\ub85c \ud574\ub2f9 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\ub294\uc9c0 \uc720\ucd94\ud560 \uc218 \uc788\ub294 \ub370\uc774\ud130\uac00 \uc874\uc7ac\ud558\uc9c0 \uc54a\ub294\ub2e4.\\n\\n### 0.8 \ubc84\uc804 \uc774\ud6c4\\n\\n0.8 \ubc84\uc804\ubd80\ud130 `assert` \ud568\uc218\ub97c \uc0ac\uc6a9\ud588\uc744 \ub54c \uc0ac\uc6a9\ub418\ub294 opcode\uac00 `REVERT` \ub85c \ubcc0\uacbd\ub41c\ub2e4.\\n\\n[REVERT opcode](https://www.evm.codes/#fd?fork=shanghai)\uc5d0 \ub300\ud55c \uc815\ubcf4\ub97c \uc0b4\ud3b4\ubcf4\uc790.\\n\\n```\\n\ud604\uc7ac \ucee8\ud14d\uc2a4\ud2b8 \uc2e4\ud589\uc744 \uc911\uc9c0\ud558\uace0 \uc0c1\ud0dc \ubcc0\uacbd\uc744 \ub418\ub3cc\ub9ac\uace0(\uc0c1\ud0dc \ubcc0\uacbd opcode \ubaa9\ub85d\uc740 STATICCALL \ucc38\uc870) \uc0ac\uc6a9\ud558\uc9c0 \uc54a\uc740 \uac00\uc2a4\ub97c \ud638\ucd9c\uc790\uc5d0\uac8c \ubc18\ud658\ud569\ub2c8\ub2e4.\\n```\\n\\n`INVALID` opcode\uc640 \ud06c\uac8c \ub2e4\ub978 \uc9c0\uc810\uc740 \uc0ac\uc6a9\ud558\uc9c0 \uc54a\uc740 \uac00\uc2a4\ub97c \ud638\ucd9c\uc790\uc5d0\uac8c \ubc18\ud658\ud55c\ub2e4\ub294 \uc810\uc774\ub2e4.\\n\\n```\\n\ud638\ucd9c \ucee8\ud14d\uc2a4\ud2b8\uc758 \ubc18\ud658 \ub370\uc774\ud130\ub294 \uc774 \ucee8\ud14d\uc2a4\ud2b8\uc758 \uc9c0\uc815\ub41c \uba54\ubaa8\ub9ac \uccad\ud06c\ub85c \uc124\uc815\ub429\ub2c8\ub2e4.\\n\\n\uc2a4\ud0dd \uc785\ub825\\noffset: \uba54\ubaa8\ub9ac\uc758 \ubc14\uc774\ud2b8 \uc624\ud504\uc14b(\ubc14\uc774\ud2b8). \ud638\ucd9c \ucee8\ud14d\uc2a4\ud2b8\uc758 \ubc18\ud658 \ub370\uc774\ud130\uc785\ub2c8\ub2e4.\\nsize: \ubcf5\uc0ac\ud560 \ubc14\uc774\ud2b8 \ud06c\uae30(\ubc18\ud658 \ub370\uc774\ud130\uc758 \ud06c\uae30).\\n```\\n\\n\ub610 \uc704\uc758 \uc124\uba85\ucc98\ub7fc \ubc18\ud658 \ub370\uc774\ud130\ub97c \uc9c0\uc815\ud560 \uc218 \uc788\uae30 \ub54c\ubb38\uc5d0, \uae30\uc874 `INVALID` opcode\uc5d0\uc11c\uc640 \ub2ec\ub9ac \ucee8\ud2b8\ub799\ud2b8 \ub0b4\ubd80\uc5d0\uc11c \uc5b4\ub5a4 \uc774\uc720\ub85c \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\ub294\uc9c0\uc5d0 \ub300\ud55c \ub370\uc774\ud130\ub97c \uc81c\uacf5\ud560 \uc218 \uc788\ub2e4.\\n\\n\uadf8\ub807\ub2e4\uba74 0.8 \ubc84\uc804 \uc774\ud6c4\uc5d0 `assert` \ud568\uc218\ub97c \uc0ac\uc6a9\ud588\uc744 \ub54c \uc624\ub958\uc5d0 \ub300\ud55c \uc815\ubcf4\ub294 \uc5b4\ub5a4 \uaddc\uce59\uc73c\ub85c \uc81c\uacf5\ub418\ub294\uc9c0\ub97c \uc0b4\ud3b4\ubcf4\uc790.\\n\\n`assert` \ud568\uc218\ub294 `Panic(uint256)` \ub370\uc774\ud130 \uc720\ud615\uc758 \uc624\ub958\ub97c \uc0dd\uc131\ud55c\ub2e4. \uc989 \ud568\uc218 \uc2dd\ubcc4\uc790\ub97c \uc9c0\uc815\ud558\ub294 \ubc29\uc2dd\uacfc \ub3d9\uc77c\ud558\uac8c \\"Panic(uint256)\\"\uc744 keccak256\uc73c\ub85c \ud574\uc2f1\ud55c \ub370\uc774\ud130\uc758 4\ubc14\uc774\ud2b8 \uac12\uacfc uint256 \uc778\uc790 \uac12\uc744 \ud1b5\ud574 \uc624\ub958\uc758 \uc815\ubcf4\ub97c \uc81c\uacf5\ud55c\ub2e4.\\n\\nSolidity \uacf5\uc2dd \ubb38\uc11c\ub97c \uc0b4\ud3b4\ubcf4\uba74, `Panic(uint256)` \uc624\ub958\ub294 \ucee8\ud2b8\ub799\ud2b8 \uc791\uc131\uc790\uac00 `assert` \ud568\uc218\ub97c \ud1b5\ud574 \uc784\uc758\ub85c \ubc1c\uc0dd\uc2dc\ud0a4\ub294 \uacbd\uc6b0 \uc678\uc5d0\ub3c4 \ubbf8\ub9ac \uc9c0\uc815\ub41c \ud2b9\uc815 \uc0c1\ud669\ub4e4\uc5d0\uc11c \ucef4\ud30c\uc77c\ub7ec\uc5d0 \uc758\ud574 \ub3d9\uc77c\ud55c \uc624\ub958\uac00 \uc0dd\uc131\ub420 \uc218 \uc788\ub2e4\uace0 \uc124\uba85\ud558\uace0 \uc788\ub2e4.\\n\\n```\\n0x00: \uc77c\ubc18 \ucef4\ud30c\uc77c\ub7ec \uc0bd\uc785 \ud328\ub2c9\uc5d0 \uc0ac\uc6a9\ub429\ub2c8\ub2e4.\\n\\n0x01: assert(false)\ub85c \ud3c9\uac00\ub418\ub294 \uc778\uc218\ub85c \ud638\ucd9c\ud558\ub294 \uacbd\uc6b0.\\n\\n0x11: \uc0b0\uc220 \uc5f0\uc0b0 \uacb0\uacfc .unchecked { ... } \ube14\ub85d \uc678\ubd80\uc5d0\uc11c \uc5b8\ub354\ud50c\ub85c \ub610\ub294 \uc624\ubc84\ud50c\ub85c\uac00 \ubc1c\uc0dd\ud558\ub294 \uacbd\uc6b0.\\n\\n0x12: 0\uc73c\ub85c \ub098\ub204\uac70\ub098 modulo\ud558\ub294 \uacbd\uc6b0 (e.g. 5 / 0 or 23 % 0).\\n\\n0x21: \ub108\ubb34 \ud06c\uac70\ub098 \uc74c\uc218\uc778 \uac12\uc744 \uc5f4\uac70\ud615\uc73c\ub85c \ubcc0\ud658\ud558\ub294 \uacbd\uc6b0.\\n\\n0x22: \uc798\ubabb \uc778\ucf54\ub529\ub41c \uc2a4\ud1a0\ub9ac\uc9c0 \ubc14\uc774\ud2b8 \ubc30\uc5f4\uc5d0 \uc561\uc138\uc2a4\ud558\ub294 \uacbd\uc6b0.\\n\\n0x31: \ube48 \ubc30\uc5f4\uc5d0 .pop()\uc744 \ud638\ucd9c\ud558\ub294 \uacbd\uc6b0.\\n\\n0x32: \ubc30\uc5f4 \ubc0f \ubc30\uc5f4 \uc2ac\ub77c\uc774\uc2a4, bytesN\uc758 \ubc94\uc704\ub97c \ubc97\uc5b4\ub09c \uc778\ub371\uc2a4 \ud639\uc740 \uc74c\uc218 \uc778\ub371\uc2a4\uc5d0 \uc561\uc138\uc2a4\ud558\ub294 \uacbd\uc6b0 (i.e. x[i] where i >= x.length or i < 0).\\n\\n0x41: \ub108\ubb34 \ub9ce\uc740 \uba54\ubaa8\ub9ac\ub97c \ud560\ub2f9\ud558\uac70\ub098 \ub108\ubb34 \ud070 \ubc30\uc5f4\uc744 \uc0dd\uc131\ud55c \uacbd\uc6b0.\\n\\n0x51: \uc720\ud6a8\ud558\uc9c0 \uc54a\uc740 \ub0b4\ubd80 \ud568\uc218 \ud638\ucd9c.\\n```\\n\\n\uc989, \uc5b8\ub354\ud50c\ub85c \ub610\ub294 \uc624\ubc84\ud50c\ub85c\uac00 \ubc1c\uc0dd\ud588\uc744 \ub54c\ub294 `Panic(uint256)` \uc758 \uc778\uc790\uac12\uc73c\ub85c \'0x11\'\uc774 \uc0ac\uc6a9\ub418\uba70 \ube48 \ubc30\uc5f4\uc5d0 `.pop()` \uc744 \ud638\ucd9c\ud55c \uacbd\uc6b0\uc5d0\ub294 \uc778\uc790\uac12\uc73c\ub85c \'0x31\'\uc774 \uc0ac\uc6a9\ub418\ub294 \uc2dd\uc774\ub2e4. \ub9cc\uc57d \uc791\uc131\uc790\uac00 \uc9c1\uc811 `assert` \ud568\uc218 \uc2dd\uc744 \uc0ac\uc6a9\ud55c \uacbd\uc6b0\uc5d0\ub294 \'0x01\'\uc774 \uc778\uc790\uac12\uc73c\ub85c \uc0ac\uc6a9\ub41c\ub2e4.\\n\\n\x3c!--truncate--\x3e\\n\\n## Assert Handling\\n\\n\uadf8\ub807\ub2e4\uba74 \uc704\uc5d0\uc11c \uc0b4\ud3b4\ubcf8 \uc815\ubcf4\ub97c \ud1a0\ub300\ub85c \ucee8\ud2b8\ub799\ud2b8\ub97c \uc0ac\uc6a9\ud558\ub294 \ud074\ub77c\uc774\uc5b8\ud2b8 \uc785\uc7a5\uc5d0\uc11c Assert \uc5d0\ub7ec\ub97c \ud6a8\uc728\uc801\uc73c\ub85c \ud5e8\ub4e4\ub9c1\ud560 \uc218 \uc788\ub294 \ud568\uc218\ub97c \ub9cc\ub4e4\uc5b4\ubcf4\uc790.\\n\\n0.8 \uc774\ud6c4 \ubc84\uc804\uc744 \uae30\uc900\uc73c\ub85c \uc6b0\ub9ac\ub294 Assert \uc5d0\ub7ec\uac00 `Panic(uint256)` \ub370\uc774\ud130 \uc720\ud615\uc73c\ub85c \uc778\ucf54\ub529\ub418\uc5b4 `REVERT` opcode\uc5d0 \uc758\ud574 \ubc18\ud658\ub41c\ub2e4\ub294 \uac83\uc744 \uc54c\uace0 \uc788\ub2e4. \uc5b4\uc148\ube14\ub9ac \ucf54\ub4dc\ub97c \ud1b5\ud574 EVM \uc548\uc5d0\uc11c \ud574\ub2f9 \ub3d9\uc791 \uacfc\uc815\uc744 \uc790\uc138\ud788 \uc0b4\ud3b4\ubcfc \uc218 \uc788\ub2e4.\\n\\n```sol\\n  function assertRevertOpcode() external pure {\\n        // 0x4e487b71\\n        bytes4 panicId = bytes4(keccak256(bytes(\\"Panic(uint256)\\")));\\n\\n        assembly {\\n            mstore(0x40, panicId)\\n            mstore(add(0x40, 4), 0x1)\\n            revert(0x40, 36)\\n        }\\n  }\\n```\\n\\n\uba3c\uc800 `Panic(uint256)` \uc744 \ud574\uc2f1\ud558\uc5ec \uc2dd\ubcc4 \ub370\uc774\ud130 \uac12\uc744 \uc0dd\uc131\ud55c\ub2e4. \uadf8\ub9ac\uace0 \ud574\ub2f9 \ub370\uc774\ud130\ub97c \uba54\ubaa8\ub9ac\uc5d0 \uc800\uc7a5\ud558\uace0 (\uc704\uc758 \uacbd\uc6b0 \'0x40\' \ud3ec\uc778\ud130), \uadf8 \uba54\ubaa8\ub9ac\uc5d0 \uc778\uc790\uac12 \ub370\uc774\ud130\ub97c \ucd94\uac00\ud55c\ub2e4 (\uc704\uc758 \uacbd\uc6b0 \'0x1\'\ub85c \uc774 \uacbd\uc6b0 \uc791\uc131\uc790\uac00 assert \ud568\uc218\uc2dd\uc744 \uc0ac\uc6a9\ud558\uc5ec false\ub85c \ud310\uc815\ub41c \uacbd\uc6b0\uc640 \ub3d9\uc77c\ud568). \uadf8\ub9ac\uace0 `REVERT` opcode\ub97c \uc0ac\uc6a9\ud558\uc5ec \ubc18\ud658 \ub370\uc774\ud130\uac00 \ub2f4\uae34 \uba54\ubaa8\ub9ac \uc704\uce58\uc640 \ubc18\ud658 \ub370\uc774\ud130\uc758 \ud06c\uae30\ub97c \uc785\ub825\ud55c\ub2e4.\\n\\n\uc774\uc81c \ucee8\ud2b8\ub799\ud2b8 \ub0b4\ubd80\uc5d0\uc11c \uc5d0\ub7ec \ub370\uc774\ud130\uac00 \uc5b4\ub5a4 \ubc29\uc2dd\uc73c\ub85c \ubc18\ud658\ub418\ub294\uc9c0\ub97c \uc54c\uc558\uc73c\ub2c8 \uc678\ubd80\uc5d0\uc11c\ub3c4 \uc5ed\uc73c\ub85c \ud574\ub2f9 \ub370\uc774\ud130\ub97c \ub514\ucf54\ub529\ud558\uc5ec \uc2dd\ubcc4\ud560 \uc218 \uc788\uc744 \uac83\uc774\ub2e4.\\n\\n```ts\\n// method id of \'Panic(uint256)\'\\nconst PANIC_CODE_PREFIX = \\"0x4e487b71\\";\\n```\\n\\n\uac00\uc7a5 \uba3c\uc800 Panic \uc624\ub958\ub97c \uc2dd\ubcc4\ud558\uae30 \uc704\ud55c \uc2dc\uadf8\ub2c8\ucc98 \uac12\uc744 \uc815\uc758\ud55c\ub2e4.\\n\\n```ts\\nconst panicErrorCodeToReason = (errorCode: number): string | undefined => {\\n  switch (errorCode) {\\n    case 0x1:\\n      return \\"Assertion error\\";\\n    case 0x11:\\n      return \\"Arithmetic operation underflowed or overflowed outside of an unchecked block\\";\\n    case 0x12:\\n      return \\"Division or modulo division by zero\\";\\n    case 0x21:\\n      return \\"Tried to convert a value into an enum, but the value was too big or negative\\";\\n    case 0x22:\\n      return \\"Incorrectly encoded storage byte array\\";\\n    case 0x31:\\n      return \\".pop() was called on an empty array\\";\\n    case 0x32:\\n      return \\"Array accessed at an out-of-bounds or negative index\\";\\n    case 0x41:\\n      return \\"Too much memory was allocated, or an array was created that is too large\\";\\n    case 0x51:\\n      return \\"Called a zero-initialized variable of internal function type\\";\\n  }\\n};\\n```\\n\\n\uadf8\ub9ac\uace0 Panic\uc758 \uc778\uc790\uac12\uc5d0 \ub530\ub77c \uc0ac\ub78c\uc774 \uc774\ud574\ud560 \uc218 \uc788\ub294 \uc790\uc138\ud55c \uc624\ub958 \uc815\ubcf4\ub85c \ubc14\uafd4\uc8fc\ub294 \ud568\uc218\ub97c \uc791\uc131\ud55c\ub2e4.\\n\\n```ts\\nconst decodeAssertErrorData = (\\n  data: string\\n): { panicCode: string; panicDescription: string } => {\\n  if (!data.startsWith(PANIC_CODE_PREFIX))\\n    return {\\n      panicCode: \\"0x\\",\\n      panicDescription: \\"not panic error\\",\\n    };\\n\\n  const encodedReason = data.slice(PANIC_CODE_PREFIX.length);\\n\\n  let decodePanicCode: number;\\n  let panicCode: string;\\n  let panicDescription: string;\\n\\n  try {\\n    decodePanicCode = defaultAbiCoder\\n      .decode([\\"uint256\\"], `0x${encodedReason}`)[0]\\n      .toNumber();\\n\\n    panicCode = `0x${decodePanicCode.toString(16)}`;\\n  } catch (e: any) {\\n    return {\\n      panicCode: \\"0x\\",\\n      panicDescription: \\"unknown panic\\",\\n    };\\n  }\\n\\n  panicDescription = panicErrorCodeToReason(decodePanicCode) ?? \\"unknown panic\\";\\n\\n  return { panicCode, panicDescription };\\n};\\n```\\n\\n\uc774\uc81c \ubc18\ud658\ub41c \uc5d0\ub7ec \ub370\uc774\ud130\ub97c \ubc14\ud0d5\uc73c\ub85c \uc0ac\ub78c\uc774 \uc2dd\ubcc4\ud560 \uc218 \uc788\uac8c \ub514\ucf54\ub529\ud574\uc8fc\ub294 \ud568\uc218\ub97c \uc791\uc131\ud574\ubcf4\uc790. \uc774 \ud568\uc218\uc758 \uacbd\uc6b0 \uc5d0\ub7ec \ub370\uc774\ud130\uac00 `Panic(uint256)` \uc720\ud615\uc758 \uc624\ub958\ub77c\ub294 \uac83\uc744 \uac00\uc815\ud558\uace0 \uc788\uae30 \ub54c\ubb38\uc5d0, \uac00\uc7a5 \uba3c\uc800 \ubc18\ud658\ub41c \uc5d0\ub7ec \ub370\uc774\ud130\uac00 `PANIC_CODE_PREFIX` \ub85c \uc2dc\uc791\ud558\uc9c0 \uc54a\uc73c\uba74 \uc2dd\ubcc4\ud560 \uc218 \uc5c6\ub294 \\"not panic error\\"\ub85c return \ud55c\ub2e4.\\n\\n`PANIC_CODE_PREFIX` \ub85c \uc2dc\uc791\ud55c\ub2e4\uba74, \uc778\uc790\uac12\uc744 \ucd94\ucd9c\ud558\uae30 \uc704\ud574 \uc5d0\ub7ec \ub370\uc774\ud130\ub97c `PANIC_CODE_PREFIX` \uc774\ud6c4\ub85c slice\ud55c\ub2e4. slice\ud55c \uc778\uc790 \ub370\uc774\ud130\ub97c ethers\uc758 `defaultAbiCoder.decode` \uc720\ud2f8 \ud568\uc218\ub97c \ud1b5\ud574 \ub514\ucf54\ub529\ud558\uace0, \ub514\ucf54\ub529\ub41c \ub370\uc774\ud130\ub85c `panicErrorCodeToReason` \ud568\uc218\ub97c \ud1b5\ud574 \uc790\uc138\ud55c \uc624\ub958 \uc815\ubcf4\ub97c \ucd94\ucd9c\ud55c\ub2e4.\\n\\n\uadf8\ub7fc \uc791\uc131\ud55c \ud568\uc218\ub97c \ud1b5\ud574 Assert \uad00\ub828 \uc5d0\ub7ec\ub97c \ubc1c\uc0dd\uc2dc\ud0a4\ub294 \ucee8\ud2b8\ub799\ud2b8\ub97c \ud638\ucd9c\ud558\uc5ec \ud14c\uc2a4\ud2b8\ud574\ubcf4\uc790. \uc55e\uc11c \uc5b8\uae09\ud588\ub4ef\uc774 Assert \uc5d0\ub7ec\ub294 Solidity \ubc84\uc804\uc5d0 \ub530\ub77c \ub2e4\ub978 opcode\ub97c \uc0ac\uc6a9\ud55c\ub2e4\ub294 \uac83\uc744 \uba3c\uc800 \uc720\ub150\ud574\uc57c\ud55c\ub2e4.\\n\\n```sol title=\\"contracts/AssertBefore.sol\\"\\npragma solidity ^0.7.5;\\n\\ncontract AssertBefore {\\n    function assert0x1() external pure {\\n        assert(false);\\n    }\\n\\n    function assert0x11() external pure {\\n        uint256 a = 5;\\n        uint256 b = 10;\\n\\n        a - b;\\n    }\\n\\n    function assert0x12() external pure {\\n        uint256 a = 5;\\n        uint256 b;\\n\\n        a / b;\\n    }\\n\\n    enum Enum {\\n        A,\\n        B\\n    }\\n\\n    function assert0x21() external pure {\\n        int256 a = -1;\\n        Enum(a);\\n    }\\n\\n    uint256[] public array;\\n\\n    function assert0x31() external {\\n        array.pop();\\n    }\\n\\n    function assert0x32() external view {\\n        array[5];\\n    }\\n\\n    function assertRevertOpcode() external pure {\\n        // 0x4e487b71\\n        bytes4 panicId = bytes4(keccak256(bytes(\\"Panic(uint256)\\")));\\n\\n        assembly {\\n            mstore(0x40, panicId)\\n            mstore(add(0x40, 4), 0x1)\\n            revert(0x40, 36)\\n        }\\n    }\\n\\n    function assertInvalidOpcode() external pure {\\n        assembly {\\n            invalid()\\n        }\\n    }\\n}\\n```\\n\\n\ud14c\uc2a4\ud2b8\ub97c \uc704\ud574 \ucef4\ud30c\uc77c\ub7ec\uc5d0 \uc758\ud574 \uc624\ub958\uac00 \ubc1c\uc0dd\ub418\ub294 \uc0c1\ud669\uc744 \uc7ac\ud604\ud55c \ud568\uc218\ub4e4\uacfc \uc9c1\uc811 `assert` \ud568\uc218\ub97c \ud1b5\ud574 \uc624\ub958\ub97c \ubc1c\uc0dd\uc2dc\ud0a4\ub294 \ud568\uc218\uac00 \uc874\uc7ac\ud558\ub294 \ucee8\ud2b8\ub799\ud2b8\ub97c 0.8 \uc774\uc804 \ubc84\uc804\uc73c\ub85c \uc791\uc131\ud558\uc600\ub2e4.\\n\\n```ts\\ndescribe(\\"Assert < 0.8\\", () => {\\n  it(\\"Assert Before 0x1\\", async () => {\\n    try {\\n      await assertBefore.assert0x1();\\n\\n      console.log(\\"success\\");\\n    } catch (error: any) {\\n      console.log(\\"assert 0x1 error data:\\", decodeAssertErrorData(error.data));\\n    }\\n  });\\n\\n  it(\\"Assert Before Revert Opcode\\", async () => {\\n    try {\\n      await assertBefore.assertRevertOpcode();\\n\\n      console.log(\\"success\\");\\n    } catch (error: any) {\\n      console.log(\\n        \\"assert revert opcode error data:\\",\\n        decodeAssertErrorData(error.data)\\n      );\\n    }\\n  });\\n\\n  it(\\"Assert Before Invalid Opcode\\", async () => {\\n    try {\\n      await assertBefore.assertInvalidOpcode();\\n\\n      console.log(\\"success\\");\\n    } catch (error: any) {\\n      console.log(\\n        \\"assert invalid opcode error data:\\",\\n        decodeAssertErrorData(error.data)\\n      );\\n    }\\n  });\\n\\n  it(\\"Assert Before 0x11\\", async () => {\\n    try {\\n      const result = await assertBefore.assert0x11();\\n\\n      console.log(\\"success\\", result);\\n    } catch (error: any) {\\n      console.log(\\"assert 0x11 error data:\\", decodeAssertErrorData(error.data));\\n    }\\n  });\\n\\n  it(\\"Assert Before 0x12\\", async () => {\\n    try {\\n      await assertBefore.assert0x12();\\n\\n      console.log(\\"success\\");\\n    } catch (error: any) {\\n      console.log(\\"assert 0x12 error data:\\", decodeAssertErrorData(error.data));\\n    }\\n  });\\n\\n  it(\\"Assert Before 0x21\\", async () => {\\n    try {\\n      await assertBefore.assert0x21();\\n\\n      console.log(\\"success\\");\\n    } catch (error: any) {\\n      console.log(\\"assert 0x21 error data:\\", decodeAssertErrorData(error.data));\\n    }\\n  });\\n\\n  it(\\"Assert Before 0x31\\", async () => {\\n    try {\\n      await assertBefore.assert0x31();\\n\\n      console.log(\\"success\\");\\n    } catch (error: any) {\\n      console.log(\\"assert 0x31 error data:\\", decodeAssertErrorData(error.data));\\n    }\\n  });\\n\\n  it(\\"Assert Before 0x32\\", async () => {\\n    try {\\n      await assertBefore.assert0x32();\\n\\n      console.log(\\"success\\");\\n    } catch (error: any) {\\n      console.log(\\"assert 0x32 error data:\\", decodeAssertErrorData(error.data));\\n    }\\n  });\\n});\\n```\\n\\n0.8 \ubc84\uc804 \uc774\uc804\uc758 \ucee8\ud2b8\ub799\ud2b8\ub97c \ud638\ucd9c\ud558\ub294 \uc704\uc758 \ud14c\uc2a4\ud2b8 \ucf54\ub4dc\ub97c \uc2e4\ud589\ud588\uc744 \ub54c \uc544\ub798\uc640 \uac19\uc740 \uacb0\uacfc\uac00 \ub098\uc654\ub2e4.\\n\\n```shell\\nAssert < 0.8\\nassert 0x1 error data: { panicCode: \'0x\', panicDescription: \'not panic error\' }\\n      \u2714 Assert Before 0x1\\n\\nassert revert opcode error data: { panicCode: \'0x1\', panicDescription: \'Assertion error\' }\\n      \u2714 Assert Before Revert Opcode\\n\\nassert invalid opcode error data: { panicCode: \'0x\', panicDescription: \'not panic error\' }\\n      \u2714 Assert Before Invalid Opcode\\n\\nsuccess BigNumber { value: \\"115792089237316195423570985008687907853269984665640564039457584007913129639931\\" }\\n      \u2714 Assert Before 0x11\\n\\nassert 0x12 error data: { panicCode: \'0x\', panicDescription: \'not panic error\' }\\n      \u2714 Assert Before 0x12\\n\\nassert 0x21 error data: { panicCode: \'0x\', panicDescription: \'not panic error\' }\\n      \u2714 Assert Before 0x21\\n\\nassert 0x31 error data: { panicCode: \'0x\', panicDescription: \'not panic error\' }\\n      \u2714 Assert Before 0x31\\n\\nassert 0x32 error data: { panicCode: \'0x\', panicDescription: \'not panic error\' }\\n      \u2714 Assert Before 0x32\\n```\\n\\n0.8 \ubc84\uc804 \uc774\uc804\uc5d0\ub294 `INVALID` opcode\uac00 \uc0ac\uc6a9\ub418\uace0, \ud574\ub2f9 opcode\ub294 `REVERT(0,0)` \uc640 \uac00\uc2a4 \ud658\ubd88 \uc9c0\uc810\uc744 \uc81c\uc678\ud558\uba74 \ub3d9\uc77c\ud558\uae30 \ub54c\ubb38\uc5d0 \ub300\ubd80\ubd84\uc758 \ucf00\uc774\uc2a4\ub4e4\uc774 \uc704\uc5d0\uc11c \uc791\uc131\ud55c \ub514\ucf54\ub529 \ud568\uc218\uc758 \uccab\ubc88 \uc9f8 if \ubb38\uc5d0 \uac78\ub9ac\ub294 \uac83\uc744 \ubcfc \uc218 \uc788\ub2e4 (\uc5d0\ub7ec \ub370\uc774\ud130\uac00 \uadf8\ub0e5 \\"0x\\"\uc774\ubbc0\ub85c). \ub2e4\ub9cc \ub450\ubc88 \uc9f8 \ud14c\uc2a4\ud2b8 \ucf00\uc774\uc2a4\uc5d0\uc11c\ub294 \uc815\uc0c1\uc801\uc73c\ub85c \ub514\ucf54\ub529\uc774 \ub418\uc5c8\ub294\ub370, \ud574\ub2f9 \ucf00\uc774\uc2a4\uc5d0\uc11c\ub294 `REVERT` opcode\ub97c \uc0ac\uc6a9\ud558\ub294 `assertRevertOpcode()` \ud568\uc218\ub97c \ud638\ucd9c\ud588\uae30 \ub54c\ubb38\uc774\ub2e4.\\n\\n\ub610 \ud55c \uac00\uc9c0 \ud2b9\uc774\ud55c \uc9c0\uc810\uc740 \\"0x11\\" (\uc624\ubc84\ud50c\ub85c \ubc0f \uc5b8\ub354\ud50c\ub85c \ubc1c\uc0dd) \ud14c\uc2a4\ud2b8 \ucf00\uc774\uc2a4\uc758 \uacbd\uc6b0 \uc5d0\ub7ec\uac00 \ub098\uc9c0 \uc54a\uace0 \uc815\uc0c1\uc801\uc73c\ub85c \ud568\uc218\uac00 \ub3d9\uc791\ud588\ub2e4\ub294 \uac83\uc774\ub2e4. \uadf8 \uc774\uc720\ub294 \uc624\ubc84\ud50c\ub85c \ubc0f \uc5b8\ub354\ud50c\ub85c\uac00 \ubc1c\uc0dd\ud588\uc744 \ub54c Solidity\uc5d0\uc11c \uc624\ub958\ub97c \ubc1c\uc0dd\uc2dc\ud0a4\ub294 \uac83\uc740 0.8 \ubc84\uc804 \uc774\ud6c4\ubd80\ud130\uc774\uae30 \ub54c\ubb38\uc774\ub2e4. \ub530\ub77c\uc11c < 0.8 \ubc84\uc804\uc778 \ud574\ub2f9 \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c\ub294 \uc624\ub958\uac00 \ubc1c\uc0dd\ud558\uc9c0 \uc54a\uace0 \uc5b8\ub354\ud50c\ub85c\uac00 \ubc1c\uc0dd\ub41c \uac12\uc774 \uadf8\ub300\ub85c \ub9ac\ud134\ub41c \uac83\uc774\ub2e4.\\n\\n\uadf8\ub7fc 0.8 \ubc84\uc804 \uc774\ud6c4\uc758 \ucee8\ud2b8\ub799\ud2b8\ub97c \ud14c\uc2a4\ud2b8 \ud574\ubcf4\uc790. \uc704\uc640 \ub3d9\uc77c\ud55c \ucf54\ub4dc\uc758 \ucee8\ud2b8\ub799\ud2b8\ub97c \ubc84\uc804\ub9cc \ubc14\uafd4\uc11c \ud14c\uc2a4\ud2b8 \ucf54\ub4dc\ub97c \uc2e4\ud589\ud588\uc744 \ub54c \uacb0\uacfc\ub294 \uc544\ub798\uc640 \uac19\ub2e4.\\n\\n```shell\\nAssert >= 0.8\\nassert 0x1 error data: { panicCode: \'0x1\', panicDescription: \'Assertion error\' }\\n      \u2714 Assert 0x1\\n\\nassert revert opcode error data: { panicCode: \'0x1\', panicDescription: \'Assertion error\' }\\n      \u2714 Assert Revert Opcode\\n\\nassert invalid opcode error data: { panicCode: \'0x\', panicDescription: \'not panic error\' }\\n      \u2714 Assert Invalid Opcode\\n\\nassert 0x11 error data: {\\n  panicCode: \'0x11\',\\n  panicDescription: \'Arithmetic operation underflowed or overflowed outside of an unchecked block\'}\\n      \u2714 Assert 0x11\\n\\nassert 0x12 error data: {\\n  panicCode: \'0x12\',\\n  panicDescription: \'Division or modulo division by zero\'}\\n      \u2714 Assert 0x12\\n\\nassert 0x21 error data: {\\n  panicCode: \'0x21\',\\n  panicDescription: \'Tried to convert a value into an enum, but the value was too big or negative\'}\\n      \u2714 Assert 0x21\\n\\nassert 0x31 error data: {\\n  panicCode: \'0x31\',\\n  panicDescription: \'.pop() was called on an empty array\'}\\n      \u2714 Assert 0x31\\n\\nassert 0x32 error data: {\\n  panicCode: \'0x32\',\\n  panicDescription: \'Array accessed at an out-of-bounds or negative index\'}\\n      \u2714 Assert 0x32\\n```\\n\\n\ud14c\uc2a4\ud2b8 \uacb0\uacfc\ub97c \uc0b4\ud3b4\ubcf4\uba74, \uace0\uc758\uc801\uc73c\ub85c `INVALID` opcode\ub97c \uc0ac\uc6a9\ud55c `assertInvalidOpcode()` \ud568\uc218\ub97c \uc81c\uc678\ud558\uace0\ub294 \ubaa8\ub450 \uc815\uc0c1\uc801\uc73c\ub85c \uc5d0\ub7ec \ub370\uc774\ud130\uac00 \ub514\ucf54\ub529\ub41c \uac83\uc744 \ubcfc \uc218 \uc788\ub2e4.\\n\\n\ud2b9\ud788 0.8 \uc774\uc804 \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c\ub294 \uc624\ub958\uac00 \ubc1c\uc0dd\ub418\uc9c0 \uc54a\uc558\ub358 \\"0x11\\" \ucf54\ub4dc\uc758 \uacbd\uc6b0\uc5d0\ub3c4 \uc815\uc0c1\uc801\uc73c\ub85c \uc624\ub958\uac00 \ubc1c\uc0dd\ub41c \uac83\uc744 \ubcfc \uc218 \uc788\ub2e4. \ub9cc\uc57d \ud574\ub2f9 \uc0b0\uc220 \uc5f0\uc0b0 \ucf54\ub4dc\ub97c `unchecked{}` \ube14\ub85d \uc548\uc5d0\uc11c \uc218\ud589\ud588\ub2e4\uba74 0.8 \uc774\uc804 \ucee8\ud2b8\ub799\ud2b8\uc758 \uacbd\uc6b0\ucc98\ub7fc \uc624\ub958\uac00 \ubc1c\uc0dd\ud558\uc9c0 \uc54a\uace0 \uc5b8\ub354\ud50c\ub85c\uac00 \ubc1c\uc0dd\ud55c \uac12\uc774 \ub9ac\ud134\ub410\uc744 \uac83\uc774\ub2e4.\\n\\n\uc5ec\ub2f4\uc774\uc9c0\ub9cc, \uc624\ubc84\ud50c\ub85c \ubc0f \uc5b8\ub354\ud50c\ub85c\ub97c 0.8 \ubc84\uc804 \uc774\ud6c4\ubd80\ud130\ub294 \uae30\uc874 SafeMath\uc640 \uac19\uc740 \ub77c\uc774\ube0c\ub7ec\ub9ac\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc9c1\uc811 \uccb4\ud06c\ud574\uc8fc\uc9c0 \uc54a\uc544\ub3c4 Solidity\uc5d0\uc11c \uae30\ubcf8\uc801\uc73c\ub85c \uccb4\ud06c\ud574\uc900\ub2e4\ub294 \uac83\uc740 \ubd84\uba85 \uc6a9\uc774\ud55c \uc9c0\uc810\uc774\uc9c0\ub9cc \uadf8 \ub9d0\uc740 \uace7 \uc624\ubc84\ud50c\ub85c \ubc0f \uc5b8\ub354\ud50c\ub85c\uac00 \ubc1c\uc0dd\ud560 \uac00\ub2a5\uc131\uc774 \uc5c6\ub294 \uc0b0\uc220 \uc5f0\uc0b0(\ub300\ud45c\uc801\uc73c\ub85c \ubc18\ubcf5\ubb38\uc5d0\uc11c \uc0ac\uc6a9\ub418\ub294 \ubcc0\uc218\uc5d0 \ub300\ud55c \ub367\uc148 \ubc0f \ube84\uc148 \uc5f0\uc0b0)\uc5d0\uc11c\ub3c4 \ud574\ub2f9 \uc624\ub958\ub97c \uccb4\ud06c\ud558\ub294 \uc624\ubc84\ud5e4\ub4dc\uac00 \ubc1c\uc0dd\ud560 \uc218 \uc788\ub2e4\ub294 \uac83\uc744 \uc758\ubbf8\ud55c\ub2e4. \ub54c\ubb38\uc5d0 \uc0c1\ud669\uc5d0 \ub530\ub77c \uc801\uc808\ud558\uac8c `unchecked{}` \ube14\ub85d\uc744 \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \ubd88\ud544\uc694\ud55c \uc624\ubc84\ud5e4\ub4dc\ub97c \uc904\uc77c \uc218 \uc788\ub294 \ubc29\ubc95\uc774\ub2e4.\\n\\n## Revert & Require\\n\\n\uc704\uc5d0\uc11c \uc0b4\ud3b4\ubcf8 `assert` \ud568\uc218, \uc989 `Panic(uint256)` \ub370\uc774\ud130 \uc720\ud615\uc73c\ub85c \ubc18\ud658\ub418\uc9c0 \uc54a\ub294 \uc5d0\ub7ec\ub294 `Error(string)` \ub370\uc774\ud130 \uc720\ud615\uc73c\ub85c \ubc18\ud658\ub418\uac70\ub098 \uc5d0\ub7ec \ub370\uc774\ud130 \uc5c6\uc774 `REVERT(0,0)` \ub85c \ubc18\ud658\ub41c\ub2e4.\\n\\n\uc194\ub9ac\ub514\ud2f0 \uacf5\uc2dd \ubb38\uc11c\uc5d0\ub294 \uc544\ub798 \uc0c1\ud669\ub4e4\uc5d0\uc11c `Error(string)` \ub370\uc774\ud130 \uc720\ud615\uc758 `REVERT` \ud639\uc740 \ub370\uc774\ud130 \uc5c6\ub294 `REVERT` \uac00 \uc0dd\uc131\ub41c\ub2e4\uace0 \uc124\uba85\ud558\uace0 \uc788\ub2e4.\\n\\n```\\n1. Calling require(x) where x evaluates to false.\\n   : require \ud638\ucd9c\uc2dd\uc774 false\ub85c \ud3c9\uac00\ub418\ub294 \uacbd\uc6b0\\n\\n2. If you use revert() or revert(\\"description\\").\\n   : revert() \ud639\uc740 revert(\uc5d0\ub7ec \uba54\uc138\uc9c0)\uac00 \ud638\ucd9c\ub418\ub294 \uacbd\uc6b0\\n\\n3. If you perform an external function call targeting a contract that contains no code.\\n   : \ucf54\ub4dc\uac00 \uc874\uc7ac\ud558\uc9c0 \uc54a\ub294 \ucee8\ud2b8\ub799\ud2b8\ub85c \ud568\uc218\ub97c \ud638\ucd9c\ud558\ub294 \uacbd\uc6b0\\n\\n4. If your contract receives Ether via a public function without payable modifier (including the constructor and the fallback function).\\n   : payable \uc218\uc815\uc790\uac00 \uc5c6\ub294 \uacf5\uac1c \ud568\uc218\uac00 Ether\ub97c \uc218\uc2e0\ud558\ub294 \uacbd\uc6b0\\n\\n5. If your contract receives Ether via a public getter function.\\n   : getter \uacf5\uac1c \ud568\uc218\uac00 Ether\ub97c \uc218\uc2e0\ud558\ub294 \uacbd\uc6b0\\n\\n```\\n\\n\uc989 `require` \ud568\uc218\ub294 \ud638\ucd9c\uc2dd \uc548\uc758 \uc870\uac74\uc774 false\ub85c \ud3c9\uac00\ub418\ub294 \uacbd\uc6b0, `revert` \ud568\uc218\ub294 \ud638\ucd9c \uadf8 \uc790\uccb4\ub85c \uc608\uc678\ub97c \ubc1c\uc0dd\uc2dc\ud0a8\ub2e4\uace0 \ubcfc \uc218 \uc788\ub2e4. \uadf8\ub9ac\uace0 `assert` \ud568\uc218\uc640\ub294 \ub2e4\ub974\uac8c \uacc4\uc57d \uc791\uc131\uc790\uac00 \ud544\uc694\uc5d0 \ub530\ub77c \uc5d0\ub7ec\uc5d0 \ub300\ud55c \uba54\uc138\uc9c0\ub97c \uc804\ub2ec\ud560 \uc218 \uc788\ub2e4.\\n\\n\ubb3c\ub860 `revert` \uc640 `require` \ud568\uc218 \ubaa8\ub450 `REVERT` opcode\ub97c \uc0ac\uc6a9\ud558\uace0 \uc788\uae30 \ub54c\ubb38\uc5d0 \ud574\ub2f9 \ud568\uc218\ub4e4\uc744 \ud1b5\ud574 \uc608\uc678\ub97c \ubc1c\uc0dd\uc2dc\ucf30\uc744 \ub54c \uc0ac\uc6a9\ub418\uc9c0 \uc54a\uc740 \uac00\uc2a4\ub294 \ud658\ubd88\ub41c\ub2e4.\\n\\n\uc815\ub9ac\ud558\uc790\uba74, \uc785\ub825\ub41c \uc5d0\ub7ec \uba54\uc138\uc9c0\uac00 \uc874\uc7ac\ud558\uc9c0 \uc54a\uc744 \ub54c \ub450 \ud568\uc218\ub294 `REVERT(0,0)` opcode\uc640 \ub3d9\uc77c\ud558\uba70 \uc5d0\ub7ec \uba54\uc138\uc9c0\uac00 \ud3ec\ud568\ub41c \uacbd\uc6b0\uc5d0\ub294 `Error(string)` \ub370\uc774\ud130 \uc720\ud615\uc73c\ub85c \uc778\ucf54\ub529 \ub418\uc5b4 `REVERT(offset, size)` opcode\ub97c \ud1b5\ud574 \ubc18\ud658\ub418\ub294 \uac83\uc774\ub2e4.\\n\\n## Revert & Require Handling\\n\\nAssert \uc5d0\ub7ec\uc640 \ub9c8\ucc2c\uac00\uc9c0\ub85c, \uc678\ubd80\uc5d0\uc11c \ucee8\ud2b8\ub799\ud2b8 \ud568\uc218\ub97c \ud638\ucd9c\ud560 \ub54c Revert \ubc0f Require \uc5d0\ub7ec\ub97c \ud5e8\ub4e4\ub9c1\ud560 \uc218 \uc788\ub294 \ud568\uc218\ub97c \ub9cc\ub4e4\uc5b4\ubcf4\uc790.\\n\\n\uc704\uc5d0\uc11c \uc0b4\ud3b4\ubcf8 \uac83\ucc98\ub7fc, `revert` \uc640 `require` \ud568\uc218\uc5d0 \uc5d0\ub7ec \uba54\uc138\uc9c0\uac00 \ud3ec\ud568\ub418\uc5b4\uc788\ub2e4\uba74 \ud574\ub2f9 \uba54\uc138\uc9c0\ub294 `Error(string)` \ud568\uc218\uc640 \ub3d9\uc77c\ud55c \ub370\uc774\ud130 \uc720\ud615\uc73c\ub85c \uc778\ucf54\ub529\ub418\uc5b4 \ubc18\ud658\ub41c\ub2e4.\\n\\n\uba3c\uc800 \uc5b4\uc148\ube14\ub9ac \ucf54\ub4dc\ub97c \ud1b5\ud574 EVM \uc548\uc5d0\uc11c\uc758 \ub3d9\uc791 \uacfc\uc815\uc744 \uc0b4\ud3b4\ubcf4\uba74 \uc544\ub798\uc640 \uac19\ub2e4.\\n\\n```sol\\n   function revertByYul() external {\\n        // 0x08c379a0\\n        bytes4 errorSelector = bytes4(keccak256(bytes(\\"Error(string)\\")));\\n\\n        assembly {\\n            mstore(0x40, errorSelector)\\n            mstore(add(0x40, 4), 32) // data offset\\n            mstore(add(0x40, 36), 14) // string length\\n            mstore(add(0x40, 68), \\"revert message\\")\\n            revert(0x40, 100)\\n        }\\n   }\\n```\\n\\n\uc774\ubc88\uc5d0\ub294 `Panic(uint256)` \ub300\uc2e0\uc5d0 `Error(string)` \uc744 keccak256\uc73c\ub85c \ud574\uc2f1\ud55c \uac12\uc758 4\ubc14\uc774\uce20 \uc2dd\ubcc4 \ub370\uc774\ud130 \uac12\uc744 \uc0dd\uc131\ud55c \ud6c4\uc5d0 \uba54\ubaa8\ub9ac\uc5d0 \uc800\uc7a5\ud55c\ub2e4.\\n\\nPanic \uc624\ub958\uc758 \uc778\uc790(uint256)\uac00 \uc815\uc801 \uc720\ud615\uc778 \uac83\uacfc \ub2e4\ub974\uac8c Error \uc624\ub958\uc758 \uc778\uc790(string)\ub294 \ub3d9\uc801 \uc720\ud615\uc73c\ub85c \uad6c\uc131\ub418\uc5b4\uc788\ub2e4. \ub530\ub77c\uc11c \uc194\ub9ac\ub514\ud2f0\uc5d0\uc11c \ub3d9\uc801 \uc720\ud615\uc758 \ub370\uc774\ud130\ub97c \uc778\ucf54\ub529\ud558\ub294 \ubc29\uc2dd\uc744 \ucc38\uace0\ud558\uc5ec \uc815\ud574\uc9c4 \ubc29\uc2dd\uc5d0 \ub530\ub77c \ub370\uc774\ud130\ub97c \ubc18\ud658\ud574\uc8fc\uc5b4\uc57c \ud55c\ub2e4.\\n\\n[solidity abi-spec use of dynamic types](https://docs.soliditylang.org/en/v0.8.21/abi-spec.html#use-of-dynamic-types) \ud574\ub2f9 \ubb38\uc11c\ub97c \ucc38\uace0\ud558\uc5ec \ub3d9\uc801 \uc720\ud615\uc758 \uc778\uc790\uac00 \ud3ec\ud568\ub41c \ud568\uc218\uc758 \uc778\ucf54\ub529 \ubc29\uc2dd\uc744 \uac04\ub2e8\ud558\uac8c \uc0b4\ud3b4\ubcf4\uc790.\\n\uc815\uc801 \uc720\ud615 \uc778\uc790\uc758 \uacbd\uc6b0, \ud568\uc218 \uc2dd\ubcc4\uac12\uc73c\ub85c \uc0ac\uc6a9\ub418\ub294 4\ubc14\uc774\uce20 \uc2dc\uadf8\ub2c8\ucc98 \uac12 \uc774\ud6c4\uc5d0 \ub9e4\uac1c\ubcc0\uc218\uc758 \uc21c\uc11c\uc5d0 \ub530\ub77c \uc778\uc790 \ub370\uc774\ud130\uac00 \ubc14\ub85c \ub2f4\uae30\uba74 \ub418\uc9c0\ub9cc \ub3d9\uc801 \uc720\ud615 \uc778\uc790\uc758 \uacbd\uc6b0 \uc778\uc790 \ube14\ub85d\uc758 \uc2dc\uc791 \ubd80\ubd84(\ud568\uc218 \uc2dc\uadf8\ub2c8\ucc98 \uac12 \uc774\ud6c4)\uc744 \uae30\uc900\uc73c\ub85c \ud574\ub2f9 \ud30c\ub77c\ubbf8\ud130\uc758 \uc778\uc790 \ub370\uc774\ud130\uac00 \uc2dc\uc791\ub418\ub294 \uc704\uce58(offset)\ub97c \ubc14\uc774\uce20 \ub2e8\uc704\ub85c \uce21\uc815\ud558\uc5ec \uba3c\uc800 \ub2f4\ub294\ub2e4.\\n\\n[solidity layout in memory](https://docs.soliditylang.org/en/latest/internals/layout_in_memory.html#layout-in-memory) \ubb38\uc11c\ub97c \ucc38\uace0\ud588\uc744 \ub54c, \uc194\ub9ac\ub514\ud2f0\uc758 \uba54\ubaa8\ub9ac \ubc30\uc5f4 \uc694\uc18c\ub294 \ud56d\uc0c1 32\ubc14\uc774\uce20\uc758 \ubc30\uc218\ub97c \ucc28\uc9c0\ud55c\ub2e4.\\n\ub530\ub77c\uc11c `Error(string)`\uc758 4\ubc14\uc774\uce20 \uc2dc\uadf8\ub2c8\ucc98\uac12 \uc774\ud6c4 \uc778\uc790 \ube14\ub85d\uc744 \uae30\uc900\uc73c\ub85c string \ud0c0\uc785\uc758 \uc778\uc790 \ub370\uc774\ud130\ub294 offset \ub370\uc774\ud130\uac00 \ub2f4\uae34 \uc774\ud6c4 \uc2dc\uc791\ub418\uae30 \ub54c\ubb38\uc5d0 32\ubc14\uc774\uce20\uac00 \ub41c\ub2e4.\\n\\n\ub3d9\uc801 \uc720\ud615 \uc778\uc790 \ub370\uc774\ud130\uc758 \uc2dc\uc791 \uc704\uce58\ub97c \uc54c\ub9ac\ub294 \ub370\uc774\ud130 \uc774\ud6c4\uc5d0\ub294 \ud574\ub2f9 \uc778\uc790 \ub370\uc774\ud130\uc758 \ubc14\uc774\uce20 \uae38\uc774\ub97c \ub2f4\uc73c\uba74 \ub41c\ub2e4. \uc704 \uc608\uc2dc \ucf54\ub4dc\uc5d0\uc11c\ub294 \'revert message\'\uc758 \uae38\uc774\uc778 14\ub97c \uc785\ub825\ud574\uc8fc\uc5c8\ub2e4.\\noffset\uacfc length \ub370\uc774\ud130\ub97c \ub2f4\uc740 \uc774\ud6c4\uc5d0 \uc624\ub958\uc640 \ud568\uaed8 \uc804\ub2ec\ud558\ub824\ub294 string \ub370\uc774\ud130\ub97c \uc785\ub825\ud558\uba74 \ub41c\ub2e4.\\n\\n\uc774\uc81c \uc194\ub9ac\ub514\ud2f0 \ub0b4\ubd80\uc5d0\uc11c `Error(string)` \uc720\ud615\uc758 \uc5d0\ub7ec \ub370\uc774\ud130\uac00 \uc778\ucf54\ub529 \ub418\ub294 \ubc29\uc2dd\uc744 \uc54c\uc558\uc73c\ub2c8 \uc678\ubd80\uc5d0\uc11c \ud574\ub2f9 \ub370\uc774\ud130\ub97c \ub514\ucf54\ub529\ud558\uc5ec \uc2dd\ubcc4\ud558\ub294 \ubc29\ubc95\uc744 \uc54c\uc544\ubcf4\uc790.\\n\\n```ts\\n    // method id of \'Error(string)\'\\n    const ERROR_STRING_PREFIX = \\"0x08c379a0\\";\\n```\\n\\n\uba3c\uc800 `Error(string)`\uc744 \uc2dd\ubcc4\ud558\uae30 \uc704\ud55c 4\ubc14\uc774\uce20\uc758 \uc2dc\uadf8\ub2c8\ucc98 \uac12\uc774 \ud544\uc694\ud558\ub2e4.\\n\\n```ts\\n    const decodeErrorData = (data: string) => {\\n    if (data === \\"0x\\") {\\n        return {kind: \\"Empty\\"};\\n    } else if (data.startsWith(ERROR_STRING_PREFIX)) {\\n        const encodedReason = data.slice(ERROR_STRING_PREFIX.length);\\n\\n        const reason = defaultAbiCoder.decode([\\"string\\"], `0x${encodedReason}`)[0];\\n\\n        return {\\n        kind: \\"Error\\",\\n        reason,\\n        };\\n      }\\n    }\\n```\\n\\n\ubc18\ud658\ub418\ub294 \uc5d0\ub7ec \ub370\uc774\ud130\ub97c \ub514\ucf54\ub529\ud558\uc5ec \uc678\ubd80\uc5d0\uc11c \uc2dd\ubcc4\ud560 \uc218 \uc788\uac8c \ud558\ub294 \ud568\uc218\ub97c \uc791\uc131\ud574\ubcf4\uc790. \uc704\uc758 \ud568\uc218\uc5d0\uc11c\ub294 \uc5d0\ub7ec \ub370\uc774\ud130\uac00 \uc874\uc7ac\ud558\uc9c0 \uc54a\uc73c\uba74 (`REVERT(0,0)` \ub85c \ubc18\ud658\ub41c \uacbd\uc6b0) \\"Empty\\" \uc885\ub958\ub85c \ubc18\ud658\ub418\uba70, \uc704\uc5d0\uc11c \uc815\uc758\ud588\ub358 ERROR_STRING_PREFIX \ub85c \uc2dc\uc791\ub418\ub294 \uacbd\uc6b0 string \ud0c0\uc785\uc758 \uc778\uc790\uac12\uc744 \ub514\ucf54\ub529\ud558\uc5ec \ud568\uaed8 \ubc18\ud658\ud574\uc900\ub2e4.\\n\\nAssert\uc640 \ub9c8\ucc2c\uac00\uc9c0\ub85c \ub514\ucf54\ub529 \ud568\uc218\uac00 \uc81c\ub300\ub85c \ub3d9\uc791\ud558\ub294\uc9c0 Revert \ubc0f Require \uc5d0\ub7ec\ub97c \ubc1c\uc0dd\uc2dc\ud0a4\ub294 \ud14c\uc2a4\ud2b8 \ucee8\ud2b8\ub799\ud2b8\ub97c \uc791\uc131\ud558\uace0 \ud638\ucd9c\ud574\ubcf4\uc790.\\n\\n```sol title=\\"contracts/Revert.sol\\"\\npragma solidity ^0.8.17;\\n\\ncontract Revert {\\n    function revertWithoutMessage() external {\\n        revert();\\n    }\\n\\n    function revertWithMessage() external {\\n        revert(\\"revert message\\");\\n    }\\n\\n    function requireWithoutMessage() external {\\n        require(false);\\n    }\\n\\n    function requireWithMessage() external {\\n        require(false, \\"require message\\");\\n    }\\n\\n    function revertByYul() external {\\n        // 0x08c379a0\\n        bytes4 errorSelector = bytes4(keccak256(bytes(\\"Error(string)\\")));\\n\\n        assembly {\\n            mstore(0x40, errorSelector)\\n            mstore(add(0x40, 4), 32) // data offset\\n            mstore(add(0x40, 36), 14) // string length\\n            mstore(add(0x40, 68), \\"revert message\\")\\n            revert(0x40, 100)\\n        }\\n    }\\n}\\n```\\n\\n\uc704\uc758 \uc608\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c\ub294 `revert` \uc640 `require` \ub97c \uc0ac\uc6a9\ud574\uc11c \uac01\uac01 \uc5d0\ub7ec \uba54\uc2dc\uc9c0\uac00 \uc5c6\ub294 \uacbd\uc6b0\uc640 \uc874\uc7ac\ud558\ub294 \uacbd\uc6b0\ub85c \uc624\ub958\ub97c \ubc1c\uc0dd\uc2dc\ud0a4\ub294 \ud568\uc218\ub97c \uc791\uc131\ud558\uc600\uace0, \ub9c8\uc9c0\ub9c9\uc73c\ub85c \uc5b4\uc148\ube14\ub9ac \ucf54\ub4dc\ub97c \ud1b5\ud574 `revert` \uc624\ub958\ub97c \uba54\uc2dc\uc9c0\uc640 \ud568\uaed8 \ubc1c\uc0dd\uc2dc\ud0a4\ub294 \ud568\uc218\ub97c \uc791\uc131\ud558\uc600\ub2e4.\\n\\n```ts\\ndescribe(\\"Revert Test\\", () => {\\n  let revert: Contract;\\n\\n  before(async () => {\\n    const Revert = await ethers.getContractFactory(\\"Revert\\");\\n    revert = await Revert.deploy();\\n    await revert.deployed();\\n  });\\n\\n  describe(\\"Error\\", () => {\\n    it(\\"Revert Without Message\\", async () => {\\n      try {\\n        await revert.revertWithoutMessage();\\n\\n        console.log(\\"success\\");\\n      } catch (error: any) {\\n        console.log(\\"revert without message:\\", decodeErrorData(error.data));\\n      }\\n    });\\n\\n    it(\\"Revert With Message\\", async () => {\\n      try {\\n        await revert.revertWithMessage();\\n\\n        console.log(\\"success\\");\\n      } catch (error: any) {\\n        console.log(\\"revert with message:\\", decodeErrorData(error.data));\\n      }\\n    });\\n\\n    it(\\"Require Without Message\\", async () => {\\n      try {\\n        await revert.requireWithoutMessage();\\n\\n        console.log(\\"success\\");\\n      } catch (error: any) {\\n        console.log(\\"require without message:\\", decodeErrorData(error.data));\\n      }\\n    });\\n\\n    it(\\"Require With Message\\", async () => {\\n      try {\\n        await revert.requireWithMessage();\\n\\n        console.log(\\"success\\");\\n      } catch (error: any) {\\n        console.log(\\"require with message:\\", decodeErrorData(error.data));\\n      }\\n    });\\n\\n    it(\\"Revert By Yul\\", async () => {\\n      try {\\n        await revert.revertByYul();\\n\\n        console.log(\\"success\\");\\n      } catch (error: any) {\\n        console.log(\\"revert by yul:\\", decodeErrorData(error.data));\\n      }\\n    });\\n  });\\n});\\n```\\n\\n\uc704\uc758 \ud14c\uc2a4\ud2b8 \ucf54\ub4dc\ub97c \uc2e4\ud589\ud588\uc744 \ub54c \uc544\ub798\uc640 \uac19\uc740 \uacb0\uacfc\uac00 \ub098\uc654\ub2e4.\\n\\n```shell\\nRevert Test\\n Error\\nrevert without message: { kind: \'Empty\' }\\n      \u2714 Revert Without Message (46ms)\\nrevert with message: { kind: \'Error\', reason: \'revert message\' }\\n      \u2714 Revert With Message (45ms)\\nrequire without message: { kind: \'Empty\' }\\n      \u2714 Require Without Message (39ms)\\nrequire with message: { kind: \'Error\', reason: \'require message\' }\\n      \u2714 Require With Message (48ms)\\nrevert by yul: { kind: \'Error\', reason: \'revert message\' }\\n      \u2714 Revert By Yul\\n```\\n\\n\ud14c\uc2a4\ud2b8 \uacb0\uacfc\ub97c \uc0b4\ud3b4\ubcf4\uc558\uc744 \ub54c, \ucee8\ud2b8\ub799\ud2b8\uc5d0 \uc785\ub825\ub41c \uc5d0\ub7ec \uba54\uc138\uc9c0 \uadf8\ub300\ub85c \uc798 \ub514\ucf54\ub529\ub418\uc5b4 \ub098\uc624\ub294 \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n\\n## Custom Error\\n\\n\uc194\ub9ac\ub514\ud2f0 0.8.4 \ubc84\uc804\ubd80\ud130\ub294 \uc0ac\uc6a9\uc790\uac00 \uc9c1\uc811 \uc5d0\ub7ec \ud0c0\uc785\uc744 \uc9c0\uc815\ud558\uc5ec \uae30\uc874 string \ud0c0\uc785 \ubfd0\ub9cc \uc544\ub2c8\ub77c \ub2e4\uc591\ud55c \ud0c0\uc785\uc758 \uc778\uc790\ub97c \uc804\ub2ec\ud558\ub294 \ucee4\uc2a4\ud140 \uc5d0\ub7ec\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub2e4.\\n\\n[Custom Errors in Solidity](https://soliditylang.org/blog/2021/04/21/custom-errors) \ud574\ub2f9 \ubb38\uc11c\ub97c \ucc38\uace0\ud558\uc5ec \ucee4\uc2a4\ud140 \uc5d0\ub7ec\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc744 \uc0b4\ud3b4\ubcf4\uc790.\\n\\n\ucee4\uc2a4\ud140 \uc5d0\ub7ec\uc758 \uc7a5\uc810\uc740 \uae30\uc874 `revert`\uc640 `require` \uc5d0\uc11c \ubb38\uc790\uc5f4\ub85c \uace0\uc815\uc801\uc73c\ub85c\ub9cc \uc804\ub2ec\ud560 \uc218 \ubc16\uc5d0 \uc5c6\ub358 \uc5d0\ub7ec \uc815\ubcf4\ub97c \ub2e4\uc591\ud55c \ud0c0\uc785\uc73c\ub85c \uc0c1\ud669\uc5d0 \ub530\ub77c \ub3d9\uc801\uc73c\ub85c \uc804\ub2ec \uac00\ub2a5\ud558\uba74\uc11c\ub3c4 \ubcf4\ub2e4 \uac00\uc2a4 \ud6a8\uc728\uc801\uc778 \ubc29\uc2dd\uc744 \uc0ac\uc6a9\ud55c\ub2e4\ub294 \uac83\uc774\ub2e4.\\n\\n\ucee4\uc2a4\ud140 \uc5d0\ub7ec\ub97c \uc0ac\uc6a9\ud558\ub294 \ubc29\uc2dd\uc740 \uc0ac\uc6a9\uc790\uac00 \ud544\uc694\ub85c \ud558\ub294 `error` \ubb38\uc744 \uc815\uc758\ud558\ub294 \uac83\uc5d0\uc11c \uc2dc\uc791\ud55c\ub2e4.\\n\\n```sol\\n// SPDX-License-Identifier: GPL-3.0\\npragma solidity ^0.8.4;\\n\\nerror Unauthorized();\\n\\ncontract VendingMachine {\\n    address payable owner = payable(msg.sender);\\n\\n    function withdraw() public {\\n        if (msg.sender != owner)\\n            revert Unauthorized();\\n\\n        owner.transfer(address(this).balance);\\n    }\\n    // ...\\n}\\n```\\n\\n\uc704\uc758 \uc608\uc2dc \ucf54\ub4dc\ub97c \ubcf4\uba74, `Unauthorized()` \ub77c\ub294 `error` \ubb38\uc744 \uc815\uc758\ud558\uace0, \ud574\ub2f9 \uc5d0\ub7ec\ub97c `revert` \ub97c \ud1b5\ud574 \uc0ac\uc6a9\ud558\ub294 \uac83\uc744 \ubcfc \uc218 \uc788\ub2e4. `error` \uad6c\ubb38\uc740 `event` \uad6c\ubb38\uacfc \uc720\uc0ac\ud558\uba70, \uc544\uc9c1\uae4c\uc9c0 `require` \ud568\uc218\ub97c \ud1b5\ud574\uc11c\ub294 \uc0ac\uc6a9\ud560 \uc218 \uc5c6\uace0 \uc624\uc9c1 `revert` \ub97c \ud1b5\ud574\uc11c\ub9cc \uc0ac\uc6a9\ud560 \uc218 \uc788\ub2e4.\\n\\n```sol\\n// SPDX-License-Identifier: GPL-3.0\\npragma solidity ^0.8.4;\\n\\n/// Insufficient balance for transfer. Needed `required` but only\\n/// `available` available.\\n/// @param available balance available.\\n/// @param required requested amount to transfer.\\nerror InsufficientBalance(uint256 available, uint256 required);\\n\\ncontract TestToken {\\n    mapping(address => uint) balance;\\n    function transfer(address to, uint256 amount) public {\\n        if (amount > balance[msg.sender])\\n            // Error call using named parameters. Equivalent to\\n            // revert InsufficientBalance(balance[msg.sender], amount);\\n            revert InsufficientBalance({\\n                available: balance[msg.sender],\\n                required: amount\\n            });\\n        balance[msg.sender] -= amount;\\n        balance[to] += amount;\\n    }\\n    // ...\\n}\\n```\\n\\n\ucee4\uc2a4\ud140 \uc5d0\ub7ec\uc758 \uc7a5\uc810\uc73c\ub85c \ub2e4\uc591\ud55c \ud0c0\uc785\uc758 \uc815\ubcf4\ub97c \uc0c1\ud669\uc5d0 \ub530\ub77c \ub3d9\uc801\uc73c\ub85c \uc804\ub2ec\ud560 \uc218 \uc788\ub2e4\uace0 \ud55c \uac83\ucc98\ub7fc, `error` \uad6c\ubb38\uc5d0\ub294 \uc6d0\ud558\ub294 \ud0c0\uc785\uc758 \ud30c\ub77c\ubbf8\ud130\ub97c \uc124\uc815\ud558\uace0 \uc0c1\ud669\uc5d0 \ub530\ub77c \uc778\uc790\ub97c \ub123\uc5b4 \uc5d0\ub7ec \uc815\ubcf4\ub97c \uc804\ub2ec\ud560 \uc218 \uc788\ub2e4.\\n\\n\uadf8\ub807\ub2e4\uba74 \ucee4\uc2a4\ud140 \uc5d0\ub7ec\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \uae30\uc874\uc758 \ubc29\uc2dd\uc744 \uc0ac\uc6a9\ud558\ub294 \uac83\ubcf4\ub2e4 \uc5b4\ub5a4 \uba74\uc5d0\uc11c \uac00\uc2a4 \ud6a8\uc728\uc801\uc778\uc9c0 \ubb38\uc11c\uc5d0 \uc5b8\uae09\ub41c \uad00\ub828 \uc608\uc2dc \ucf54\ub4dc\ub97c \uc0b4\ud3b4\ubcf4\uc790.\\n\\n```sol\\n// revert Unauthorized();\\nlet free_mem_ptr := mload(64)\\nmstore(free_mem_ptr, 0x82b4290000000000000000000000000000000000000000000000000000000000)\\nrevert(free_mem_ptr, 4)\\n\\n// revert(\\"Unauthorized\\");\\nlet free_mem_ptr := mload(64)\\nmstore(free_mem_ptr, 0x08c379a000000000000000000000000000000000000000000000000000000000)\\nmstore(add(free_mem_ptr, 4), 32)\\nmstore(add(free_mem_ptr, 36), 12)\\nmstore(add(free_mem_ptr, 68), \\"Unauthorized\\")\\nrevert(free_mem_ptr, 100)\\n```\\n\\n\uccab\ubc88 \uc9f8 \uc608\uc2dc\ub294 `error Unauthorized()` \ub85c \uc815\uc758\ub41c \ucee4\uc2a4\ud140 \uc5d0\ub7ec\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc608\uc678\ub97c \ubc1c\uc0dd\uc2dc\ud0a4\ub294 \uacbd\uc6b0\ub97c \uc5b4\uc148\ube14\ub9ac \ucf54\ub4dc\ub85c \ud480\uc5b4\ub0b8 \uac83\uc774\uace0, \ub450\ubc88 \uc9f8 \uc608\uc2dc\ub294 \uae30\uc874\uc758 `revert` \ud568\uc218\ub97c \uc0ac\uc6a9\ud574\uc11c \\"Unauthorized\\" \uba54\uc138\uc9c0\ub97c \uc804\ub2ec\ud558\uc5ec \uc608\uc678\ub97c \ubc1c\uc0dd\uc2dc\ud0a4\ub294 \uacbd\uc6b0\uc5d0 \ub300\ud55c \uc5b4\uc148\ube14\ub9ac \ucf54\ub4dc\uc774\ub2e4.\\n\\n`error Unauthorized()` \uc5d0 \ub300\ud55c ABI \uc778\ucf54\ub529 \ubc29\uc2dd\uc740 `Unauthorized()` \ud568\uc218\uc758 \uc778\ucf54\ub529 \ubc29\uc2dd\uacfc \ub3d9\uc77c\ud558\ub2e4. \ub530\ub77c\uc11c \ucee4\uc2a4\ud140 \uc5d0\ub7ec\uc758 \uacbd\uc6b0 `Unauthorized()` \ud568\uc218\uc758 4\ubc14\uc774\uce20 \uc2dc\uadf8\ub2c8\ucc98 \uac12\ub9cc\uc744 \ud544\uc694\ub85c \ud558\uc9c0\ub9cc, \uae30\uc874 \ubc29\uc2dd\uc744 \uc0ac\uc6a9\ud588\uc744 \ub54c\ub294 \uc55e\uc11c `revert` \uc5d0 \ub300\ud55c \uc778\ucf54\ub529 \ubc29\uc2dd\uc744 \uc0b4\ud3b4\ubcf8 \uac83\ucc98\ub7fc `Error(string)` \ud568\uc218\ub97c \uc778\ucf54\ub529 \ud558\ub294 \uacfc\uc815\uc744 \uac70\uccd0\uc57c \ud55c\ub2e4.\\n\\n\uacb0\uacfc\uc801\uc73c\ub85c \\"Unauthorized\\" \ub77c\ub294 \ub3d9\uc77c\ud55c \uc815\ubcf4\ub97c \uc804\ub2ec\ud558\uace0 \uc788\uc9c0\ub9cc \ucee4\uc2a4\ud140 \uc5d0\ub7ec \ubc29\uc2dd\uc744 \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \ube44\uc6a9\uba74\uc5d0\uc11c \ud6a8\uc728\uc801\uc778 \uac83\uc744 \uc54c \uc218 \uc788\ub2e4. \ud2b9\ud788 \ub7f0\ud0c0\uc784 \ud658\uacbd\uc5d0\uc11c\ub294 `revert`\uc758 \uc870\uac74\uc774 \ucda9\uc871\ub41c \uacbd\uc6b0\uc5d0\ub9cc \ub450 \ubc29\uc2dd\uc758 \ucc28\uc774\uc810\uc774 \uc801\uc6a9\ub418\uaca0\uc9c0\ub9cc \ucee8\ud2b8\ub799\ud2b8 \ubc30\ud3ec \ube44\uc6a9\uc5d0 \uc788\uc5b4\uc11c\ub294 \uae30\ubcf8\uc801\uc73c\ub85c \ube44\uc6a9\uc758 \ucc28\uc774\uac00 \ubc1c\uc0dd\ud55c\ub2e4.\\n\\n## Custom Error Handling\\n\\n\uadf8\ub807\ub2e4\uba74 \uc774\uc81c \ucee4\uc2a4\ud140 \uc5d0\ub7ec\ub97c \uc678\ubd80\uc5d0\uc11c \ud5e8\ub4e4\ub9c1\ud560 \uc218 \uc788\ub294 \ud568\uc218\ub97c \ub9cc\ub4e4\uc5b4\ubcf4\uc790.\\n\\n\ucee4\uc2a4\ud140 \uc5d0\ub7ec\ub294 \ubbf8\ub9ac \uc815\uc758\ub41c `error` \ubb38\uc5d0 \ub300\ud574 \ud568\uc218\ub97c \uc778\ucf54\ub529\ud558\ub294 \ubc29\uc2dd\uacfc \ub3d9\uc77c\ud558\uac8c \uc778\ucf54\ub529\ud558\uc5ec \uc815\ubcf4\ub97c \uc804\ub2ec\ud55c\ub2e4.\\n\\n\uc608\ub97c \ub4e4\uc5b4 `error CustomErrorWithParameter(uint256 param)` \uc5d0 \ub300\ud574 `param` \uc758 \uac12\uc774 1\uc778 \uc608\uc678\ub97c \ubc1c\uc0dd\uc2dc\ud0a4\ub294 \uacfc\uc815\uc740 \uc544\ub798\uc640 \uac19\ub2e4.\\n\\n```sol\\n    function revertCustomErrorWithParameterByYul() external {\\n        bytes4 errorSelector = CustomErrorWithParameter.selector;\\n\\n        assembly {\\n            mstore(0x40, errorSelector)\\n            mstore(add(0x40, 4), 1) // param uint256 value 1 padded to 32 bytes\\n            revert(0x40, 36)\\n        }\\n    }\\n```\\n\\n\uba3c\uc800 `CustomErrorWithParameter(uint256 param)` \ud568\uc218\ub97c \uc2dd\ubcc4\ud560 \uc218 \uc788\ub294 4\ubc14\uc774\uce20 \uc2dc\uadf8\ub2c8\ucc98 \uac12\uc744 \uba3c\uc800 \ub2f4\uace0, `param` \uc740 \uc815\uc801 \uc720\ud615\uc758 \uc778\uc790\uc774\uae30 \ub54c\ubb38\uc5d0 \ubc14\ub85c \ud574\ub2f9 \uc778\uc790\uc758 \uac12\uc778 1\uc744 \ub2f4\uc544\uc8fc\uba74 \ub41c\ub2e4.\\n\\n\uadf8\ub7fc \uc678\ubd80\uc5d0\uc11c \ucee4\uc2a4\ud140 \uc5d0\ub7ec\ub97c \ud1b5\ud574 \ubc18\ud658\ub41c \ub370\uc774\ud130\ub97c \ub514\ucf54\ub529\ud558\uc5ec \uc2dd\ubcc4\ud558\ub294 \uacfc\uc815\uc744 \uc0b4\ud3b4\ubcf4\uc790.\\n\\n```ts\\nconst errorIface = new ethers.utils.Interface([\\n  \\"error CustomError()\\",\\n  \\"error CustomErrorWithParameter(uint256 param)\\",\\n]);\\n```\\n\\n\uba3c\uc800 \ucee8\ud2b8\ub799\ud2b8\uc5d0 \uc815\uc758\ub41c `error` \uad6c\ubb38\ub4e4\uc744 \uc678\ubd80\uc5d0\uc11c \uc2dd\ubcc4\ud560 \uc218 \uc788\ub3c4\ub85d \ud574\ub2f9 \uc778\ud130\ud398\uc774\uc2a4\ub97c \uc0dd\uc131\ud55c\ub2e4.\\n\\n```ts\\nconst decodeErrorData = (data: string) => {\\n  const sig = data.slice(0, 10);\\n  const error = errorIface.getError(sig);\\n\\n  return {\\n    kind: \\"Custom\\",\\n    id: sig,\\n    name: error.name,\\n    data: errorIface.decodeErrorResult(error, data),\\n  };\\n};\\n```\\n\\n\uadf8\ub9ac\uace0 \uc5d0\ub7ec \ub370\uc774\ud130\uc5d0\uc11c \uba3c\uc800 \ud568\uc218 \uc2dc\uadf8\ub2c8\ucc98 \uac12\uc744 `slice()` \ud558\uc5ec \uc5d0\ub7ec \uc778\ud130\ud398\uc774\uc2a4\uc5d0\uc11c \ud574\ub2f9 \uc2dc\uadf8\ub2c8\ucc98 \uac12\uc758 \uc5d0\ub7ec\ub97c \ucc3e\uc740 \ub4a4\uc5d0 `decodeErrorResult()` \ud568\uc218\ub97c \ud65c\uc6a9\ud558\uc5ec \ub514\ucf54\ub529\ud574\uc900\ub2e4.\\n\\n\uadf8\ub7fc \ub514\ucf54\ub529 \ud568\uc218\uac00 \uc798 \ub3d9\uc791\ud558\ub294\uc9c0 \ud14c\uc2a4\ud2b8 \ucee8\ud2b8\ub799\ud2b8\ub97c \uc791\uc131\ud558\uace0 \ud638\ucd9c\ud574\ubcf4\uc790.\\n\\n```sol title=\\"contracts/Revert.sol\\"\\n// SPDX-License-Identifier: UNLICENSED\\npragma solidity ^0.8.17;\\n\\ncontract Revert {\\n    error CustomError();\\n    error CustomErrorWithParameter(uint256 param);\\n\\n    function revertCustomError() external {\\n        revert CustomError();\\n    }\\n\\n    function revertCustomErrorWithParameter() external {\\n        revert CustomErrorWithParameter(1);\\n    }\\n\\n    function revertCustomErrorByYul() external {\\n        bytes4 errorSelector = CustomError.selector;\\n\\n        assembly {\\n            mstore(0x40, errorSelector)\\n            revert(0x40, 0x04)\\n        }\\n    }\\n\\n    function revertCustomErrorWithParameterByYul() external {\\n        bytes4 errorSelector = CustomErrorWithParameter.selector;\\n\\n        assembly {\\n            mstore(0x40, errorSelector)\\n            mstore(add(0x40, 4), 1) // param uint256 value 1 padded to 32 bytes\\n            revert(0x40, 36)\\n        }\\n    }\\n}\\n```\\n\\n\uc704\uc758 \uc608\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c\ub294 \ud30c\ub77c\ubbf8\ud130\uac00 \uc5c6\ub294 \uacbd\uc6b0\uc640 \uc874\uc7ac\ud558\ub294 \uacbd\uc6b0\uc758 `error` \ub97c \uc815\uc758\ud55c \ud6c4\uc5d0 \ud574\ub2f9 \uc5d0\ub7ec\ub4e4\uc744 \ubc1c\uc0dd\uc2dc\ud0a4\ub294 \ud568\uc218\ub97c \uac01\uac01 \uc791\uc131\ud558\uc600\ub2e4.\\n\\n```ts\\ndescribe(\\"Revert Test\\", () => {\\n  let revert: Contract;\\n\\n  before(async () => {\\n    const Revert = await ethers.getContractFactory(\\"Revert\\");\\n    revert = await Revert.deploy();\\n    await revert.deployed();\\n  });\\n\\n  describe(\\"Custom Error\\", () => {\\n    it(\\"Revert Custom Error\\", async () => {\\n      try {\\n        await revert.revertCustomError();\\n\\n        console.log(\\"success\\");\\n      } catch (error: any) {\\n        console.log(\\"revert custom error:\\", decodeErrorData(error.data));\\n      }\\n    });\\n\\n    it(\\"Revert Custom Error With Parameter\\", async () => {\\n      try {\\n        await revert.revertCustomErrorWithParameter();\\n\\n        console.log(\\"success\\");\\n      } catch (error: any) {\\n        console.log(\\n          \\"revert custom error with parameter:\\",\\n          decodeErrorData(error.data)\\n        );\\n      }\\n    });\\n\\n    it(\\"Revert Custom Error By Yul\\", async () => {\\n      try {\\n        await revert.revertCustomErrorByYul();\\n\\n        console.log(\\"success\\");\\n      } catch (error: any) {\\n        console.log(\\"revert custom error by yul:\\", decodeErrorData(error.data));\\n      }\\n    });\\n\\n    it(\\"Revert Custom Error With Parameter By Yul\\", async () => {\\n      try {\\n        await revert.revertCustomErrorWithParameterByYul();\\n\\n        console.log(\\"success\\");\\n      } catch (error: any) {\\n        console.log(\\"revert custom error by yul:\\", decodeErrorData(error.data));\\n      }\\n    });\\n  });\\n});\\n```\\n\\n\uc704\uc758 \ud14c\uc2a4\ud2b8 \ucf54\ub4dc\ub97c \uc2e4\ud589\ud588\uc744 \ub54c \uc544\ub798\uc640 \uac19\uc740 \uacb0\uacfc\uac00 \ub098\uc654\ub2e4.\\n\\n```shell\\n    Custom Error\\nrevert custom error: { kind: \'Custom\', id: \'0x09caebf3\', name: \'CustomError\', data: [] }\\n      \u2714 Revert Custom Error\\nrevert custom error with parameter: {\\n  kind: \'Custom\',\\n  id: \'0x241d671b\',\\n  name: \'CustomErrorWithParameter\',\\n  data: [ BigNumber { value: \\"1\\" }, param: BigNumber { value: \\"1\\" } ]\\n}\\n      \u2714 Revert Custom Error With Parameter\\nrevert custom error by yul: { kind: \'Custom\', id: \'0x09caebf3\', name: \'CustomError\', data: [] }\\n      \u2714 Revert Custom Error By Yul\\nrevert custom error by yul: {\\n  kind: \'Custom\',\\n  id: \'0x241d671b\',\\n  name: \'CustomErrorWithParameter\',\\n  data: [ BigNumber { value: \\"1\\" }, param: BigNumber { value: \\"1\\" } ]\\n}\\n```\\n\\n\uacb0\uacfc\ub97c \uc0b4\ud3b4\ubcf4\uc558\uc744 \ub54c, \ubc1c\uc0dd\uc2dc\ud0a8 \ucee4\uc2a4\ud140 \uc5d0\ub7ec\uc758 \uc774\ub984\uacfc \ub370\uc774\ud130\uac00 \uc791\uc131\ub41c \ucee8\ud2b8\ub799\ud2b8\uc758 \ucf54\ub4dc\uc640 \ub3d9\uc77c\ud558\uac8c \ub514\ucf54\ub529\ub418\uc5b4 \ub098\uc624\ub294 \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n\\n<hr />\\n\\n\uc5ec\uae30\uae4c\uc9c0 \uc0b4\ud3b4\ubd24\uc744 \ub54c, \ucee4\uc2a4\ud140 \uc5d0\ub7ec\uc5d0 \ub300\ud55c \ud5e8\ub4e4\ub9c1\uc740 `assert`, `revert`, `require` \uc5d0 \ub300\ud55c \ud5e8\ub4e4\ub9c1\uacfc \ube44\uad50\ud588\uc744 \ub54c \ub2e4\ub978 \uc810 \ud55c \uac00\uc9c0\ub97c \ubc1c\uacac\ud560 \uc218 \uc788\ub2e4.\\n\\n\uae30\ubcf8\uc801\uc73c\ub85c `assert`\ub294 `Panic(uint256)` \uc720\ud615, `revert` \uc640 `require` \ub294 `Error(string)` \uc758 \uc720\ud615\uc73c\ub85c \uc778\ucf54\ub529 \ub418\uc5b4 \ubc18\ud658\ub41c\ub2e4. \ub54c\ubb38\uc5d0 \ud574\ub2f9 \uc5d0\ub7ec\ub4e4\uc758 \uc778\ud130\ud398\uc774\uc2a4\ub294 \ub2ec\ub77c\uc9c0\ub294 \uacbd\uc6b0 \uc5c6\uc774 \uace0\uc815\ub418\uc5b4\uc788\ub2e4. A \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c\ub4e0 B \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c\ub294 `revert(\\"message\\")` \ub85c \uc608\uc678\ub97c \ubc1c\uc0dd\uc2dc\ucf30\ub2e4\uba74 \uc815\ud574\uc9c4 `Error(string)` \uc720\ud615\uc5d0 \ub530\ub77c \uc778\ucf54\ub529\ub418\uc5b4 \ubc18\ud658\ub41c\ub2e4.\\n\\n\ud558\uc9c0\ub9cc \ucee4\uc2a4\ud140 \uc5d0\ub7ec\ub294 \ucee8\ud2b8\ub799\ud2b8 \uc791\uc131\uc790\uac00 \uc815\uc758\ud55c `error` \uc720\ud615\uc5d0 \ub530\ub77c \ub370\uc774\ud130\uac00 \uc778\ucf54\ub529\ub41c\ub2e4. \ub530\ub77c\uc11c \uc815\uc758\ub41c \uc778\ud130\ud398\uc774\uc2a4 \uc815\ubcf4\ub97c \uac16\uace0 \uc788\uc9c0 \uc54a\ub2e4\uba74 \ucee4\uc2a4\ud140 \uc5d0\ub7ec\ub85c \ubc18\ud658\ub41c \uc5d0\ub7ec \ub370\uc774\ud130\ub97c \uc678\ubd80\uc5d0\uc11c \ub514\ucf54\ub529\ud560 \uc218 \uc5c6\ub2e4. \uc678\ubd80\uc5d0\uc11c \ucee8\ud2b8\ub799\ud2b8\uc640 \uc0c1\ud638\uc791\uc6a9\ud558\ub294 \ubc29\uc2dd\uc740 \uae30\ubcf8\uc801\uc73c\ub85c ABI\ub97c \ud1b5\ud574 \uc774\ub8e8\uc5b4\uc9c0\uae30 \ub54c\ubb38\uc5d0 \uc6b0\ub9ac\ub294 ABI\ub85c \uc81c\uacf5\ub418\uc9c0 \uc54a\uc740 \ucee8\ud2b8\ub799\ud2b8\uc758 \ud568\uc218 \ubc0f \ub370\uc774\ud130\ub97c \uc2dd\ubcc4\ud560 \uc218 \uc5c6\ub2e4.\\n(\uc5ec\ud0dc\uae4c\uc9c0 \uc791\uc131\ub41c \ub514\ucf54\ub529 \ud568\uc218\ub4e4\uc758 \uae30\ubcf8\uc801\uc778 \ud750\ub984\uc744 \ub5a0\uc62c\ub824\ubcf4\uc790. \uc6b0\ub9ac\ub294 \uc678\ubd80\uc5d0\uc11c `Panic(uint256)`, `Error(string)`, `CustomError()` \uc640 \uac19\uc740 \uc778\ud130\ud398\uc774\uc2a4\ub97c \ubbf8\ub9ac \uc815\uc758\ud574\ub450\uace0, \ucee8\ud2b8\ub799\ud2b8 \ub0b4\ubd80\uc640 \ub3d9\uc77c\ud55c \ubc29\uc2dd\uc73c\ub85c \uc778\ucf54\ub529\ub41c \ub370\uc774\ud130\ub97c \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c \ubc18\ud658\ub41c \ub370\uc774\ud130\uc640 \ube44\uad50\ud558\ub294 \ubc29\uc2dd\uc744 \uc0ac\uc6a9\ud588\ub2e4.)\\n\\n\ubb3c\ub860 `ethers` \uc640 \uac19\uc740 \ub77c\uc774\ube0c\ub7ec\ub9ac\ub97c \uc0ac\uc6a9\ud588\uc744 \ub54c \ud574\ub2f9 \ucee8\ud2b8\ub799\ud2b8\uc758 ABI\ub85c \uc778\uc2a4\ud134\uc2a4\ub97c \uc0dd\uc131\ud558\uba74 \uae30\ubcf8\uc801\uc73c\ub85c \ucee4\uc2a4\ud140 \uc5d0\ub7ec\uc5d0 \ub300\ud55c \uc778\ud130\ud398\uc774\uc2a4\ub3c4 \ud3ec\ud568\ub418\uc5b4\uc788\uc744 \uac83\uc774\ub2e4. \ud558\uc9c0\ub9cc \ud574\ub2f9 \ucee8\ud2b8\ub799\ud2b8 \ud568\uc218 \uc548\uc5d0\uc11c \uc678\ubd80\uc758 \ucee8\ud2b8\ub799\ud2b8 \ud568\uc218\ub97c \ud638\ucd9c\ud588\uc744 \ub54c \uc678\ubd80 \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c \ucee4\uc2a4\ud140 \uc5d0\ub7ec\ub97c \ud1b5\ud574 \uc608\uc678\uac00 \ubc1c\uc0dd\ud588\ub2e4\uba74, \uc6b0\ub9ac\uc758 \ucee8\ud2b8\ub799\ud2b8 ABI \uc548\uc5d0 \ud574\ub2f9 \ucee4\uc2a4\ud140 \uc5d0\ub7ec \uc778\ud130\ud398\uc774\uc2a4\uae4c\uc9c0 \ud3ec\ud568\ub418\uc5b4\uc788\uc744 \uacbd\uc6b0\ub294 \ub4dc\ubb3c\uae30 \ub54c\ubb38\uc5d0 \ud574\ub2f9 \uc5d0\ub7ec \uc815\ubcf4\ub97c \ud30c\uc545\ud558\ub294\ub370 \uc5b4\ub824\uc6c0\uc774 \uc0dd\uae34\ub2e4.\\n\\n\ub530\ub77c\uc11c \ucee4\uc2a4\ud140 \uc5d0\ub7ec\uc5d0 \ub300\ud55c \uc880 \ub354 \uc6d0\ud65c\ud55c \ud5e8\ub4e4\ub9c1\uc744 \uc704\ud574\uc11c\ub294 \uc791\uc131\ud55c \ucee8\ud2b8\ub799\ud2b8 \uc548\uc5d0\uc11c \uc0c1\ud638\uc791\uc6a9\ud558\ub294 \ucee8\ud2b8\ub799\ud2b8\ub4e4\uc5d0 \ub300\ud55c \ud3ec\uad04\uc801\uc778 `error` \uc778\ud130\ud398\uc774\uc2a4 \uc815\ubcf4\ub97c \uad6c\ucd95\ud558\ub294 \uac83\uc774 \ud544\uc694\ud558\ub2e4. \ubcf4\ud1b5 \ud68c\uc0ac\uc5d0\uc11c \ub514\uc571\uc744 \uad6c\ucd95\ud558\ub294 \uc0c1\ud669\uc5d0\uc11c\ub294 \ud300\uc5d0\uc11c \uc9c1\uc811 \uc791\uc131\ud55c \uc5ec\ub7ec \ucee8\ud2b8\ub799\ud2b8\uac00 \uc0c1\ud638\uc791\uc6a9\ud558\ub294 \uacbd\uc6b0\uac00 \ub9ce\uae30 \ub54c\ubb38\uc5d0, \ud300\uc5d0\uc11c \uc791\uc131\ud55c \ubaa8\ub4e0 \ucee8\ud2b8\ub799\ud2b8\uc758 `error` \uc778\ud130\ud398\uc774\uc2a4 \uc815\ubcf4\ub97c \uae30\ubc18\uc73c\ub85c \ub514\ucf54\ub529 \ud568\uc218\ub97c \uc791\uc131\ud558\ub294 \uac83\uc774 \ud6a8\uc728\uc801\uc774\ub2e4.\\n\\n(* \ub610\ud55c \uc774 \uc9c0\uc810\uc5d0\uc11c \ud55c \uac00\uc9c0 \uc720\uc758\ud574\uc57c\ud560 \uc9c0\uc810\uc740, \ubc18\ud658\ub41c \uc5d0\ub7ec \ub370\uc774\ud130\ub85c\ub294 \ud574\ub2f9 \uc5d0\ub7ec \ub370\uc774\ud130\uc758 \ucd9c\ucc98\uac00 \ucd94\uc801\ub418\uc9c0 \uc54a\ub294\ub2e4\ub294 \uc810\uc774\ub2e4. \ub530\ub77c\uc11c \uc678\ubd80\uc758 \ucee8\ud2b8\ub799\ud2b8 \ud568\uc218\ub97c \ud638\ucd9c\ud588\uc744 \ub54c, \ud574\ub2f9 \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c \ub3d9\uc77c\ud55c \ucee4\uc2a4\ud140 \uc5d0\ub7ec \uc2dc\uadf8\ub2c8\ucc98\ub97c \uc704\uc870\ud558\uc5ec \ubc18\ud658\ud568\uc73c\ub85c\uc368 \uc5d0\ub7ec \uc0c1\ud669\uc744 \uc704\uc870\ud560 \uc218 \uc788\ub2e4. \ub54c\ubb38\uc5d0 \ud074\ub77c\uc774\uc5b8\ud2b8 \uc785\uc7a5\uc5d0\uc11c \ud638\ucd9c\ud55c \ucee8\ud2b8\ub799\ud2b8 \ud568\uc218 \uc548\uc5d0 \uac80\uc99d\ub418\uc9c0 \uc54a\ub294 \uc678\ubd80 \ucee8\ud2b8\ub799\ud2b8 \ud568\uc218\ub97c \ud638\ucd9c\ud558\ub294 \ub85c\uc9c1\uc774 \ud3ec\ud568\ub418\uc5b4\uc788\ub2e4\uba74 \ubbf8\ub9ac \uc815\uc758\ub41c `error` \uc2dc\uadf8\ub2c8\ucc98\ub97c \uc5d0\ub7ec\ub85c \ubc18\ud658\ud558\ub354\ub77c\ub3c4 \ud574\ub2f9 \ub370\uc774\ud130\ub97c \uc644\uc804\ud788 \uc2e0\ub8b0\ud558\uc5ec \uc5d0\ub7ec \uc0c1\ud669\uc744 \uc720\ucd94\ud574\uc11c\ub294 \uc548 \ub41c\ub2e4.)\\n\\n```ts\\nimport { Interface } from \\"ethers/lib/utils\\";\\n\\nexport const getErrorData = (contractInterfaces: Interface[]) => {\\n  const errorData = {} as any;\\n\\n  for (let i = 0; i < contractInterfaces.length; i++) {\\n    for (const [signature, value] of Object.entries(\\n      contractInterfaces[i].errors\\n    )) {\\n      const id = ethers.utils.id(signature).slice(0, 10);\\n      if (!errorData[id]) {\\n        errorData[id] = value.name;\\n      }\\n    }\\n  }\\n\\n  return errorData;\\n};\\n```\\n\\n\ub098\uc758 \uacbd\uc6b0\uc5d0\ub294 \ud604\uc7ac \ud504\ub85c\uc81d\ud2b8\uc5d0\uc11c \ud30c\ub77c\ubbf8\ud130\ub97c \ud3ec\ud568\ud558\ub294 \ucee4\uc2a4\ud140 \uc5d0\ub7ec\ub97c \uc0ac\uc6a9\ud558\uace0 \uc788\uc9c0 \uc54a\uae30 \ub54c\ubb38\uc5d0, \uc704\uc758 \ud568\uc218\uc5d0\uc11c\ucc98\ub7fc \ucee8\ud2b8\ub799\ud2b8 \uc778\ud130\ud398\uc774\uc2a4 \ubc30\uc5f4\uc744 \ub123\uc5b4\uc8fc\uba74 \ubaa8\ub4e0 `error` \uc758 \uc2dc\uadf8\ub2c8\ucc98 \uac12\uc744 key \uac12\uc73c\ub85c \uac16\uace0 `error` \uc774\ub984\uc744 value \uac16\ub294 object\ub97c \uc0dd\uc131\ud574\uc8fc\ub294 \ud568\uc218\ub97c \ub9cc\ub4e4\uc5b4\uc11c \uc0ac\uc6a9\uc911\uc774\ub2e4.\\n\\n\ucee8\ud2b8\ub799\ud2b8\ub97c \ubc30\ud3ec\ud55c \uc774\ud6c4\uc5d0 \uc704 \ud568\uc218\ub97c \ud1b5\ud574 \ud504\ub85c\uc81d\ud2b8\uc5d0\uc11c \uc0ac\uc6a9\ud558\ub294 \ubaa8\ub4e0 \ucee8\ud2b8\ub799\ud2b8\uc5d0 \ub300\ud55c \ucee4\uc2a4\ud140 \uc5d0\ub7ec \uc815\ubcf4\ub97c \uac16\uace0 \uc788\ub294 object\ub97c \uc0dd\uc131\ud558\ub294 \uac83\uc774\ub2e4.\\n\\n```ts\\nconst CustomErrorData = {\\n  \'0x00bfc921\': \'InvalidPrice\',\\n  \'0x0c5317cc\': \'AlreadyExistTokenContract\',\\n   // ...\\n  \'0x3f6cc768\': \'InvalidTokenId\',\\n  \'0xb7d09497\': \'InvalidTimestamp\',\\n  \'0xba83c474\': \'DuplicateAccount\',\\n};\\n\\nconst customErrorName = CustomErrorData[errorData.slice(0, 10)];\\n```\\n\\n\uadf8\ub9ac\uace0 \uc704\uc758 \ucf54\ub4dc\uc5d0\uc11c\ucc98\ub7fc \ucee8\ud2b8\ub799\ud2b8 \ud638\ucd9c\uc774 \ud544\uc694\ud55c \ubc31\uc5d4\ub4dc \ubc0f \ud504\ub860\ud2b8\uc5d0\uc11c \ud574\ub2f9 object\ub97c \uae30\ubc18\uc73c\ub85c \ucee4\uc2a4\ud140 \uc5d0\ub7ec\uba85\uc744 \uc2dd\ubcc4\ud558\ub294 \ubc29\uc2dd\uc744 \uc0ac\uc6a9\ud558\uace0 \uc788\ub2e4. \ud604\uc7ac \ud504\ub85c\uc81d\ud2b8 \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c \ubc1c\uc0dd\uc2dc\ud0a4\ub294 \uc608\uc678\ub294 \ubaa8\ub450 \ucee4\uc2a4\ud140 \uc5d0\ub7ec\ub97c \uc0ac\uc6a9\ud558\uace0 \uc788\uae30 \ub54c\ubb38\uc5d0 \uc774 \ubc29\uc2dd\uc744 \uc0ac\uc6a9\ud558\uba74 \uc790\uccb4\uc801\uc73c\ub85c \ubc1c\uc0dd\uc2dc\ud0a8 \ub300\ubd80\ubd84\uc758 \uc608\uc678\uc5d0 \ub300\ud574\uc11c\ub294 \uc678\ubd80\uc5d0\uc11c\ub3c4 \ud3b8\ub9ac\ud558\uac8c \uc2dd\ubcc4\uc774 \uac00\ub2a5\ud558\ub2e4.\\n\\n## \uc815\ub9ac\\n\\n\uc774\uc81c \ub9c8\uc9c0\ub9c9\uc73c\ub85c \uc5d0\ub7ec \uc885\ub958\uc5d0 \ub530\ub77c \ubd84\ub9ac\ub418\uc5b4\uc788\ub358 \ub514\ucf54\ub529 \ud568\uc218\ub97c \ud558\ub098\uc758 \ud568\uc218\ub85c \ud569\uccd0\ubcf4\uc790.\\n\\n```ts\\nimport { AssertionError } from \\"assert\\";\\nimport { ethers, BigNumber } from \\"ethers\\";\\nimport { defaultAbiCoder } from \\"ethers/lib/utils\\";\\n\\n// method id of \'Error(string)\'\\nconst ERROR_STRING_PREFIX = \\"0x08c379a0\\";\\n// method id of \'Panic(uint256)\'\\nconst PANIC_CODE_PREFIX = \\"0x4e487b71\\";\\nconst UNKNOWN_ERROR = \\"Unknown Error\\";\\n\\nconst panicErrorCodeToReason = (errorCode: BigNumber): string | undefined => {\\n  switch (errorCode.toNumber()) {\\n    case 0x1:\\n      return \\"Assertion error\\";\\n    case 0x11:\\n      return \\"Arithmetic operation underflowed or overflowed outside of an unchecked block\\";\\n    case 0x12:\\n      return \\"Division or modulo division by zero\\";\\n    case 0x21:\\n      return \\"Tried to convert a value into an enum, but the value was too big or negative\\";\\n    case 0x22:\\n      return \\"Incorrectly encoded storage byte array\\";\\n    case 0x31:\\n      return \\".pop() was called on an empty array\\";\\n    case 0x32:\\n      return \\"Array accessed at an out-of-bounds or negative index\\";\\n    case 0x41:\\n      return \\"Too much memory was allocated, or an array was created that is too large\\";\\n    case 0x51:\\n      return \\"Called a zero-initialized variable of internal function type\\";\\n  }\\n};\\n\\nconst CustomErrorData = {\\n  \'0x00bfc921\': \'InvalidPrice\',\\n  \'0x0c5317cc\': \'AlreadyExistTokenContract\',\\n   // ...\\n  \'0x3f6cc768\': \'InvalidTokenId\',\\n  \'0xb7d09497\': \'InvalidTimestamp\',\\n  \'0xba83c474\': \'DuplicateAccount\',\\n};\\n\\nconst decodeErrorData = (error: any): string => {\\n     if (!(error instanceof Error)) {\\n      return UNKNOWN_ERROR;\\n    }\\n\\n    error = error as any;\\n\\n    if (error.errorName) {\\n      return error.errorName;\\n    }\\n\\n    const errorData =\\n      error.data ?? error.error?.data ?? error.error?.error?.error?.data;\\n\\n    if (errorData === undefined) {\\n      return error.message ? error.message : UNKNOWN_ERROR;\\n    }\\n\\n    const returnData =\\n      typeof errorData === \'string\' ? errorData : errorData.data;\\n\\n    if (returnData === undefined || typeof returnData !== \'string\') {\\n      return UNKNOWN_ERROR;\\n    } else if (returnData === \'0x\') {\\n      return UNKNOWN_ERROR;\\n    } else if (returnData.startsWith(ERROR_STRING_PREFIX)) {\\n      const encodedReason = returnData.slice(ERROR_STRING_PREFIX.length);\\n      let reason: string;\\n\\n      try {\\n        reason = defaultAbiCoder.decode([\'string\'], `0x${encodedReason}`)[0];\\n      } catch (err) {\\n        return UNKNOWN_ERROR;\\n      }\\n\\n      return reason;\\n    } else if (returnData.startsWith(PANIC_CODE_PREFIX)) {\\n      const encodedReason = returnData.slice(PANIC_CODE_PREFIX.length);\\n      let code: BigNumber;\\n\\n      try {\\n        code = defaultAbiCoder.decode([\'uint256\'], `0x${encodedReason}`)[0];\\n      } catch (err) {\\n        return UNKNOWN_ERROR;\\n      }\\n\\n      return (\\n        panicErrorCodeToReason(code) ?? \'unknown panic code\'\\n      );\\n    }\\n\\n    const customErrorName = CumstomErrorData[returnData.slice(0, 10)];\\n\\n    if (customErrorName === undefined) {\\n      return UNKNOWN_ERROR;\\n    }\\n    return customErrorName;\\n  }\\n};\\n```\\n\\n`decodeErrorData()` \ud568\uc218\ub294 `ethers` \ub97c \ud1b5\ud574 \ucee8\ud2b8\ub799\ud2b8 \ud568\uc218 \ud638\ucd9c\uc2dc \uc5d0\ub7ec\uac00 \ubc1c\uc0dd\ud588\uc744 \ub54c, \ubc18\ud658\ub41c \uc5d0\ub7ec\ub97c \uc778\uc790\ub85c \ubc1b\ub294\ub2e4. 1\ucc28\uc801\uc73c\ub85c `error.errorName` \uc5d0 \uac12\uc774 \uc788\ub2e4\uba74 ethers \uc790\uccb4\uc5d0\uc11c \uc774\ubbf8 \ub514\ucf54\ub529\ub41c \uc5d0\ub7ec \uc815\ubcf4\uac00 \uc874\uc7ac\ud558\ub294 \uac83\uc774\uae30 \ub54c\ubb38\uc5d0 \uadf8\ub300\ub85c \ub9ac\ud134\ud55c\ub2e4.\\n\\n\ub9cc\uc57d `errorName` \uc774 \uc874\uc7ac\ud558\uc9c0 \uc54a\ub294\ub2e4\uba74 \ub514\ucf54\ub529\ud560 \uc5d0\ub7ec \ub370\uc774\ud130\ub97c \ucd94\ucd9c\ud558\uace0, \uc5d0\ub7ec \ub370\uc774\ud130\uac00 \uc5c6\ub2e4\uba74 `error.message` \ud639\uc740 `UNKNOWN_ERROR` \ub97c \ub9ac\ud134\ud55c\ub2e4.\\n\\n\uc5d0\ub7ec \ub370\uc774\ud130\ub97c \ucd94\ucd9c\ud55c \uc774\ud6c4\ubd80\ud130\ub294 `Error(string)`, `Panic(uint256)` \uc720\ud615\uc5d0 \ud574\ub2f9\ud558\ub294\uc9c0\uc5d0 \ub530\ub77c Revert, Require, Assert \uc5d0\ub7ec\uc5d0 \ub9de\uac8c \ub370\uc774\ud130\ub97c \ub514\ucf54\ub529\ud558\uba70 \uc704 \uc720\ud615\ub4e4\uc5d0 \ud574\ub2f9\ud558\uc9c0 \uc54a\ub294\ub2e4\uba74 \ub9c8\uc9c0\ub9c9\uc73c\ub85c \ucee4\uc2a4\ud140 \uc5d0\ub7ec\uc778\uc9c0\ub97c \ud655\uc778\ud55c\ub2e4.\\n\\n<hr />\\n\\n\uc774\ub807\uac8c \ucee8\ud2b8\ub799\ud2b8 \ub0b4\ubd80\uc5d0\uc11c \ubc1c\uc0dd\ub418\ub294 \uc5d0\ub7ec\uc758 \uc885\ub958\uc640 \ud2b9\uc9d5\ub4e4\uc5d0 \ub300\ud574 \uc54c\uc544\ubcf4\uace0, \uc5d0\ub7ec \uc885\ub958\uc5d0 \ub530\ub77c \uc678\ubd80\uc5d0\uc11c \uc2dd\ubcc4\ud558\ub294 \ubc29\uc2dd\uc744 \uc0b4\ud3b4\ubcf4\uc558\ub2e4. \uc5d0\ub7ec\uc5d0 \uad00\ud55c \ub370\uc774\ud130 \ub610\ud55c \uae30\ubcf8\uc801\uc73c\ub85c ABI \uc2a4\ud399\uc744 \uae30\uc900\uc73c\ub85c \uc774\ub8e8\uc5b4\uc9c0\uae30 \ub54c\ubb38\uc5d0, \ucee8\ud2b8\ub799\ud2b8 \ub0b4\ubd80\uc758 \uc5d0\ub7ec \uc0c1\ud669\uc744 \uc678\ubd80\uc5d0\uc11c \uc6d0\ud65c\ud558\uac8c \ud30c\uc545\ud558\uae30 \uc704\ud574\uc11c\ub294 \uc5ed\uc2dc \ucee8\ud2b8\ub799\ud2b8 \ub0b4\uc5d0\uc11c \ud574\ub2f9 \uc5d0\ub7ec\uac00 \ubc1c\uc0dd\ub418\ub294 \uacfc\uc815\uacfc \ub370\uc774\ud130\uac00 \uc778\ucf54\ub529\ub418\ub294 \ubc29\uc2dd\uc774 \uc911\uc694\ud558\uac8c \uace0\ub824\ub3fc\uc57c \ud55c\ub2e4.\\n\\n\uae00\uc5d0\uc11c \uc5b8\uae09\ub41c \uc608\uc2dc\ucf54\ub4dc\ub294 [\ub9c1\ud06c](https://github.com/chihunmanse/solidity-error-handling)\ub85c \ub4e4\uc5b4\uac00\uba74 \ubcfc \uc218 \uc788\uace0, \uc9c1\uc811 \ud14c\uc2a4\ud2b8 \uacb0\uacfc\ub97c \ud655\uc778\ud574\ubcfc \uc218 \uc788\ub2e4."},{"id":"/2022/06/20/blockchain/upgradeable-contract2","metadata":{"permalink":"/2022/06/20/blockchain/upgradeable-contract2","source":"@site/blog/blockchain/2022-06-20-upgradeable-contract2.mdx","title":"Upgradeable Contract 2 - ERC1967, TransparentProxy, UUPS","description":"writing upgradeable contract with solidity.","date":"2022-06-20T00:00:00.000Z","formattedDate":"June 20, 2022","tags":[{"label":"BlockChain","permalink":"/tags/block-chain"},{"label":"Solidity","permalink":"/tags/solidity"}],"readingTime":48.08,"hasTruncateMarker":true,"authors":[{"name":"Chihun Park","url":"https://github.com/chihunmanse","email":"chihunmanse@gmail.com","imageURL":"https://p.ipic.vip/o1ih3g.png","key":"chihun"}],"frontMatter":{"title":"Upgradeable Contract 2 - ERC1967, TransparentProxy, UUPS","description":"writing upgradeable contract with solidity.","keywords":["solidity","ethereum","contract","blockchain","ERC1967","TransparentProxy","UUPS"],"tags":["BlockChain","Solidity"],"authors":"chihun"},"prevItem":{"title":"Contract Error Handling","permalink":"/2023/09/10/blockchain/contract-errorhandling"},"nextItem":{"title":"Upgradeable Contract 1 - Migration, DelegateCall","permalink":"/2022/06/10/blockchain/upgradeable-contract1"}},"content":"import Tabs from \\"@theme/Tabs\\";\\nimport TabItem from \\"@theme/TabItem\\";\\n\\n[\uc774\uc804 \uae00](./2022-06-10-upgradeable-contract1.mdx)\uc5d0 \uc774\uc5b4\uc11c \ud504\ub85d\uc2dc \ud328\ud134\uc5d0 \ub300\ud574 \ubcf8\uaca9\uc801\uc73c\ub85c \uc0b4\ud3b4\ubcf4\ub824\uace0 \ud55c\ub2e4.\\n\\n\ud504\ub85d\uc2dc \ud328\ud134\uc740 \uae30\ubcf8\uc801\uc73c\ub85c delegatecall \uacfc fallback \ud568\uc218\uc758 \uc870\ud569\uc744 \ud1b5\ud574 \uad6c\ud604\ub41c\ub2e4.\\n\\n### fallback \ud568\uc218\\n\\nfallback \ud568\uc218\ub780 \ucee8\ud2b8\ub799\ud2b8\uc5d0 \uc874\uc7ac\ud558\uc9c0 \uc54a\ub294 \ud568\uc218\uac00 \ud638\ucd9c\ub418\uc5c8\uc744 \uacbd\uc6b0 \ub300\uc2e0\ud574\uc11c \ud638\ucd9c\ub418\ub294 \ud568\uc218\uc774\ub2e4.\\n\\n0.6 \uc774\uc804\uc758 fallback \ud568\uc218\\n\\n```sol\\nfunction() external payable {}\\n```\\n\\n0.6 \uc774\ud6c4\uc758 fallback \ud568\uc218\\n\\n- fallback : \ud638\ucd9c\ub41c \ud568\uc218\uac00 \ucee8\ud2b8\ub799\ud2b8\uc5d0 \uc874\uc7ac\ud558\uc9c0 \uc54a\uc744\ub54c \uc791\ub3d9\ud558\ub294 \ud568\uc218\\n- receive : calldata \uc5c6\uc774 \ucee8\ud2b8\ub799\ud2b8\uc5d0 \uc774\ub354\uac00 \uc804\uc1a1\ub410\uc744 \ub54c \uc791\ub3d9\ud558\ub294 \ud568\uc218\\n\\n```sol\\nfallback() external payable {}\\nreceive() external payable {}\\n```\\n\\n\x3c!--truncate--\x3e\\n\\n<hr />\\n\\n\uc624\ud508\uc7ac\ud50c\ub9b0\uc758 ERC1967Proxy, TransparentProxy, UUPS \ub4f1 \ud504\ub85d\uc2dc \ud328\ud134\uc744 \uad6c\ud604\ud55c \uc5ec\ub7ec \ubc29\uc2dd\ub4e4\uc740 \ubaa8\ub450 Proxy \ucd94\uc0c1 \ucee8\ud2b8\ub799\ud2b8\ub97c \uae30\ubc18\uc73c\ub85c \uad6c\ud604\ub418\uc5b4\uc788\ub2e4.\\n\\n```sol title=\\"openzeppelin-contracts/contracts/proxy/Proxy.sol\\"\\n// SPDX-License-Identifier: MIT\\n// OpenZeppelin Contracts (last updated v4.6.0) (proxy/Proxy.sol)\\n\\npragma solidity ^0.8.0;\\n\\n/**\\n * @dev This abstract contract provides a fallback function that delegates all calls to another contract using the EVM\\n * instruction `delegatecall`. We refer to the second contract as the _implementation_ behind the proxy, and it has to\\n * be specified by overriding the virtual {_implementation} function.\\n *\\n * Additionally, delegation to the implementation can be triggered manually through the {_fallback} function, or to a\\n * different contract through the {_delegate} function.\\n *\\n * The success and return data of the delegated call will be returned back to the caller of the proxy.\\n */\\nabstract contract Proxy {\\n    /**\\n     * @dev Delegates the current call to `implementation`.\\n     *\\n     * This function does not return to its internal call site, it will return directly to the external caller.\\n     */\\n    function _delegate(address implementation) internal virtual {\\n        assembly {\\n            // Copy msg.data. We take full control of memory in this inline assembly\\n            // block because it will not return to Solidity code. We overwrite the\\n            // Solidity scratch pad at memory position 0.\\n            calldatacopy(0, 0, calldatasize())\\n\\n            // Call the implementation.\\n            // out and outsize are 0 because we don\'t know the size yet.\\n            let result := delegatecall(gas(), implementation, 0, calldatasize(), 0, 0)\\n\\n            // Copy the returned data.\\n            returndatacopy(0, 0, returndatasize())\\n\\n            switch result\\n            // delegatecall returns 0 on error.\\n            case 0 {\\n                revert(0, returndatasize())\\n            }\\n            default {\\n                return(0, returndatasize())\\n            }\\n        }\\n    }\\n\\n    /**\\n     * @dev This is a virtual function that should be overridden so it returns the address to which the fallback function\\n     * and {_fallback} should delegate.\\n     */\\n    function _implementation() internal view virtual returns (address);\\n\\n    /**\\n     * @dev Delegates the current call to the address returned by `_implementation()`.\\n     *\\n     * This function does not return to its internal call site, it will return directly to the external caller.\\n     */\\n    function _fallback() internal virtual {\\n        _beforeFallback();\\n        _delegate(_implementation());\\n    }\\n\\n    /**\\n     * @dev Fallback function that delegates calls to the address returned by `_implementation()`. Will run if no other\\n     * function in the contract matches the call data.\\n     */\\n    fallback() external payable virtual {\\n        _fallback();\\n    }\\n\\n    /**\\n     * @dev Fallback function that delegates calls to the address returned by `_implementation()`. Will run if call data\\n     * is empty.\\n     */\\n    receive() external payable virtual {\\n        _fallback();\\n    }\\n\\n    /**\\n     * @dev Hook that is called before falling back to the implementation. Can happen as part of a manual `_fallback`\\n     * call, or as part of the Solidity `fallback` or `receive` functions.\\n     *\\n     * If overridden should call `super._beforeFallback()`.\\n     */\\n    function _beforeFallback() internal virtual {}\\n}\\n```\\n\\nProxy \ucee8\ud2b8\ub799\ud2b8\uc758 \ucf54\ub4dc\ub97c \uc0b4\ud3b4\ubcf4\uba74, `_delegate`\ub77c\ub294 \uc778\ub77c\uc778 \uc5b4\uc148\ube14\ub9ac\ub85c \uc801\ud78c \ub0b4\ubd80 \ud568\uc218\uac00 \uc788\uace0, \uc774 \ud568\uc218\ub97c fallback \ud568\uc218\uc640 receive \ud568\uc218\uc5d0\uc11c \ud638\ucd9c\ud558\uace0 \uc788\ub294 \uac83\uc744 \ubcfc \uc218 \uc788\ub2e4. \ud604\uc7ac \uc774 \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c\ub294 \uc678\ubd80\uc5d0\uc11c \ud638\ucd9c\ud560 \uc218 \uc788\ub294 \ud568\uc218\ub97c \ub530\ub85c \ub9cc\ub4e4\uc5b4\ub450\uc9c0 \uc54a\uc558\uae30 \ub54c\ubb38\uc5d0, \uc678\ubd80\uc5d0\uc11c \uc5b4\ub5a4 calldata\ub97c \uac16\uace0 \ud638\ucd9c\ud558\ub354\ub77c\ub3c4 \uc2e4\ud589\ub418\ub294 \uac83\uc740 fallback \ud568\uc218, \uc989 `_beforeFallback`\uacfc `_delegate` \ub450 \ud568\uc218\uac00 \uc2e4\ud589\ub420 \uac83\uc774\ub2e4.\\n\\n`_delegate` \ud568\uc218\uc5d0\ub294 \ud2b8\ub79c\uc7ad\uc158\uc5d0 \ub2f4\uae34 calldata\ub97c \ud1b5\ud558\uc5ec `_implementation`(\uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8 \uc8fc\uc18c)\uc5d0 delegatecall\uc744 \ud558\uace0, \uc131\uacf5\ud588\ub2e4\uba74 return \ub370\uc774\ud130\ub97c \ubc18\ud658\ud558\uace0 \uc2e4\ud328\ud588\ub2e4\uba74 revert \uc2dc\ud0a4\ub294 \ub85c\uc9c1\uc774 \ub2f4\uaca8\uc788\ub2e4.\\n\\n\uc774\uc640 \uac19\uc774 delegatecall\uacfc fallback \ud568\uc218\uc758 \uc870\ud569\uc744 \ud1b5\ud558\uc5ec, \uc774\uc804 \uae00\uc5d0\uc11c\ucc98\ub7fc \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8 \ucabd\uc5d0 \ud568\uc218\ub97c \uc815\uc758\ud560 \ud544\uc694 \uc5c6\uc774, \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8 \ucabd\uc5d0 \uc788\ub294 \ud568\uc218\ub4e4\uc744 \uc720\ub3d9\uc801\uc73c\ub85c \ud638\ucd9c\ud558\ub294 \ubc29\uc2dd\uc774 \uac00\ub2a5\ud574\uc9c4\ub2e4. \uc774 \ubc29\uc2dd\uc744 \uc801\uc6a9\ud558\uba74 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\ub97c \uc5c5\uadf8\ub808\uc774\ub4dc\ud558\ub294 \uacbd\uc6b0\uc5d0 \ud568\uc218\uba85\uacfc \uc778\uc790, return \ub418\ub294 \ub370\uc774\ud130\uae4c\uc9c0 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc5d0 \uc5bd\ub9e4\uc774\uc9c0 \uc54a\uace0 \uc218\uc815\ud560 \uc218 \uc788\uac8c \ub41c\ub2e4.\\n\\n## ERC1967\\n\\n\ud558\uc9c0\ub9cc \uc774\uc804 \uae00\uc5d0\uc11c \uc0b4\ud3b4\ubcf4\uc558\ub4ef\uc774, delegatecall\uc744 \uc0ac\uc6a9\ud560 \ub54c \uc2a4\ud1a0\ub9ac\uc9c0\ucda9\ub3cc\uc774 \ubc1c\uc0dd\ud560 \uc218 \uc788\ub2e4\ub294 \ubb38\uc81c\ub294 \uc5ec\uc804\ud788 \ud574\uacb0\ub418\uc9c0 \uc54a\uc740 \ucc44\ub85c \ub0a8\uc544\uc788\ub2e4.\\n\\n\ud2b9\ud788 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\ub294 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc5d0 \ub2f4\uae34 \ub85c\uc9c1\uc744 \ud638\ucd9c\ud558\uae30 \uc704\ud574 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc758 \uc8fc\uc18c\uac12\uc774 \uaf2d \ud544\uc694\ud55c\ub370, \uc774 \uc8fc\uc18c\uac12\uc774 \ub2f4\uae34 \ubcc0\uc218\uac00 \ucda9\ub3cc\ud558\uc5ec \uc608\uc0c1\uce58 \ubabb\ud55c \uac12\uc73c\ub85c \ubcc0\uacbd\ub41c\ub2e4\uba74 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uac00 \uc81c\ub300\ub85c \ub3d9\uc791\ud558\uc9c0 \ubabb\ud558\uac8c \ub418\ub294 \uc2ec\uac01\ud55c \ubb38\uc81c\ub85c \uc774\uc5b4\uc9c4\ub2e4.\\n\\n\uc774 \ubb38\uc81c\ub97c \ud574\uacb0\ud558\uae30 \uc704\ud574 \uc624\ud508\uc7ac\ud50c\ub9b0\uc5d0\ub294 [ERC1967](https://eips.ethereum.org/EIPS/eip-1967)\uc744 \uae30\ubc18\uc73c\ub85c\ud55c ERC1967\uc774 \uad6c\ud604\ub418\uc5b4\uc788\ub2e4.\\n\\n\ubb38\uc81c\ub97c \ud574\uacb0\ud558\ub294 \uc544\uc774\ub514\uc5b4\ub294 \uc758\uc678\ub85c \uac04\ub2e8\ud558\ub2e4. \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc758 \uc8fc\uc18c\uac00 \uc800\uc7a5\ub418\ub294 \uc2a4\ud1a0\ub9ac\uc9c0 \uc2ac\ub86f\uc758 \uc704\uce58\ub97c \uc784\uc758\ub85c \ubc30\uc815\ud574\uc8fc\ub294 \uac83\uc774\ub2e4.\\n\\n```sol title=\\"openzeppelin-contracts-upgradeable/contracts/proxy/ERC1967/ERC1967UpgradeUpgradeable.sol\\"\\nabstract contract ERC1967UpgradeUpgradeable {\\n    /**\\n     * @dev Storage slot with the address of the current implementation.\\n     * This is the keccak-256 hash of \\"eip1967.proxy.implementation\\" subtracted by 1, and is\\n     * validated in the constructor.\\n     */\\n    bytes32 internal constant _IMPLEMENTATION_SLOT = 0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc;\\n\\n\\n    /**\\n     * @dev Returns the current implementation address.\\n     */\\n    function _getImplementation() internal view returns (address) {\\n        return StorageSlotUpgradeable.getAddressSlot(_IMPLEMENTATION_SLOT).value;\\n    }\\n\\n    /**\\n     * @dev Stores a new address in the EIP1967 implementation slot.\\n     */\\n    function _setImplementation(address newImplementation) private {\\n        require(AddressUpgradeable.isContract(newImplementation), \\"ERC1967: new implementation is not a contract\\");\\n        StorageSlotUpgradeable.getAddressSlot(_IMPLEMENTATION_SLOT).value = newImplementation;\\n    }\\n\\n    /**\\n     * @dev Perform implementation upgrade\\n     *\\n     * Emits an {Upgraded} event.\\n     */\\n    function _upgradeTo(address newImplementation) internal {\\n        _setImplementation(newImplementation);\\n        emit Upgraded(newImplementation);\\n    }\\n}\\n```\\n\\n`_IMPLEMENTATION_SLOT`\uc758 \uac12\uc774 \ub3c4\ucd9c\ub41c \uacfc\uc815\uc740 \u201ceip1967.proxy.implementation\u201d \ub97c \ud574\uc2f1\ud55c \ud6c4\uc5d0 1\uc744 \ube80 \uac12\uc774\ub77c\uace0 \uc8fc\uc11d\uc5d0 \uc124\uba85 \ub418\uc5b4\uc788\ub2e4.\\n\\n\uc774\ud6c4 `_setImplementation` \ud568\uc218\ub098 `_getImplementation` \ud568\uc218\uc5d0\uc11c\ub294 \ud574\ub2f9 \uc2ac\ub86f\uac12\uc744 \ud65c\uc6a9\ud558\uc5ec \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc758 \uc8fc\uc18c\ub97c \uc800\uc7a5\ud558\uac70\ub098 \uc870\ud68c\ud558\ub294 \uac83\uc744 \ubcfc \uc218 \uc788\ub2e4.\\n\\n\uc774\uc804 \uae00\uc5d0\uc11c \uc194\ub9ac\ub514\ud2f0\uc758 \uc2a4\ud1a0\ub9ac\uc9c0 \ub808\uc774\uc544\uc6c3\uc5d0 \ub300\ud574 \uc0b4\ud3b4\ubcfc \ub54c, \ucee8\ud2b8\ub799\ud2b8\uc758 \ubcc0\uc218\ub4e4\uc774 \uc2a4\ud1a0\ub9ac\uc9c0\uc5d0 \ud560\ub2f9\ub418\ub294 \uae30\ubcf8\uc801\uc778 \ubc29\uc2dd\uc740 \uc120\uc5b8\ub418\ub294 \uc21c\uc11c\uc5d0 \ub530\ub77c \uc2ac\ub86f\ub118\ubc84\uac00 \ud560\ub2f9\ub418\ub294 \ubc29\uc2dd\uc774\uba70, \ub9e4\ud551\ud0c0\uc785\uc758 \uacbd\uc6b0 value\uac00 \uc800\uc7a5\ub418\ub294 \ubc29\uc2dd\uc740 \ub9e4\ud551 \ud0c0\uc785 \ubcc0\uc218\uac00 \ucd5c\ucd08\uc5d0 \ud560\ub2f9\ub41c \uc2ac\ub86f\ub118\ubc84\uc640 \ub9e4\ud551\uc758 key\uac12\uc744 \ud568\uaed8 \ud574\uc2f1\ud55c \uc2ac\ub86f\ub118\ubc84\uc5d0 \ud560\ub2f9\ub41c\ub2e4\ub294 \uac83\uc744 \uc54c \uc218 \uc788\uc5c8\ub2e4.\\n\\nERC1967\uc5d0\uc11c \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8 \uc8fc\uc18c\uc758 \uc2a4\ud1a0\ub9ac\uc9c0 \uc2ac\ub86f\ub118\ubc84\ub97c \uc784\uc758\ub85c \uc9c0\uc815\ud558\uc5ec \uc800\uc7a5\ud558\ub294 \ubc29\uc2dd\uc740 \ub9e4\ud551 \ud0c0\uc785\uc758 value\uac00 \uc800\uc7a5\ub418\ub294 \ubc29\uc2dd\uc744 \ucc28\uc6a9\ud55c \ubc29\uc2dd\uc774\ub2e4. \uc77c\ubc18\uc801\uc778 \uacbd\uc6b0\uc5d0 \uc0ac\uc6a9\ub418\uc9c0 \uc54a\uc744 \ud2b9\uc815 \uc2ac\ub86f\ub118\ubc84\uc5d0 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8 \uc8fc\uc18c\ub97c \uc800\uc7a5\ud574\ub193\uc558\uae30 \ub54c\ubb38\uc5d0 \uc774\ud6c4 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c \uc120\uc5b8\ub418\ub294 \ubcc0\uc218\ub4e4\uc5d0 \uc758\ud574 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8 \uc8fc\uc18c\uc5d0 \ub300\ud55c \uc2a4\ud1a0\ub9ac\uc9c0 \ucda9\ub3cc\uc774 \ubc1c\uc0dd\ud558\ub294 \uac83\uc744 \ub9c9\uc744 \uc218 \uc788\ub294 \uac83\uc774\ub2e4.\\n\\n```mdx-code-block\\n<Tabs>\\n<TabItem value=\\"contracts/ERC1967/ERC1967.sol\\">\\n```\\n\\n```sol\\n// SPDX-License-Identifier: MIT\\n\\npragma solidity ^0.8.0;\\n\\nimport \\"@openzeppelin/contracts/proxy/ERC1967/ERC1967Proxy.sol\\";\\nimport \\"@openzeppelin/contracts/access/Ownable.sol\\";\\n\\ncontract ERC1967 is ERC1967Proxy, Ownable {\\n    constructor(address _logic, bytes memory _data)\\n        payable\\n        ERC1967Proxy(_logic, _data)\\n    {}\\n\\n    function upgradeTo(address newImplementation) external onlyOwner {\\n        _upgradeToAndCall(newImplementation, bytes(\\"\\"), false);\\n    }\\n\\n    function upgradeToAndCall(address newImplementation, bytes calldata data)\\n        external\\n        payable\\n        onlyOwner\\n    {\\n        _upgradeToAndCall(newImplementation, data, true);\\n    }\\n\\n    function implementation() external view returns (address) {\\n        return _implementation();\\n    }\\n}\\n```\\n\\n```mdx-code-block\\n</TabItem>\\n<TabItem value=\\"contracts/ERC1967/v1.sol\\">\\n```\\n\\n```sol\\n//SPDX-License-Identifier: Unlicense\\npragma solidity ^0.8.0;\\n\\ncontract ERC1967ImplementationV1 {\\n    mapping(address => uint256) public counts;\\n\\n    function count() external {\\n        counts[msg.sender] += 1;\\n    }\\n}\\n```\\n\\n```mdx-code-block\\n</TabItem>\\n<TabItem value=\\"contracts/ERC1967/v2.sol\\">\\n```\\n\\n```solidity\\n//SPDX-License-Identifier: Unlicense\\npragma solidity ^0.8.0;\\n\\ncontract ERC1967ImplementationV2 {\\n    mapping(address => uint256) public counts;\\n\\n    function count() external {\\n        counts[msg.sender] += 2;\\n    }\\n}\\n```\\n\\n```mdx-code-block\\n</TabItem>\\n</Tabs>\\n```\\n\\n\uc704\uc640 \uac19\uc774 ERC1967\uc744 \ud1b5\ud574 \uc5c5\uadf8\ub808\uc774\ub4dc \uac00\ub2a5\ud55c \ucee8\ud2b8\ub799\ud2b8\ub97c \uad6c\ud604\ud558\uc600\uc744 \ub54c, \ub354 \uc774\uc0c1 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc5d0 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8 \uc8fc\uc18c\uac00 \ub2f4\uae34 \ubcc0\uc218\ub97c \uc21c\uc11c\uc5d0 \ub9de\uac8c \uc120\uc5b8\ud574\uc904 \ud544\uc694\uac00 \uc5c6\uc5b4\uc9c4 \uac83\uc744 \ubcfc \uc218 \uc788\ub2e4. \uc65c\ub0d0\ud558\uba74 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8 \uc8fc\uc18c\ub294 [StorageSlot](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/utils/StorageSlot.sol) \ub77c\uc774\ube0c\ub7ec\ub9ac\ub97c \ud65c\uc6a9\ud558\uc5ec \ubbf8\ub9ac \uc815\ud574\uc9c4 \uc2ac\ub86f\ub118\ubc84\uc758 \uc2a4\ud1a0\ub9ac\uc9c0\uc2ac\ub86f\uc5d0 \uc800\uc7a5\ub418\uae30 \ub54c\ubb38\uc774\ub2e4.\\n\\n```sol title=\\"contracts/ERC1967/v4.sol\\"\\n//SPDX-License-Identifier: Unlicense\\npragma solidity ^0.8.0;\\n\\nimport \\"@openzeppelin/contracts/utils/StorageSlot.sol\\";\\n\\ncontract ERC1967ImplementationV4 {\\n    bytes32 internal constant _IMPLEMENTATION_SLOT =\\n        0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc;\\n\\n    mapping(address => uint256) public counts;\\n\\n    function count() external {\\n        counts[msg.sender] += 3;\\n    }\\n\\n    function storageTest(address _target) external {\\n        StorageSlot.getAddressSlot(_IMPLEMENTATION_SLOT).value = _target;\\n    }\\n\\n    function getAddress() external view returns (address target_) {\\n        target_ = StorageSlot.getAddressSlot(_IMPLEMENTATION_SLOT).value;\\n    }\\n}\\n```\\n\\n```bash\\nconsole.log(\\"V4 ------ storage test ------\\");\\nconst storageTest = await proxy.storageTest(users[0].address);  await storageTest.wait();\\nconsole.log(\\"users[0]:\\", users[0].address);  console.log(\\"implementation:\\", await erc1967Proxy.implementation());\\n\ud14c\uc2a4\ud2b8 \uacb0\uacfc\\nV4 ------ storage test ------\\nusers[0]: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266\\nimplementation: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266\\n```\\n\\n\ucc38\uace0\ub85c \ub2f9\uc5f0\ud55c \uacb0\uacfc\uaca0\uc9c0\ub9cc, \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c \uc0ac\uc6a9\ud558\uace0 \uc788\ub294 \uc2ac\ub86f\ub118\ubc84\ub97c \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c \ub3d9\uc77c\ud558\uac8c \uc0ac\uc6a9\ud558\uac8c \ub418\uba74 \uc2a4\ud1a0\ub9ac\uc9c0 \ucda9\ub3cc\uc774 \ubc1c\uc0dd\ud55c\ub2e4.\\n\\n<hr />\\n\ubb3c\ub860 \uc774\uc640 \uac19\uc740 \ubc29\uc2dd\uc744 \ud1b5\ud574 \ud574\uacb0\ud55c \uac83\uc740 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc5d0 \ud544\uc218\uc801\uc73c\ub85c \ud544\uc694\ud55c \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\\n\uc8fc\uc18c \ubcc0\uc218\uc5d0 \ud55c\uc815\ub41c \uc2a4\ud1a0\ub9ac\uc9c0 \ucda9\ub3cc\uc774\ub2e4. \uc5c5\uadf8\ub808\uc774\ub4dc \ub418\ub294 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc5d0 \uc120\uc5b8\ub41c \ubcc0\uc218\uac00\\n\uc774\uc804 \ubc84\uc804\uc758 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c \uc0ac\uc6a9\ub418\ub358 \ubcc0\uc218\uc640 \ucda9\ub3cc\ud560 \uc218 \uc788\ub294 \uc704\ud5d8\uc740 \uc5ec\uc804\ud788 \uadf8\ub300\ub85c\\n\uc874\uc7ac\ud55c\ub2e4.\\n\\n\uadf8\ub807\ub2e4\uba74 \uc2a4\ud1a0\ub9ac\uc9c0 \ucda9\ub3cc \uc774\uc678\uc5d0\ub294 \ud504\ub85d\uc2dc \ud328\ud134\uc758 \ub2e8\uc810\uc740 \uc874\uc7ac\ud558\uc9c0 \uc54a\uace0 \uc774\uc81c ERC1967\uc744 \uadf8\ub300\ub85c \uc0ac\uc6a9\ud558\uae30\ub9cc \ud558\uba74 \ub418\ub294 \uac83\uc77c\uae4c?\\n\\n### \uc0dd\uc131\uc790 \ud568\uc218\\n\\n\uc774 \ub2e8\uc810\uc740 ERC1967\uc758 \ub2e8\uc810\uc774\ub77c\uae30 \ubcf4\ub2e4\ub294 delegatecall\uc744 \uae30\ubc18\uc73c\ub85c \ud558\ub294 \ud504\ub85d\uc2dc \ud328\ud134 \uc790\uccb4\uc758 \ub2e8\uc810\uc774\ub77c\uace0 \ubcfc \uc218 \uc788\ub2e4.\\n\\n\ud504\ub85d\uc2dc \ud328\ud134\uc744 \uad6c\ud604\ud560 \ub54c \ub85c\uc9c1\uc774 \ub2f4\uae34 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c\ub294 constructor\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc5c6\ub2e4. \uc815\ud655\ud788 \ub9d0\ud574 \uc0ac\uc6a9\ud560 \uc218 \uc5c6\ub2e4\uae30\ubcf4\ub2e4\ub294 \uc124\uc0ac \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c \uc0dd\uc131\uc790 \ud568\uc218\ub97c \uc0ac\uc6a9\ud558\uc5ec \ubcc0\uc218\ub4e4\uc5d0 \uac12\uc744 \ucd08\uae30\ud654\ud588\ub2e4\uace0 \ud558\ub354\ub77c\ub3c4 \uc758\ubbf8\uac00 \uc5c6\ub2e4.\\n\\n\uc774\uc804 \uae00\uc5d0\uc11c \ubcf4\uc558\ub4ef\uc774 \ud504\ub85d\uc2dc \ud328\ud134\uc758 \uae30\ubcf8 \uc544\uc774\ub514\uc5b4\ub294 \ub370\uc774\ud130\uc640 \ub85c\uc9c1\uc744 \ubd84\ub9ac\ud558\ub294 \uac83\uc774\uace0, \ub370\uc774\ud130\ub294 \uc0c8\ub86d\uac8c \ubc30\ud3ec\ub41c \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc758 \uc2a4\ud1a0\ub9ac\uc9c0\ub97c \ud65c\uc6a9\ud558\ub294 \uac83\uc774 \uc544\ub2c8\ub77c \uc774\ubbf8 \ubc30\ud3ec\ub418\uc5b4\uc788\ub358 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc758 \uc2a4\ud1a0\ub9ac\uc9c0\ub97c \uc774\uc5b4\uc11c \ud65c\uc6a9\ud55c\ub2e4\ub294 \uac83\uc774 \uc5c5\uadf8\ub808\uc774\ub4dc\uc758 \uc758\ubbf8\uc774\uae30 \ub54c\ubb38\uc774\ub2e4.\\n\\n\uc2e4\uc81c \ud504\ub85c\ub355\ud2b8\ub85c \ud65c\uc6a9\ub418\uace0 \uc788\ub294 \ucee8\ud2b8\ub799\ud2b8 \ub370\uc774\ud130\ub294 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc758 \ub370\uc774\ud130\uc77c \uac83\uc774\uae30 \ub54c\ubb38\uc5d0, \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uac00 \ubc30\ud3ec\ub418\uba74\uc11c \uc2e4\ud589\ub41c \uc0dd\uc131\uc790 \ud568\uc218\uc758 \ub85c\uc9c1\uc740 \uc758\ubbf8\uc5c6\uc774 \ub3d9\uc791\ud55c \ucc44\ub85c \ub05d\ub0a0 \uac83\uc774\ub2e4. \uc0dd\uc131\uc790 \ud568\uc218\ub294 \ucee8\ud2b8\ub799\ud2b8\uac00 \ubc30\ud3ec\ub418\ub294 \uc21c\uac04\uc5d0 \ud55c \ubc88 \uc2e4\ud589\ub41c \uc774\ud6c4\ub85c \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c \ud638\ucd9c\ud560 \uc218 \uc5c6\uae30 \ub54c\ubb38\uc5d0, \ub9cc\uc57d \ucd08\uae30 \uc14b\ud305\uc774 \ud544\uc694\ud558\ub2e4\uba74 \uc0dd\uc131\uc790 \ud568\uc218\uac00 \uc544\ub2cc \ub2e4\ub978 \ubc29\uc2dd\uc744 \uc0ac\uc6a9\ud574\uc57c \ud55c\ub2e4.\\n\\n\uc77c\ubc18\uc801\uc73c\ub85c \uc0ac\uc6a9\ub418\ub294 \ubc29\uc2dd\uc740 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c \uc784\uc758\uc758 \ucd08\uae30\ud654 \ud568\uc218\ub97c \ub9cc\ub4e4\uc5b4\ub193\uace0 \ubc84\uc804 \ubcc4\ub85c \ub531 \ud55c \ubc88\ub9cc \uc2e4\ud589\ub418\uace0, \ud55c \ubc88 \ud638\ucd9c\ub41c \uc774\ud6c4\ub85c\ub294 \ud638\ucd9c\ub418\ub354\ub77c\ub3c4 \uc2e4\ud589\ub418\uc9c0 \uc54a\uac8c [\uc81c\ud55c \ud574\ub193\ub294 \ubc29\uc2dd](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/proxy/utils/Initializable.sol#L107)\uc774\ub2e4.\\n\\n\uac19\uc740 \uc774\uc720\ub85c \ud504\ub85d\uc2dc \ud328\ud134\uc744 \uc0ac\uc6a9\ud560 \ub54c\ub294 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\ub97c \uc791\uc131\ud560 \ub54c \ubcc0\uc218\uc5d0 \ucd08\uae30\uac12\uc744 \ub300\uc785\ud558\ub294 \ubc29\uc2dd\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc5c6\ub2e4. \ub300\uc785\ud55c \uac12\uc740 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc758 \uc2a4\ud1a0\ub9ac\uc9c0\uc5d0 \uc800\uc7a5\ub3fc\uc788\uc744 \ubfd0, \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc758 \uc2a4\ud1a0\ub9ac\uc9c0\uc640\ub294 \uc0c1\uad00\uc774 \uc5c6\uae30 \ub54c\ubb38\uc774\ub2e4.\\n\\n### \ud568\uc218 \ucda9\ub3cc\\n\\n\ub2e4\uc2dc ERC1967\ub85c \ub3cc\uc544\uc640\uc11c, ERC1967\uc744 \uc0ac\uc6a9\ud588\uc744 \ub54c \ubc1c\uc0dd\ud560 \uc218 \uc788\ub294 \uc704\ud5d8 \uc911\uc5d0\ub294 \uc2a4\ud1a0\ub9ac\uc9c0 \ucda9\ub3cc\ub9cc \uc874\uc7ac\ud558\ub294 \uac83\uc740 \uc544\ub2c8\ub2e4. \uc704\uc5d0\uc11c \ud14c\uc2a4\ud2b8\ub97c \uc704\ud574 \uad6c\ud604\ub41c ERC1967 \ucee8\ud2b8\ub799\ud2b8\ub97c \uc0b4\ud3b4\ubcf4\uba74, \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc758 \uc8fc\uc18c\ub97c \ubcc0\uacbd\ud558\ub294 `upgradeTo` \ud568\uc218\uc640 \uc5c5\uadf8\ub808\uc774\ub4dc \ud558\uba74\uc11c \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc5d0 \ubbf8\ub9ac \uc791\uc131\ud574\ub193\uc740 \ucd08\uae30\ud654 \ud568\uc218\ub97c \ud568\uaed8 \ud638\ucd9c\ud558\ub294 \uacbd\uc6b0\uc5d0 \ud65c\uc6a9\ud558\ub294 `upgradeToAndCall` \ud568\uc218, \uadf8\ub9ac\uace0 \ud604\uc7ac \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc758 \uc8fc\uc18c\ub97c \uc870\ud68c\ud558\ub294 `implementation` \ud568\uc218\uac00 \uc678\ubd80 \ud568\uc218\ub85c \uc874\uc7ac\ud558\ub294 \uac83\uc744 \ubcfc \uc218 \uc788\ub2e4.\\n\\n\uc6b0\ub9ac\ub294 \uc5ec\uae30\uc11c \ud55c \uac00\uc9c0 \ud569\ub2f9\ud55c \uad81\uae08\uc99d\uc744 \uac00\uc9c8 \uc218 \uc788\ub2e4. \ub9cc\uc57d \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc5d0\ub3c4 `upgradeTo`\ub77c\ub294 \uc774\ub984\uc758 \ud568\uc218\uac00 \uc874\uc7ac\ud55c\ub2e4\uba74, \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\ub85c `upgradeTo` \ud568\uc218\ub97c \ud638\ucd9c \ud588\uc744 \ub54c, \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc5d0 \uc874\uc7ac\ud558\ub294 \ud568\uc218\uac00 \ub3d9\uc791\ud574\uc57c \uc815\uc0c1\uc801\uc73c\ub85c \ub3d9\uc791\ud55c \uac83\uc77c\uae4c \uc544\ub2c8\uba74 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc5d0 \uc874\uc7ac\ud558\ub294 \ud568\uc218\uac00 \ub3d9\uc791\ud574\uc57c \uc815\uc0c1\uc801\uc73c\ub85c \ub3d9\uc791\ud55c \uac83\uc77c\uae4c?\\n\\n\ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc5d0 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc758 \uc8fc\uc18c\uac12\uc774 \uaf2d \ud544\uc694\ud55c \uac83\ucc98\ub7fc, \uc5c5\uadf8\ub808\uc774\ub4dc\ub97c \uc704\ud574\uc11c\ub294 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc758 \uc8fc\uc18c\ub97c \uc218\uc815\ud558\ub294 \ub85c\uc9c1\uc758 \ud568\uc218\uac00 \uaf2d \ud544\uc694\ud558\ub2e4. \ubb3c\ub860 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\ub97c \uc791\uc131\ud558\ub294 \uac1c\ubc1c\uc790\uac00 \uc774 \uc810\uc744 \uc798 \uc219\uc9c0\ud558\uace0 \uc788\uc744 \uac83\uc774\uae30 \ub54c\ubb38\uc5d0 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc5d0 \uad73\uc774 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c \uc790\uccb4\uc801\uc73c\ub85c \uc0ac\uc6a9\ud558\ub294 \ud568\uc218\uc640 \ub3d9\uc77c\ud55c \ud568\uc218\uba85\uacfc \uc778\uc790\ub97c \uac00\uc9c4 \ud568\uc218\ub97c \ub9cc\ub4e4\uc9c0\ub294 \uc54a\uc744 \uac83\uc774\ub2e4.\\n\\n\ud558\uc9c0\ub9cc \uc0ac\ub78c\uc740 \uc5b8\uc81c\ub098 \uc2e4\uc218\ub97c \ud560 \uc218 \uc788\uc744 \ubfd0\ub354\ub7ec, \ub354 \uae4c\ub2e4\ub85c\uc6b4 \ubb38\uc81c\ub294 \ud568\uc218\uba85\uc774 \ub3d9\uc77c\ud558\uc9c0 \uc54a\ub354\ub77c\ub3c4 \ub3d9\uc77c\ud55c \ud568\uc218\ub85c \uc778\uc2dd\ub418\ub294 \uacbd\uc6b0\uac00 \ubc1c\uc0dd\ud560 \uc218 \uc788\ub2e4\ub294 \uac83\uc774\ub2e4.\\n\\n### \ucee8\ud2b8\ub799\ud2b8\uac00 \ud568\uc218\ub97c \uc2dd\ubcc4\ud558\ub294 \ubc29\uc2dd\\n\\n\ucee8\ud2b8\ub799\ud2b8\uc5d0 \uc5b4\ub5a4 \ud568\uc218\ub97c \ud638\ucd9c\ud558\ub294 \uc694\uccad\uc774 \ub4e4\uc5b4\uc654\uc744 \ub54c, \ud638\ucd9c\ub41c \ud568\uc218\uac00 \ubb34\uc5c7\uc778\uc9c0\ub294 \ud2b8\ub79c\uc7ad\uc158\uc758 \ub370\uc774\ud130 \ud544\ub4dc(calldata)\uc5d0 \ub4e4\uc5b4\uc788\ub294 \ub370\uc774\ud130\ub4e4\uc744 \ud1b5\ud574 \uacb0\uc815\ub41c\ub2e4. \uc5ec\uae30\uc5d0\ub294 \ud568\uc218\uc758 \uc774\ub984\uacfc \uc778\uc790 \ud0c0\uc785\uc744 keccak256\uc73c\ub85c \ud574\uc2f1\ud55c \ud568\uc218 \uc2dc\uadf8\ub2c8\ucc98\uc758 4\ubc14\uc774\ud2b8 \ud568\uc218 \uc2dd\ubcc4\uc790\uc640 \uc778\uc790\uac12\ub4e4\uc774 \ud3ec\ud568\ub418\uc5b4\uc788\ub2e4.\\n\\nfallback \ud568\uc218\ub97c \uae30\ubc18\uc73c\ub85c \uad6c\ud604\ub41c \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\ub294 calldata\uc5d0 \ub2f4\uae34 \ud568\uc218 \uc2dd\ubcc4\uc790\uc640 \ub3d9\uc77c\ud55c \uc2dd\ubcc4\uc790\ub97c \uac00\uc9c4 \ud568\uc218\uac00 \uc874\uc7ac\ud558\ub294\uc9c0 \ud655\uc778\ud558\uace0, \uc874\uc7ac\ud558\uc9c0 \uc54a\uc73c\uba74 fallback \ud568\uc218\ub97c \uc2e4\ud589\uc2dc\ud0ac \uac83\uc774\ub2e4. \uadf8\ub7ec\uba74 fallback \ud568\uc218\uc5d0\uc11c\ub294 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc5d0 \ud574\ub2f9 \ud568\uc218\ub97c delegatecall \ud558\ub294 \ub85c\uc9c1\uc744 \uc218\ud589\ud560 \uac83\uc774\ub2e4.\\n\\n\ubb38\uc81c\ub294 \ud568\uc218 \uc2dd\ubcc4\uc790\uac00 \ud574\uc2dc\uac12\uc758 \uc55e\ubd80\ubd84 4\ubc14\uc774\ud2b8 \uac12\ub9cc\uc73c\ub85c \uc774\ub8e8\uc5b4\uc9c4\ub2e4\ub294 \uac83\uc774\ub2e4. \ub54c\ubb38\uc5d0 \ud568\uc218\uba85\uacfc \uc778\uc790\uac00 \ub2e4\ub978 \ud568\uc218\ub77c\ud558\ub354\ub77c\ub3c4 \ub3d9\uc77c\ud55c \ud568\uc218 \uc2dd\ubcc4\uc790\ub97c \uac16\uac8c \ub418\ub294 \uacbd\uc6b0\uac00 \ubc1c\uc0dd\ud560 \uc218 \uc788\ub2e4. \ud558\ub098\uc758 \ucee8\ud2b8\ub799\ud2b8 \uc548\uc5d0\uc11c \ud568\uc218 \uc2dd\ubcc4\uc790\uac00 \ucda9\ub3cc\ub418\ub294 \uacbd\uc6b0\uc5d0\ub294 [\uc194\ub9ac\ub514\ud2f0 \ucef4\ud30c\uc77c\ub7ec](https://solidity-kr.readthedocs.io/ko/latest/using-the-compiler.html)\uac00 \ucef4\ud30c\uc77c \uacfc\uc815\uc5d0\uc11c \uc5d0\ub7ec\ub97c \ubc1c\uc0dd\uc2dc\ud0a4\uae30 \ub54c\ubb38\uc5d0 \ubbf8\ub9ac \ubc29\uc9c0\ud560 \uc218 \uc788\ub2e4.\\n\\n```bash\\n\\"DeclarationError\\" : \uc720\ud6a8\ud558\uc9c0 \uc54a\uac70\ub098 \ud639\uc740 \uc758\uacb0 \ud560\uc218 \uc5c6\ub294(unresolvable), \uc2dd\ubcc4\uc790 \uc774\ub984\ucda9\ub3cc\uc785\ub2c8\ub2e4.\\n```\\n\\n\ud558\uc9c0\ub9cc \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc640 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c\ucc98\ub7fc \uc11c\ub85c \ub2e4\ub978 \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c \ud568\uc218 \uc2dd\ubcc4\uc790\uac00 \uc911\ubcf5\ub418\ub294 \uacbd\uc6b0\ub294 \ucef4\ud30c\uc77c \uacfc\uc815\uc5d0\uc11c \ubc29\uc9c0\ud560 \uc218 \uc5c6\ub2e4.\\n\\n<hr />\\n\\n```sol title=\\"contracts/ERC1967/v3.sol\\"\\n//SPDX-License-Identifier: Unlicense\\npragma solidity ^0.8.0;\\n\\ncontract ERC1967ImplementationV3 {\\n    mapping(address => uint256) public counts;\\n\\n    function count() external {\\n        counts[msg.sender] += 3;\\n    }\\n\\n    function upgradeTo(address _target) external {\\n        counts[_target] += 3;\\n    }\\n}\\n```\\n\\n\uc704\ucc98\ub7fc \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc5d0 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc640 \ub3d9\uc77c\ud55c \uc774\ub984\uacfc \ud30c\ub77c\ubbf8\ud130\ub97c \uac00\uc9c4 `upgradeTo` \ud568\uc218\uac00 \uc788\uc744 \ub54c, \ud574\ub2f9 \ud568\uc218\ub97c \ud638\ucd9c\ud558\uba74 \uc5b4\ub5bb\uac8c \ub420\uae4c?\\n\\n```ts\\nconsole.log(\\"V3 ------ upgradeTo function Error ------\\");\\nawait expect(proxy.upgradeTo(users[0].address)).to.be.revertedWith(\\n  \\"ERC1967: new implementation is not a contract\\"\\n);\\n```\\n\\n\ud14c\uc2a4\ud2b8 \uacb0\uacfc\ub97c \ubcf4\uba74, \uc5c5\uadf8\ub808\uc774\ub4dc \ud558\ub824\ub294 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc758 \uc8fc\uc18c\uac00 \ucee8\ud2b8\ub799\ud2b8\uc778\uc9c0 \ud655\uc778\ud558\ub294 require\ubb38\uc5d0 \uac78\ub824 revert \ub418\ub294 \uac83\uc744 \ubcfc \uc218 \uc788\ub2e4.\\n\\n\ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc5d0\ub294 \ud574\ub2f9 \ud568\uc218\uc2dd\ubcc4\uc790\ub97c \uac00\uc9c4 \ud568\uc218\uac00 \uc774\ubbf8 \uc874\uc7ac\ud558\uae30 \ub54c\ubb38\uc5d0 fallback \ud568\uc218\ub85c \ub118\uc5b4\uac00\uc9c0 \uc54a\uace0 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc758 `upgradeTo` \ud568\uc218\uac00 \uc2e4\ud589\ub41c\ub2e4.\\n\\n\ub9cc\uc57d \ud568\uc218\ud638\ucd9c\uc790\uac00 \ucee8\ud2b8\ub799\ud2b8\ub97c \uc5c5\uadf8\ub808\uc774\ub4dc \ud558\ub824\ub358\uac8c \uc544\ub2c8\ub77c, \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc5d0 \uc788\ub294 target \uc8fc\uc18c\uc5d0 \uce74\uc6b4\ud2b8\ub97c 3 \ub354 \ud574\uc8fc\ub294 \uae30\ub2a5\uc744 \uc218\ud589\ud558\uace0 \uc2f6\uc5c8\ub358 \uac83\uc774\ub77c\uba74 \uc694\uccad\uc758 \uc2e4\ud328\uac00 \ubb34\ucc99 \ub2f9\ud669\uc2a4\uc6e0\uc744 \uac83\uc774\ub2e4.\\n\\n\uc774\ucc98\ub7fc \ud638\ucd9c\uc790\uc758 \uc758\ub3c4\uc640\ub294 \ub2e4\ub974\uac8c \ucee8\ud2b8\ub799\ud2b8\uc758 \uae30\ub2a5\ub4e4\uc774 \ub3d9\uc791\ud560 \uc218 \uc788\uae30 \ub54c\ubb38\uc5d0 ERC1967\uc744 \uc0ac\uc6a9\ud560 \ub54c\ub294 \ud568\uc218 \ucda9\ub3cc\uc758 \ubb38\uc81c\ub97c \uace0\ub824\ud574\uc57c\ud55c\ub2e4.\\n\\n## TransparentProxy\\n\\nERC1967\uc758 \ud568\uc218 \ucda9\ub3cc \ubb38\uc81c\ub97c \ud574\uacb0\ud558\uae30 \uc704\ud574 \ub098\uc628 \ubc29\uc2dd\uc774 \uc624\ud508\uc7ac\ud50c\ub9b0\uc758 \ud22c\uba85\ud504\ub85d\uc2dc\uc774\ub2e4.\\n\\n\ud22c\uba85\ud504\ub85d\uc2dc\uac00 \ud568\uc218 \ucda9\ub3cc \ubb38\uc81c\ub97c \ud574\uacb0\ud558\ub294 \uc544\uc774\ub514\uc5b4\ub294 \ud638\ucd9c\uc790\uac00 \ub204\uad6c\uc778\uc9c0\ub97c \uae30\uc900\uc73c\ub85c \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc758 \uc790\uccb4 \ud568\uc218\ub97c \ud638\ucd9c\ud560\uc9c0, \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc758 \ud568\uc218\ub97c \ud638\ucd9c\ud560\uc9c0\ub97c \uacb0\uc815\ud558\uac8c \ud558\ub294 \uac83\uc774\ub2e4.\\n\\n```sol title=\\"openzeppelin-contracts/contracts/proxy/transparent/TransparentUpgradeableProxy.sol\\"\\ncontract TransparentUpgradeableProxy is ERC1967Proxy {\\n    /**\\n     * @dev Initializes an upgradeable proxy managed by `_admin`, backed by the implementation at `_logic`, and\\n     * optionally initialized with `_data` as explained in {ERC1967Proxy-constructor}.\\n     */\\n    constructor(\\n        address _logic,\\n        address admin_,\\n        bytes memory _data\\n    ) payable ERC1967Proxy(_logic, _data) {\\n        _changeAdmin(admin_);\\n    }\\n\\n    /**\\n     * @dev Modifier used internally that will delegate the call to the implementation unless the sender is the admin.\\n     */\\n    modifier ifAdmin() {\\n        if (msg.sender == _getAdmin()) {\\n            _;\\n        } else {\\n            _fallback();\\n        }\\n    }\\n\\n    /**\\n     * @dev Returns the current admin.\\n     *\\n     * NOTE: Only the admin can call this function. See {ProxyAdmin-getProxyAdmin}.\\n     *\\n     * TIP: To get this value clients can read directly from the storage slot shown below (specified by EIP1967) using the\\n     * https://eth.wiki/json-rpc/API#eth_getstorageat[`eth_getStorageAt`] RPC call.\\n     * `0xb53127684a568b3173ae13b9f8a6016e243e63b6e8ee1178d6a717850b5d6103`\\n     */\\n    function admin() external ifAdmin returns (address admin_) {\\n        admin_ = _getAdmin();\\n    }\\n\\n    /**\\n     * @dev Returns the current implementation.\\n     *\\n     * NOTE: Only the admin can call this function. See {ProxyAdmin-getProxyImplementation}.\\n     *\\n     * TIP: To get this value clients can read directly from the storage slot shown below (specified by EIP1967) using the\\n     * https://eth.wiki/json-rpc/API#eth_getstorageat[`eth_getStorageAt`] RPC call.\\n     * `0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc`\\n     */\\n    function implementation() external ifAdmin returns (address implementation_) {\\n        implementation_ = _implementation();\\n    }\\n\\n    /**\\n     * @dev Changes the admin of the proxy.\\n     *\\n     * Emits an {AdminChanged} event.\\n     *\\n     * NOTE: Only the admin can call this function. See {ProxyAdmin-changeProxyAdmin}.\\n     */\\n    function changeAdmin(address newAdmin) external virtual ifAdmin {\\n        _changeAdmin(newAdmin);\\n    }\\n\\n    /**\\n     * @dev Upgrade the implementation of the proxy.\\n     *\\n     * NOTE: Only the admin can call this function. See {ProxyAdmin-upgrade}.\\n     */\\n    function upgradeTo(address newImplementation) external ifAdmin {\\n        _upgradeToAndCall(newImplementation, bytes(\\"\\"), false);\\n    }\\n\\n    /**\\n     * @dev Upgrade the implementation of the proxy, and then call a function from the new implementation as specified\\n     * by `data`, which should be an encoded function call. This is useful to initialize new storage variables in the\\n     * proxied contract.\\n     *\\n     * NOTE: Only the admin can call this function. See {ProxyAdmin-upgradeAndCall}.\\n     */\\n    function upgradeToAndCall(address newImplementation, bytes calldata data) external payable ifAdmin {\\n        _upgradeToAndCall(newImplementation, data, true);\\n    }\\n\\n    /**\\n     * @dev Returns the current admin.\\n     */\\n    function _admin() internal view virtual returns (address) {\\n        return _getAdmin();\\n    }\\n\\n    /**\\n     * @dev Makes sure the admin cannot access the fallback function. See {Proxy-_beforeFallback}.\\n     */\\n    function _beforeFallback() internal virtual override {\\n        require(msg.sender != _getAdmin(), \\"TransparentUpgradeableProxy: admin cannot fallback to proxy target\\");\\n        super._beforeFallback();\\n    }\\n}\\n```\\n\\n\ud22c\uba85\ud504\ub85d\uc2dc\uc758 \ucf54\ub4dc\ub97c \uc0b4\ud3b4\ubcf4\uba74, \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\ub97c \uc5c5\uadf8\ub808\uc774\ub4dc \ud558\uac70\ub098 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc758 \uc5b4\ub4dc\ubbfc\uc744 \ubc14\uafb8\ub294 \ub4f1\uc758 \ud504\ub85d\uc2dc \uc790\uccb4 \ud568\uc218\ub4e4\uc5d0\ub294 \ubaa8\ub450 `ifAdmin`\uc774\ub77c\ub294 modifier\uac00 \ucd94\uac00 \ub3fc\uc788\ub294 \uac83\uc744 \ubcfc \uc218 \uc788\ub2e4.\\n\\n`ifAdmin`\uc758 \ub85c\uc9c1\uc744 \ubcf4\uba74 sender\uac00 \uc5b4\ub4dc\ubbfc\uc778 \uacbd\uc6b0\uc5d0\ub9cc \uc790\uccb4 \ud568\uc218\ub97c \uc2e4\ud589\ud558\uace0 \uc5b4\ub4dc\ubbfc\uc774 \uc544\ub2cc \uacbd\uc6b0\uc5d0\ub294 `_fallback`\uc744 \uc2e4\ud589\ud55c\ub2e4. \ub610\ud55c `_beforeFallback` \ud568\uc218\uc5d0\uc11c\ub294 sender\uac00 \uc5b4\ub4dc\ubbfc\uc778 \uacbd\uc6b0\uc5d0 revert \uc2dc\ud0a4\ub294 \uac83\uc744 \ubcfc \uc218 \uc788\ub2e4. `_beforeFallback` \ud568\uc218\ub294 `_fallback` \ud568\uc218 \uc548\uc5d0\uc11c delegatecall\uc774 \uc2e4\ud589\ub418\uae30 \uc804\uc5d0 \ud638\ucd9c\ub418\uae30 \ub54c\ubb38\uc5d0 sender\uac00 \uc5b4\ub4dc\ubbfc\uc778 \uacbd\uc6b0\uc5d0\ub294 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc5d0 \ub300\ud55c \ud568\uc218 \ud638\ucd9c\uc774 \ucc28\ub2e8\ub418\uace0, \uc624\ub85c\uc9c0 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc758 \uc790\uccb4 \ud568\uc218\ub4e4\uc5d0\ub9cc \uc811\uadfc\ud560 \uc218 \uc788\uac8c \ub41c\ub2e4.\\n\\nERC1967\uc5d0\uc11c\ub294 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc5d0 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc640 \ub3d9\uc77c\ud55c \ud568\uc218 \uc2dd\ubcc4\uc790\ub97c \uac00\uc9c4 \ud568\uc218\uac00 \uc874\uc7ac\ud55c\ub2e4\uba74, \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc758 \ud568\uc218\ub97c \ud638\ucd9c\ud558\ub824\ub294 \uc758\ub3c4\ub85c \ud568\uc218\ub97c \ud638\ucd9c\ud558\ub354\ub77c\ub3c4 fallback \ud568\uc218\uac00 \uc2e4\ud589\ub418\uc9c0 \uc54a\uace0 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8 \uc790\uccb4 \ud568\uc218\uac00 \uc2e4\ud589\ub418\uc5c8\uc744 \uac83\uc774\ub2e4.\\n\\n\ubc18\uba74 \ud22c\uba85 \ud504\ub85d\uc2dc\uc5d0\uc11c\ub294 \ud638\ucd9c\uc790\uac00 \uc5b4\ub4dc\ubbfc\uc778\uc9c0 \uc544\ub2cc\uc9c0\uc5d0 \ub530\ub77c\uc11c \ud638\ucd9c\uc790\uc758 \uc758\ub3c4\ub97c \uacb0\uc815 \uc9d3\ub294 \ubc29\uc2dd\uc774\ub77c\uace0 \ubcfc \uc218 \uc788\ub2e4. \ud638\ucd9c\uc790\uac00 \uc5b4\ub4dc\ubbfc\uc774\ub77c\uba74 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc758 \uc5b4\ub4dc\ubbfc \uae30\ub2a5\uc744 \uc0ac\uc6a9\ud558\uae30 \uc704\ud574 \uc790\uccb4 \ud568\uc218\ub97c \ud638\ucd9c\ud588\uc744 \uac83\uc774\ub77c\uace0 \ubcf4\uace0, \uc5b4\ub4dc\ubbfc\uc774 \uc544\ub2c8\ub77c\uba74 \uc790\uccb4 \ud568\uc218\uc640 \ub3d9\uc77c\ud55c \ud568\uc218\uc2dd\ubcc4\uc790 \ud568\uc218\uac00 \ud638\ucd9c\ub410\ub354\ub77c\ub3c4 \ubb34\uc870\uac74 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\ub85c delegatecall\ud558\ub294 \ubc29\uc2dd\uc778 \uac83\uc774\ub2e4.\\n\\n### \ud504\ub85d\uc2dc \uc5b4\ub4dc\ubbfc\\n\\n\ud22c\uba85\ud504\ub85d\uc2dc\ub97c \uc0ac\uc6a9\ud560 \ub54c \uc5b4\ub4dc\ubbfc\uc744 EOA \uc8fc\uc18c\ub85c \uc124\uc815\ud558\uae30 \ubcf4\ub2e4\ub294, \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc758 \uc5b4\ub4dc\ubbfc \uae30\ub2a5\uc744 \ud638\ucd9c\ud558\ub294 \ud568\uc218\ub4e4\uc774 \uad6c\ud604\ub41c [\uc5b4\ub4dc\ubbfc \ucee8\ud2b8\ub799\ud2b8](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/proxy/transparent/ProxyAdmin.sol)\ub97c \ub530\ub85c \ubc30\ud3ec\ud558\uc5ec \ud574\ub2f9 \ucee8\ud2b8\ub799\ud2b8 \uc8fc\uc18c\ub85c \uc124\uc815\ud558\ub294 \uac83\uc774 \uc77c\ubc18\uc801\uc774\ub2e4.\\n\\n\uc5b4\ub4dc\ubbfc\uc744 EOA\ub85c \uc124\uc815\ud558\uba74 \ud574\ub2f9 \uc5b4\uce74\uc6b4\ud2b8\ub294 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc758 \uc790\uccb4 \ud568\uc218\ub4e4\ub9cc \ud638\ucd9c\ud560 \uc218 \uc788\uae30 \ub54c\ubb38\uc5d0, \uc5c5\uadf8\ub808\uc774\ub4dc\uc640 \uad00\ub828\ub41c \uc5b4\ub4dc\ubbfc \uc5b4\uce74\uc6b4\ud2b8\uc640 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc5d0 \uc874\uc7ac\ud558\ub294 \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1\uacfc \uc5f0\uacc4\ub41c \uc5b4\ub4dc\ubbfc \uae30\ub2a5\uc744 \uc0ac\uc6a9\ud558\ub294 \uc5b4\uce74\uc6b4\ud2b8\ub97c \ubd84\ub9ac\ud558\uc5ec \uad00\ub9ac\ud574\uc57c\ud55c\ub2e4.\\n\\n\ucee8\ud2b8\ub799\ud2b8\ub97c \ud504\ub85d\uc2dc \uc5b4\ub4dc\ubbfc\uc73c\ub85c \uc124\uc815\ud558\uace0, \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc758 \ud568\uc218\ub97c \ud638\ucd9c\ud558\ub294 \uc5b4\ub4dc\ubbfc \ucee8\ud2b8\ub799\ud2b8\uc758 \ud568\uc218\uc5d0 \ub530\ub85c \uad8c\ud55c\uc744 \uc124\uc815\ud558\ub294 \ubc29\uc2dd\uc744 \uc0ac\uc6a9\ud558\uba74 \ub3d9\uc77c\ud55c \uc5b4\uce74\uc6b4\ud2b8\ub85c\ub3c4 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc758 \uae30\ub2a5\uacfc \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc758 \uc5b4\ub4dc\ubbfc \uae30\ub2a5\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc788\uac8c \ub41c\ub2e4. (\ub610\ud55c \uc5ec\ub7ec \uc5b4\uce74\uc6b4\ud2b8\ub97c \uc5b4\ub4dc\ubbfc\uc73c\ub85c \uc124\uc815\ud560 \uc218\ub3c4 \uc788\uac8c \ub41c\ub2e4.)\\n\\n```sol title=\\"contracts/transparent/v2.sol\\"\\n//SPDX-License-Identifier: Unlicense\\npragma solidity ^0.8.0;\\n\\nimport \\"./v1.sol\\";\\n\\ncontract TransparentImplementationV2 is TransparentImplementationV1 {\\n    function initialize(uint256 _count) external virtual override {\\n        uint256 version = 2;\\n        require(!initializes[version], \\"already initialize\\");\\n\\n        counts[msg.sender] = _count + 1;\\n        initializes[version] = true;\\n    }\\n\\n    function count() external override {\\n        counts[msg.sender] += 2;\\n    }\\n\\n    function admin() external view returns (address) {\\n        return msg.sender;\\n    }\\n}\\n```\\n\\n\uc704\uc640 \uac19\uc774 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc758 \uc790\uccb4 \ud568\uc218\uc640 \ub3d9\uc77c\ud55c `admin` \ud568\uc218\uac00 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc5d0\ub3c4 \uc874\uc7ac\ud55c\ub2e4\uace0 \ud588\uc744 \ub54c,\\n\\n```ts\\nconsole.log(\\"proxyAdmin:\\", proxyAdmin.address);\\nconsole.log(\\n  \\"admin() from proxyAdmin\\",\\n  await proxyAdmin.getProxyAdmin(proxy.address)\\n);\\nconsole.log(\\"users[0]\\", users[0].address);\\nconsole.log(\\"admin() from users[0]\\", await proxy.admin());\\n```\\n\\n\ud14c\uc2a4\ud2b8 \uacb0\uacfc\ub294 \uc544\ub798\uc640 \uac19\ub2e4.\\n\\n```bash\\n\ud14c\uc2a4\ud2b8 \uacb0\uacfc\\nproxyAdmin: 0x5FbDB2315678afecb367f032d93F642f64180aa3\\nadmin() from proxyAdmin 0x5FbDB2315678afecb367f032d93F642f64180aa3\\nusers[0] 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266\\nadmin() from users[0] 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266\\n```\\n\\n```sol title=\\"openzeppelin-contracts/contracts/proxy/transparent/ProxyAdmin.sol\\"\\npragma solidity ^0.8.0;\\n\\nfunction getProxyAdmin(TransparentUpgradeableProxy proxy) public view virtual returns (address) {\\n    // We need to manually run the static call since the getter cannot be flagged as view\\n    // bytes4(keccak256(\\"admin()\\")) == 0xf851a440\\n    (bool success, bytes memory returndata) = address(proxy).staticcall(hex\\"f851a440\\");\\n    require(success);\\n    return abi.decode(returndata, (address));\\n}\\n```\\n\\n\ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc758 `admin` \ud568\uc218\ub97c \ud638\ucd9c\ud574\uc11c return \ud574\uc8fc\ub294 \uc5b4\ub4dc\ubbfc \ucee8\ud2b8\ub799\ud2b8\uc758 `getProxyAdmin` \ud568\uc218\ub97c \ud1b5\ud574 \ud638\ucd9c\ud588\uc744 \ub54c\ub294 sender\uac00 \ud504\ub85d\uc2dc\uc758 \uc5b4\ub4dc\ubbfc\uc774\uae30 \ub54c\ubb38\uc5d0 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc5d0 \uc788\ub294 `admin` \ud568\uc218\uac00 \uc2e4\ud589\ub41c \uac83\uc744 \ubcfc \uc218 \uc788\uace0, \uac19\uc740 \uc5b4\uce74\uc6b4\ud2b8\ub85c \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc5d0 \ubc14\ub85c `admin` \ud568\uc218\ub97c \ud638\ucd9c\ud588\uc744 \ub54c\ub294 `_fallback` \uc73c\ub85c \ub118\uc5b4\uac00\uc11c \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc758 `admin` \ud568\uc218\uac00 \uc2e4\ud589\ub41c \uac83\uc744 \ubcfc \uc218 \uc788\ub2e4.\\n\\n### @openzeppelin/hardhat-upgrades\\n\\nhardhat\uc5d0\uc11c \uc81c\uacf5\ud558\ub294 \ud50c\ub7ec\uadf8\uc778\uc744 \uc0ac\uc6a9\ud558\uba74 \ud504\ub85d\uc2dc \ud328\ud134\uc744 \ud65c\uc6a9\ud55c \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8 \ubc30\ud3ec \ubc0f \uc5c5\uadf8\ub808\uc774\ub4dc\ub97c \ubcf4\ub2e4 \uc27d\uac8c \uc9c4\ud589\ud560 \uc218 \uc788\ub294\ub370, \uac00\uc7a5 \ub9ce\uc774 \uc0ac\uc6a9\ub418\ub294 `upgradeProxy` \ud568\uc218\uc758 \ub0b4\ubd80 \ucf54\ub4dc\ub97c \uc0b4\ud3b4\ubcf4\uba74 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc5d0 \ub4f1\ub85d\ub41c \uc5b4\ub4dc\ubbfc\uc774 EOA\uc778\uc9c0 CA\uc778\uc9c0\uc5d0 \ub530\ub77c \ub2e4\ub974\uac8c \ub3d9\uc791\ud558\ub294 \uac83\uc744 \ubcfc \uc218 \uc788\ub2e4.\\n\\n```ts\\nasync function getUpgrader(\\n  proxyAddress: string,\\n  signer: Signer\\n): Promise<Upgrader> {\\n  const { provider } = hre.network;\\n\\n  const adminAddress = await getAdminAddress(provider, proxyAddress);\\n  const adminBytecode = await getCode(provider, adminAddress);\\n\\n  if (adminBytecode === \\"0x\\") {\\n    // No admin contract: use TransparentUpgradeableProxyFactory to get proxiable interface\\n    const TransparentUpgradeableProxyFactory =\\n      await getTransparentUpgradeableProxyFactory(hre, signer);\\n    const proxy = TransparentUpgradeableProxyFactory.attach(proxyAddress);\\n\\n    return (nextImpl, call) =>\\n      call ? proxy.upgradeToAndCall(nextImpl, call) : proxy.upgradeTo(nextImpl);\\n  } else {\\n    // Admin contract: redirect upgrade call through it\\n    const manifest = await Manifest.forNetwork(provider);\\n    const AdminFactory = await getProxyAdminFactory(hre, signer);\\n    const admin = AdminFactory.attach(adminAddress);\\n    const manifestAdmin = await manifest.getAdmin();\\n\\n    if (admin.address !== manifestAdmin?.address) {\\n      throw new Error(\\n        \\"Proxy admin is not the one registered in the network manifest\\"\\n      );\\n    }\\n\\n    return (nextImpl, call) =>\\n      call\\n        ? admin.upgradeAndCall(proxyAddress, nextImpl, call)\\n        : admin.upgrade(proxyAddress, nextImpl);\\n  }\\n}\\n```\\n\\n`adminBytecode`\uac00 \uc874\uc7ac\ud558\uc9c0 \uc54a\ub294\ub2e4\ub294 \uac83\uc740 \ud574\ub2f9 \uc5b4\uce74\uc6b4\ud2b8\uac00 \ucee8\ud2b8\ub799\ud2b8\uac00 \uc544\ub2c8\ub77c\ub294 \uac83\uc774\uae30 \ub54c\ubb38\uc5d0 \uc774 \uacbd\uc6b0\uc5d0\ub294 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc5d0 \uc788\ub294 \uc5c5\uadf8\ub808\uc774\ub4dc \ud568\uc218\ub97c \uc9c1\uc811 \ud638\ucd9c\ud558\uace0, \uc5b4\ub4dc\ubbfc\uc774 \ucee8\ud2b8\ub799\ud2b8\ub77c\uba74 \uc5b4\ub4dc\ubbfc \ucee8\ud2b8\ub799\ud2b8 \uc8fc\uc18c\ub97c \uac00\uc838\uc640\uc11c \uc5b4\ub4dc\ubbfc \ucee8\ud2b8\ub799\ud2b8\uc5d0 \uc788\ub294 \uc5c5\uadf8\ub808\uc774\ub4dc \ud568\uc218\ub97c \ud638\ucd9c\ud558\ub294 \uc2dd\uc73c\ub85c \ub3d9\uc791\ud558\ub294 \uac83\uc774\ub2e4.\\n\\n### \ud22c\uba85\ud504\ub85d\uc2dc\uc758 \ub2e8\uc810\\n\\n\uc774\ub807\uac8c \ud22c\uba85\ud504\ub85d\uc2dc\ub97c \ud1b5\ud558\uc5ec ERC1967\uc5d0 \uc874\uc7ac\ud558\ub358 \ud568\uc218 \ucda9\ub3cc\uc758 \ubb38\uc81c\ub97c \ud574\uacb0\ud558\ub294 \uacfc\uc815\uc744 \uc0b4\ud3b4\ubcf4\uc558\ub2e4.\\n\\n\ud558\uc9c0\ub9cc \uc5ed\uc2dc \ud22c\uba85\ud504\ub85d\uc2dc\uc5d0\ub3c4 \ub2e8\uc810\uc740 \uc874\uc7ac\ud55c\ub2e4. ERC1967\uc5d0\uc11c \uc2dc\uc791\ud558\uc5ec \ud22c\uba85\ud504\ub85d\uc2dc\ub85c \uc774\uc5b4\uc838\uc624\uba74\uc11c \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8 \uc8fc\uc18c\uc758 \uc2a4\ud1a0\ub9ac\uc9c0 \ucda9\ub3cc \ubb38\uc81c, \ud568\uc218 \ucda9\ub3cc \ubb38\uc81c\uc640 \uac19\uc740 \ubcf4\uc548 \uad00\ub828 \ubb38\uc81c\ub4e4\uc740 \uc5b4\ub290 \uc815\ub3c4 \ud574\uacb0\ub418\uc5c8\ub2e4\uace0 \ubcfc \uc218 \uc788\ub2e4.\\n\\n\ub2e4\ub9cc \ubb38\uc81c\uac00 \ud574\uacb0\ub418\uc5c8\ub2e4\ub294 \uacb0\uacfc\ub3c4 \uc911\uc694\ud558\uc9c0\ub9cc, \uc5bc\ub9c8\ub098 \ud6a8\uc728\uc801\uc73c\ub85c \ubb38\uc81c\ub97c \ud574\uacb0\ud588\ub294\uc9c0 \uadf8 \uacfc\uc815\ub3c4 \uc911\uc694\ud560 \uac83\uc774\ub2e4.\\n\\n\ud22c\uba85\ud504\ub85d\uc2dc\uc758 \ubc29\uc2dd\uc744 \ub2e4\uc2dc \ub418\uc9da\uc5b4\ubcf4\uba74, \ud568\uc218 \ucda9\ub3cc \ubb38\uc81c\ub97c \ud574\uacb0\ud558\uae30 \uc704\ud574 \ud56d\uc0c1 \ud638\ucd9c\uc790\uac00 \ub204\uad6c\uc778\uc9c0\ub97c \ud544\uc218\uc801\uc73c\ub85c \ud655\uc778\ud574\uc57c\ud55c\ub2e4.\\n\\n\ud504\ub85c\ub355\ud2b8 \ud658\uacbd\uc5d0\uc11c \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc758 \uc5c5\uadf8\ub808\uc774\ub4dc \uae30\ub2a5\uc774 \ud638\ucd9c\ub418\ub294 \ube48\ub3c4\ub294 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc758 \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1\uc774 \ub2f4\uae34 \uae30\ub2a5\ub4e4\uc774 \ud638\ucd9c\ub418\ub294 \ube48\ub3c4\uc5d0 \ube44\ud574 \uadf9\ud788 \ub0ae\uc744 \uac83\uc774\ub2e4. \uadf8\ub7fc\uc5d0\ub3c4 \ucee8\ud2b8\ub799\ud2b8\uc758 \uae30\ub2a5\uc774 \ud638\ucd9c\ub420 \ub54c\ub9c8\ub2e4 \ud638\ucd9c\uc790\uac00 \uc5b4\ub4dc\ubbfc\uc778\uc9c0 \uc5ec\ubd80\ub97c \ud56d\uc0c1 \ud655\uc778\ud558\ub294 \ud22c\uba85\ud504\ub85d\uc2dc\uc758 \ubc29\uc2dd\uc740 \uadf8\ub9ac \ud6a8\uc728\uc801\uc774\ub77c\uace0 \ubcfc \uc218 \uc5c6\ub2e4.\\n\\n\ud2b9\ud788 \uc774\ub354\ub9ac\uc6c0\uc744 \uc0ac\uc6a9\ud558\uba74 \uac00\uc2a4\ube44 \ubb38\uc81c\ub294 \ubcf4\uc548 \ubb38\uc81c\ub9cc\ud07c\uc774\ub098 \uc911\uc694\ud55c \ubb38\uc81c\uc774\ub2e4. \ucee8\ud2b8\ub799\ud2b8 \uc0ac\uc6a9\uc790\ub4e4\uc758 \uc785\uc7a5\uc5d0\uc11c\ub294 \ubd88\ud544\uc694\ud55c \uc791\uc5c5\uc744 \ucd5c\ub300\ud55c \uc904\uc5ec \uac00\uc2a4\ube44\ub97c \ub0ae\ucdb0\uc8fc\ub294\uac8c \ubcf4\uc548\uc801\uc73c\ub85c \ubb38\uc81c\uac00 \uc5c6\ub294 \ucee8\ud2b8\ub799\ud2b8\ub9cc\ud07c\uc774\ub098 \uc88b\uc740 \ucee8\ud2b8\ub799\ud2b8\ub97c \ud310\ub2e8\ud558\ub294 \uc9c0\ud45c\uc77c \uac83\uc774\ub2e4.\\n\\n## UUPS\\n\\n\ud22c\uba85\ud504\ub85d\uc2dc\uc758 \ube44\ud6a8\uc728\uc801\uc778 \ubd80\ubd84\uc744 \uac1c\uc120\ud558\uace0 \ubcf4\ub2e4 \ud6a8\uc728\uc801\uc778 \ubc29\uc2dd\uc73c\ub85c \ud568\uc218 \ucda9\ub3cc \ubb38\uc81c\ub97c \ud574\uacb0\ud558\uae30 \uc704\ud574 \ub098\uc628 \uac83\uc774 UUPS\uc774\ub2e4.\\n\\nUUPS\ub294 [EIP-1822](https://eips.ethereum.org/EIPS/eip-1822)\uc5d0\uc11c \ub530\uc628 \uc774\ub984\uc73c\ub85c Universal Upgradeable Proxy Standard\uc758 \uc57d\uc790\uc774\ub2e4.\\n\\n\ud22c\uba85\ud504\ub85d\uc2dc\uac00 \uac00\uc9c4 \ube44\ud6a8\uc728\uc758 \uc694\uc810\uc740, \ud568\uc218 \ucda9\ub3cc\uc744 \ud574\uacb0\ud558\uae30 \uc704\ud574 \uc5b4\ub5a4 \uc694\uccad\uc5d0\uc11c\ub4e0 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc5d0 \ub4f1\ub85d\ub41c \uc5b4\ub4dc\ubbfc \uc8fc\uc18c\uac12\uc5d0 \uc811\uadfc\ud558\uc5ec \uc694\uccad\uc790\uc758 \uc8fc\uc18c\uc640 \ub3d9\uc77c\ud55c\uc9c0 \uc5ec\ubd80\ub97c \ud56d\uc0c1 \ud655\uc778\ud574\uc57c\ud55c\ub2e4\ub294 \uac83\uc774\uc5c8\ub2e4.\\n\\n\uadf8\ub807\ub2e4\uba74 UUPS\ub294 \uc5b4\ub5a4 \ubc29\uc2dd\uc73c\ub85c \uc774\ub7f0 \ube44\ud6a8\uc728\uc744 \ud574\uacb0\ud588\uc744\uae4c? UUPS\uc5d0\uc11c\ub294 \ud568\uc218 \ucda9\ub3cc \ubb38\uc81c\ub97c \ud574\uacb0\ud558\uae30 \uc704\ud574 \ud638\ucd9c\uc790\ub97c \uae30\uc900\uc73c\ub85c \ud638\ucd9c \ud568\uc218\ub97c \uad6c\ubd84\ud558\ub294 \ubc29\uc2dd\uc774 \uc544\ub2c8\ub77c, \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc5d0 \uc874\uc7ac\ud558\ub294 \uc790\uccb4 \ud568\uc218\ub4e4\ub3c4 \uc544\uc608 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\ub85c \uc62e\uae30\ub294 \ubc29\uc2dd\uc744 \uc120\ud0dd\ud588\ub2e4.\\n\\n\uae30\uc874\uc5d0\ub294 \uc5c5\uadf8\ub808\uc774\ub4dc\uc640 \uad00\ub828\ub41c \uae30\ub2a5\uc758 \ud568\uc218\ub4e4\uc740 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\ub97c \ubc30\ud3ec\ud560 \ub54c \uc790\uccb4 \ud568\uc218\ub4e4\ub85c \uc774\ubbf8 \uad6c\ud604\ub418\uc5b4\uc788\uace0, \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc5d0\ub294 \uc5c5\uadf8\ub808\uc774\ub4dc \uc774\uc678\uc758 \uc2e4\uc81c \uc0ac\uc6a9\ud574\uc57c\ud560 \uae30\ub2a5\ub4e4\uc774 \ud568\uc218\ub85c \uad6c\ud604\ub418\uc5b4 \ubc30\ud3ec \ubc0f \uc5c5\uadf8\ub808\uc774\ub4dc \ub418\ub294 \ubc29\uc2dd\uc774\uc5c8\ub2e4.\\n\\n\ud558\uc9c0\ub9cc UUPS\uc5d0\uc11c\ub294 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc5d0 \uc790\uccb4 \ud568\uc218\uac00 \uc874\uc7ac\ud558\uc9c0 \uc54a\uace0 \uc5c5\uadf8\ub808\uc774\ub4dc\ub97c \ud3ec\ud568\ud55c \ubaa8\ub4e0 \uae30\ub2a5\ub4e4\uc774 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc5d0 \uc874\uc7ac\ud55c\ub2e4. \ub54c\ubb38\uc5d0 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\ub294 \uc5b4\ub5a4 \ud568\uc218\uc5d0 \ub300\ud55c \ud638\ucd9c\uc774 \ub4e4\uc5b4\uc640\ub3c4 \ubb34\uc870\uac74 fallback \ud568\uc218\uac00 \uc2e4\ud589\ub418\uc5b4 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc758 \ud568\uc218\ub97c \ud638\ucd9c\ud558\uac8c \ub41c\ub2e4.\\n\\n```sol title=\\"openzeppelin-contracts-upgradeable/contracts/proxy/utils/UUPSUpgradeable.sol\\"\\npragma solidity ^0.8.0;\\n\\nfunction getProxyAdmin(TransparentUpgradeableProxy proxy) public view virtual returns (address) {\\n    // We need to manually run the static call since the getter cannot be flagged as view\\n    // bytes4(keccak256(\\"admin()\\")) == 0xf851a440\\n    (bool success, bytes memory returndata) = address(proxy).staticcall(hex\\"f851a440\\");\\n    require(success);\\n    return abi.decode(returndata, (address));\\n}\\n```\\n\\n\uadf8\ub7fc \uc624\ud508\uc7ac\ud50c\ub9b0\uc758 UUPS \ucf54\ub4dc\ub97c \uc0b4\ud3b4\ubcf4\uc790. \uae30\uc874 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc5d0 \uc788\uc5c8\ub358 `upgradeTo` \ud568\uc218\uc640 `upgradeToAndCall` \ud568\uc218 \ub4f1\uc774 \uc774\uc81c\ub294 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc5d0 \ubaa8\ub450 \ud3ec\ud568\ub418\uc5b4\uc788\ub2e4.\\n\\n\uc5c5\uadf8\ub808\uc774\ub4dc \ud568\uc218\ub4e4\uc5d0\ub294 `onlyProxy`\ub77c\ub294 modifier\uac00 \ubd99\uc5b4\uc788\ub2e4. `__self`\uc5d0\ub294 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uac00 \ubc30\ud3ec\ub420 \ub54c \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8 \uc8fc\uc18c\uac12\uc774 \ub2f4\uaca8\uc788\uc744 \uac83\uc774\ub2e4.\\n\\n```sol\\nrequire(address(this) != __self, \\"Function must be called through delegatecall\\");\\n```\\n\\n\ub9cc\uc57d delegatecall\uc744 \ud1b5\ud574 \ud638\ucd9c\ub410\ub2e4\uba74, \ud604\uc7ac \ucf58\ud14d\uc2a4\ud2b8\uc758 \ucee8\ud2b8\ub799\ud2b8 \uc8fc\uc18c(address(this))\uac00 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc758 \uc8fc\uc18c\uac12\uc774 \uc544\ub2cc delegatecall\uc744 \uc2e4\ud589\ud55c \ucee8\ud2b8\ub799\ud2b8 (\ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8) \uc758 \uc8fc\uc18c\uc77c \uac83\uc774\ub2e4.\\n\\n```sol\\nrequire(_getImplementation() == __self, \\"Function must be called through active proxy\\");\\n```\\n\\n\uadf8\ub9ac\uace0 \ud574\ub2f9 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c `_getImplementation()`\ub85c \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc758 \uc8fc\uc18c\ub97c \uc870\ud68c\ud588\uc744 \ub54c \ud604\uc7ac \ud638\ucd9c\ud55c \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc758 \uc8fc\uc18c\uc640 \ub3d9\uc77c\ud55c\uc9c0\ub97c \uccb4\ud06c\ud568\uc73c\ub85c\uc368 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc758 \uc801\uc808\ud55c \uc694\uccad\uc774 \ub9de\ub294\uc9c0\ub97c \ud655\uc778\ud558\ub294 \uac83\uc774\ub2e4.\\n\\n<hr />\\n\\n\uc55e\uc11c ERC1967\uc5d0\uc11c\ub294 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8 \uc8fc\uc18c\uac00 \ub2f4\uae34 \uc0c1\ud0dc \ubcc0\uc218\uc758 \uc2a4\ud1a0\ub9ac\uc9c0 \ucda9\ub3cc \ubb38\uc81c\ub97c \ud574\uacb0\ud558\uae30 \uc704\ud574 \ud574\ub2f9 \ubcc0\uc218\ub97c \uc784\uc758\uc758 \uc2a4\ud1a0\ub9ac\uc9c0 \uc2ac\ub86f\ub118\ubc84\uc5d0 \ud560\ub2f9\ud558\ub294 \ubc29\uc2dd\uc744 \uc0ac\uc6a9\ud588\ub2e4. \uadf8\ub807\ub2e4\uba74 \uc5c5\uadf8\ub808\uc774\ub4dc \ud568\uc218\uac00 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc5d0 \uc788\uc744 \ub54c, \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\ub294 \uc5c5\uadf8\ub808\uc774\ub4dc \ub418\ub294 \uc8fc\uc18c\ub97c \ud560\ub2f9\ud560 \uc2ac\ub86f\ub118\ubc84\ub97c \uc54c\uace0 \uc788\uc5b4\uc57c\ud560 \uac83\uc774\ub2e4.\\n\\n```sol\\nfunction proxiableUUID() external view virtual override notDelegated returns (bytes32) {\\n  return _IMPLEMENTATION_SLOT;\\n}\\n```\\n\\n```sol title=\\"openzeppelin-contracts-upgradeable/contracts/proxy/ERC1967/ERC1967UpgradeUpgradeable.sol\\"\\npragma solidity ^0.8.0;\\n\\nfunction getProxyAdmin(TransparentUpgradeableProxy proxy) public view virtual returns (address) {\\n    // We need to manually run the static call since the getter cannot be flagged as view\\n    // bytes4(keccak256(\\"admin()\\")) == 0xf851a440\\n    (bool success, bytes memory returndata) = address(proxy).staticcall(hex\\"f851a440\\");\\n    require(success);\\n    return abi.decode(returndata, (address));\\n}\\n```\\n\\n`_upgradeToAndCallUUPS` \ud568\uc218\ub97c \uc0b4\ud3b4\ubcf4\uba74, \ucee8\ud2b8\ub799\ud2b8\uac00 \uc5c5\uadf8\ub808\uc774\ub4dc \ub420 \ub54c \uc0c8\ub85c\uc6b4 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8 \uc8fc\uc18c\ub85c `proxibleUUID` \ud568\uc218\ub97c call\ud558\uc5ec return\ub41c \uc2ac\ub86f \ub118\ubc84\uac12\uc774 \uae30\uc874 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\ub97c \ud560\ub2f9\ud574\ub450\uc5c8\ub358 \uc2ac\ub86f \ub118\ubc84\uc640 \uac19\uc740\uc9c0\ub97c \ud655\uc778\ud55c\ub2e4.\\n\\n\ub9cc\uc57d \uc2ac\ub86f\uc774 \uac19\uc9c0 \uc54a\uac70\ub098, \uc0c8 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc5d0 `proxibleUUID` \ud568\uc218\uac00 \uc874\uc7ac\ud558\uc9c0 \uc54a\uc73c\uba74 \uc5c5\uadf8\ub808\uc774\ub4dc\uac00 \ubd88\uac00\ub2a5\ud55c \uac83\uc744 \ubcfc \uc218 \uc788\ub2e4.\\n\\n<hr />\\n\\n\uc5c5\uadf8\ub808\uc774\ub4dc\uc640 \uad00\ub828\ub41c \uad8c\ud55c \uc124\uc815\uc740 `_authorizeUpgrade` \ud568\uc218\ub97c \ud1b5\ud574 \uc124\uc815\ud558\uba74 \ub41c\ub2e4.\\n\\n`_authorizeUpgrade`\ub294 \uc5c5\uadf8\ub808\uc774\ub4dc \ub85c\uc9c1\uc774 \uc2e4\ud589\ub418\uae30 \uc804\uc5d0 \ud56d\uc0c1 \uba3c\uc800 \uc2e4\ud589\ub418\ub294 \ud568\uc218\uc774\ub2e4.\\n\\n```sol title=\\"contracts/UUPS/v1.sol\\"\\npragma solidity ^0.8.0;\\n\\nimport \\"@openzeppelin/contracts-upgradeable/proxy/utils/UUPSUpgradeable.sol\\";\\nimport \\"@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol\\";\\n\\ncontract UUPSImplementationV1 is UUPSUpgradeable, OwnableUpgradeable {\\n    mapping(address => uint256) public counts;\\n\\n    function initialize(uint256 _count) public virtual initializer {\\n        __Ownable_init();\\n\\n        counts[msg.sender] = _count;\\n    }\\n\\n    function _authorizeUpgrade(address) internal override onlyOwner {}\\n\\n    function count() external virtual {\\n        counts[msg.sender] += 1;\\n    }\\n}\\n```\\n\\n\uc704\uc640 \uac19\uc774 `_authorizeUpgrade` \ud568\uc218\ub97c \uc624\ubc84\ub77c\uc774\ub529\ud558\uc5ec \uc5c5\uadf8\ub808\uc774\ub4dc\uc5d0 \ub300\ud55c \uad8c\ud55c \ubc0f \uc870\uac74\uc5d0 \ub300\ud55c \ub85c\uc9c1\uc744 \ucd94\uac00\ud574\uc8fc\uba74 \ub41c\ub2e4.\\n\\n<hr />\\n\\n\uc774\ucc98\ub7fc UUPS\ub294 \uae30\uc874 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc5d0 \uc788\ub358 \uc5c5\uadf8\ub808\uc774\ub4dc \ud568\uc218\ub97c \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\ub85c \ubaa8\ub450 \uc62e\uae40\uc73c\ub85c\uc368 \ubcf4\ub2e4 \uac00\uc2a4 \ud6a8\uc728\uc801\uc778 \ubc29\uc2dd\uc73c\ub85c \ud568\uc218 \ucda9\ub3cc \ubb38\uc81c\ub97c \ud574\uacb0\ud588\ub2e4. \uc55e\uc11c \uc598\uae30\ud588\ub4ef\uc774 \ub3d9\uc77c \ucee8\ud2b8\ub799\ud2b8 \uc548\uc5d0\uc11c\ub294 \ub3d9\uc77c\ud55c \ud568\uc218 \uc2dd\ubcc4\uc790\ub97c \uac00\uc9c4 \ud568\uc218\uac00 \uc874\uc7ac\ud560 \uc218 \uc5c6\uae30 \ub54c\ubb38\uc5d0, \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc5d0 \uc788\ub294 \ud568\uc218\ub4e4\ub07c\ub9ac\ub294 \ud568\uc218 \ucda9\ub3cc\uc774 \uc77c\uc5b4\ub098\uc9c0 \uc54a\ub294\ub2e4. \uc774\uc81c \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\ub294 \ud638\ucd9c\uc790\uac00 \ub204\uad6c\uc778\uc9c0\ub97c \ud655\uc778\ud560 \ud544\uc694\uc5c6\uc774 \ubb34\uc870\uac74 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\ub85c delegatecall \ud558\uae30\ub9cc \ud558\uba74 \ub41c\ub2e4.\\n\\n![UUPS](https://miro.medium.com/v2/resize:fit:720/format:webp/1*_mwOE2Ou0zf8x5kIiJAANg.png)\\n\\n\ud22c\uba85\ud504\ub85d\uc2dc\uc640 UUPS\uc758 \uac00\uc2a4\ube44 \ucc28\uc774\ub97c \uc0b4\ud3b4\ubcf4\uba74, \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc758 \ubc30\ud3ec \ube44\uc6a9\uc774 \ub9e4\uc6b0 \uc800\ub834\ud574\uc9c4 \uac83\uc744 \ubcfc \uc218 \uc788\ub2e4. \uae30\uc874 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc5d0 \uad6c\ud604\ub418\uc5b4\uc788\ub358 \ud568\uc218\ub4e4\uc774 \ubaa8\ub450 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\ub85c \uc62e\uaca8\uac14\uae30 \ub54c\ubb38\uc5d0 \ub2f9\uc5f0\ud55c \uacb0\uacfc\uc77c \uac83\uc774\ub2e4. \ub9cc\uc57d \ud22c\uba85 \ud504\ub85d\uc2dc\ub97c \uc0ac\uc6a9\ud558\uba74 \ud1b5\uc0c1\uc801\uc73c\ub85c \ud504\ub85d\uc2dc \uc5b4\ub4dc\ubbfc\uc73c\ub85c \uc124\uc815\ud560 \uc5b4\ub4dc\ubbfc \ucee8\ud2b8\ub799\ud2b8\ub3c4 \ud568\uaed8 \ubc30\ud3ec\ud558\uae30 \ub54c\ubb38\uc5d0, UUPS\ub97c \uc0ac\uc6a9\ud558\uba74 \uc774 \ube44\uc6a9\ub3c4 \uc808\uc57d\ud560 \uc218 \uc788\ub2e4.\\n\\n\ubb3c\ub860 \ubc18\ub300\ub85c \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\ub97c \ubc30\ud3ec\ud560 \ub54c\ub294 \ube44\uc6a9\uc774 \uc99d\uac00\ud55c \uac83\uc744 \ubcfc \uc218 \uc788\ub2e4. \uc544\ubb34\ub798\ub3c4 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\ub294 \ucd5c\ucd08 \ud55c \ubc88 \ubc30\ud3ec\ub418\uace0, \uc774\ud6c4\uc5d0\ub294 \uc5c5\uadf8\ub808\uc774\ub4dc \ub420 \ub54c\ub9c8\ub2e4 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\ub9cc \ubc30\ud3ec\ub418\uae30 \ub54c\ubb38\uc5d0 \uc7a5\uae30\uc801\uc778 \ubc30\ud3ec \ube44\uc6a9\uc744 \uc0dd\uac01\ud558\uba74 UUPS\uac00 \ub354 \ube44\uc2f8\ub2e4\uace0 \ubcfc \uc218 \uc788\ub2e4.\\n\\n\ud558\uc9c0\ub9cc \uc911\uc694\ud55c \uac83\uc740 \ucee8\ud2b8\ub799\ud2b8 \ub7f0\ud0c0\uc784\uc2dc\uc5d0 \uc624\ubc84\ud5e4\ub4dc\uac00 \uc904\uc5b4\ub4e4\uc5c8\ub2e4\ub294 \uc810\uc774\ub2e4. UUPS\uc5d0\uc11c\ub294 \ud568\uc218\uac00 \ud638\ucd9c\ub420 \ub54c\ub9c8\ub2e4 \uc5b4\ub4dc\ubbfc \ubcc0\uc218 \uc2a4\ud1a0\ub9ac\uc9c0\uc5d0 \uc811\uadfc\ud558\uc5ec \uac12\uc744 \ube44\uad50\ud558\ub294 \uc5f0\uc0b0\uc744 \ud558\uc9c0 \uc54a\uc544\ub3c4 \ub418\uae30 \ub54c\ubb38\uc774\ub2e4.\\n\\n<hr />\\n\\nUUPS\ub97c \uc0ac\uc6a9\ud560 \ub54c \uc720\ub150\ud574\uc57c\ud560 \uc810\uc740 \uc5c5\uadf8\ub808\uc774\ub4dc \uae30\ub2a5\uc774 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc5d0 \uc874\uc7ac\ud558\uae30 \ub54c\ubb38\uc5d0, \ub9cc\uc57d \uc0c8\ub86d\uac8c \uc5c5\uadf8\ub808\uc774\ub4dc\ud55c \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8 \ucabd\uc5d0 \uc5c5\uadf8\ub808\uc774\ub4dc\ub97c \uc218\ud589\ud558\ub294 \ud568\uc218\uac00 \uc874\uc7ac\ud558\uc9c0 \uc54a\ub294\ub2e4\uba74 \ub354 \uc774\uc0c1\uc758 \uc5c5\uadf8\ub808\uc774\ub4dc\uac00 \ubd88\uac00\ub2a5\ud574\uc9c4\ub2e4\ub294 \uc810\uc774\ub2e4.\\n\\n\uc624\ud788\ub824 \uc774\ub7f0 \ud2b9\uc131\uc744 \uc774\uc6a9\ud558\uc5ec \ub354 \uc774\uc0c1\uc758 \uc5c5\uadf8\ub808\uc774\ub4dc\uac00 \ubd88\uac00\ub2a5\ud558\uac8c \ub9cc\ub4e4\uace0 \uc2f6\uc744 \ub54c \uace0\uc758\uc801\uc73c\ub85c \uc5c5\uadf8\ub808\uc774\ub4dc \uae30\ub2a5\uc744 \ubc30\uc81c\ud55c \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\ub85c \uc5c5\uadf8\ub808\uc774\ub4dc \ud558\ub294 \uc2dd\uc73c\ub85c UUPS\ub97c \uc6b4\uc601\ud560 \uc218\ub3c4 \uc788\ub2e4.\\n\\nUUPS\uc758 \ub610 \ub2e4\ub978 \uc7a5\uc810 \uc911\uc5d0 \ud558\ub098\ub294 \uc5c5\uadf8\ub808\uc774\ub4dc \uae30\ub2a5\uc774 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc5d0 \ubd84\ub9ac\ub3fc\uc788\uc9c0 \uc54a\uae30 \ub54c\ubb38\uc5d0, \uc5c5\uadf8\ub808\uc774\ub4dc \uae30\ub2a5\uc744 \uc5b4\ub4dc\ubbfc \uae30\ub2a5\uc73c\ub85c\ub9cc \uc81c\ud55c\ud558\uc9c0 \uc54a\uace0 \uc11c\ube44\uc2a4\uc640 \uc5f0\uacc4\ud558\uc5ec \uc720\uc800\ub4e4\ub3c4 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uae30\ub2a5\uc73c\ub85c \uc720\uc5f0\ud558\uac8c \ub9cc\ub4e4 \uc218 \uc788\ub2e4\ub294 \uc810\uc774\ub2e4.\\n\\n\uc608\ub97c \ub4e4\uc5b4 \uc5c5\uadf8\ub808\uc774\ub4dc \ud568\uc218\uc758 \uad8c\ud55c\uc744 \ub2e8\uc21c\ud788 \ud2b9\uc815 \uc5b4\uce74\uc6b4\ud2b8\ub85c \uc124\uc815\ud574\ub193\ub294 \uac83\uc774 \uc544\ub2c8\ub77c, \uc5b4\ub5a4 \uc870\uac74\uc744 \ub2ec\uc131\ud55c \uc5b4\uce74\uc6b4\ud2b8\uc778 \uacbd\uc6b0\uc5d0 \uc2e4\ud589\ud560 \uc218 \uc788\ub294 \uc2dd\uc73c\ub85c \uc124\uc815\ud574\ub193\ub294\ub2e4\uba74, \uae30\ub2a5 \ucd94\uac00\uc5d0 \ub300\ud55c \uac70\ubc84\ub10c\uc2a4 \ud22c\ud45c\ub97c \ud1b5\ud574 \uc120\uc815\ub41c \uae30\ub2a5\uc744 \uc81c\uc548\ud55c \uc720\uc800\uac00 \uc5c5\uadf8\ub808\uc774\ub4dc\ub97c \uc9c1\uc811 \uc218\ud589\ud558\uac8c \ub9cc\ub4e4 \uc218 \uc788\ub2e4.\\n\\n(\ubb3c\ub860 \ud22c\uba85\ud504\ub85d\uc2dc\uc5d0\uc11c\ub3c4 \uc5b4\ub4dc\ubbfc \ucee8\ud2b8\ub799\ud2b8\ub97c \ud1b5\ud574 \uc774\ub7f0 \ub85c\uc9c1\uc744 \uc801\uc6a9\uc2dc\ud0a4\ub294 \uac83\uc774 \uac00\ub2a5\ud558\uc9c0\ub9cc, \uc720\uc800\ub294 \uc5c5\uadf8\ub808\uc774\ub4dc \uae30\ub2a5\uacfc \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc5d0 \uc788\ub294 \uae30\ub2a5\uc744 \ubcc4 \uac1c\uc758 \ucee8\ud2b8\ub799\ud2b8\ub85c \ub098\ub204\uc5b4 \uc0ac\uc6a9\ud574\uc57c \ud55c\ub2e4.)\\n\\n## \ub9fa\uc74c\ub9d0\\n\\nERC1967\ubd80\ud130 \ud22c\uba85\ud504\ub85d\uc2dc, UUPS\uae4c\uc9c0 \uc5c5\uadf8\ub808\uc774\ub4dc \uac00\ub2a5\ud55c \ucee8\ud2b8\ub799\ud2b8\ub97c \uad6c\ud604\ud558\uae30 \uc704\ud574 \uac00\uc7a5 \ubcf4\ud3b8\uc801\uc73c\ub85c \uc0ac\uc6a9\ub418\uace0\uc788\ub294 \uc5ec\ub7ec \ubc29\uc2dd\uc758 \ud504\ub85d\uc2dc \ud328\ud134\uc5d0 \ub300\ud574 \uc54c\uc544\ubcf4\uc558\ub2e4.\\n\\n\ubb3c\ub860, \ub9c8\uc9c0\ub9c9\uc5d0 \uc0b4\ud3b4\ubcf8 UUPS \ubc29\uc2dd\ub3c4 \uc7a5\uc810\ub9cc \uc874\uc7ac\ud558\ub294 \uac83\uc740 \uc544\ub2d0 \uac83\uc774\ub2e4. \uae30\ubcf8\uc801\uc73c\ub85c \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c \uc120\uc5b8\ub418\ub294 \ubcc0\uc218\ub4e4\uc758 \uc2a4\ud1a0\ub9ac\uc9c0 \ucda9\ub3cc\uc740 \ud504\ub85d\uc2dc \ud328\ud134\uc744 \uc0ac\uc6a9\ud560 \ub54c \uc5ec\uc804\ud788 \ud070 \ubb38\uc81c\ub97c \ubd88\ub7ec\uc77c\uc73c\ud0ac \uc218 \uc788\ub294 \ubd80\ubd84\uc774\uae30 \ub54c\ubb38\uc5d0 \ud56d\uc0c1 \uc720\ub150\ud558\uc5ec \uc0ac\uc6a9\ud574\uc57c \ud55c\ub2e4.\\n\\n\ub610\ud55c \ucee8\ud2b8\ub799\ud2b8\ub294 \ubc30\ud3ec\uc2dc\uc5d0 24KB\uc758 \ud06c\uae30 \uc81c\ud55c\uc774 \uc788\uae30 \ub54c\ubb38\uc5d0 \ucee8\ud2b8\ub799\ud2b8\ub97c \uacc4\uc18d \uc5c5\uadf8\ub808\uc774\ub4dc \ud558\uba74\uc11c \uae30\ub2a5 \ubc0f \uc2a4\ud1a0\ub9ac\uc9c0 \ubcc0\uc218\ub97c \ucd94\uac00\ud558\ub294 \ub370\uc5d0\ub3c4 \uadfc\ubcf8\uc801\uc778 \ud55c\uacc4\uac00 \uc788\ub2e4. \uc774\ub7f0 \ub2e8\uc810\uc744 \ud574\uacb0\ud558\uae30 \uc704\ud574 \uc81c\uc548\ub41c [\ub2e4\uc774\uc544\ubaac\ub4dc \ud328\ud134](https://eip2535diamonds.substack.com/p/introduction-to-the-diamond-standard?s=r)\uc774\ub77c\ub294 \uac83\ub3c4 \uc874\uc7ac\ud55c\ub2e4. \ub2e4\uc774\uc544\ubaac\ub4dc \ud328\ud134\uc5d0 \ub300\ud574\uc11c\ub3c4 \ub2e4\uc74c\uc5d0 \uae30\ud68c\uac00 \ub41c\ub2e4\uba74 \uc790\uc138\ud788 \uc0b4\ud3b4\ubcf4\ub3c4\ub85d \ud558\uaca0\ub2e4.\\n\\n\uc774\ub807\uac8c \uc624\ud508\uc7ac\ud50c\ub9b0\uc744 \ud544\ub450\ub85c\ud55c \uc774\ub354\ub9ac\uc6c0 \uc0dd\ud0dc\uacc4\uc5d0\uc11c\ub294 \ub354 \ud6a8\uc728\uc801\uc774\uace0 \ub354 \uc548\uc815\uc801\uc778 \uc5c5\uadf8\ub808\uc774\ub4dc \uac00\ub2a5\ud55c \ucee8\ud2b8\ub799\ud2b8\ub97c \uad6c\ud604\ud558\uae30 \uc704\ud574 \uc0c8\ub85c\uc6b4 \uc544\uc774\ub514\uc5b4\uc640 \uae30\uc220\uc801 \uc811\uadfc\uc744 \ud1b5\ud55c \uc624\ud508\uc18c\uc2a4\ub4e4\uc774 \ub04a\uc784\uc5c6\uc774 \uc81c\uc548\ub418\uace0 \uc788\ub2e4.\\n\\n### \uc2a4\ub9c8\ud2b8 \ucee8\ud2b8\ub799\ud2b8\uc758 \ubd88\ubcc0\uc131\\n\\n\uac1c\uc778\uc801\uc73c\ub85c \ub04a\uc784\uc5c6\uc774 \uac1c\uc120\ub418\uace0 \ubc1c\uc804\ud558\ub294 \ubc29\uc2dd\ub4e4\uc744 \uc774\ud574\ud558\uace0 \ud559\uc2b5\ud558\uba70 \uac1c\ubc1c \ud658\uacbd\uc5d0 \uc801\uc6a9\ud558\ub294 \uac83\ub3c4 \uc911\uc694\ud558\uc9c0\ub9cc, \uc5c5\uadf8\ub808\uc774\ub4dc \uac00\ub2a5\ud55c \ucee8\ud2b8\ub799\ud2b8\ub77c\ub294 \ud0a4\uc6cc\ub4dc\uc5d0 \uc811\uadfc\ud560 \ub54c\ub294 \uae30\uc220\uc801\uc778 \uace0\ubbfc\uacfc \ud568\uaed8 \ucee8\ud2b8\ub799\ud2b8\uc5d0 \ub300\ud55c \uc758\ubbf8\ub860\uc801\uc778 \uace0\ubbfc\ub3c4 \ubcd1\ud589\ub3fc\uc57c\ud55c\ub2e4\uace0 \uc0dd\uac01\ud55c\ub2e4.\\n\\n\uc774\uc804 \uae00\uc5d0\uc11c \ucee8\ud2b8\ub799\ud2b8\uc758 \ubd88\ubcc0\uc131\uc5d0 \ub300\ud574 \uc598\uae30\ud560 \ub54c \uc5b8\uae09\ud588\ub4ef\uc774, \uc2a4\ub9c8\ud2b8 \ucee8\ud2b8\ub799\ud2b8\ub780 \uadfc\ubcf8\uc801\uc73c\ub85c \ub514\uc9c0\ud138 \uacc4\uc57d\uc11c\ub85c\uc11c\uc758 \uc5ed\ud560\uc744 \ud558\uae30 \uc704\ud574 \ud0c4\uc0dd\ud55c \uae30\uc220\uc774\ub2e4. \uadf8\ub7f0 \uba74\uc5d0\uc11c \uacc4\uc57d\uc758 \ubd88\ubcc0\uc131\uc740 \ub2e8\uc21c\ud788 \ubd88\ud3b8\ud558\uace0 \uadf8\ub807\uae30 \ub54c\ubb38\uc5d0 \uadf9\ubcf5\ub3fc\uc57c\ud558\ub294 \uc81c\uc57d\uc0ac\ud56d\uc73c\ub85c\uc11c\ub9cc \uc874\uc7ac\ud558\ub294 \uac83\uc774 \uc544\ub2c8\ub77c web3 \uc0dd\ud0dc\uacc4\uc5d0\uc11c \ud0c8\uc911\uc559\ud654\ub41c \uc11c\ube44\uc2a4\ub97c \uc81c\uacf5\ud558\uae30 \uc704\ud55c \uc911\uc694\ud55c \uc815\uccb4\uc131 \uc911\uc5d0 \ud558\ub098\uc774\ub2e4.\\n\\n\ub530\ub77c\uc11c \uc5b4\ub5a4 \ub514\uc571\uc5d0\uc11c \uc5c5\uadf8\ub808\uc774\ub4dc \uac00\ub2a5\ud55c \ucee8\ud2b8\ub799\ud2b8\ub97c \ub3c4\uc785\ud55c\ub2e4\uace0 \ud588\uc744 \ub54c\ub294 \ubb34\uc870\uac74\uc801\uc73c\ub85c \ud3b8\ub9ac\ud558\uace0 \ud6a8\uc728\uc801\uc778 \uc5c5\uadf8\ub808\uc774\ub4dc\ub9cc \ucd94\uad6c\ud558\uae30\ubcf4\ub2e4, \ud0c8\uc911\uc559\uc131\uacfc \uc11c\ube44\uc2a4 \uad00\ub9ac \uce21\uba74 \uc0ac\uc774\uc5d0\uc11c\uc758 \uc801\uc808\ud55c \uade0\ud615\uc774 \ud56d\uc0c1 \uace0\ub824\ub3fc\uc57c\ud55c\ub2e4.\\n\\n\uc544\ubb34\ub9ac \uc11c\ube44\uc2a4 \uac1c\uc120\uacfc \ub354 \ub2e4\uc591\ud55c \uae30\ub2a5 \ucd94\uac00\ub97c \ubaa9\uc801\uc73c\ub85c \ud558\ub294 \uc5c5\uadf8\ub808\uc774\ub4dc\ub77c\uace0 \ud558\ub354\ub77c\ub3c4, \uc5b4\ub4dc\ubbfc \ucc28\uc6d0\uc5d0\uc11c \ub2e8 \ud55c\ubc88\uc758 \ud2b8\ub79c\uc7ad\uc158\uc73c\ub85c \ucee8\ud2b8\ub799\ud2b8\uc758 \uc8fc\uc694 \ub85c\uc9c1\uc774 \ubcc0\uacbd\ub420 \uc218 \uc788\ub2e4\uace0 \ud55c\ub2e4\uba74 \uc720\uc800\ub294 \uacfc\uc5f0 \uadf8 \ucee8\ud2b8\ub799\ud2b8\ub97c \uacc4\uc57d\uc11c\ub85c\uc11c \uc2e0\ub8b0\ud560 \uc218 \uc788\uc744\uae4c? \uadf8\ub9ac\uace0 \uadf8\ub7f0 \uacc4\uc57d\uc11c\ub4e4\ub85c \uc774\ub8e8\uc5b4\uc9c4 \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uacfc\uc5f0 \ub514\uc571\uc774\ub77c\uace0 \ubd80\ub97c \uc218 \uc788\uc744\uae4c?\\n\\n<hr />\\n\\n\uae00\uc5d0\uc11c \uc5b8\uae09\ub41c \uc608\uc2dc\ucf54\ub4dc\ub294 [\ub9c1\ud06c](https://github.com/chihunmanse/solidity-upgradeable)\ub85c \ub4e4\uc5b4\uac00\uba74 \ubcfc \uc218 \uc788\uace0, \uc9c1\uc811 \ud14c\uc2a4\ud2b8 \uacb0\uacfc\ub97c \ud655\uc778\ud574\ubcfc \uc218 \uc788\ub2e4."},{"id":"/2022/06/10/blockchain/upgradeable-contract1","metadata":{"permalink":"/2022/06/10/blockchain/upgradeable-contract1","source":"@site/blog/blockchain/2022-06-10-upgradeable-contract1.mdx","title":"Upgradeable Contract 1 - Migration, DelegateCall","description":"writing upgradeable contract with solidity.","date":"2022-06-10T00:00:00.000Z","formattedDate":"June 10, 2022","tags":[{"label":"BlockChain","permalink":"/tags/block-chain"},{"label":"Solidity","permalink":"/tags/solidity"}],"readingTime":23.365,"hasTruncateMarker":true,"authors":[{"name":"Chihun Park","url":"https://github.com/chihunmanse","email":"chihunmanse@gmail.com","imageURL":"https://p.ipic.vip/o1ih3g.png","key":"chihun"}],"frontMatter":{"title":"Upgradeable Contract 1 - Migration, DelegateCall","description":"writing upgradeable contract with solidity.","keywords":["solidity","ethereum","contract","blockchain","delegatecall"],"tags":["BlockChain","Solidity"],"authors":"chihun"},"prevItem":{"title":"Upgradeable Contract 2 - ERC1967, TransparentProxy, UUPS","permalink":"/2022/06/20/blockchain/upgradeable-contract2"},"nextItem":{"title":"NestJS & MongoDB Project","permalink":"/2022/02/10/backend/project/nestJS"}},"content":"import Tabs from \\"@theme/Tabs\\";\\nimport TabItem from \\"@theme/TabItem\\";\\n\\n## \uc2a4\ub9c8\ud2b8 \uacc4\uc57d\uc758 \ubd88\ubcc0\uc131\\n\\n\ucee8\ud2b8\ub799\ud2b8\ub97c \uac1c\ubc1c\ud558\uba74\uc11c \uac00\uc7a5 \uae4c\ub2e4\ub86d\uac8c \ub290\uaef4\uc9c0\ub294 \uc9c0\uc810\uc911\uc5d0 \ud558\ub098\ub294 \ubc30\ud3ec \uc774\ud6c4\uc5d0\ub294 \ucf54\ub4dc\ub97c \uc218\uc815\ud560 \uc218 \uc5c6\ub2e4\ub294 \uac83\uc774\ub2e4.\\n\\n\uc2a4\ub9c8\ud2b8 \ucee8\ud2b8\ub799\ud2b8\ub294 \uc774\ub984 \uadf8\ub300\ub85c \ub514\uc9c0\ud138\ud654\ub41c \uacc4\uc57d\uc11c\uc758 \uc5ed\ud560\uc744 \ud558\uae30 \ub54c\ubb38\uc5d0 \uacc4\uc57d\uc758 \ubd88\ubcc0\uc131\uc740 \uae30\uc220\uc801\uc778 \uad00\uc810\uacfc \ubcc4\uac1c\ub85c, Dapp \uc0dd\ud0dc\uacc4\uc5d0\uc11c \uc911\uc694\ud55c \ud2b9\uc131 \uc911\uc5d0 \ud558\ub098\uc774\ub2e4.\\n\\n\ub9cc\uc57d \ucee8\ud2b8\ub799\ud2b8\uc758 \ucf54\ub4dc\ub97c \ub9c8\uc74c\ub300\ub85c \uc218\uc815\ud560 \uc218 \uc788\uc5b4\uc11c, \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \uc8fc\uc694\ud55c \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1\ub4e4\uc774 \uad00\ub9ac\uc790\uc5d0 \uc758\ud574 \uc5b8\uc81c\ub4e0\uc9c0 \ubc14\ub014 \uc218 \uc788\ub2e4\uba74 \uc0ac\uc6a9\uc790\ub4e4\uc740 \uadf8 \ucf54\ub4dc\ub97c \ud558\ub098\uc758 \uacc4\uc57d\uc73c\ub85c \uc2e0\uc784\ud560 \uc218 \uc5c6\uc744 \uac83\uc774\ub2e4. \ub530\ub77c\uc11c \uc2a4\ub9c8\ud2b8\uacc4\uc57d\uc758 \ubd88\ubcc0\uc131\uc740 web3\uc758 \ud0c8\uc911\uc559\uc131\uacfc \uc9c1\uc811\uc801\uc73c\ub85c \uc5f0\uacb0\ub418\uc5b4\uc788\ub2e4.\\n\\n\ud558\uc9c0\ub9cc \ucee8\ud2b8\ub799\ud2b8\ub97c \uc791\uc131\ud558\ub294 \uac1c\ubc1c\uc790 \uc785\uc7a5\uc5d0\uc11c\ub294, \ubc30\ud3ec \uc774\ud6c4\uc5d0 \ucf54\ub4dc\ub97c \uc218\uc815\ud560 \uc218 \uc5c6\ub2e4\ub294 \uc0ac\uc2e4\uc740 \uc7a5\uc810\ubcf4\ub2e4\ub294 \ucee4\ub2e4\ub780 \uc81c\uc57d\uc774\uc790 \ubd80\ub2f4\uac10\uc73c\ub85c \ub2e4\uac00\uc628\ub2e4.\\n\\n\ud639 \uc0ac\uc18c\ud55c \uc2e4\uc218\uac00 \ub2f4\uae34 \ucf54\ub4dc\ub97c \ubc30\ud3ec\ud558\uc9c0\ub294 \uc54a\uc558\uc744 \uc9c0, \uadf8 \uc0ac\uc18c\ud55c \uc2e4\uc218\uac00 \uc8fc\uc694\ud55c \ubcf4\uc548 \ubb38\uc81c\ub97c \uc57c\uae30\uc2dc\ud0a4\uc9c0\ub294 \uc54a\uc744 \uc9c0, \uc194\ub9ac\ub514\ud2f0 \ubc0f \uc774\ub354\ub9ac\uc6c0\uc5d0 \ub300\ud55c \ubd80\uc871\ud55c \uc774\ud574\ub3c4\ub85c \ube44\ud6a8\uc728\uc801\uc778 \ucf54\ub4dc\ub97c \uc791\uc131\ud558\uc9c0\ub294 \uc54a\uc558\uc744 \uc9c0, \ud6c4\uc5d0 \ub354 \ub098\uc740 \ubc29\uc2dd\uc744 \uc775\ud788\ub354\ub77c\ub3c4 \ub9ac\ud329\ud1a0\ub9c1\uc744 \uc9c4\ud589\ud560 \uc218 \uc5c6\ub2e4\ub294 \uc810\uae4c\uc9c0. \ucee8\ud2b8\ub799\ud2b8\ub97c \ubc30\ud3ec\ud558\ub294 \uc21c\uac04\uc5d0 \uadf8 \ucf54\ub4dc\uac00 \ubaa8\ub4e0 \ubc29\uba74\uc5d0\uc11c \uc644\uacb0\ub418\uc5c8\ub294 \uc9c0\ub97c \uac80\uc99d\ud574\uc57c \ud55c\ub2e4\ub294 \uc555\ubc15\uac10\uc740 \uc0c1\ub2f9\ud558\ub2e4.\\n\\n\uac1c\ubc1c\uc790 \ubfd0\ub9cc \uc544\ub2c8\ub77c, \uc2a4\ub9c8\ud2b8 \ucee8\ud2b8\ub799\ud2b8\ub97c \uae30\ubc18\uc73c\ub85c \ud55c \ud504\ub85c\uc81d\ud2b8\ub97c \uae30\ud68d \ubc0f \uc6b4\uc601\ud558\ub294 \uad00\ub9ac\uc790\uc758 \uc785\uc7a5\ub3c4 \ube44\uc2b7\ud560 \uac83\uc774\ub2e4. \uae30\uc874 \uae30\ub2a5\uc5d0 \ub300\ud55c \uae30\ud68d\uc774 \ubcc0\uacbd\ub418\uc5c8\uac70\ub098, \uc720\uc800\ub4e4\uc758 \ubc18\uc751 \ubc0f \uae30\ud0c0 \uc0c1\ud669\uc5d0 \ub530\ub77c \uc7ac\ube60\ub974\uace0 \uc720\uc5f0\ud55c \ubcc0\ud654\ub97c \ud544\uc694\ub85c \ud560 \ub54c\ub3c4 \ucee8\ud2b8\ub799\ud2b8\uc758 \ubd88\ubcc0\uc131\uc740 \ucee4\ub2e4\ub780 \uc81c\uc57d\uc774\uae30 \ub54c\ubb38\uc774\ub2e4.\\n\\n\uc774\ub7ec\ud55c \ubd88\ud3b8\ud568\ub4e4\uc744 \ub9ce\uc740 \uc0ac\ub78c\ub4e4\uc774 \ube44\uc2b7\ud558\uac8c \ub290\ub07c\uace0 \uc788\uc5c8\uc744 \uac83\uc774\uae30\uc5d0, \uc5c5\uadf8\ub808\uc774\ub4dc \uac00\ub2a5\ud55c \ucee8\ud2b8\ub799\ud2b8\uc5d0 \ub300\ud55c \ub2e4\uc591\ud55c \uae30\uc220\uc801 \ubc29\uc2dd\uacfc \uc811\uadfc\ubc95\uc774 \uafb8\uc900\ud788 \ub098\uc624\uace0 \uc788\ub294 \uac83 \uac19\ub2e4. \uc774 \uae00\uc5d0\uc11c\ub294 \uadf8\ub7f0 \ub2e4\uc591\ud55c \ubc29\uc2dd \uc911\uc5d0 \uba87 \uac00\uc9c0\ub97c \ud559\uc2b5\ud558\uace0 \uc801\uc6a9\ud574\ubcf4\uba74\uc11c \uc775\ud78c \ub0b4\uc6a9\ub4e4\uacfc \uc18c\ubc15\ud55c \ub290\ub080\uc810\ub4e4\uc744 \uc815\ub9ac\ud574\ubcf4\ub824\uace0 \ud55c\ub2e4.\\n\\n\x3c!--truncate--\x3e\\n\\n## \ub9c8\uc774\uadf8\ub808\uc774\uc158(Migration)\\n\\n\uccab \ubc88\uc9f8 \ubc29\uc2dd\uc740 \uc218\uc815\ub41c \ucf54\ub4dc\ub97c \uc7ac\ubc30\ud3ec\ud558\uace0 \uc774\uc804 \ubc84\uc804\uc758 \ucee8\ud2b8\ub799\ud2b8\uc640 \ub3d9\uae30\ud654\uc2dc\ud0a4\ub294 \uac83\uc774\ub2e4. \uc774 \ubc29\uc2dd\uc740 \uc0ac\uc2e4 \uc5c5\uadf8\ub808\uc774\ub4dc \uac00\ub2a5\ud55c \ucee8\ud2b8\ub799\ud2b8\ub77c\uace0 \ubd84\ub958\ud560 \uc218 \uc5c6\ub294 \ubc29\uc2dd\uc774\uc9c0\ub9cc, \ud504\ub85d\uc2dc \ud328\ud134\uc758 \ud544\uc694\uc131\uacfc \ub9e5\ub77d\uc744 \uc774\ud574\ud558\ub294 \ub370\uc5d0 \ub3c4\uc6c0\uc744 \uc904 \uc218 \uc788\uace0 \uc5b4\ub5a4 \uba74\uc5d0\uc11c \uac00\uc7a5 \uc548\uc815\uc801\uc778 \ubc29\uc2dd\uc77c \uc218 \uc788\uae30 \ub54c\ubb38\uc5d0 \ud3ec\ud568\uc2dc\ucf30\ub2e4.\\n\\n```sol title=\\"contracts/migration/v1.sol\\"\\npragma solidity ^0.8.0;\\n\\ncontract Version1 {\\n    address public owner;\\n    bool public contractActive;\\n\\n    constructor() {\\n        owner = msg.sender;\\n        contractActive = true;\\n    }\\n\\n    mapping(address => uint256) public counts;\\n\\n    modifier whenContractActive() {\\n        require(contractActive, \\"contract unActive\\");\\n        _;\\n    }\\n\\n    function count() external whenContractActive {\\n        counts[msg.sender] += 1;\\n    }\\n\\n    function setContractActive(bool _contractActive) external {\\n        require(msg.sender == owner, \\"only owner\\");\\n        contractActive = _contractActive;\\n    }\\n}\\n```\\n\\n`count` \ud568\uc218\ub97c \ud638\ucd9c\ud55c sender\uc5d0\uac8c \uce74\uc6b4\ud2b8\ub97c 1 \ub354\ud574\uc8fc\ub294 \uac04\ub2e8\ud55c \uae30\ub2a5\uc758 \ucee8\ud2b8\ub799\ud2b8\uac00 \uc788\ub2e4. \ub9cc\uc57d \uc8fc\uc694 \uae30\ub2a5\uc774 \ubcc0\uacbd\ub418\uac70\ub098 \uae30\uc874 \ub85c\uc9c1\uc5d0 \uc5b4\ub5a4 \ubb38\uc81c\uac00 \ubc1c\uacac\ub418\uc5b4\uc11c `count` \ud568\uc218\ub97c \uc218\uc815\ud574\uc57c\ud55c\ub2e4\uace0 \uac00\uc815\ud574\ubcf4\uc790. \uc0c8\ub85c \uc791\uc131\ud55c `count` \ud568\uc218\ub97c \uac00\uc9c4 \ucee8\ud2b8\ub799\ud2b8\ub97c \ubc30\ud3ec\ud558\uace0, \uc720\uc800\ub4e4\uc5d0\uac8c \uc0c8\ub85c\uc6b4 \uc8fc\uc18c\uc758 \ucee8\ud2b8\ub799\ud2b8\ub97c \uc0ac\uc6a9\ud558\uac8c \ud558\ub294 \uac83\uc740 \uadf8\ub9ac \uc5b4\ub824\uc6b4 \uc77c\uc774 \uc544\ub2d0 \uc218 \uc788\uc9c0\ub9cc \ubb38\uc81c\ub294 \uc774\ubbf8 \ubc84\uc804 1\uc744 \uc0ac\uc6a9\ud558\uace0 \uc788\uc5c8\ub358 \uc720\uc800\ub4e4\uc758 \ub370\uc774\ud130\uac00 \uc0c8\ub85c\uc6b4 \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c\ub3c4 \uc774\uc5b4\uc838\uc57c \ud55c\ub2e4\ub294 \uc810\uc774\ub2e4.\\n\\n```sol title=\\"contracts/migration/v2.sol\\"\\n\\npragma solidity ^0.8.0;\\n\\ninterface IVersion1 {\\n    function counts(address) external view returns (uint256);\\n}\\n\\ncontract Version2 {\\n    address public owner;\\n    IVersion1 public version1;\\n    bool public contractActive;\\n\\n    constructor(IVersion1 _version1) {\\n        owner = msg.sender;\\n        version1 = _version1;\\n        contractActive = true;\\n    }\\n\\n    mapping(address => uint256) public counts;\\n    mapping(address => bool) private v1Counts;\\n\\n    modifier whenContractActive() {\\n        require(contractActive, \\"contract unActive\\");\\n        _;\\n    }\\n\\n    function count() external whenContractActive {\\n        if (!v1Counts[msg.sender]) {\\n            v1Counts[msg.sender] = true;\\n            uint256 v1Count = version1.counts(msg.sender);\\n            counts[msg.sender] += v1Count;\\n        }\\n        counts[msg.sender] += 2;\\n    }\\n\\n    function setContractActive(bool _contractActive) external {\\n        require(msg.sender == owner, \\"only owner\\");\\n        contractActive = _contractActive;\\n    }\\n}\\n```\\n\\n\ud55c \uac00\uc9c0 \ubc29\uc548\uc740 \uc0c8\ub85c \ubc30\ud3ec\ub418\ub294 \ucf54\ub4dc\uc5d0 \ubc84\uc804 1\uacfc\uc758 \ub3d9\uae30\ud654\ub97c \uc5fc\ub450\ud574\ub454 \ucf54\ub4dc\ub97c \ucd94\uac00\ud558\ub294 \uac83\uc774\ub2e4. \uc608\uc2dc \ucf54\ub4dc\uc5d0\uc11c\ub294 \ubc84\uc804 2\uc758 `count` \ud568\uc218\ub97c sender\uac00 \ucc98\uc74c \ud638\ucd9c\ud55c \uac83\uc774\ub77c\uba74 \ubc84\uc804 1\uc758 \uce74\uc6b4\ud2b8 \uac12\uc744 \uc870\ud68c\ud558\uace0 \uadf8 \uac12\uc744 \ub354 \ud574\uc8fc\ub294 \uacfc\uc815\uc744 \uac70\uce5c\ub2e4. \uadf8\ub9ac\uace0 \uac01 \ucee8\ud2b8\ub799\ud2b8\uc5d0\ub294 \ucee8\ud2b8\ub799\ud2b8\uc758 active \uc0c1\ud0dc\ub97c \uad00\ub9ac\ud558\uace0 \uc788\uc5b4\uc11c, \ub9cc\uc57d \ubc84\uc804 2\ub85c \uc5c5\uadf8\ub808\uc774\ub4dc \ub410\ub2e4\uba74 \ubc84\uc804 1\uc758 `count` \ud568\uc218\uac00 \ub354 \uc774\uc0c1 \uc791\ub3d9\ub418\uc9c0 \ubabb\ud558\uac8c \ubc84\uc804 1\uc758 active\ub97c false\ub85c \ubc14\uafb8\uba74 \ub41c\ub2e4.\\n\\n\uc774\uc640 \uac19\uc740 \ubc29\uc2dd\uc758 \ub2e8\uc810\uc740 \uba85\ubc31\ud558\ub2e4. \uc77c\ub2e8 \uc608\uc2dc\ucf54\ub4dc\uc5d0\uc11c\ub294 \uc544\uc8fc \uac04\ub2e8\ud55c `count` \uac12\ub9cc \uc62e\uae30\uace0 \uc788\uc74c\uc5d0\ub3c4 \ubc84\uc804 2\uc758 `count` \ud568\uc218\uc5d0\uc11c\ub294 \uc5ec\ub7ec \uc904\uc758 \ucf54\ub4dc\uac00 \ucd94\uac00 \ub41c\ub2e4. \ubc84\uc804 1\uc744 \uc0ac\uc6a9\ud558\ub358 \ubaa8\ub4e0 \uc720\uc800\ub4e4\uc758 \uae30\uc874 `count` \uac12\uc744 \uc62e\uae34 \ud6c4\uc5d0\ub3c4 \ubc84\uc804 2\uc758 `count` \ud568\uc218\ub294 \uc8fc\uc694 \ub85c\uc9c1\uc744 \uc218\ud589\ud558\uae30 \uc804\uc5d0 \uc5b8\uc81c\ub098 `v1Counts` \uc2a4\ud1a0\ub9ac\uc9c0\ub97c \uc870\ud68c\ud558\uc5ec sender\uc5d0 \ub9e4\ud551\ub41c bool \uac12\uc774 true\uc778\uc9c0 false\uc778\uc9c0\ub97c \ud655\uc778\ud560 \uac83\uc774\ub2e4.\\n\\n\ub610 \uc608\uc2dc\ucf54\ub4dc\uac00 \uc544\ub2cc \uc2e4\uc81c \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1\uc774 \ub2f4\uae34 \ucee8\ud2b8\ub799\ud2b8\uc5d0\ub294 \ud6e8\uc52c \ub354 \ubcf5\uc7a1\ud558\uace0 \ub2e4\uc591\ud55c \ubcc0\uc218\ub4e4\uc744 \ud544\uc694\ub85c \ud560 \uac83\uc774\ub2e4. \uadf8\ub7f0 \ubcf5\uc7a1\ud55c \ub370\uc774\ud130\ub4e4\uc744 \uc0c8\ub85c\uc6b4 \ubc84\uc804\uc758 \ucee8\ud2b8\ub799\ud2b8\uac00 \ub098\uc62c \ub54c\ub9c8\ub2e4 \uc544\ubb34\ub7f0 \ubb38\uc81c \uc5c6\uc774 \uacc4\uc18d\ud574\uc11c \uc774\uc5b4\ubc1b\ub294 \uac83\uc740 \ubb34\ucc99 \uae4c\ub2e4\ub86d\uace0, \uad6c\ud604\ud55c\ub2e4\uace0 \ud558\ub354\ub77c\ub3c4 \uae30\ub2a5\uacfc \uc0c1\uad00 \uc5c6\ub294 \uc5f0\uc0b0\ub4e4\uc744 \uc8fc\uc694 \ud568\uc218\ub4e4\uc5d0 \ucd94\uac00\ud574\uc57c \ud558\uae30 \ub54c\ubb38\uc5d0 \ube44\ud6a8\uc728\uc801\uc774\ub2e4.\\n\\n\ub610 \ub2e4\ub978 \ubc29\uc548\uc740 \uc880 \ub354 \ub2e8\uc21c\ud558\ub2e4. \uad00\ub9ac\uc790\uac00 \uc9c1\uc811 \uc0c8\ub85c\uc6b4 \ubc84\uc804\uc758 \ucee8\ud2b8\ub799\ud2b8\uc5d0 \uc774\uc804 \ucee8\ud2b8\ub799\ud2b8\uc5d0 \uc788\ub358 \ub370\uc774\ud130\ub4e4\uc744 \uc774\uad00\ud558\ub294 \uc791\uc5c5\uc744 \uc218\ud589\ud55c \ub4a4\uc5d0 \uc14b\ud305\uc774 \uc644\ub8cc\ub41c \ud6c4\ubd80\ud130 \uc0c8\ub85c\uc6b4 \ucee8\ud2b8\ub799\ud2b8\ub97c \uc0ac\uc6a9\ud558\ub3c4\ub85d \ud558\ub294 \uac83\uc774\ub2e4. \uc774\ub807\uac8c \ud558\uba74 \uc0c8\ub85c\uc6b4 \ubc84\uc804\uc758 \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c \ub9c8\uc774\uadf8\ub808\uc774\uc158\uc744 \uc704\ud55c \ucf54\ub4dc\ub97c \ucd94\uac00\ud558\uc9c0 \uc54a\uc544\ub3c4 \ub41c\ub2e4. (\ubb3c\ub860 \uc774\uc804 \ubc84\uc804\uc758 \ub370\uc774\ud130\ub97c \uad00\ub9ac\uc790\uac00 insert \ud558\uae30 \uc704\ud55c \uae30\ub2a5\uc740 \ucd94\uac00\ub3fc\uc788\uc5b4\uc57c \ud55c\ub2e4.) \uad00\ub9ac\uc790\ub294 \uc774\uc804 \ubc84\uc804 \ucee8\ud2b8\ub799\ud2b8\uc758 \uc870\ud68c\ud568\uc218\ub97c \uc774\uc6a9\ud558\uac70\ub098 \uc774\ubca4\ud2b8\ub97c \uc218\uc9d1\ud558\uc5ec \uc0c8\ub85c\uc6b4 \ucee8\ud2b8\ub799\ud2b8\ub85c \ub370\uc774\ud130\ub97c \uc62e\uae30\uae30\ub9cc \ud558\uba74 \ub41c\ub2e4. \uc774 \ubc29\uc2dd\uc758 \ub2e8\uc810\uc740 \ucee8\ud2b8\ub799\ud2b8\uac00 \uc5c5\uadf8\ub808\uc774\ub4dc \ub420 \ub54c\ub9c8\ub2e4 \uad00\ub9ac\uc790 \ucc28\uc6d0\uc5d0\uc11c\uc758 \ub9c8\uc774\uadf8\ub808\uc774\uc158 \ube44\uc6a9\uc774 \ubc1c\uc0dd\ud55c\ub2e4\ub294 \uac83\uacfc, \ub9c8\uc774\uadf8\ub808\uc774\uc158\uc758 \uc218\ud589\uc774 \uacc4\uc57d \ucf54\ub4dc\ub85c \uc774\ub8e8\uc5b4\uc9c0\ub294 \uac83\uc774 \uc544\ub2c8\ub77c \ubc14\uae65\uc5d0\uc11c \uc774\ub8e8\uc5b4\uc9c0\uae30 \ub54c\ubb38\uc5d0 \uadf8 \uacfc\uc815\uc5d0\uc11c \ub370\uc774\ud130\uac00 \uc720\uc2e4\ub418\uac70\ub098 \ubcc0\uc870\ub418\ub294 \uc704\ud5d8\uc131\uc774 \uc874\uc7ac\ud55c\ub2e4\ub294 \uac83\uc774\ub2e4.\\n\\n[\ucc38\uc870 \ubb38\uc11c](https://blog.trailofbits.com/2018/10/29/how-contract-migration-works)\\n\\n## \ub378\ub9ac\uac8c\uc774\ud2b8\ucf5c(DelegateCall)\\n\\n\uc704\uc5d0\uc11c \ub098\uc5f4\ub41c \uace0\ubbfc\ub4e4\uc744 \ud558\ub2e4\ubcf4\uba74, \ubc30\ud3ec \uc774\ud6c4 \ucee8\ud2b8\ub799\ud2b8\uc758 \ucf54\ub4dc\ub97c \uc218\uc815\ud560 \uc218 \uc5c6\ub2e4\ub294 \uc790\uce6b \ub2e8\uc21c\ud574\ubcf4\uc774\ub294 \uc81c\ud55c\uc0ac\ud56d\uc5d0 \ub300\ud574 \uc880 \ub354 \uad6c\uccb4\uc801\uc73c\ub85c \uc811\uadfc\ud560 \uc218 \uc788\uac8c \ub41c\ub2e4.\\n\\n\uc2a4\ub9c8\ud2b8\uacc4\uc57d\uc740 \uc2a4\ud1a0\ub9ac\uc9c0\uc5d0 \ud560\ub2f9\ub41c \ubcc0\uc218\ub4e4(\ub370\uc774\ud130\ub4e4)\uacfc \uadf8 \ub370\uc774\ud130\ub97c \ud65c\uc6a9\ud558\ub294 \ub85c\uc9c1\uc73c\ub85c \uad6c\uc131\ub3fc\uc788\ub2e4\uace0 \ubcfc \uc218 \uc788\ub2e4. \ub530\ub77c\uc11c \uacc4\uc57d\uc758 \uc218\uc815\uc744 \ud544\uc694\ub85c \ud560 \ub54c\ub3c4 \ub370\uc774\ud130 \uad6c\uc870\uc758 \uc218\uc815\uc774 \ud544\uc694\ud55c \uacbd\uc6b0\uc640 \ub85c\uc9c1\uc758 \uc218\uc815\uc774 \ud544\uc694\ud55c \uacbd\uc6b0\ub85c \ub098\ub204\uc5b4 \ubcfc \uc218 \uc788\ub2e4. \uc704\uc758 \uc608\uc2dc\ucf54\ub4dc \uacbd\uc6b0\uc5d0\ub294 `counts`\ub77c\ub294 \ub9e4\ud551\ud0c0\uc785\uc758 \ubcc0\uc218\ub294 \uc218\uc815\ud560 \ud544\uc694\uac00 \uc5c6\uc9c0\ub9cc \uadf8 \ubcc0\uc218\ub97c \ub2e4\ub8e8\ub294 \ub85c\uc9c1\uc5d0 \ub300\ud55c \uc218\uc815\uc744 \ud544\uc694\ub85c \ud55c\ub2e4.\\n\\n### \ucf54\ub4dc\ub97c \uc218\uc815\ud560 \uc218 \uc5c6\ub2e4\ub294 \uac83\uc758 \uc758\ubbf8\\n\\n![stateMachine](https://miro.medium.com/v2/resize:fit:1280/format:webp/1*KYgvINFl2iyIW6oTOJOD1Q.png)\\n\\n\ud754\ud788 \uc774\ub354\ub9ac\uc6c0\uc5d0 \ub300\ud55c \uc815\uc758\ub97c \ub0b4\ub9b4 \ub54c \uc0ac\ub78c\ub4e4\uc740 \u2018\uc0c1\ud0dc\uba38\uc2e0\u2019\uc774\ub77c\ub294 \ud45c\ud604\uc744 \uc0ac\uc6a9\ud55c\ub2e4. \ucc44\uad74\ub41c \ube14\ub85d\uc774 \uccb4\uc778\uc5d0 \ub4e4\uc5b4\uac00\ub294 \uacfc\uc815\uc5d0\uc11c \ud2b8\ub79c\uc7ad\uc158\uc774 \uc2e4\ud589\ub418\uace0, \uadf8 \ud2b8\ub79c\uc7ad\uc158\uc5d0 \uc758\ud574 \ubcc0\uacbd\ub41c \uc5b4\uce74\uc6b4\ud2b8\uc758 \uc0c1\ud0dc\ub97c \uc5c5\ub370\uc774\ud2b8 \ud55c\ub2e4. \uc774 \ub54c \ud2b8\ub79c\uc7ad\uc158\uc758 \uc218\uc2e0\uc790 \uc5b4\uce74\uc6b4\ud2b8\uac00 CA\ub77c\uba74, CA\uc5d0 \uc5f0\uacb0\ub41c code hash\ub97c \ud1b5\ud574 \ud574\ub2f9 \ucee8\ud2b8\ub799\ud2b8\uc758 \ucf54\ub4dc\ub97c \ucc3e\uc544 EVM\uc5d0\uc11c \uc2e4\ud589\uc2dc\ud0a4\uace0, CA\uc758 \uc2a4\ud1a0\ub9ac\uc9c0 \uc0c1\ud0dc\uac00 \uc5c5\ub370\uc774\ud2b8 \ub41c\ub2e4.\\n\\n\ucee8\ud2b8\ub799\ud2b8\uc758 \ucf54\ub4dc\ub97c \uc218\uc815\ud560 \uc218 \uc5c6\ub2e4\ub294 \uac83\uc758 \uc815\ud655\ud55c \uc758\ubbf8\ub294 CA\uc5d0 \uc800\uc7a5\ub41c code hash\uac12\uc744 \uc218\uc815\ud560 \uc218 \uc5c6\ub2e4\ub294 \uc758\ubbf8\uc774\ub2e4.\\n\\n### \ub0b4\ubd80\ud2b8\ub79c\uc7ad\uc158, call\uacfc delegatecall\\n\\n\ud2b8\ub79c\uc7ad\uc158\uc740 \uc5b8\uc81c\ub098 EOA\uc5d0 \uc758\ud574 \ubc1c\uc0dd\ub418\uc9c0\ub9cc \uadf8 \uc218\uc2e0\uc790\uac00 CA\uc77c \ub54c, \uc218\uc2e0 \ucee8\ud2b8\ub799\ud2b8 \ucf54\ub4dc\uc5d0 \uc758\ud574 \ub2e4\ub978 CA\ub97c \ud638\ucd9c\ud558\uac70\ub098 EOA\uc5d0\uac8c \uc774\ub354\ub97c \uc804\uc1a1\ud558\ub294 \ub4f1\uc758 \ub0b4\ubd80 \ud2b8\ub79c\uc7ad\uc158(Internal Transaction)\uc744 \uc77c\uc73c\ud0ac \uc218 \uc788\ub2e4.\\n\\n\uc774 \ub54c, CA\uac00 \ub2e4\ub978 CA\ub97c \ud638\ucd9c\ud558\ub294 \ubc29\uc2dd\uc740 \ud06c\uac8c **call** \ubc29\uc2dd\uacfc **delegatecall** \ubc29\uc2dd\uc73c\ub85c \ub098\ub25c\ub2e4.\\n\\nA \ucee8\ud2b8\ub799\ud2b8\uac00 B \ucee8\ud2b8\ub799\ud2b8\uc758 \ud568\uc218\ub97c \ud638\ucd9c\ud588\ub2e4\uace0 \ud588\uc744 \ub54c, call\uc740 sender\uac00 A\uac00 \ub418\uc5b4 B\uc5d0 \uc788\ub294 \ud568\uc218\uc758 \ucf54\ub4dc\ub97c \uc218\ud589\ud558\uba70 B\uac00 \uac16\uace0 \uc788\ub294 \uc2a4\ud1a0\ub9ac\uc9c0\ub97c \ubcc0\uacbd\ud558\ub294 \ubc29\uc2dd\uc774\ub2e4. \ubc18\uba74 delegatecall\uc740 sender\uac00 A\ub97c \ud638\ucd9c\ud588\ub358 \uc5b4\uce74\uc6b4\ud2b8\uc778 \ucc44\ub85c, B\uc5d0 \uc788\ub294 \ud568\uc218\uc758 \ucf54\ub4dc\ub97c \ud1b5\ud574 A\uc758 \uc2a4\ud1a0\ub9ac\uc9c0\ub97c \ubcc0\uacbd\ud558\ub294 \ubc29\uc2dd\uc774\ub2e4.\\n\\n\uc5ec\uae30\uc11c \uc6b0\ub9ac\ub294 \uc5c5\uadf8\ub808\uc774\ub4dc \uac00\ub2a5\ud55c \ucee8\ud2b8\ub799\ud2b8\ub97c \ub9cc\ub4e4\uae30 \uc704\ud55c \uac00\uc7a5 \uae30\ubcf8\uc801\uc778 \ub2e8\ucd08\ub97c \uc5bb\uc744 \uc218 \uc788\ub2e4. \uc774\ubbf8 \ubc30\ud3ec\ub41c CA\uc758 \ucf54\ub4dc\ub97c \uc218\uc815\ud560 \uc218\ub294 \uc5c6\uc9c0\ub9cc, \ub2e4\ub978 CA\uc758 \ucf54\ub4dc\ub97c \uc2e4\ud589\uc2dc\ucf1c \uae30\uc874 CA\uc758 \uc2a4\ud1a0\ub9ac\uc9c0\ub97c \uc218\uc815\ud560 \uc218 \uc788\ub2e4\uace0 \ud55c\ub2e4\uba74 \uc801\uc5b4\ub3c4 \ucee8\ud2b8\ub799\ud2b8\uc758 \ub85c\uc9c1\uc744 \ubcc0\uacbd\ud560 \uc218 \uc788\uac8c \ub418\uae30 \ub54c\ubb38\uc774\ub2e4.\\n\\n### \ub370\uc774\ud130\uc640 \ub85c\uc9c1\uc758 \ubd84\ub9ac\\n\\ndelegatecall\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc704\uc758 \uc608\uc2dc\ucf54\ub4dc\uc640 \uac19\uc774 \uac04\ub2e8\ud55c `count` \ud568\uc218\ub97c \uac00\uc9c4 \ucee8\ud2b8\ub799\ud2b8\ub97c \ub9cc\ub4e4\uc5b4\ubcf4\uc790.\\n\\n```mdx-code-block\\n<Tabs>\\n<TabItem value=\\"contracts/delegatecall/proxy.sol\\">\\n```\\n\\n```sol\\npragma solidity ^0.8.0;\\n\\ncontract DelegateProxy {\\n    address public owner;\\n    address public implementation;\\n\\n    constructor(address _implementation) {\\n        owner = msg.sender;\\n        implementation = _implementation;\\n    }\\n\\n    mapping(address => uint256) public counts;\\n\\n    function count() external {\\n        (bool success, ) = implementation.delegatecall(\\n            abi.encodeWithSignature(\\"count()\\")\\n        );\\n\\n        require(success, \\"failed\\");\\n    }\\n\\n    function setImplementation(address _implementation) external {\\n        require(msg.sender == owner, \\"only owner\\");\\n        implementation = _implementation;\\n    }\\n}\\n```\\n\\n```mdx-code-block\\n</TabItem>\\n<TabItem value=\\"contracts/delegatecall/v1.sol\\">\\n```\\n\\n```sol\\npragma solidity ^0.8.0;\\n\\ncontract ImplementationV1 {\\n    address public owner;\\n    address public implementation;\\n\\n    mapping(address => uint256) public counts;\\n\\n    function count() external {\\n        counts[msg.sender] += 1;\\n    }\\n}\\n```\\n\\n```mdx-code-block\\n</TabItem>\\n<TabItem value=\\"contracts/delegatecall/v2.sol\\">\\n```\\n\\n```solidity\\npragma solidity ^0.8.0;\\n\\ncontract ImplementationV2 {\\n    address public owner;\\n    address public implementation;\\n\\n    mapping(address => uint256) public counts;\\n\\n    function count() external {\\n        counts[msg.sender] += 2;\\n    }\\n}\\n```\\n\\n```mdx-code-block\\n</TabItem>\\n</Tabs>\\n```\\n\\n`count` \ud568\uc218\uc758 \ub85c\uc9c1\uc774 \ub2f4\uae34 `ImplementationV1`\uc744 \uba3c\uc800 \ubc30\ud3ec\ud558\uace0 `DelegateProxy`\ub97c \ubc30\ud3ec\ud558\uba74\uc11c `ImplementationV1`\uc758 \uc8fc\uc18c\ub97c \ub123\uc5b4\uc900\ub2e4. \uc774\ud6c4 \uc720\uc800\ub4e4\uc740 `DelegateProxy` \ucee8\ud2b8\ub799\ud2b8 \uc8fc\uc18c\ub85c \ud2b8\ub79c\uc7ad\uc158\uc744 \ubc1c\uc0dd\uc2dc\ud0ac \uac83\uc774\uace0, `DelegateProxy`\uc758 `count` \ud568\uc218\uc5d0\uc11c\ub294 `ImplementationV1`\uc744 \ud638\ucd9c\ud558\ub294 \ub0b4\ubd80\ud2b8\ub79c\uc7ad\uc158\uc744 \ubc1c\uc0dd\uc2dc\ud0a8\ub2e4. \uc774 \ub54c `ImplementationV1`\uc758 `count` \ud568\uc218\ub97c delegatecall \ud588\uae30 \ub54c\ubb38\uc5d0 sender\ub294 \uc5ec\uc804\ud788 \uc720\uc800\uc758 \uc8fc\uc18c\uc778 \ucc44\ub85c, \uce74\uc6b4\ud2b8 \ub370\uc774\ud130\ub294 `DelegateProxy`\uc758 \uc2a4\ud1a0\ub9ac\uc9c0\uc5d0\uc11c \uc218\uc815\ub41c\ub2e4.\\n\\n\ub9cc\uc57d `count` \ud568\uc218\uc758 \ub85c\uc9c1 \uc218\uc815\uc774 \ud544\uc694\ud558\ub2e4\uba74 \uc218\uc815\ub41c \ucf54\ub4dc\uc758 \ucee8\ud2b8\ub799\ud2b8\ub97c \uc0c8\ub85c \ubc30\ud3ec\ud55c \ub4a4\uc5d0 `DelegateProxy`\uc758 `setImplementation` \ud568\uc218\ub97c \ud1b5\ud574 delegatecall\ub85c \ud638\ucd9c\ud558\ub294 \ub85c\uc9c1 \ucee8\ud2b8\ub799\ud2b8\uc758 \uc8fc\uc18c\ub97c \ubcc0\uacbd\ud558\uae30\ub9cc \ud558\uba74 \ub41c\ub2e4.\\n\\n\uccab \ubc88\uc9f8\ub85c \uc0b4\ud3b4\ubd24\ub358 \ub9c8\uc774\uadf8\ub808\uc774\uc158 \ubc29\uc2dd\uc5d0 \ube44\ud558\uba74 \ubb34\ucc99 \ud3b8\ub9ac\ud558\uace0 \ud6a8\uc728\uc801\uc774\ub2e4. \uc77c\ub2e8 \uc720\uc800\ub4e4\uc774 \uc0ac\uc6a9\ud558\uace0 \uc788\ub358 \uae30\uc874 \ucee8\ud2b8\ub799\ud2b8\ub97c \uc8fc\uc18c\ub97c \uadf8\ub300\ub85c \uc0ac\uc6a9\ud558\uac8c \ud560 \uc218 \uc788\uc73c\uba70, \ub2f9\uc5f0\ud788 \uae30\uc874 \ucee8\ud2b8\ub799\ud2b8\uc758 \uc2a4\ud1a0\ub9ac\uc9c0\ub97c \uc0ac\uc6a9\ud558\uae30 \ub54c\ubb38\uc5d0 \ub370\uc774\ud130\ub97c \uc774\uad00\ud558\uac70\ub098 \ub3d9\uae30\ud654\ud558\ub294 \uc791\uc5c5\uc744 \uc218\ud589\ud558\uc9c0 \uc54a\uc544\ub3c4 \ub41c\ub2e4.\\n\\n\ubb3c\ub860 delegatecall \ubc29\uc2dd\uc758 \uc7a5\uc810\ub9cc \uc874\uc7ac\ud558\ub294 \uac83\uc740 \uc544\ub2c8\ub2e4. \ub85c\uc9c1\uc744 \uad6c\ud604\ud55c \ucee8\ud2b8\ub799\ud2b8\uc640 \ub370\uc774\ud130\uac00 \uc313\uc774\ub294 \ucee8\ud2b8\ub799\ud2b8\ub97c \ubd84\ub9ac \ud588\uc744 \ub54c \uac00\uc7a5 \uc720\uc758\ud574\uc57c\ud558\ub294 \uac83 \uc911\uc5d0 \ud558\ub098\ub294 \uc2a4\ud1a0\ub9ac\uc9c0 \ucda9\ub3cc\uc774\ub2e4.\\n\\n\uc194\ub9ac\ub514\ud2f0\uc5d0\uc11c\ub294 \uc2a4\ud1a0\ub9ac\uc9c0 \ubcc0\uc218\ub4e4\uc744 \uc2ac\ub86f\uc5d0 \ud560\ub2f9\ud560 \ub54c \ubcc0\uc218\uac00 \uc120\uc5b8\ub41c \uc21c\uc11c\uc5d0 \ub530\ub77c\uc11c \ud560\ub2f9\ud55c\ub2e4.\\n\\n(\uc194\ub9ac\ub514\ud2f0\uc758 \uc2a4\ud1a0\ub9ac\uc9c0 \ub808\uc774\uc544\uc6c3\uc5d0 \ub300\ud55c \ub354 \uc790\uc138\ud55c \uc124\uba85\uc740 [\ud574\ub2f9 \ubb38\uc11c](https://docs.soliditylang.org/en/v0.5.4/miscellaneous.html#layout-of-state-variables-in-storage)\ub97c \ucc38\uace0)\\n\\n```sol title=\\"contracts/delegatecall/v3.sol\\"\\npragma solidity ^0.8.0;\\n\\ncontract ImplementationV3 {\\n    address public owner;\\n    // address public implementation;\\n\\n    mapping(address => uint256) public counts;\\n\\n    function count() external {\\n        counts[msg.sender] += 3;\\n    }\\n}\\n```\\n\\n\ub9cc\uc57d \ubc84\uc804 3\uc758 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc640 \ub2e4\ub974\uac8c \ub450\ubc88 \uc9f8 `implementation` \ubcc0\uc218\ub97c \uc120\uc5b8\ud558\uc9c0 \uc54a\uace0 \ubc30\ud3ec\ud558\uba74 \uc5b4\ub5bb\uac8c \ub420\uae4c?\\n\\n```ts title=\\"contracts/scripts/delegatecall.ts\\"\\nconst V3 = await ethers.getContractFactory(\\"ImplementationV3\\");\\nconst v3 = await V3.deploy();\\nawait v3.deployed();\\nconsole.log(\\"V3 deployed to:\\", v3.address);\\n\\nconst versionUp2 = await proxy.setImplementation(v3.address);\\nawait versionUp2.wait();\\nconsole.log(\\"Set Implementation for V3\\");\\n\\nconsole.log(\\"V3 ------ V3 users Count ------ \\");\\nfor (let i = 0; i < v3Users.length; i++) {\\n  const count = await proxy.connect(v3Users[i]).count();\\n  await count.wait();\\n\\n  console.log(`V3 User${i} count:`, await proxy.counts(v3Users[i].address));\\n}\\n```\\n\\n\uc704\uc640 \uac19\uc740 \ud14c\uc2a4\ud2b8 \ucf54\ub4dc\ub97c \ub3d9\uc791\uc2dc\ucf30\uc744 \ub54c,\\n\\n```bash\\nV3 deployed to: 0x0165878A594ca255338adfa4d48449f69242Eb8F\\nSet Implementation for V3\\nV3 ------ V3 users Count ------\\nV3 User0 count: BigNumber { value: \\"0\\" }\\nV3 User1 count: BigNumber { value: \\"0\\" }\\nV3 User2 count: BigNumber { value: \\"0\\" }\\nV3 User3 count: BigNumber { value: \\"0\\" }\\n```\\n\\n`count` \ud568\uc218\ub97c \ud638\ucd9c\ud55c \ub4a4\uc5d0 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c `counts`\ub97c \uc870\ud68c\ud574\ub3c4 0\uc774 \ub098\uc624\ub294 \uac83\uc744 \ubcfc \uc218 \uc788\ub2e4. \uc194\ub9ac\ub514\ud2f0\uc5d0\uc11c \ub9e4\ud551\uc758 value\uac00 \uc2a4\ud1a0\ub9ac\uc9c0\uc5d0 \uc800\uc7a5\ub418\ub294 \ubc29\uc2dd\uc740 \ucd5c\ucd08 \ub9e4\ud551\uc774 \ud560\ub2f9\ub41c \uc2ac\ub86f\ub118\ubc84\uc640 \ub9e4\ud551\uc758 \ud0a4 \uac12\uc744 \ud568\uaed8 \ud574\uc2f1\ud55c \uac12\uc758 \uc2ac\ub86f\uc5d0 \uc800\uc7a5\ub41c\ub2e4.\\n\\n\ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c `counts` \ub9e4\ud551\uc740 \uc138 \ubc88\uc9f8\uc5d0 \uc120\uc5b8\ub418\uc5c8\uc74c\uc73c\ub85c \uc2ac\ub86f\ub118\ubc84 2\uc640(0\ubd80\ud130 \ud560\ub2f9\ub418\uae30 \ub54c\ubb38\uc5d0) sender\uc758 address\ub97c \ud568\uaed8 \ud574\uc2f1\ud55c \uac12\uc758 \uc2ac\ub86f\uc5d0 count \uac12\uc774 \uc800\uc7a5\ub420 \uac83\uc774\ub2e4. \ubc18\uba74 \ubc84\uc804 3 \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c\ub294 \ub450\ubc88 \uc9f8\uc5d0 \uc120\uc5b8\ub418\uc5c8\uae30 \ub54c\ubb38\uc5d0 \uc2ac\ub86f\ub118\ubc84 1\uacfc \ud568\uaed8 \ud574\uc2f1\ud55c \uac12\uc758 \uc2ac\ub86f\uc5d0 count \uac12\uc774 \uc800\uc7a5\ub41c\ub2e4.\\n\\n\ub54c\ubb38\uc5d0 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c `counts`\ub97c \uc870\ud68c\ud574\ub3c4 `count` \ud568\uc218\uc758 \uacb0\uacfc\uac00 \ubc18\uc601\ub418\uc9c0 \uc54a\ub294 \uac83\uc774\ub2e4.\\n\\n\uc774\ucc98\ub7fc delegatecall\uc744 \uc0ac\uc6a9\ud560 \ub54c\ub294 \uc194\ub9ac\ub514\ud2f0\uc758 \uc2a4\ud1a0\ub9ac\uc9c0 \ub808\uc774\uc544\uc6c3\uc5d0 \ub300\ud55c \uc774\ud574\uac00 \ud544\uc694\ud558\uba70 \ubcc0\uc218\uac00 \uc120\uc5b8\ub418\ub294 \uc21c\uc11c\uac00 \ubb34\ucc99 \uc911\uc694\ud558\ub2e4.\\n\\n\ud2b9\ud788 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c\ub294 \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1\uc744 \uc704\ud55c \ubcc0\uc218\ub4e4\ub3c4 \ud544\uc694\ud558\uc9c0\ub9cc \uae30\ubcf8\uc801\uc73c\ub85c \ub85c\uc9c1\uc774 \uad6c\ud604\ub41c \ucee8\ud2b8\ub799\ud2b8\ub97c \ud638\ucd9c\ud558\uae30 \uc704\ud55c \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc758 \uc8fc\uc18c\uac12\uc774 \uaf2d \ud544\uc694\ud558\ub2e4.\\n\\n```mdx-code-block\\n<Tabs>\\n<TabItem value=\\"contracts/delegatecall/proxy.sol\\">\\n```\\n\\n```sol\\npragma solidity ^0.8.0;\\n\\ncontract DelegateProxy {\\n    address public owner;\\n    address public implementation;\\n\\n    constructor(address _implementation) {\\n        owner = msg.sender;\\n        implementation = _implementation;\\n    }\\n\\n    mapping(address => uint256) public counts;\\n    address public second;\\n\\n    function count() external {\\n        (bool success, ) = implementation.delegatecall(\\n            abi.encodeWithSignature(\\"count()\\")\\n        );\\n\\n        require(success, \\"failed\\");\\n    }\\n\\n    function setImplementation(address _implementation) external {\\n        require(msg.sender == owner, \\"only owner\\");\\n        implementation = _implementation;\\n    }\\n\\n    function test(address _second) external {\\n        (bool success, ) = implementation.delegatecall(\\n            abi.encodeWithSignature(\\"test(address)\\", _second)\\n        );\\n\\n        require(success, \\"failed\\");\\n    }\\n}\\n```\\n\\n```mdx-code-block\\n</TabItem>\\n<TabItem value=\\"contracts/delegatecall/v4.sol\\">\\n```\\n\\n```sol\\npragma solidity ^0.8.0;\\n\\ncontract ImplementationV4 {\\n    uint256 public first;\\n    address public second;\\n\\n    mapping(address => uint256) public counts;\\n\\n    function count() external {\\n        counts[msg.sender] += 3;\\n    }\\n\\n    function test(address _second) external {\\n        second = _second;\\n    }\\n}\\n```\\n\\n```mdx-code-block\\n</TabItem>\\n</Tabs>\\n```\\n\\n\ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc5d0 `second`\ub77c\ub294 \ubcc0\uc218\ub97c \ucd94\uac00\ud558\uace0 delegatecall\ub85c \ubc84\uc8044\uc758 \ud568\uc218\ub97c \ud638\ucd9c\ud558\ub294 `test` \ud568\uc218\ub97c \ucd94\uac00\ud588\ub2e4. \ubc84\uc804 4\uc758 \ucf54\ub4dc\ub97c \uc791\uc131\ud558\ub358 \uac1c\ubc1c\uc790\uac00 \uc2e4\uc218\ub85c \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc758 `implementation` \uc774 \uc120\uc5b8\ub418\ub294 \uc21c\uc11c\uc5d0 \uac19\uc740 address \ud0c0\uc785\uc758 `second` \ubcc0\uc218\ub97c \uc120\uc5b8\ud588\ub2e4\uace0 \ud574\ubcf4\uc790.\\n\\n```ts\\nconst V4 = await ethers.getContractFactory(\\"ImplementationV4\\");\\nconst v4 = await V4.deploy();\\nawait v4.deployed();\\nconsole.log(\\"V4 deployed to:\\", v4.address);\\n\\nconst versionUp3 = await proxy.setImplementation(v4.address);\\nawait versionUp3.wait();\\nconsole.log(\\"Set Implementation for V4\\");\\n\\nconsole.log(\\"V4 ------ V4 users Count ------ \\");\\nfor (let i = 0; i < v4Users.length; i++) {\\n  const count = await proxy.connect(v4Users[i]).count();\\n  await count.wait();\\n\\n  console.log(`V4 User${i} count:`, await proxy.counts(v4Users[i].address));\\n}\\n\\nconsole.log(\\"V4 ------ storage test ------ \\");\\nconst test = await proxy.test(users[0].address);\\nawait test.wait();\\nconsole.log(\\"users[0]:\\", users[0].address);\\nconsole.log(\\"second:\\", await proxy.second());\\nconsole.log(\\"implementation:\\", await proxy.implementation());\\n```\\n\\n\uc704\uc640 \uac19\uc740 \ud14c\uc2a4\ud2b8\ucf54\ub4dc\ub97c \ub3d9\uc791\uc2dc\ucf30\uc744 \ub54c,\\n\\n```bash\\nV4 deployed to: 0x2279B7A0a67DB372996a5FaB50D91eAA73d2eBe6\\nSet Implementation for V4\\nV4 ------ V4 users Count ------\\nV4 User0 count: BigNumber { value: \\"3\\" }\\nV4 User1 count: BigNumber { value: \\"3\\" }\\nV4 User2 count: BigNumber { value: \\"3\\" }\\nV4 User3 count: BigNumber { value: \\"3\\" }\\nV4 ------ storage test ------\\nusers[0]: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266\\nsecond: 0x0000000000000000000000000000000000000000\\nimplementation: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266\\n```\\n\\n\ubc84\uc804 4\uc5d0\uc11c \uad6c\ud604\ub41c `test` \ud568\uc218\uc5d0\uc11c\ub294 `second` \ubcc0\uc218\uc5d0 \uac12\uc744 \ub300\uc785\ud558\uace0 \uc788\uc9c0\ub9cc, \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c\ub294 `implementation`\uc758 \uac12\uc774 \ubc14\ub00c\uc5b4\uc788\ub2e4. \ubc84\uc804 4\uc758 `second` \ubcc0\uc218\ub294 \ubcc0\uc218\uba85\ub9cc \ub2e4\ub97c \ubfd0, \uac19\uc740 \uc2a4\ud1a0\ub9ac\uc9c0 \uc2ac\ub86f\uc5d0 \ud560\ub2f9\ub418\uc5b4\uc788\uc744 \uac83\uc774\uae30 \ub54c\ubb38\uc774\ub2e4. \uc774\ucc98\ub7fc \uc0ac\uc18c\ud55c \uc2e4\uc218\ub85c \uc778\ud574 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc5d0\uc11c \ub9e4\uc6b0 \uc911\uc694\ud55c \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\uc758 \uc8fc\uc18c\uac00 \uc608\uc0c1\uce58 \ubabb\ud55c \uac12\uc73c\ub85c \ubcc0\uacbd\ub418\ub294 \uc2a4\ud1a0\ub9ac\uc9c0 \ucda9\ub3cc\uc774 \uc77c\uc5b4\ub0a0 \uc218 \uc788\ub2e4.\\n\\n<hr />\\n\\n\uc7a0\uc2dc \ub3cc\uc544\uc640\uc11c, \uc704\uc758 \uc608\uc2dc \ucf54\ub4dc\ub85c \uad6c\ud604\ub41c \ub378\ub9ac\uac8c\uc774\ud2b8\ucf5c \ubc29\uc2dd\uc5d0\ub294 \uc5c5\uadf8\ub808\uc774\ub4dc \uac00\ub2a5\ud55c \ucee8\ud2b8\ub799\ud2b8\ub85c\uc11c \ub610 \ub2e4\ub978 \ub2e8\uc810\uc774 \uc874\uc7ac\ud55c\ub2e4. \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc5d0 \uae30\ubcf8\uc801\uc73c\ub85c \ud568\uc218\uac00 \uad6c\ud604\ub418\uc5b4\uc788\uae30 \ub54c\ubb38\uc5d0 \uc5c5\uadf8\ub808\uc774\ub4dc \ub418\ub294 \uad6c\ud604 \ucee8\ud2b8\ub799\ud2b8\ub294 \uacb0\uad6d \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\uc5d0 \uc788\ub294 \ud568\uc218\uc5d0 \uc885\uc18d\ub41c\ub2e4. \ub9cc\uc57d `count` \ud568\uc218\uc5d0 \uc0c8\ub85c\uc6b4 \uc778\uc790\uac00 \ud544\uc694\ud558\uac8c \ub418\uac70\ub098, return\uc774 \ud544\uc694\ud55c \ud568\uc218\uac00 \uc0c8\ub86d\uac8c \ucd94\uac00\ub418\uc5b4\uc57c \ud55c\ub2e4\uace0 \ud588\uc744 \ub54c\ub294 \ud604\uc7ac\uc758 \ubc29\uc2dd\uc73c\ub85c\ub294 \ub354 \uc774\uc0c1 \uc5c5\uadf8\ub808\uc774\ub4dc \ud560 \uc218 \uc5c6\uace0 \uacb0\uad6d \uc0c8\ub85c\uc6b4 \ud504\ub85d\uc2dc \ucee8\ud2b8\ub799\ud2b8\ub97c \ubc30\ud3ec\ud574\uc57c \ud55c\ub2e4.\\n\\n\uc774\ub7f0 \uc81c\uc57d\uc744 \ud574\uacb0\ud558\uae30 \uc704\ud574 \ub370\uc774\ud130\uc640 \ub85c\uc9c1\uc744 \ubd84\ub9ac\ud558\ub294 \ud504\ub85d\uc2dc \ud328\ud134\uc740 \uae30\ubcf8\uc801\uc73c\ub85c delegatecall \uacfc fallback \ud568\uc218\uc758 \uc870\ud569\uc744 \ud1b5\ud574 \uad6c\ud604\ub41c\ub2e4.\\n\\n## \uc774\uc5b4\uc11c...\\n\\n\ub2e4\uc74c \uae00\uc5d0\uc11c\ub294 \uc704\uc5d0\uc11c \uc0b4\ud3b4\ubd24\ub358 \uc2a4\ud1a0\ub9ac\uc9c0 \ucda9\ub3cc\uc744 \ud574\uacb0\ud558\uae30 \uc704\ud55c ERC1967Proxy\uc640 \uc624\ud508\uc7ac\ud50c\ub9b0\uc758 \ud22c\uba85\ud504\ub85d\uc2dc, \uadf8\ub9ac\uace0 UUPS\uc5d0 \ub300\ud574\uc11c \uc0b4\ud3b4\ubcf4\ub824\uace0 \ud55c\ub2e4.\\n\\n\uae00\uc5d0\uc11c \uc5b8\uae09\ub41c \uc608\uc2dc\ucf54\ub4dc\ub294 [\ub9c1\ud06c](https://github.com/chihunmanse/solidity-upgradeable)\ub85c \ub4e4\uc5b4\uac00\uba74 \ubcfc \uc218 \uc788\uace0, \uc9c1\uc811 \ud14c\uc2a4\ud2b8 \uacb0\uacfc\ub97c \ud655\uc778\ud574\ubcfc \uc218 \uc788\ub2e4."},{"id":"/2022/02/10/backend/project/nestJS","metadata":{"permalink":"/2022/02/10/backend/project/nestJS","source":"@site/blog/backend/project/2022-02-10-nestJS.md","title":"NestJS & MongoDB Project","description":"\uae30\uac04: 2022-01-17 ~ 2022-01-28","date":"2022-02-10T00:00:00.000Z","formattedDate":"February 10, 2022","tags":[{"label":"BackEnd","permalink":"/tags/back-end"},{"label":"NestJS","permalink":"/tags/nest-js"}],"readingTime":18.35,"hasTruncateMarker":true,"authors":[{"name":"Chihun Park","url":"https://github.com/chihunmanse","email":"chihunmanse@gmail.com","imageURL":"https://p.ipic.vip/o1ih3g.png","key":"chihun"}],"frontMatter":{"title":"NestJS & MongoDB Project","tags":["BackEnd","NestJS"],"authors":"chihun"},"prevItem":{"title":"Upgradeable Contract 1 - Migration, DelegateCall","permalink":"/2022/06/10/blockchain/upgradeable-contract1"},"nextItem":{"title":"\uc6d0\ud2f0\ub4dc \ud504\ub9ac\uc628\ubcf4\ub529 8percent \uae30\uc5c5\uacfc\uc81c","permalink":"/2021/11/20/backend/project/preonboarding-8percent"}},"content":"**\uae30\uac04: 2022-01-17 ~ 2022-01-28**\\n\\n**Stack: TypeScript, NestJS, MongoDB, Mongoose**\\n\\n**[Github \ub9c1\ud06c](https://github.com/chihunmanse/nest-api)**\\n\\n**[API Document](https://documenter.getpostman.com/view/17663987/UVe9QUfM)**\\n\\n## ENDPOINT\\n\\n- POST /users/signup (\ud68c\uc6d0\uac00\uc785)\\n- POST /users/signin (\ub85c\uadf8\uc778)\\n- GET /users/reviews (\uc791\uc131 \ub9ac\ubdf0 \uc870\ud68c)\\n- GET /categories (\uc804\uccb4 \uce74\ud14c\uace0\ub9ac \uc870\ud68c)\\n- GET /categories/:id (\uce74\ud14c\uace0\ub9ac \uc870\ud68c)\\n- GET /products (\uc804\uccb4 \uc0c1\ud488 \uc870\ud68c)\\n- GET /products/keyword (\uce74\ud14c\uace0\ub9ac&\uac80\uc0c9\uc5b4\ub85c \uc0c1\ud488 \uc870\ud68c)\\n- GET /products/:id (\uc0c1\ud488 \uc870\ud68c)\\n- POST /products/like (\uc0c1\ud488 \uc88b\uc544\uc694)\\n- GET /products/like (\uc88b\uc544\uc694\ud55c \uc0c1\ud488 \uc870\ud68c)\\n- POST /carts (\uc7a5\ubc14\uad6c\ub2c8 \uc544\uc774\ud15c \ucd94\uac00)\\n- PATCH /carts (\uc7a5\ubc14\uad6c\ub2c8 \uc544\uc774\ud15c \uc218\uc815)\\n- DELETE /carts (\uc7a5\ubc14\uad6c\ub2c8 \uc544\uc774\ud15c \uc0ad\uc81c)\\n- GET /carts (\uc7a5\ubc14\uad6c\ub2c8 \uc870\ud68c)\\n- POST /products/reviews/:productId (\ub9ac\ubdf0 \uc0dd\uc131)\\n- GET /products/reviews/:productId (\ub9ac\ubdf0 \uc870\ud68c)\\n- PUT /products/reviews/:reviewId (\ub9ac\ubdf0 \uc218\uc815)\\n- DELETE /products/reviews/:reviewId (\ub9ac\ubdf0 \uc0ad\uc81c)\\n- POST /image/upload (\uc774\ubbf8\uc9c0 \ud30c\uc77c \uc5c5\ub85c\ub4dc)\\n\\n\x3c!--truncate--\x3e\\n\\n## Code\\n\\n### POST /users/signup (\ud68c\uc6d0\uac00\uc785)\\n\\n```ts title=\\"users.schema.ts\\"\\nexport class User extends Document {\\n  @Prop({\\n    required: true,\\n    unique: true,\\n  })\\n  @IsEmail()\\n  @IsNotEmpty()\\n  email: string;\\n\\n  @Prop({\\n    required: true,\\n  })\\n  @IsString()\\n  @IsNotEmpty()\\n  name: string;\\n\\n  @Prop({\\n    required: true,\\n  })\\n  @IsString()\\n  @IsNotEmpty()\\n  password: string;\\n\\n  @Prop({\\n    default: 50000,\\n  })\\n  @IsNumber()\\n  @IsNotEmpty()\\n  point: number;\\n\\n  readonly readOnlyData: {\\n    id: string;\\n    email: string;\\n    name: string;\\n    point: number;\\n  };\\n}\\n\\nUserSchema.virtual(\\"readOnlyData\\").get(function (this: User) {\\n  return {\\n    id: this.id,\\n    email: this.email,\\n    name: this.name,\\n    point: this.point,\\n  };\\n});\\n```\\n\\n`readonly`\ub77c\ub294 `password`\ub97c \uc81c\uc678\ud55c virtual \ud544\ub4dc\ub97c \ub9cc\ub4e4\uc5b4\uc11c \uc720\uc800 \uc815\ubcf4 \uc870\ud68c\uc2dc\uc5d0 \uc0ac\uc6a9\ud558\uc600\ub2e4.\\n\\n```ts title=\\"users.controller.ts\\"\\n@Controller(\\"users\\")\\nexport class UsersController {\\n  constructor(\\n    private readonly usersService: UsersService,\\n    private readonly authService: AuthService,\\n    private readonly reviewsService: ReviewsService\\n  ) {}\\n\\n  @Post(\\"signup\\")\\n  async signUp(@Body() body: SignUpRequestDto) {\\n    return await this.usersService.signUp(body);\\n  }\\n}\\n```\\n\\n```ts title=\\"signup.request.dto.ts\\"\\nimport {\\n  IsEmail,\\n  IsNotEmpty,\\n  IsString,\\n  Matches,\\n  MaxLength,\\n  MinLength,\\n} from \\"class-validator\\";\\n\\nexport class SignUpRequestDto {\\n  @IsEmail()\\n  @IsNotEmpty()\\n  email: string;\\n\\n  @IsString()\\n  @IsNotEmpty()\\n  @Matches(/^[A-Za-z\\\\d!@#$%^&*()]{8,30}$/)\\n  password: string;\\n\\n  @IsString()\\n  @IsNotEmpty()\\n  @MinLength(2)\\n  @MaxLength(20)\\n  name: string;\\n}\\n```\\n\\n\ud68c\uc6d0\uac00\uc785 \uc694\uccad\uc5d0\uc11c body\uc5d0 \ub300\ud55c dto\ub97c \ub530\ub85c \uc0dd\uc131\ud558\uace0 class-validator\uc758 \ub370\ucf54\ub808\uc774\ud130\ub4e4\uc744 \ud65c\uc6a9\ud558\uc5ec \uc720\ud6a8\uc131 \uac80\uc0ac\ub97c \uc218\ud589\ud588\ub2e4.\\n\\n```ts title=\\"users.service.ts\\"\\n@Injectable()\\nexport class UsersService {\\n  constructor(private readonly usersRepository: UsersRepository) {}\\n\\n  async signUp(body: SignUpRequestDto) {\\n    const { email, name, password } = body;\\n\\n    const isUserExist = await this.usersRepository.existsByEmail(email);\\n    if (isUserExist) throw new HttpException(\\"DUPLICATE_EMAIL\\", 409);\\n\\n    const salt = await bcrypt.genSalt();\\n    const hashedPassword = await bcrypt.hash(password, salt);\\n\\n    const user = await this.usersRepository.createUser({\\n      email,\\n      name,\\n      password: hashedPassword,\\n    });\\n\\n    return user.readOnlyData;\\n  }\\n}\\n```\\n\\nbcrypt\ub97c \ud1b5\ud574 \ube44\ubc00\ubc88\ud638\ub97c \uc554\ud638\ud654\ud558\uc5ec \uc720\uc800\ub97c \uc0dd\uc131\ud55c\ub2e4.\\n\\n```ts title=\\"users.repository.ts\\"\\n@Injectable()\\nexport class UsersRepository {\\n  constructor(\\n    @InjectModel(User.name) private readonly userModel: Model<User>\\n  ) {}\\n\\n  async existsByEmail(email: string): Promise<boolean> {\\n    const result = await this.userModel.exists({ email });\\n    return result;\\n  }\\n\\n  async createUser(user: SignUpRequestDto): Promise<User> {\\n    return await this.userModel.create(user);\\n  }\\n}\\n```\\n\\nDB \uc791\uc5c5\uc744 \ud558\ub294 \ud568\uc218\ub4e4\uc744 repository\uc5d0 \ub530\ub85c \uc791\uc131\ud558\uc5ec service\uc5d0\uc11c \ud65c\uc6a9\ud558\uc600\ub2e4.\\n\\n### POST /users/signin (\ub85c\uadf8\uc778)\\n\\n```ts title=\\"auth.service.ts\\"\\nasync jwtLogIn(data: LoginRequestDto) {\\n    const { email, password } = data;\\n\\n    const user = await this.usersRepository.findUserByEmail(email);\\n\\n    if (!user) throw new UnauthorizedException(\'INVALID_EMAIL\');\\n\\n    const isPasswordValidated: boolean = await bcrypt.compare(\\n      password,\\n      user.password,\\n    );\\n\\n    if (!isPasswordValidated)\\n      throw new UnauthorizedException(\'INVALID_PASSWORD\');\\n\\n    const payload = { id: user.id };\\n\\n    return {\\n      token: this.jwtService.sign(payload),\\n    };\\n  }\\n```\\n\\n```ts title=\\"login.request.dto.ts\\"\\nimport { PickType } from \\"@nestjs/mapped-types\\";\\nimport { User } from \\"src/users/users.schema\\";\\n\\nexport class LoginRequestDto extends PickType(User, [\\n  \\"email\\",\\n  \\"password\\",\\n] as const) {}\\n```\\n\\n### GET /products/keyword (\uc0c1\ud488 \uc870\ud68c)\\n\\n```ts title=\\"products.schema.ts\\"\\n@Schema(options)\\nexport class Product extends Document {\\n  @Prop({\\n    type: Category,\\n    required: true,\\n    ref: \\"Category\\",\\n  })\\n  @IsNotEmpty()\\n  category: Category;\\n\\n  @Prop({\\n    required: true,\\n  })\\n  @IsString()\\n  @IsNotEmpty()\\n  name: string;\\n\\n  @Prop({\\n    required: false,\\n  })\\n  @IsString()\\n  thumbnailImage: string;\\n\\n  @Prop({\\n    required: true,\\n  })\\n  @IsNotEmpty()\\n  @IsNumber()\\n  price: number;\\n\\n  @Prop({\\n    default: 0,\\n  })\\n  @IsNumber()\\n  likeCount: number;\\n\\n  @Prop({\\n    type: Object,\\n  })\\n  @IsObject()\\n  likeUsers: object;\\n\\n  @Prop()\\n  recentReviews: Review[];\\n}\\n```\\n\\n```ts title=\\"products.controller.ts\\"\\n@Get(\'keyword\')\\n  async getProductByKeyword(\\n    @Query(QueryValidationPipe) query: ProductByKeywordRequestDto,\\n  ) {\\n    return await this.productsService.getProductByKeyword(query);\\n  }\\n```\\n\\n```ts title=\\"query.validation.pipe.ts\\"\\n@Injectable()\\nexport class QueryValidationPipe implements PipeTransform {\\n  transform(value: any) {\\n    const { category, offset, limit } = value;\\n    if (!isValidObjectId(category))\\n      throw new BadRequestException(\\"INVALID_CATEGORY_ID\\");\\n\\n    if (offset < 0) throw new BadRequestException(\\"INVALID_OFFSET\\");\\n    if (limit < 0) throw new BadRequestException(\\"INVALID_LIMIT\\");\\n    return value;\\n  }\\n}\\n```\\n\\n`category`\uac12\uc774 objectId \ud615\uc2dd\uc774 \ub9de\ub294\uc9c0, `offset`\uacfc `limit`\uc774 \uc591\uc218\uc778\uc9c0\uc5d0 \ub300\ud574 \uccb4\ud06c\ud558\uae30 \uc704\ud574 \uc694\uccad\uc758 query \uac12\uc5d0 \ub300\ud574 \uc720\ud6a8\uc131 \uac80\uc0ac\ub97c \uc218\ud589\ud558\ub294 pipe\ub97c \ub530\ub85c \uc791\uc131\ud558\uc600\ub2e4.\\n\\n```ts title=\\"productByKeyword.request.dto.ts\\"\\nexport class ProductByKeywordRequestDto {\\n  category: string | null;\\n\\n  sort: string | null;\\n\\n  offset: number | null;\\n\\n  limit: number | null;\\n\\n  search: string | null;\\n}\\n```\\n\\n\uc0c1\ud488 \uc870\ud68c\uc2dc\uc5d0 \ud544\ud130\ub9c1 \ubc0f \uc194\ud305\uc5d0 \uc0ac\uc6a9\ub418\ub294 query\uc5d0 \ub300\ud55c dto\uc774\ub2e4.\\n\\n```ts title=\\"products.repository.ts\\"\\nasync findProductByKeyword(\\n    query: ProductByKeywordRequestDto,\\n  ): Promise<Product[]> {\\n    const { category, sort, offset = 0, limit = 10, search } = query;\\n    const sortBy = {\\n      lowPrice: \'price\',\\n      highPrice: \'-price\',\\n      likeCount: \'-likeCount\',\\n    };\\n    const filterQuery = new Query();\\n    if (category) {\\n      filterQuery.find({ \'category._id\': category });\\n    }\\n    const products = await this.productModel\\n      .find(filterQuery)\\n      .or([\\n        { name: new RegExp(search) },\\n        { \'category.name\': new RegExp(search) },\\n      ])\\n      .select([\'-category\', \'-likeUsers\', \'-recentReviews\'])\\n      .skip(offset)\\n      .limit(limit)\\n      .sort(sortBy[sort]);\\n\\n    return products;\\n  }\\n```\\n\\n### POST /products/like (\uc0c1\ud488 \uc88b\uc544\uc694)\\n\\n```ts title=\\"products.schema.ts\\"\\n@Prop({\\n    default: 0,\\n  })\\n  @IsNumber()\\n  likeCount: number;\\n\\n  @Prop({\\n    type: Object,\\n  })\\n  @IsObject()\\n  likeUsers: object;\\n```\\n\\n![img1](https://i.ibb.co/fQCyWNK/2022-01-28-4-10-08.png)\\n\\nproducts\uc5d0 `likeUsers`\ub77c\ub294 object \ud0c0\uc785\uc758 \ud544\ub4dc\ub97c \uc0dd\uc131\ud558\uace0 \uc720\uc800\uac00 \uc88b\uc544\uc694\ud55c \uc0c1\ud488\ub4e4\uc744 \uc870\ud68c\ud560 \ub54c \uac80\uc0c9\uc18d\ub3c4\ub97c \ub192\uc774\uae30 \uc704\ud574 array \ud0c0\uc785\uc774 \uc544\ub2cc \uc88b\uc544\uc694\ud55c \uc720\uc800\uc758 objectId\ub97c \ud0a4 \uac12\uc73c\ub85c \uac1d\uccb4\uc5d0 \ub370\uc774\ud130\ub97c \ucd94\uac00\ud558\uc600\ub2e4.\\n\\n```ts title=\\"products.controller.ts\\"\\n@UseGuards(JwtAuthGuard)\\n  @Post(\'like\')\\n  async updateLikeUser(\\n    @Body(\'productId\', ObjectIdValidationPipe) productId: string,\\n    @LogInUser() user: User,\\n  ) {\\n    return this.productsService.updateLikeUser(productId, user._id);\\n  }\\n```\\n\\n```ts title=\\"products.service.ts\\"\\nasync updateLikeUser(productId: string, userId: string) {\\n    const isProductExist = await this.productsRepository.existsById(productId);\\n\\n    if (!isProductExist) throw new BadRequestException(\'INVALID_PRODUCT_ID\');\\n\\n    const isLikeExist = await this.productsRepository.existsLike(\\n      productId,\\n      userId,\\n    );\\n\\n    if (!isLikeExist) {\\n      const result = await this.productsRepository.addLikeUser(\\n        productId,\\n        userId,\\n      );\\n      return result;\\n    } else {\\n      const result = await this.productsRepository.deleteLikeUser(\\n        productId,\\n        userId,\\n      );\\n      return result;\\n    }\\n  }\\n```\\n\\n\uc720\uc800\uac00 \uc774\ubbf8 \uc88b\uc544\uc694\ud55c \uc0c1\ud488\uc774\ub77c\uba74 `likeUsers` object\uc5d0\uc11c \uc720\uc800\uc758 key\uac12\uc744 \uc0ad\uc81c\ud558\uace0 \uc88b\uc544\uc694\ud558\uc9c0 \uc54a\uc558\ub2e4\uba74 \uc720\uc800\uc758 key\uac12\uc744 \uc0dd\uc131\ud55c\ub2e4.\\n\\n```tsx title=\\"products.repository.ts\\"\\n\\tasync existsLike(productId: string, userId: string): Promise<boolean> {\\n    const key = `likeUsers.${userId}`;\\n    const query = {\\n      _id: productId,\\n    };\\n    query[key] = true;\\n\\n    const result = await this.productModel.exists(query);\\n    return result;\\n  }\\n\\n  async addLikeUser(productId: string, userId: string): Promise<Product> {\\n    const key = `likeUsers.${userId}`;\\n    const query = {};\\n    query[key] = true;\\n\\n    const result = await this.productModel\\n      .findOneAndUpdate(\\n        { _id: productId },\\n        {\\n          $set: query,\\n          $inc: { likeCount: 1 },\\n        },\\n        {\\n          new: true,\\n        },\\n      )\\n      .select(\'likeCount\');\\n    return result;\\n  }\\n\\n  async deleteLikeUser(productId: string, userId: string): Promise<Product> {\\n    const key = `likeUsers.${userId}`;\\n    const query = {};\\n    query[key] = true;\\n\\n    const result = await this.productModel\\n      .findOneAndUpdate(\\n        { _id: productId },\\n        {\\n          $unset: query,\\n          $inc: { likeCount: -1 },\\n        },\\n        {\\n          new: true,\\n        },\\n      )\\n      .select(\'likeCount\');\\n    return result;\\n  }\\n```\\n\\n### GET /products/like (\uc88b\uc544\uc694\ud55c \uc0c1\ud488 \uc870\ud68c)\\n\\n```ts title=\\"products.controller.ts\\"\\n@UseGuards(JwtAuthGuard)\\n  @Get(\'like\')\\n  async getLikeProduct(@LogInUser() user: User) {\\n    return this.productsService.getLikeProduct(user._id);\\n  }\\n```\\n\\n```ts title=\\"products.repository.ts\\"\\nasync findLikeProduct(userId: string): Promise<Product[]> {\\n    const key = `likeUsers.${userId}`;\\n    const query = {};\\n    query[key] = true;\\n\\n    const likeProducts = await this.productModel\\n      .find(query)\\n      .select([\'-category\', \'-likeUsers\']);\\n    return likeProducts;\\n  }\\n```\\n\\nproducts \ucf5c\ub809\uc158\uc5d0\uc11c `likeUsers`\uc758 key\uac12\uc774 \ub85c\uadf8\uc778 \uc720\uc800\uc758 objectId\uc640 \uac19\uace0 value\uac12\uc774 true\uc778 \uc0c1\ud488\ub4e4\uc744 \ud544\ud130\ub9c1\ud558\uc5ec \uc870\ud68c\ud55c\ub2e4.\\n\\n### \uc7a5\ubc14\uad6c\ub2c8 \uc544\uc774\ud15c \ucd94\uac00, \uc218\uc815, \uc0ad\uc81c, \uc870\ud68c\\n\\n- POST /carts (\uc7a5\ubc14\uad6c\ub2c8 \uc544\uc774\ud15c \ucd94\uac00)\\n- PATCH /carts (\uc7a5\ubc14\uad6c\ub2c8 \uc544\uc774\ud15c \uc218\uc815)\\n- DELETE /carts (\uc7a5\ubc14\uad6c\ub2c8 \uc544\uc774\ud15c \uc0ad\uc81c)\\n- GET /carts (\uc7a5\ubc14\uad6c\ub2c8 \uc870\ud68c)\\n\\n```ts title=\\"arts.schema.ts\\"\\n@Schema(options)\\nexport class Cart extends Document {\\n  @Prop({\\n    type: Types.ObjectId,\\n    required: true,\\n    ref: \\"User\\",\\n  })\\n  @IsNotEmpty()\\n  user: Types.ObjectId;\\n\\n  @Prop({\\n    required: true,\\n  })\\n  items: [\\n    {\\n      product: {\\n        type: Types.ObjectId;\\n        ref: \\"Product\\";\\n        required: true;\\n      };\\n      quantity: {\\n        type: number;\\n        required: true;\\n        default: 0;\\n      };\\n    }\\n  ];\\n}\\n```\\n\\n`items`\ub77c\ub294 array \ud0c0\uc785 \ud544\ub4dc\uc5d0 `product`\uc640 \uc218\ub7c9\ub4e4\uc744 \uc800\uc7a5\ud558\ub294 \ud615\ud0dc\uc774\ub2e4.\\n\\n```ts title=\\"carts.controller.ts\\"\\n@UseGuards(JwtAuthGuard)\\n  @Post(\'\')\\n  async addCartItem(\\n    @Body(\'productId\', ObjectIdValidationPipe) productId: string,\\n    @Body(\'quantity\') quantity: number,\\n    @LogInUser() user: User,\\n  ) {\\n    return this.cartsService.addCartItem(productId, quantity, user._id);\\n  }\\n\\n  @UseGuards(JwtAuthGuard)\\n  @Patch(\'\')\\n  async updateCartItem(\\n    @Body(\'productId\', ObjectIdValidationPipe) productId: string,\\n    @Body(\'quantity\') quantity: number,\\n    @LogInUser() user: User,\\n  ) {\\n    return this.cartsService.updateCartItem(productId, quantity, user._id);\\n  }\\n\\n  @UseGuards(JwtAuthGuard)\\n  @Delete(\'\')\\n  async deleteCartItem(\\n    @Body(\'productId\', ObjectIdValidationPipe) productId: string,\\n    @LogInUser() user: User,\\n  ) {\\n    return this.cartsService.deleteCartItem(productId, user._id);\\n  }\\n\\n  @UseGuards(JwtAuthGuard)\\n  @Get(\'\')\\n  async getCart(@LogInUser() user: User) {\\n    return this.cartsService.getCart(user._id);\\n  }\\n```\\n\\n```ts title=\\"carts.service.ts\\"\\nasync addCartItem(productId: string, quantity: number, userId: string) {\\n    const isProductExist = await this.productsRepository.existsById(productId);\\n\\n    if (!isProductExist) throw new BadRequestException(\'INVALID_PRODUCT_ID\');\\n\\n    const existCartItem = await this.cartsRepository.existsCartItem(\\n      productId,\\n      userId,\\n    );\\n\\n    if (existCartItem) {\\n      const updateItem = await this.cartsRepository.updateCartItem(\\n        productId,\\n        quantity,\\n        userId,\\n      );\\n      return updateItem;\\n    } else {\\n      const addItem = await this.cartsRepository.addCartItem(\\n        productId,\\n        quantity,\\n        userId,\\n      );\\n      return addItem;\\n    }\\n  }\\n\\n  async updateCartItem(productId: string, quantity: number, userId: string) {\\n    const isItemExist = await this.cartsRepository.existsCartItem(\\n      productId,\\n      userId,\\n    );\\n\\n    if (!isItemExist) throw new BadRequestException(\'DOES_NOT_EXIST_ITEM\');\\n\\n    const updateItem = await this.cartsRepository.updateItemQuantity(\\n      productId,\\n      quantity,\\n      userId,\\n    );\\n\\n    return updateItem;\\n  }\\n\\n  async deleteCartItem(productId: string, userId: string) {\\n    const isItemExist = await this.cartsRepository.existsCartItem(\\n      productId,\\n      userId,\\n    );\\n\\n    if (!isItemExist) throw new BadRequestException(\'DOES_NOT_EXIST_ITEM\');\\n\\n    const deleteItem = await this.cartsRepository.deleteCartItem(\\n      productId,\\n      userId,\\n    );\\n\\n    return deleteItem;\\n  }\\n\\n  async getCart(userId: string) {\\n    const cart = await this.cartsRepository.findCartByUser(userId);\\n    if (!cart) {\\n      return cart;\\n    }\\n    const shipping = this.calculateShipping(cart.totalPrice);\\n    cart.shipping = shipping;\\n    cart.orderPrice = cart.totalPrice + shipping;\\n    return cart;\\n  }\\n\\n  calculateShipping(totalPrice: number) {\\n    const FREE_SHIPPING = 30000;\\n    const SHIPPING = 3000;\\n    const shippingPrice =\\n      totalPrice >= FREE_SHIPPING || totalPrice == 0 ? 0 : SHIPPING;\\n\\n    return shippingPrice;\\n  }\\n```\\n\\n`addCardItem` \ud568\uc218\uc5d0\uc11c\ub294 \ucd94\uac00\ud558\ub824\ub294 \uc544\uc774\ud15c\uc774 \uc7a5\ubc14\uad6c\ub2c8\uc5d0 \uc788\ub294\uc9c0 \ud655\uc778\ud558\uace0 \uc788\uc73c\uba74 \uc218\ub7c9 \ucd94\uac00, \uc5c6\uc73c\uba74 `items` \ud544\ub4dc\uc5d0 \uc0c8\ub85c\uc6b4 item\uc744 push \ud55c\ub2e4.\\n\\n`updateCartItem` \ud568\uc218\uc5d0\uc11c\ub294 \uc218\uc815\ud558\ub824\ub294 \uc544\uc774\ud15c\uc774 \uc874\uc7ac\ud558\ub294\uc9c0 \ud655\uc778 \ud6c4\uc5d0 \uc218\ub7c9 \uc218\uc815\ud55c\ub2e4.\\n\\n`deleteCartItem` \ud568\uc218\uc5d0\uc11c\ub294 \uc0ad\uc81c\ud558\ub824\ub294 \uc544\uc774\ud15c\uc774 \uc874\uc7ac\ud558\ub294\uc9c0 \ud655\uc778 \ud6c4\uc5d0 `items` \ud544\ub4dc\uc5d0\uc11c \ud574\ub2f9 item\uc744 \uc81c\uac70\ud55c\ub2e4.\\n\\n```ts title=\\"carts.repository.ts\\"\\nasync existsCartItem(productId: string, userId: string): Promise<boolean> {\\n    const result = await this.cartModel.exists({\\n      user: userId,\\n      items: {\\n        $elemMatch: {\\n          product: new Types.ObjectId(productId),\\n        },\\n      },\\n    });\\n    return result;\\n  }\\n\\n  async addCartItem(\\n    productId: string,\\n    quantity: number,\\n    userId: string,\\n  ): Promise<Cart> {\\n    const addItem = await this.cartModel.findOneAndUpdate(\\n      { user: userId },\\n      {\\n        $push: {\\n          items: {\\n            product: new Types.ObjectId(productId),\\n            quantity: quantity,\\n          },\\n        },\\n      },\\n      { new: true, upsert: true },\\n    );\\n\\n    return addItem;\\n  }\\n\\n  async updateCartItem(\\n    productId: string,\\n    quantity: number,\\n    userId: string,\\n  ): Promise<Cart> {\\n    const updateItem = await this.cartModel.findOneAndUpdate(\\n      {\\n        user: userId,\\n        items: { $elemMatch: { product: new Types.ObjectId(productId) } },\\n      },\\n      {\\n        $inc: {\\n          \'items.$.quantity\': quantity,\\n        },\\n      },\\n      {\\n        new: true,\\n      },\\n    );\\n\\n    return updateItem;\\n  }\\n\\n  async updateItemQuantity(\\n    productId: string,\\n    quantity: number,\\n    userId: string,\\n  ): Promise<Cart> {\\n    const updateItem = await this.cartModel.findOneAndUpdate(\\n      {\\n        user: userId,\\n        items: { $elemMatch: { product: new Types.ObjectId(productId) } },\\n      },\\n      {\\n        $set: {\\n          \'items.$.quantity\': quantity,\\n        },\\n      },\\n      {\\n        new: true,\\n      },\\n    );\\n\\n    return updateItem;\\n  }\\n\\n  async deleteCartItem(productId: string, userId: string): Promise<Cart> {\\n    const deleteItem = await this.cartModel.findOneAndUpdate(\\n      {\\n        user: userId,\\n        items: { $elemMatch: { product: new Types.ObjectId(productId) } },\\n      },\\n      {\\n        $pull: {\\n          items: {\\n            product: new Types.ObjectId(productId),\\n          },\\n        },\\n      },\\n      {\\n        new: true,\\n      },\\n    );\\n\\n    return deleteItem;\\n  }\\n```\\n\\n```ts title=\\"populate \uc774\uc6a9\ud55c join\\"\\nasync findCartByUser(userId: string) {\\n    const cart = await this.cartModel\\n      .findOne({\\n        user: userId,\\n      })\\n      .populate({\\n        path: \'items.product\',\\n        model: \'Product\',\\n        select: [\'-category\', \'-likeCount\'],\\n      })\\n      .select(\'items\');\\n    return cart;\\n  }\\n```\\n\\n```js title=\\"query \uacb0\uacfc\\"\\nMongoose: carts.findOne({ user: new ObjectId(\\"61ef4ef483aeaabd737f4059\\") }, { projection: { items: 1 } })\\nMongoose: products.find({ _id: { \'$in\': [ new ObjectId(\\"61e7cb111c3b362cd6b15440\\"), new ObjectId(\\"61e7b58e1c3b362cd6b15413\\") ], [Symbol(mongoose#trustedSymbol)]: true }}, { skip: undefined, limit: undefined, perDocumentLimit: undefined, projection: { category: 0, likeCount: 0 }})\\n```\\n\\n```ts title=\\"lookup\uc744 \uc774\uc6a9\ud55c join\\"\\nasync findCartByUser(userId: string): Promise<aggregateCartDto> {\\n    const cart = await this.cartModel.aggregate([\\n      {\\n        $match: { user: userId },\\n      },\\n      {\\n        $unwind: { path: \'$items\' },\\n      },\\n      {\\n        $lookup: {\\n          from: \'products\',\\n          localField: \'items.product\',\\n          foreignField: \'_id\',\\n          as: \'items.product\',\\n        },\\n      },\\n      {\\n        $unwind: { path: \'$items.product\' },\\n      },\\n      {\\n        $group: {\\n          _id: \'$_id\',\\n          items: {\\n            $push: \'$items\',\\n          },\\n        },\\n      },\\n      {\\n        $project: {\\n          \'items.product.category\': 0,\\n          \'items.product.likeUsers\': 0,\\n        },\\n      },\\n      {\\n        $addFields: {\\n          items: {\\n            $map: {\\n              input: \'$items\',\\n              as: \'item\',\\n              in: {\\n                product: \'$$item.product\',\\n                quantity: \'$$item.quantity\',\\n                itemPrice: {\\n                  $multiply: [\'$$item.product.price\', \'$$item.quantity\'],\\n                },\\n              },\\n            },\\n          },\\n        },\\n      },\\n      {\\n        $addFields: {\\n          totalQuantity: { $sum: \'$items.quantity\' },\\n          totalPrice: { $sum: \'$items.itemPrice\' },\\n        },\\n      },\\n    ]);\\n    return cart[0];\\n  }\\n```\\n\\n```js title=\\"query \uacb0\uacfc\\"\\nMongoose: carts.aggregate(\\n  [\\n    { $match: { user: new ObjectId(\\"61ef4ef483aeaabd737f4059\\") } },\\n    { $unwind: { path: \\"$items\\" } },\\n    {\\n      $lookup: {\\n        from: \\"products\\",\\n        localField: \\"items.product\\",\\n        foreignField: \\"_id\\",\\n        as: \\"items.product\\",\\n      },\\n    },\\n    { $unwind: { path: \\"$items.product\\" } },\\n    { $group: { _id: \\"$_id\\", items: { $push: \\"$items\\" } } },\\n    { $project: { \\"items.product.category\\": 0, \\"items.product.likeUsers\\": 0 } },\\n    {\\n      $addFields: {\\n        items: {\\n          $map: {\\n            input: \\"$items\\",\\n            as: \\"item\\",\\n            in: {\\n              product: \\"$$item.product\\",\\n              quantity: \\"$$item.quantity\\",\\n              itemPrice: {\\n                $multiply: [\\"$$item.product.price\\", \\"$$item.quantity\\"],\\n              },\\n            },\\n          },\\n        },\\n      },\\n    },\\n    {\\n      $addFields: {\\n        totalQuantity: { $sum: \\"$items.quantity\\" },\\n        totalPrice: { $sum: \\"$items.itemPrice\\" },\\n      },\\n    },\\n  ],\\n  {}\\n);\\n```\\n\\n**MongoDB\uc758 \\"$lookup\\" \uae30\ub2a5\uacfc RDBMS join\uc758 \ucc28\uc774**\\n\\n- INNER JOIN\uc740 \uc9c0\uc6d0\ud558\uc9c0 \uc54a\uc73c\uba70, OUTER JOIN\ub9cc \uc9c0\uc6d0\ud55c\ub2e4.\\n- \uc870\uc778\ub418\ub294 \ub300\uc0c1 \uceec\ub809\uc158\uc740 \uac19\uc740 \ub370\uc774\ud130\ubca0\uc774\uc2a4\uc5d0 \uc788\uc5b4\uc57c \ud55c\ub2e4.\\n- \uc0e4\ub529\ub418\uc9c0 \uc54a\uc740 \uceec\ub809\uc158\ub9cc \\"$lookup\\" \uc624\ud37c\ub808\uc774\uc158\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub2e4.\\n\\n### \ub9ac\ubdf0 \uc0dd\uc131, \uc218\uc815, \uc0ad\uc81c, \uc870\ud68c\\n\\n- POST /products/reviews/:productId (\ub9ac\ubdf0 \uc0dd\uc131)\\n- GET /products/reviews/:productId (\ub9ac\ubdf0 \uc870\ud68c)\\n- PUT /products/reviews/:reviewId (\ub9ac\ubdf0 \uc218\uc815)\\n- DELETE /products/reviews/:reviewId (\ub9ac\ubdf0 \uc0ad\uc81c)\\n\\n```ts title=\\"reviews.schema.ts\\"\\n@Schema(options)\\nexport class Review extends Document {\\n  @Prop({\\n    type: Types.ObjectId,\\n    required: true,\\n    ref: \\"User\\",\\n  })\\n  @IsNotEmpty()\\n  author: Types.ObjectId;\\n\\n  @Prop({\\n    type: Types.ObjectId,\\n    required: true,\\n    ref: \\"Product\\",\\n  })\\n  @IsNotEmpty()\\n  product: Types.ObjectId;\\n\\n  @Prop()\\n  @IsString()\\n  content: string;\\n\\n  @Prop()\\n  @IsString()\\n  image: string;\\n\\n  @Prop({\\n    default: 0,\\n    required: true,\\n  })\\n  @IsNotEmpty()\\n  @IsNumber()\\n  @Min(0)\\n  @Max(5)\\n  rating: number;\\n\\n  @Prop({\\n    default: false,\\n  })\\n  @IsBoolean()\\n  isDeleted: boolean;\\n}\\n```\\n\\n```ts title=\\"products.schema.ts\\"\\n@Prop()\\n  recentReviews: Review[];\\n```\\n\\nSubset \ud328\ud134\uc744 \ub3c4\uc785\ud558\uc5ec \uc0c1\ud488 \ub3c4\ud050\uba3c\ud2b8\uc5d0 5\uac1c\uc758 \ucd5c\uc2e0 \ub9ac\ubdf0\ub4e4\uc744 \ub530\ub85c \uc800\uc7a5\ud558\uc600\ub2e4.\\n\\n![img](https://i.ibb.co/hmp1KwY/2022-01-28-5-15-08.png)\\n\\n\uc0c1\ud488 \ub3c4\ud050\uba3c\ud2b8\uc5d0 \uc815\ud574\uc9c4 \uac2f\uc218\ub9cc\ud07c\uc758 \ucd5c\uc2e0 \ub9ac\ubdf0\ub4e4\uc744 \uc800\uc7a5\ud574\ub193\ub294 \ubc29\uc2dd\uc744 \uc0ac\uc6a9\ud558\uba74 \uc870\ud68c\uc2dc\uc5d0 \ud6a8\uc728\uc801\uc73c\ub85c \ub370\uc774\ud130\ub97c \uc804\ub2ec\ud560 \uc218 \uc788\ub2e4.\\n\\n\ud558\uc9c0\ub9cc \ub370\uc774\ud130 \uc218\uc815\uc774 \ubc1c\uc0dd\ud588\uc744 \ub54c \uc591\ucabd \ubaa8\ub450\ub97c \uc218\uc815\ud574\uc8fc\uc5b4\uc57c\ud558\uace0, \uc0c8\ub85c\uc6b4 \ub9ac\ubdf0\uac00 \uc0dd\uc131\ub420 \ub54c\ub9c8\ub2e4 \uc0c1\ud488\uc758 \ucd5c\uc2e0\ub9ac\ubdf0 \ud544\ub4dc\ub97c \uc815\ud574\uc9c4 \uac2f\uc218\uc5d0 \ub9de\uac8c \uac31\uc2e0\ud574\uc8fc\ub294 \uc791\uc5c5\uc744 \ud574\uc8fc\uc5b4\uc57c\ud558\uae30 \ub54c\ubb38\uc5d0 \uc0dd\uc131\uacfc \uc218\uc815\uc774 \ub354 \ube48\ubc88\ud55c \ub370\uc774\ud130\ub77c\uace0 \ud55c\ub2e4\uba74 \uc624\ud788\ub824 \ube44\ud6a8\uc728\uc801\uc77c \uc218 \uc788\ub2e4.\\n\\n```ts title=\\"reviews.controller.ts\\"\\n@UseGuards(JwtAuthGuard)\\n  @Post(\':productId\')\\n  async createReivew(\\n    @Param(\'productId\', ObjectIdValidationPipe) productId: string,\\n    @Body() body: ReviewRequestDto,\\n    @Body(\'rating\', ParseIntPipe, RatingValidationPipe) rating: number,\\n    @LogInUser() user: User,\\n  ) {\\n    const reviewDto = {\\n      product: productId,\\n      author: user._id,\\n      ...body,\\n    };\\n    return await this.reviewsService.createReview(reviewDto);\\n  }\\n\\n  @Get(\':productId\')\\n  async getReivewByProduct(\\n    @Param(\'productId\', ObjectIdValidationPipe) productId: string,\\n    @Query(QueryValidationPipe) query: ReviewQueryDto,\\n  ) {\\n    return await this.reviewsService.getReviewByProduct(productId, query);\\n  }\\n\\n  @UseGuards(JwtAuthGuard)\\n  @Put(\':reviewId\')\\n  async updateReview(\\n    @Param(\'reviewId\', ObjectIdValidationPipe) reviewId: string,\\n    @Body() body: ReviewRequestDto,\\n    @Body(\'rating\', ParseIntPipe, RatingValidationPipe) rating: number,\\n    @LogInUser() user: User,\\n  ) {\\n    return await this.reviewsService.updateReview(reviewId, user._id, body);\\n  }\\n\\n  @UseGuards(JwtAuthGuard)\\n  @Delete(\':reviewId\')\\n  async deleteReview(\\n    @Param(\'reviewId\', ObjectIdValidationPipe) reviewId: string,\\n    @LogInUser() user: User,\\n  ) {\\n    return await this.reviewsService.deleteReview(reviewId, user._id);\\n  }\\n```\\n\\n```ts title=\\"reviews.service.ts\\"\\n\\tasync createReview(reviewDto: ReviewDto) {\\n    const { product } = reviewDto;\\n\\n    const isProductExist = await this.productsRepository.existsById(product);\\n\\n    if (!isProductExist)\\n      throw new BadRequestException(\'PRODUCT_DOES_NOT_EXIST\');\\n\\n    const review = await this.reviewsRepository.createReview(reviewDto);\\n\\n    await this.reviewsRepository.addRecentReview(review);\\n\\n    const recentReviewCount = await this.reviewsRepository.countRecentReview(\\n      product,\\n    );\\n\\n    if (recentReviewCount > 5) {\\n      await this.reviewsRepository.removeRecentReview(product);\\n    }\\n    return review;\\n  }\\n\\n  async updateReview(reviewId: string, userId: string, body: ReviewRequestDto) {\\n    const isReviewExist = await this.reviewsRepository.existsReview(\\n      reviewId,\\n      userId,\\n    );\\n\\n    if (!isReviewExist) throw new BadRequestException(\'REVIEW_DOES_NOT_EXIST\');\\n\\n    const updateReview = await this.reviewsRepository.updateReview(\\n      reviewId,\\n      body,\\n    );\\n\\n    await this.reviewsRepository.updateRecentReview(updateReview);\\n\\n    return updateReview;\\n  }\\n\\n  async deleteReview(reviewId: string, userId: string) {\\n    const isReviewExist = await this.reviewsRepository.existsReview(\\n      reviewId,\\n      userId,\\n    );\\n\\n    if (!isReviewExist) throw new BadRequestException(\'REVIEW_DOES_NOT_EXIST\');\\n\\n    await this.reviewsRepository.deleteRecentReview(reviewId);\\n    const deleteReview = await this.reviewsRepository.deleteReview(reviewId);\\n\\n    return deleteReview;\\n  }\\n\\n  async getReviewByProduct(productId: string, query: ReviewQueryDto) {\\n    const isProductExist = await this.productsRepository.existsById(productId);\\n\\n    if (!isProductExist)\\n      throw new BadRequestException(\'PRODUCT_DOES_NOT_EXIST\');\\n\\n    return await this.reviewsRepository.findReviewByProduct(productId, query);\\n  }\\n\\n  async getReviewByAuthor(\\n    userId: string | Types.ObjectId,\\n    query: ReviewQueryDto,\\n  ) {\\n    return await this.reviewsRepository.findReviewByAuthor(userId, query);\\n  }\\n```\\n\\n```ts title=\\"reviews.repository.ts\\"\\n\\tasync createReview(reviewDto: ReviewDto): Promise<Review> {\\n    return await this.reviewModel.create(reviewDto);\\n  }\\n\\n  async updateReview(\\n    reviewId: string,\\n    body: ReviewRequestDto,\\n  ): Promise<Review> {\\n    const { content, image, rating } = body;\\n    return await this.reviewModel.findOneAndUpdate(\\n      {\\n        _id: reviewId,\\n      },\\n      {\\n        $set: { content, image, rating },\\n      },\\n      {\\n        new: true,\\n      },\\n    );\\n  }\\n\\n\\t// \uc0ad\uc81c\uc2dc\uc5d0 isDeleted \ud544\ub4dc\ub97c true \uac12\uc73c\ub85c \uc218\uc815\ud558\uc5ec softDelete\\n  async deleteReview(reviewId: string): Promise<Review> {\\n    return await this.reviewModel.findOneAndUpdate(\\n      {\\n        _id: reviewId,\\n      },\\n      {\\n        $set: { isDeleted: true },\\n      },\\n      {\\n        new: true,\\n      },\\n    );\\n  }\\n\\n  async existsReview(reviewId: string, userId: string): Promise<boolean> {\\n    return await this.reviewModel.exists({\\n      _id: reviewId,\\n      author: userId,\\n    });\\n  }\\n\\n  // \uc0c1\ud488\uc758 \ucd5c\uc2e0\ub9ac\ubdf0 \ud544\ub4dc\uc5d0 \uc0dd\uc131\ub41c \ub9ac\ubdf0 push\\n  async addRecentReview(review: Review) {\\n    return await this.productModel.updateOne(\\n      {\\n        _id: review.product,\\n      },\\n      { $push: { recentReviews: review } },\\n    );\\n  }\\n\\n  // \ucd5c\uc2e0\ub9ac\ubdf0 \ud544\ub4dc\uc5d0 \ub9ac\ubdf0 \uc218\uac00 5\uac1c\uac00 \ub118\uc5b4\uac14\uc744 \ub54c \uac00\uc7a5 \uc624\ub798\ub41c \ub9ac\ubdf0\ub97c array\uc5d0\uc11c \uc0ad\uc81c\\n  async removeRecentReview(productId: string) {\\n    return await this.productModel.updateOne(\\n      {\\n        _id: productId,\\n      },\\n      {\\n        $pop: { recentReviews: -1 },\\n      },\\n    );\\n  }\\n\\n  // \uc218\uc815 \ub9ac\ubdf0\uac00 \ucd5c\uc2e0 \ub9ac\ubdf0 \ud544\ub4dc\uc5d0 \uc874\uc7ac\ud55c\ub2e4\uba74 \ud568\uaed8 \uc218\uc815\\n  async updateRecentReview(review: Review): Promise<Product> {\\n    return await this.productModel.findOneAndUpdate(\\n      {\\n        recentReviews: {\\n          $elemMatch: {\\n            _id: new Types.ObjectId(review._id),\\n            author: review.author,\\n          },\\n        },\\n      },\\n      {\\n        $set: { \'recentReviews.$[review]\': review },\\n      },\\n      {\\n        arrayFilters: [{ \'review._id\': new Types.ObjectId(review._id) }],\\n        new: true,\\n      },\\n    );\\n  }\\n\\n  // \uc0ad\uc81c \ub9ac\ubdf0\uac00 \ucd5c\uc2e0 \ub9ac\ubdf0 \ud544\ub4dc\uc5d0 \uc874\uc7ac\ud55c\ub2e4\uba74 array\uc5d0\uc11c \uc0ad\uc81c\\n  async deleteRecentReview(reviewId: string) {\\n    return await this.productModel.updateOne(\\n      {\\n        recentReviews: {\\n          $elemMatch: {\\n            _id: new Types.ObjectId(reviewId),\\n          },\\n        },\\n      },\\n      {\\n        $pull: { recentReviews: { _id: new Types.ObjectId(reviewId) } },\\n      },\\n    );\\n  }\\n\\n  // \ucd5c\uc2e0 \ub9ac\ubdf0 array\uc5d0 \ub2f4\uae34 \ub9ac\ubdf0 \uc218\ub97c count\\n  async countRecentReview(productId: string): Promise<number> {\\n    const countAggregation = await this.productModel.aggregate([\\n      {\\n        $match: { _id: new Types.ObjectId(productId) },\\n      },\\n      {\\n        $project: {\\n          _id: 0,\\n          reviewCount: {\\n            $cond: {\\n              if: { $isArray: \'$recentReviews\' },\\n              then: { $size: \'$recentReviews\' },\\n              else: 0,\\n            },\\n          },\\n        },\\n      },\\n    ]);\\n    return countAggregation[0].reviewCount;\\n  }\\n\\n  async countReview(productId: string): Promise<number> {\\n    return await this.reviewModel.countDocuments({\\n      product: productId,\\n\\t\\t\\tisDeleted: false,\\n    });\\n  }\\n\\n  async calculateRatingAvg(productId: string): Promise<number> {\\n    const avgAggregation = await this.reviewModel.aggregate([\\n      {\\n        $match: { product: productId, isDeleted: false },\\n      },\\n      {\\n        $group: {\\n          _id: productId,\\n          ratingAvg: { $avg: { $sum: \'$rating\' } },\\n        },\\n      },\\n    ]);\\n\\n    if (avgAggregation.length === 0) {\\n      return 0;\\n    }\\n\\n    return avgAggregation[0].ratingAvg.toFixed(1);\\n  }\\n\\n  async findReviewByProduct(productId: string, query: ReviewQueryDto) {\\n    const { sort, offset = 0, limit = 10, rating } = query;\\n\\n    const sortBy = {\\n      recent: \'-createdAt\',\\n      old: \'createdAt\',\\n      rating: \'-rating\',\\n    };\\n\\n    const filterQuery = { product: productId, isDeleted: false };\\n\\n    if (rating) {\\n      filterQuery[\'rating\'] = rating;\\n    }\\n\\n    return await this.reviewModel\\n      .find(filterQuery)\\n      .skip(offset)\\n      .limit(limit)\\n      .sort(sortBy[sort]);\\n  }\\n\\n  async findReviewByAuthor(\\n    userId: string | Types.ObjectId,\\n    query: ReviewQueryDto,\\n  ) {\\n    const { sort, offset = 0, limit = 10, rating } = query;\\n\\n    const sortBy = {\\n      recent: \'-createdAt\',\\n      old: \'createdAt\',\\n      rating: \'-rating\',\\n    };\\n\\n    const filterQuery = { author: userId, isDeleted: false };\\n\\n    if (rating) {\\n      filterQuery[\'rating\'] = rating;\\n    }\\n\\n    return await this.reviewModel\\n      .find(filterQuery)\\n      .skip(offset)\\n      .limit(limit)\\n      .sort(sortBy[sort]);\\n  }\\n```\\n\\n### POST /image/upload (\uc774\ubbf8\uc9c0 \ud30c\uc77c \uc5c5\ub85c\ub4dc)\\n\\n```ts title=\\"image.controller.ts\\"\\n@UseGuards(JwtAuthGuard)\\n  @Post(\'upload\')\\n  @UseInterceptors(FileInterceptor(\'image\'))\\n  async uploadImage(\\n    @LogInUser() user: User,\\n    @UploadedFile() image: Express.Multer.File,\\n  ) {\\n    return await this.imageService.uploadImageToS3(user._id, image);\\n  }\\n```\\n\\n```ts title=\\"image.service.ts\\"\\nconstructor() {\\n    this.awsS3 = new AWS.S3({\\n      accessKeyId: process.env.AWS_ACCESS_KEY_ID,\\n      secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY,\\n      region: process.env.AWS_REGION,\\n    });\\n    this.S3_BUCKET_NAME = process.env.AWS_S3_BUCKET_NAME;\\n  }\\n\\n  async uploadImageToS3(folder: string, image: Express.Multer.File) {\\n    try {\\n      const key = `images/${folder}/${Date.now()}_${path.basename(\\n        image.originalname,\\n      )}`.replace(/ /g, \'\');\\n\\n      await this.awsS3\\n        .putObject({\\n          Bucket: this.S3_BUCKET_NAME,\\n          Key: key,\\n          Body: image.buffer,\\n          ContentType: image.mimetype,\\n        })\\n        .promise();\\n\\n      return `https://${this.S3_BUCKET_NAME}.s3.amazonaws.com/${key}`;\\n    } catch (error) {\\n      console.log(error);\\n      throw new BadRequestException(\'IMAGE_UPLOAD_FAILED\');\\n    }\\n  }\\n```"},{"id":"/2021/11/20/backend/project/preonboarding-8percent","metadata":{"permalink":"/2021/11/20/backend/project/preonboarding-8percent","source":"@site/blog/backend/project/2021-11-20-preonboarding-8percent.md","title":"\uc6d0\ud2f0\ub4dc \ud504\ub9ac\uc628\ubcf4\ub529 8percent \uae30\uc5c5\uacfc\uc81c","description":"\uae30\uac04: 2021-11-12 ~ 2021-11-13","date":"2021-11-20T00:00:00.000Z","formattedDate":"November 20, 2021","tags":[{"label":"BackEnd","permalink":"/tags/back-end"},{"label":"Django","permalink":"/tags/django"}],"readingTime":9.2,"hasTruncateMarker":true,"authors":[{"name":"Chihun Park","url":"https://github.com/chihunmanse","email":"chihunmanse@gmail.com","imageURL":"https://p.ipic.vip/o1ih3g.png","key":"chihun"}],"frontMatter":{"title":"\uc6d0\ud2f0\ub4dc \ud504\ub9ac\uc628\ubcf4\ub529 8percent \uae30\uc5c5\uacfc\uc81c","tags":["BackEnd","Django"],"authors":"chihun"},"prevItem":{"title":"NestJS & MongoDB Project","permalink":"/2022/02/10/backend/project/nestJS"},"nextItem":{"title":"Kream Clone Project","permalink":"/2021/11/10/backend/project/kream-clone"}},"content":"**\uae30\uac04: 2021-11-12 ~ 2021-11-13**\\n\\n**Stack: Python, Django, SQLite, DjangoORM**\\n\\n**[Github \ub9c1\ud06c](https://github.com/chihunmanse/PreonBoarding4-8percent)**\\n\\n- \uac70\ub798\ub0b4\uc5ed\uc774 1\uc5b5\uac74\uc744 \ub118\uc5b4\uac08 \ub54c\uc5d0 \ub300\ud55c \uace0\ub824\\n  - \uc774\ub97c \uace0\ub824\ud558\uc5ec \uc5b4\ub5a4 \uc124\uacc4\ub97c \ucd94\uac00\ud558\uc168\ub294\uc9c0\ub97c README\uc5d0 \ub0a8\uaca8 \uc8fc\uc138\uc694.\\n\\n\\n8\ud37c\uc13c\ud2b8\uc758 \uacfc\uc81c\uc5d0\uc11c\ub294 \ud558\ub098\uc758 \ud14c\uc774\ube14\uc5d0 \ub300\ub7c9\uc758 \ub370\uc774\ud130\uac00 \uc9d1\uc911\uc801\uc73c\ub85c \uc313\uc778 \uacbd\uc6b0\uc5d0 \ub300\ud55c \ub300\ube44\ub97c \uc5b4\ub5bb\uac8c \ud560 \uc218 \uc788\ub294\uc9c0\uac00 \uc8fc\ub41c \ud3ec\uc778\ud2b8\uc600\ub358 \uac83 \uac19\ub2e4.\\n\\n\ud558\ub098\uc758 \ud14c\uc774\ube14\uc5d0 \ub300\ub7c9\uc758 \ub370\uc774\ud130\uac00 \uc9d1\uc911\uc801\uc73c\ub85c \uc313\uc774\uba74 \uc131\ub2a5\uc774 \uc800\ud558\ub420 \ud655\ub960\uc774 \ub192\ub2e4. \\n\\n## Indexing\\n\\n\uc778\ub371\uc2a4\ub780?\\n\\n```\\n\uc778\ub371\uc2a4(Index)\ub294 \ub370\uc774\ud130\ubca0\uc774\uc2a4 \ubd84\uc57c\uc5d0 \uc788\uc5b4\uc11c \ud14c\uc774\ube14\uc5d0 \ub300\ud55c \ub3d9\uc791\uc758 \uc18d\ub3c4\ub97c \ub192\uc5ec\uc8fc\ub294 \uc790\ub8cc \uad6c\uc870\ub97c \uc77c\uceeb\ub294\ub2e4. \uc778\ub371\uc2a4\ub294 \ud14c\uc774\ube14 \ub0b4\uc758 1\uac1c\uc758 \uceec\ub7fc, \ud639\uc740 \uc5ec\ub7ec \uac1c\uc758 \uceec\ub7fc\uc744 \uc774\uc6a9\ud558\uc5ec \uc0dd\uc131\ub420 \uc218 \uc788\ub2e4. \uace0\uc18d\uc758 \uac80\uc0c9 \ub3d9\uc791\ubfd0\ub9cc \uc544\ub2c8\ub77c \ub808\ucf54\ub4dc \uc811\uadfc\uacfc \uad00\ub828 \ud6a8\uc728\uc801\uc778 \uc21c\uc11c \ub9e4\uae40 \ub3d9\uc791\uc5d0 \ub300\ud55c \uae30\ucd08\ub97c \uc81c\uacf5\ud55c\ub2e4. \uc778\ub371\uc2a4\ub97c \uc800\uc7a5\ud558\ub294 \ub370 \ud544\uc694\ud55c \ub514\uc2a4\ud06c \uacf5\uac04\uc740 \ubcf4\ud1b5 \ud14c\uc774\ube14\uc744 \uc800\uc7a5\ud558\ub294 \ub370 \ud544\uc694\ud55c \ub514\uc2a4\ud06c \uacf5\uac04\ubcf4\ub2e4 \uc791\ub2e4. (\uc65c\ub0d0\ud558\uba74 \ubcf4\ud1b5 \uc778\ub371\uc2a4\ub294 \ud0a4-\ud544\ub4dc\ub9cc \uac16\uace0 \uc788\uace0, \ud14c\uc774\ube14\uc758 \ub2e4\ub978 \uc138\ubd80 \ud56d\ubaa9\ub4e4\uc740 \uac16\uace0 \uc788\uc9c0 \uc54a\uae30 \ub54c\ubb38\uc774\ub2e4.) \uad00\uacc4\ud615 \ub370\uc774\ud130\ubca0\uc774\uc2a4\uc5d0\uc11c\ub294 \uc778\ub371\uc2a4\ub294 \ud14c\uc774\ube14 \ubd80\ubd84\uc5d0 \ub300\ud55c \ud558\ub098\uc758 \uc0ac\ubcf8\uc774\ub2e4.\\n\\n\uc778\ub371\uc2a4\ub294 \uace0\uc720 \uc81c\uc57d \uc870\uac74\uc744 \uc2e4\ud604\ud558\uae30 \uc704\ud574\uc11c\ub3c4 \uc0ac\uc6a9\ub41c\ub2e4. \uace0\uc720 \uc778\ub371\uc2a4\ub294 \uc911\ubcf5\ub41c \ud56d\ubaa9\uc774 \ub4f1\ub85d\ub418\ub294 \uac83\uc744 \uae08\uc9c0\ud558\uae30 \ub54c\ubb38\uc5d0 \uc778\ub371\uc2a4\uc758 \ub300\uc0c1\uc778 \ud14c\uc774\ube14\uc5d0\uc11c \uace0\uc720\uc131\uc774 \ubcf4\uc7a5\ub41c\ub2e4.\\n```\\n\\n![](https://media.vlpt.us/images/bsjp400/post/f0417278-986a-4599-99b1-5468abf2610d/image.png)\\n\\nHistory \uac12\uc744 \uc704\uc758 \ud14c\uc774\ube14\uc5d0\uc11c \uc870\ud68c\ud55c\ub2e4\uace0 \ud588\uc744 \ub54c \uc5b4\ub290 \uc704\uce58\uc5d0 \ud574\ub2f9 \ub370\uc774\ud130\uac00 \uc874\uc7ac\ud558\ub294\uc9c0 \ubaa8\ub974\uae30 \ub54c\ubb38\uc5d0 \ud14c\uc774\ube14 \uc804\uccb4\ub97c \uc870\ud68c\ud574\uc57c\ud55c\ub2e4. \uc774 \ub54c \ub370\uc774\ud130\uc758 \uc218\uac00 \ub9ce\uc740 \ud14c\uc774\ube14\uc774\ub77c\uace0 \ud588\uc744 \ub54c \uc870\ud68c\uac00 \uc7a6\uc740 \ud14c\uc774\ube14\uc774\ub77c\uace0 \ud558\uba74 \uc11c\ube44\uc2a4\uc758 \uc131\ub2a5\uc774 \ub5a8\uc5b4\uc9c0\uac8c \ub41c\ub2e4.\\n\\n\uc67c\ucabd\uacfc \uac19\uc774 \uc778\ub371\uc2a4\ub97c \ub530\ub85c \uc0dd\uc131\ud558\uc5ec \ud544\uc694\ud55c \ub370\uc774\ud130\ub97c \ube60\ub974\uac8c \ucc3e\uc744 \uc218 \uc788\uac8c \ud568\uc73c\ub85c\uc368 \uc870\ud68c\ud560 \ub54c \uc131\ub2a5\uc744 \ud5a5\uc0c1\uc2dc\ud0ac \uc218 \uc788\ub2e4.\\n\\n\ud558\uc9c0\ub9cc \ub370\uc774\ud130\uc758 \ucd94\uac00, \uc218\uc815, \uc0ad\uc81c\uac00 \uc7a6\uc740 \ud14c\uc774\ube14\uc774\ub77c\uba74 \uc778\ub371\uc2a4\ub97c \uc0ac\uc6a9\ud588\uc744 \ub54c \uc624\ud788\ub824 \uc131\ub2a5\uc774 \uc800\ud558\ub420 \uc218 \uc788\ub2e4.\\n\\n![](https://user-images.githubusercontent.com/61782539/141482697-6ff59772-441a-4a9a-95f3-7734127ceb64.png)\\n\\n\uac70\ub798\ub0b4\uc5ed\uc744 \uc870\ud68c\ud560 \ub54c \uac70\ub798\ub0b4\uc5ed \ud14c\uc774\ube14\uc5d0 \ub300\ud55c \uac80\uc0c9 \uc18d\ub3c4\ub97c \ub192\uc774\uae30 \uc704\ud574 \ud544\ud130\ub9c1\uacfc \uc815\ub82c\uc5d0 \uc790\uc8fc \uc0ac\uc6a9\ub418\ub294 created_at \ud544\ub4dc\uc5d0 index\uac00 \uc0dd\uc131\ub418\ub3c4\ub85d \ud558\uc600\ub2e4.\\n\\n\\n## Partitioning\\n\\n\uc774\ubc88 \uacfc\uc81c\uc5d0\uc11c \ub300\ub7c9\uc758 \ub370\uc774\ud130\uac00 \uc313\uc778 \ud14c\uc774\ube14\uc5d0 \ub300\ud55c \uad00\ub9ac\ub97c \uace0\ubbfc\ud558\uba74\uc11c \ud30c\ud2f0\uc154\ub2dd\uc5d0 \ub300\ud55c \uac1c\ub150\uc744 \ucc98\uc74c \uc811\ud558\uac8c \ub418\uc5c8\ub2e4. \\n\\n\ud30c\ud2f0\uc154\ub2dd\uc774\ub780?\\n\\n```\\n\ub17c\ub9ac\uc801\uc778 \ub370\uc774\ud130 element\ub4e4\uc744 \ub2e4\uc218\uc758 entity\ub85c \ucabc\uac1c\ub294 \ud589\uc704\ub97c \ub73b\ud558\ub294 \uc77c\ubc18\uc801\uc778 \uc6a9\uc5b4\\n\uc989 \ud070 table\uc774\ub098 index\ub97c, \uad00\ub9ac\ud558\uae30 \uc26c\uc6b4 partition\uc774\ub77c\ub294 \uc791\uc740 \ub2e8\uc704\ub85c \ubb3c\ub9ac\uc801\uc73c\ub85c \ubd84\ud560\ud558\ub294 \uac83\uc744 \uc758\ubbf8\ud55c\ub2e4.\\n\ubb3c\ub9ac\uc801\uc778 \ub370\uc774\ud130 \ubd84\ud560\uc774 \uc788\ub354\ub77c\ub3c4, DB\uc5d0 \uc811\uadfc\ud558\ub294 application\uc758 \uc785\uc7a5\uc5d0\uc11c\ub294 \uc774\ub97c \uc778\uc2dd\ud558\uc9c0 \ubabb\ud55c\ub2e4.\\n```\\n\\n1\uc5b5\uac74\uc774 \ub118\ub294 \uac70\ub798\ub0b4\uc5ed\uc744 \uac70\ub798\uae30\uac04\uc5d0 \ub530\ub77c RANGE \ud30c\ud2f0\uc158\uc744 \uc801\uc6a9\ud558\uc5ec \uc5ec\ub7ec\uac1c\uc758 \ud14c\uc774\ube14\ub85c \ub098\ub204\uc5b4 \uc800\uc7a5\ud558\uba74, \ub17c\ub9ac\uc801\uc73c\ub85c\ub294 \ud558\ub098\uc758 \ud14c\uc774\ube14\ucc98\ub7fc \ubcf4\uc774\uc9c0\ub9cc DBMS \ub0b4\ubd80\uc801\uc73c\ub85c\ub294 \uac70\ub798\uc77c\uc790\uc5d0 \ub530\ub77c \uac01 \ud30c\ud2f0\uc158\uc758 \ub370\uc774\ud130\ub97c \uc870\ud68c\ud558\ubbc0\ub85c \ub9cc\uc57d \ud574\ub2f9 \uac70\ub798\uae30\uac04\uc774 \uc18d\ud55c \ud14c\uc774\ube14\uc5d0 \ub370\uc774\ud130\uac00 500\ub9cc\uac74\uc774\ub77c\uace0 \ud558\uba74 500\ub9cc\uac74\uc758 \ub370\uc774\ud130\uac00 \uc788\ub294 \ud14c\uc774\ube14\ub9cc \uc870\ud68c\ud560 \uc218 \uc788\uac8c \ub41c\ub2e4. \ub610 \ub370\uc774\ud130 \ubcf4\uad00\uc8fc\uae30\ub97c \uad00\ub9ac\ud560 \ub54c \ubcf4\uad00\uae30\uac04\uc774 \uc9c0\ub09c \ud30c\ud2f0\uc158 \ud14c\uc774\ube14\ub9cc \uc0ad\uc81c\ud558\uba74 \ub418\uae30 \ub54c\ubb38\uc5d0 \uae08\uc735\uac70\ub798 \ub0b4\uc5ed\uc744 \uad00\ub9ac\ud558\ub294\ub370\ub3c4 \uc720\uc6a9\ud558\uac8c \uc0ac\uc6a9\ub420 \uc218 \uc788\ub2e4.\\n\\n\x3c!--truncate--\x3e\\n\\n\ud504\ub85c\uc81d\ud2b8\uc5d0 \ud30c\ud2f0\uc154\ub2dd\uc744 \uc801\uc6a9\ud574\ubcf4\uae30 \uc704\ud574 Architect \ud328\ud0a4\uc9c0\ub97c \uc0ac\uc6a9\ud574\ubcf4\uc558\ub2e4.\\n\\n```python\\nfrom django.db import models\\nimport architect\\n\\n@architect.install(\'partition\', type=\'range\', subtype=\'integer\',\\n                   constraint=\'100\', column=\'id\')\\nclass User(models.Model):\\n    name     = models.CharField(max_length = 50)\\n    email    = models.CharField(max_length = 200, unique = True)\\n    password = models.CharField(max_length = 500)\\n\\n    class Meta:\\n        db_table = \'users\'\\n    \\n    def __str__(self):\\n        return self.name\\n```\\n\\n```\\narchitect partition --module users.models\\narchitect partition: result: successfully (re)configured the database for the following models: User\\n```\\n\\n\uc801\uc6a9\uc774 \uc798 \ub418\ub294\uc9c0 User \ubaa8\ub378\uc5d0 \uc801\uc6a9 \ud6c4\uc5d0 \uba85\ub839\uc5b4\ub97c \uc2e4\ud589\ud574\ubcf4\uc558\uc9c0\ub9cc \ud30c\ud2f0\uc158\uc774 \uc801\uc6a9\ub418\uc9c0 \uc54a\uc558\ub2e4.\\n\\nArchitect\uc758 \uacf5\uc2dd\ubb38\uc11c\ub97c \ucc3e\uc544\ubcf4\ub2c8  PostgreSQL\uacfc MySQL \ub450 DB\ub97c \uc9c0\uc6d0\ud558\uace0 sqlite3\ub294 \uc9c0\uc6d0\ud558\uc9c0 \uc54a\ub294\ub2e4\ub294 \uac83\uc744 \uc54c\uc558\ub2e4.\\n\\ndjango-db-parti \ub77c\ub294 \ub2e4\ub978 \ud328\ud0a4\uc9c0\ub3c4 \ucc3e\uc544\ubcf4\uc558\uc9c0\ub9cc \ud574\ub2f9 \ud328\ud0a4\uc9c0\ub3c4 PostgreSQL\uacfc MySQL\ub9cc \uc9c0\uc6d0\ud558\uc600\ub2e4.\\n\\n\uc774\ubc88 \uacfc\uc81c\ub294 sqlite3 \ub97c \ud544\uc218\ub85c \uc0ac\uc6a9\ud558\ub77c\uace0 \ub418\uc5b4 \uc788\uc5c8\uae30 \ub54c\ubb38\uc5d0 \uc2dc\uac04\uc774 \uc5bc\ub9c8 \ub0a8\uc9c0 \uc54a\uc740 \uc0c1\ud669\uc5d0\uc11c \ud300\uc6d0\ub4e4\uacfc \uc0c1\uc758 \ud6c4, \ucc28\ub77c\ub9ac \ubaa8\ub378\ub9c1 \ucc28\uc6d0\uc5d0\uc11c\ub77c\ub3c4 \ud558\ub098\uc758 \ud14c\uc774\ube14\ub85c \uad00\ub9ac\ub418\ub358 \uac70\ub798\ub0b4\uc5ed \ud14c\uc774\ube14\uc744 \ub144\ub3c4\uc5d0 \ub530\ub77c \ub530\ub85c \uc0dd\uc131\ud558\uc5ec \uad00\ub9ac\ud558\ub294 \uac83\uc73c\ub85c \ubbf8\uc57d\ud558\uac8c\ub098\ub9c8 \uad6c\ud604\ud574\ubcf4\ub294 \uac83\uc774 \uc88b\uaca0\ub2e4\ub294 \uacb0\uc815\uc744 \ub0b4\ub838\ub2e4.\\n\\n\ub530\ub77c\uc11c deals \ud14c\uc774\ube14\uc744 2021\ub144 \uac70\ub798\ub0b4\uc5ed\uc774 \uc800\uc7a5\ub3fc\uc788\ub294 deals2021 \ud14c\uc774\ube14\uacfc 2020\ub144 \uac70\ub798\ub0b4\uc5ed\uc774 \uc800\uc7a5\ub3fc\uc788\ub294 deals2020 \ud14c\uc774\ube14\ub85c \ubd84\ud560\ub418\ub3c4\ub85d \ubaa8\ub378\ub9c1\uc744 \uc218\uc815\ud558\uc600\ub2e4.\\n\\n![](https://user-images.githubusercontent.com/61782539/141502990-2fc032aa-e997-4e72-9261-60ba96e9e84b.png)\\n\\ndeals2020 \ud14c\uc774\ube14\uc5d0\ub294 2020\ub144\ub3c4\uc5d0 \uc0dd\uc131\ub41c \uac70\ub798\ub0b4\uc5ed \ub370\uc774\ud130\ub9cc \uc800\uc7a5\ub3fc\uc788\ub2e4.\\n\\n![](https://user-images.githubusercontent.com/61782539/141503320-74a2b342-529c-4da1-a496-a2d4d3035722.png)\\n\\ndeals2021 \ud14c\uc774\ube14\uc5d0\ub294 2021\ub144\ub3c4\uc5d0 \uc0dd\uc131\ub41c \uac70\ub798\ub0b4\uc5ed \ub370\uc774\ud130\ub9cc \uc800\uc7a5\ub3fc\uc788\ub2e4.\\n\\n\uc774\ub807\uac8c \ubaa8\ub378\uc744 \uc218\uc815\ud55c \ud6c4\uc5d0 \uac70\ub798\ub0b4\uc5ed\uc744 \uc870\ud68c\ud558\ub294 API\uc5d0\uc11c \uc870\ud68c\ud55c \uac70\ub798\uae30\uac04\uc758 \uc2dc\uc791\ub0a0\uc9dc \uc5f0\ub3c4\uac00 2020\ub144\uc77c \ub54c\ub9cc deals2020 \ud14c\uc774\ube14\uc5d0 \uc811\uadfc\ud558\uc5ec \uc870\ud68c\ud55c \uae30\uac04\uc5d0 \ud3ec\ud568\ub418\ub294 \ub370\uc774\ud130\ub97c \uac00\uc838\uc624\uace0, \uc870\ud68c\ud55c \uae30\uac04\uc774 2021\ub144\uc5d0 \uad6d\ud55c\ub418\uba74 deals2021\ud14c\uc774\ube14\uc758 \ub370\uc774\ud130\uc5d0\ub9cc \uc811\uadfc\ud558\ub3c4\ub85d \uad6c\ud604\ud558\uc5ec \ub9ce\uc740 \uc591\uc758 \uac70\ub798\ub0b4\uc5ed\uc744 \ubd84\ud560\ud558\uc5ec \uc811\uadfc\ud560 \uc218 \uc788\uac8c \ud558\uc600\ub2e4. 2020\ub144 \ub370\uc774\ud130\uc758 \ubcf4\uad00\uae30\uac04\uc774 \uc9c0\ub0ac\ub2e4\uace0 \ud588\uc744 \ub54c \ud574\ub2f9 \ud14c\uc774\ube14\uc758 \ub370\uc774\ud130\ub9cc \uc0ad\uc81c\ud558\uba74 \ub418\uae30 \ub54c\ubb38\uc5d0 \ub370\uc774\ud130 \uad00\ub9ac\uc5d0\ub3c4 \uc880 \ub354 \uc6a9\uc774\ud560 \uac83 \uac19\uc558\ub2e4.\\n\\n**2020-04-02 ~ 2021-11-12 \uac70\ub798\ub0b4\uc5ed \uc870\ud68c**\\n\\n```\\n/deals/1?start_date=2020-04-02&end_date=2021-11-12&sort=old&deal_position_id=&page=2\\n```\\n\\n```sql\\n2021-11-13 02:31:37,353 DEBUG (0.095) SELECT \\"deals2020\\".\\"id\\", \\"deals2020\\".\\"account_id\\", \\"deals2020\\".\\"deal_position_id\\", \\"deals2020\\".\\"amount\\", \\"deals2020\\".\\"created_at\\", \\"deals2020\\".\\"balance\\", \\"deals2020\\".\\"description\\", \\"deal_positions\\".\\"id\\", \\"deal_positions\\".\\"position\\" FROM \\"deals2020\\" INNER JOIN \\"deal_positions\\" ON (\\"deals2020\\".\\"deal_position_id\\" = \\"deal_positions\\".\\"id\\") WHERE (django_datetime_cast_date(\\"deals2020\\".\\"created_at\\", NULL, NULL) BETWEEN \'2020-04-02\' AND \'2021-11-12\' AND \\"deals2020\\".\\"account_id\\" = 1) ORDER BY \\"deals2020\\".\\"created_at\\" ASC; args=(\'2020-04-02\', \'2021-11-12\', 1)\\n2021-11-13 02:31:37,716 DEBUG (0.068) SELECT \\"deals2021\\".\\"id\\", \\"deals2021\\".\\"account_id\\", \\"deals2021\\".\\"deal_position_id\\", \\"deals2021\\".\\"amount\\", \\"deals2021\\".\\"created_at\\", \\"deals2021\\".\\"balance\\", \\"deals2021\\".\\"description\\", \\"deal_positions\\".\\"id\\", \\"deal_positions\\".\\"position\\" FROM \\"deals2021\\" INNER JOIN \\"deal_positions\\" ON (\\"deals2021\\".\\"deal_position_id\\" = \\"deal_positions\\".\\"id\\") WHERE (django_datetime_cast_date(\\"deals2021\\".\\"created_at\\", NULL, NULL) BETWEEN \'2020-04-02\' AND \'2021-11-12\' AND \\"deals2021\\".\\"account_id\\" = 1) ORDER BY \\"deals2021\\".\\"created_at\\" ASC; args=(\'2020-04-02\', \'2021-11-12\', 1)\\n[13/Nov/2021 02:31:38] \\"GET /deals/1?start_date=2020-04-02&end_date=2021-11-12&sort=old&deal_position_id=&page=2 HTTP/1.1\\" 200 3548\\n```\\n\\n\uc774 \uacbd\uc6b0 deals2020 \ud14c\uc774\ube14\uacfc deals2021 \ud14c\uc774\ube14\uc5d0 \uc811\uadfc\ud55c\ub2e4.\\n\\n**2021-04-02 ~ 2021-11-12 \uac70\ub798\ub0b4\uc5ed \uc870\ud68c**\\n\\n```sql\\ndeals/1?start_date=2021-04-02&end_date=2021-11-12&sort=old&deal_position_id=&page=1\\n```\\n\\n```sql\\n2021-11-13 02:34:27,308 DEBUG (0.099) SELECT \\"deals2021\\".\\"id\\", \\"deals2021\\".\\"account_id\\", \\"deals2021\\".\\"deal_position_id\\", \\"deals2021\\".\\"amount\\", \\"deals2021\\".\\"created_at\\", \\"deals2021\\".\\"balance\\", \\"deals2021\\".\\"description\\", \\"deal_positions\\".\\"id\\", \\"deal_positions\\".\\"position\\" FROM \\"deals2021\\" INNER JOIN \\"deal_positions\\" ON (\\"deals2021\\".\\"deal_position_id\\" = \\"deal_positions\\".\\"id\\") WHERE (django_datetime_cast_date(\\"deals2021\\".\\"created_at\\", NULL, NULL) BETWEEN \'2021-04-02\' AND \'2021-11-12\' AND \\"deals2021\\".\\"account_id\\" = 1) ORDER BY \\"deals2021\\".\\"created_at\\" ASC; args=(\'2021-04-02\', \'2021-11-12\', 1)\\n[13/Nov/2021 02:34:27] \\"GET /deals/1?start_date=2021-04-02&end_date=2021-11-12&sort=old&deal_position_id=&page=1 HTTP/1.1\\" 200 3550\\n```\\n\\n\uc774 \uacbd\uc6b0 deals2021 \ud14c\uc774\ube14\uc5d0\ub9cc \uc811\uadfc\ud55c\ub2e4."},{"id":"/2021/11/10/backend/project/kream-clone","metadata":{"permalink":"/2021/11/10/backend/project/kream-clone","source":"@site/blog/backend/project/2021-11-10-kream-clone.md","title":"Kream Clone Project","description":"\uae30\uac04: 2021-10-10 ~ 2021-10-29","date":"2021-11-10T00:00:00.000Z","formattedDate":"November 10, 2021","tags":[{"label":"BackEnd","permalink":"/tags/back-end"},{"label":"Django","permalink":"/tags/django"}],"readingTime":18.435,"hasTruncateMarker":true,"authors":[{"name":"Chihun Park","url":"https://github.com/chihunmanse","email":"chihunmanse@gmail.com","imageURL":"https://p.ipic.vip/o1ih3g.png","key":"chihun"}],"frontMatter":{"title":"Kream Clone Project","tags":["BackEnd","Django"],"authors":"chihun"},"prevItem":{"title":"\uc6d0\ud2f0\ub4dc \ud504\ub9ac\uc628\ubcf4\ub529 8percent \uae30\uc5c5\uacfc\uc81c","permalink":"/2021/11/20/backend/project/preonboarding-8percent"},"nextItem":{"title":"Lush Clone Project","permalink":"/2021/11/10/backend/project/lush-clone"}},"content":"**\uae30\uac04: 2021-10-10 ~ 2021-10-29**\\n\\n**Stack: Python, Django, MySQL, DjangoORM**\\n\\n**[Github \ub9c1\ud06c](https://github.com/chihunmanse/KREAM-motive-Project)**\\n\\n## Modeling\\n\\n![erd](https://user-images.githubusercontent.com/61782539/139529652-5d04aa32-b615-478e-87fe-b17693fc3b9c.png)\\n\\n\ud544\uc218\ub85c \uad6c\ud604\ud558\uae30\ub85c \ud55c \uae30\ub2a5\ub4e4\uc744 \uc911\uc2ec\uc73c\ub85c \ubaa8\ub378\ub9c1\ud558\uc600\ub2e4. kream\uc740 \uc774\uc6a9\uc790\ub4e4\uc774 \ud55c\uc815\ud310 \uc0c1\ud488\ub4e4\uc744 \uc11c\ub85c \uc0ac\uace0 \ud314\uace0 \ud560 \uc218 \uc788\ub3c4\ub85d \ub9e4\uac1c\ud574\uc8fc\ub294 \uc0ac\uc774\ud2b8\uc774\ub2e4. \uadf8 \uacfc\uc815\uc5d0\uc11c \uc774\uc6a9\uc790\ub4e4\uc774 \uc6d0\ud558\ub294 \uac00\uaca9\uc5d0 \ubb3c\uac74\uc744 \uc0ac\uace0 \ud314 \uc218 \uc788\ub3c4\ub85d \uad6c\ub9e4\uac00\ub098 \ud310\ub9e4\uac00\ub97c \uc81c\uc2dc\ud558\ub294 \uacbd\ub9e4 \uc2dc\uc2a4\ud15c\uc774 \uc788\ub2e4. \uadf8\ub9ac\uace0 \uadf8 \uacbd\ub9e4 \uc2dc\uc2a4\ud15c\uc5d0 \ub530\ub77c\uc11c \ubb3c\uac74\uc744 \uc989\uc2dc \uad6c\ub9e4\ud558\uace0 \uc989\uc2dc \ud310\ub9e4\ud560 \uc218 \uc788\ub294 \uc2e4\uc81c\uc801\uc778 \uac00\uaca9\uc774 \uacb0\uc815\ub41c\ub2e4.\\n\\n\uc0c1\ud488\uc758 \uc0ac\uc774\uc988\ubcc4\ub85c (\uc2e4\uc81c kream\uc5d0\ub294 \uc5ec\ub7ec \uc885\ub958\uc758 \uc0c1\ud488\uc774 \uc788\uae30 \ub54c\ubb38\uc5d0 \uc635\uc158\ub3c4 \uc5ec\ub7ec\uac00\uc9c0\uc9c0\ub9cc \ud504\ub85c\uc81d\ud2b8\uc5d0\uc11c\ub294 \uc2e0\ubc1c\ub9cc \ub2e4\ub8e8\uae30\ub85c \uae30\ud68d\ud588\ub2e4.) \uc785\ucc30\uc774 \uc0dd\uc131\ub41c\ub2e4.\\n\\nkream\uc5d0\uc11c \uad6c\ub9e4, \ud310\ub9e4 \uacc4\uc57d(\uc8fc\ubb38)\uc740 \uac70\ub798\ud558\ub824\ub294 \uc0c1\ud488\uc5d0 \uc785\ucc30\uc774 \ud558\ub098\ub77c\ub3c4 \uac78\ub824\uc788\uc744 \ub54c\ub9cc \uac00\ub2a5\ud558\ub2e4. \uc0c1\ud488\uc744 \uad6c\ub9e4\ud558\ub824\ud560 \ub54c\ub294 \ud574\ub2f9 \uc0c1\ud488\uc758 \ud310\ub9e4 \uc785\ucc30\ub4e4\uc911\uc5d0 \uac00\uc7a5 \ub0ae\uc740 \uac00\uaca9\uc73c\ub85c \uc81c\uc2dc\ub41c \uc785\ucc30\uac00\uac00 \uc989\uc2dc \uad6c\ub9e4\uac00\ub85c \uacb0\uc815\ub418\uace0 \uadf8 \uac00\uaca9\uc774 \ub9c8\uc74c\uc5d0 \ub4e0\ub2e4\uba74 \ubc14\ub85c \uac70\ub798\ud560 \uc218 \uc788\ub2e4. \ubc18\ub300\ub85c \uc0c1\ud488\uc744 \ud310\ub9e4\ud560 \ub54c\ub294 \ud574\ub2f9 \uc0c1\ud488\uc758 \uad6c\ub9e4 \uc785\ucc30\ub4e4\uc911\uc5d0 \uac00\uc7a5 \ub192\uc740 \uac00\uaca9\uc73c\ub85c \uc81c\uc2dc\ub41c \uc785\ucc30\uac00\uac00 \uc989\uc2dc \ud310\ub9e4\uac00\ub85c \uacb0\uc815\ub41c\ub2e4. \ub530\ub77c\uc11c \uc8fc\ubb38\uc740 \uc989\uc2dc\uac70\ub798\ud558\ub294 \uc720\uc800\uc640 \ud574\ub2f9 \uc989\uc2dc\uac70\ub798\uac00\ub97c \ud615\uc131\ud55c \ud558\ub098\uc758 \uc785\ucc30\uc774 \ub9cc\ub098\uc11c \uc774\ub8e8\uc5b4\uc9c4\ub2e4. \ub9cc\uc57d \uc8fc\ubb38 \uc694\uccad\ub41c \uc785\ucc30\uc758 \ud3ec\uc9c0\uc158\uc774 \uad6c\ub9e4\ub77c\uba74 \ud310\ub9e4\uc790\ub294 \uc989\uc2dc\ud310\ub9e4\uac00\ub85c \uac70\ub798\ud558\ub294 \uc720\uc800\uac00 \ub420 \uac83\uc774\uace0 \uad6c\ub9e4\uc790\ub294 \ud574\ub2f9 \uc785\ucc30\uc744 \uc81c\uc2dc\ud55c \uc720\uc800\uac00 \ub420 \uac83\uc774\ub2e4.\\n\\n\uc774\ubc88 \ud504\ub85c\uc81d\ud2b8\uc5d0\uc11c\ub294 \uacbd\ub9e4 \ud504\ub85c\uc138\uc2a4\ub97c \uad6c\ud604\ud574\ubcf4\ub294 \uac83\uc5d0 \uc911\uc810\uc744 \ub450\uc5c8\uae30 \ub54c\ubb38\uc5d0 \uacb0\uc81c\ub294 \uc720\uc800\uc758 \ud3ec\uc778\ud2b8\ub97c \uc11c\ub85c \uc8fc\uace0 \ubc1b\ub294 \uac83\uc73c\ub85c \uac04\ub7b5\ud558\uac8c \uae30\ud68d\ud588\ub2e4.\\n\\n## End Point\\n\\n\ud504\ub85c\uc81d\ud2b8\uc5d0\uc11c \uc785\ucc30, \uc8fc\ubb38 \uad00\ub828 API\ub97c \ub9cc\ub4dc\ub294 \uc5ed\ud560\uc744 \ub2f4\ub2f9\ud588\ub2e4.\\n\\n- POST /orders/bidding/{int:productsize_id}/{int:position_id} (\uc785\ucc30 \uc0dd\uc131)\\n- GET /orders/bidding/{int:productsize_id}/{int:position_id} (\uc785\ucc30 \uc870\ud68c - \uc8fc\ubb38 \ud398\uc774\uc9c0\uc5d0\uc11c \uc989\uc2dc \uac70\ub798\uac00 \uc870\ud68c)\\n- POST /orders/{int:bidding_id} (\uc8fc\ubb38 \uc0dd\uc131)\\n- GET /orders/size-price/{int:product_id}/{int:position_id} (\uc0c1\ud488\uc758 \uc0ac\uc774\uc988\ubcc4 \uc989\uc2dc \uac70\ub798\uac00 \uc870\ud68c)\\n- GET /orders/price/{int:product_id} (\uc0c1\ud488\uc758 \uc2dc\uc138 \uc870\ud68c)\\n- GET /orders (\uc8fc\ubb38, \uc785\ucc30\uc911\uc778 \ub0b4\uc5ed \uc870\ud68c)\\n\\n\x3c!--truncate--\x3e\\n\\n## Code\\n\\n```python\\nclass BiddingStatusId(Enum):\\n    ON_BIDDING = 1\\n    CONTRACTED = 2\\n\\nclass BiddingPositionId(Enum):\\n    BUY  = 1\\n    SELL = 2\\n\\nclass OrderStatusId(Enum):\\n    INSPECTION = 1\\n    IN_TRANSIT = 2\\n    DELIVERED  = 3\\n\\nclass InsufficientPointError(Exception):\\n    pass\\n\\nclass InvalidBiddingStatusError(Exception):\\n    pass\\n\\nclass CheckId():\\n    def check_product_id(product_id):\\n        if not Product.objects.filter(id = product_id).exists():\\n            raise Product.DoesNotExist\\n\\n    def check_product_size_id(productsize_id):\\n        if not ProductSize.objects.filter(id = productsize_id).exists():\\n            raise ProductSize.DoesNotExist\\n\\n    def check_bidding_id(bidding_id):\\n        if not Bidding.objects.filter(id = bidding_id).exists():\\n            raise Bidding.DoesNotExist\\n\\n    def check_bidding_position_id(position_id):\\n        if not BiddingPosition.objects.filter(id = position_id).exists():\\n            raise BiddingPosition.DoesNotExist\\n\\n    def check_bidding_status_id(bidding_status_id):\\n        if bidding_status_id == BiddingStatusId.CONTRACTED.value:\\n            raise InvalidBiddingStatusError\\n\\ndef user_point_check(user, position, bidding):\\n    if (position == BiddingPositionId.SELL.name and bidding.price > user.point) or (position == \\t\\t\\t\\t BiddingPositionId.BUY.name and bidding.price > bidding.user.point):\\n        raise InsufficientPointError\\n```\\n\\nposition \ud14c\uc774\ube14\uacfc status \ud14c\uc774\ube14\uc758 id\uac12\uc744 \uc0ac\uc6a9\ud558\ub294\ub370 \uc788\uc5b4\uc11c, DB\uc0c1\uc5d0 \uc5b4\ub5a4 \ub370\uc774\ud130\uac00 \uc5b4\ub5a4 id\ub97c \uac16\uace0 \uc788\ub294\uc9c0 \ud5f7\uac08\ub9b4 \uc218 \uc788\ub294 \uac83\uc744 \ubc29\uc9c0\ud558\uace0, \ub2e4\ub978 \uc0ac\ub78c\uc774 \ucf54\ub4dc\ub97c \ubd24\uc744 \ub54c\ub3c4 \ub17c\ub9ac\uc801\uc73c\ub85c \uc774\ud574\ud560 \uc218 \uc788\ub3c4\ub85d Enum class\ub4e4\uc744 \ub530\ub85c \ub9cc\ub4e4\uc5b4\uc11c api\ub97c \uc791\uc131\ud560 \ub54c \uc0ac\uc6a9\ud588\ub2e4.\\n\\n\uc694\uccad\uc5d0\uc11c \ub4e4\uc5b4\uc628 id\uc758 \ub370\uc774\ud130\uac00 \uc874\uc7ac\ud558\uc9c0 \uc54a\uac70\ub098 \uc798\ubabb\ub41c id\uac12\uc77c \uacbd\uc6b0\uc5d0 \uc608\uc678\ub97c \ubc1c\uc0dd\uc2dc\ud0a4\ub294 class\ub97c \ub530\ub85c \ub9cc\ub4e4\uc5b4 api \uc548\uc5d0\uc11c \ucf54\ub4dc\uc758 \uac00\ub3c5\uc131\uc744 \uc880 \ub354 \ub192\uc77c \uc218 \uc788\uc5c8\ub2e4.\\n\\n`user_point_check` \ud568\uc218\uc758 \uacbd\uc6b0 \uc8fc\ubb38 \uc0dd\uc131 api\uc5d0\uc11c \uc0ac\uc6a9\ub418\ub294\ub370, \ub85c\uadf8\uc778 \uc720\uc800\uac00 \uc81c\ud488\uc744 \ud310\ub9e4\ud558\ub824\ub294 \uacbd\uc6b0\uc5d0\ub294 \uad6c\ub9e4 \uc785\ucc30\uc744 \uac78\uc5c8\ub358 \uc720\uc800\uc758 \ud3ec\uc778\ud2b8\uac00 \uac00\uaca9\ubcf4\ub2e4 \uc801\uc73c\uba74 \uc608\uc678\ub97c \ubc1c\uc0dd\uc2dc\ud0a4\uace0, \uad6c\ub9e4\ud558\ub824\ub294 \uacbd\uc6b0\uc5d0\ub294 \ub85c\uadf8\uc778 \uc720\uc800\uc758 \ud3ec\uc778\ud2b8\uac00 \uac00\uaca9\ubcf4\ub2e4 \uc801\uc73c\uba74 \uc608\uc678\ub97c \ubc1c\uc0dd\uc2dc\ucf30\ub2e4.\\n\\n### POST /orders/bidding/{int:productsize_id}/{int:position_id} (\uc785\ucc30 \uc0dd\uc131)\\n\\n```python\\nclass BiddingView(View):\\n    @login_decorator\\n    def post(self, request, productsize_id, position_id):\\n        try:\\n            CheckId.check_product_size_id(productsize_id)\\n            CheckId.check_bidding_position_id(position_id)\\n\\n            data  = json.loads(request.body)\\n            user  = request.user\\n            price = data[\'price\']\\n\\n            Bidding.objects.create(\\n                user                 = user,\\n                bidding_status_id    = BiddingStatusId.ON_BIDDING.value,\\n                bidding_position_id  = position_id,\\n                product_size_id      = productsize_id,\\n                price                = price\\n            )\\n\\n            return JsonResponse({\'message\' : \'SUCCESS\'}, status = 201)\\n\\n        except KeyError:\\n            return JsonResponse({\'message\' : \'KEY_ERROR\'}, status = 400)\\n\\n        except JSONDecodeError:\\n            return JsonResponse({\'message\' : \'JSON_DECODE_ERROR\'}, status = 400)\\n\\n        except ProductSize.DoesNotExist:\\n            return JsonResponse({\'message\' : \'PRODUCT_SIZE_DOES_NOT_EXIST\'}, status = 404)\\n\\n        except BiddingPosition.DoesNotExist:\\n            return JsonResponse({\'message\' : \'INVALID_BIDDING_POSITION\'}, status = 400)\\n\\n```\\n\\n\uc785\ucc30 \uc0dd\uc131\uc740 \uc694\uccad\uc5d0\uc11c path \ubcc0\uc218\ub85c `productize_id`\uc640 `position_id`\ub97c \ubc1b\uace0 \uc694\uccad\uc758 body\uc5d0\uc11c \uc720\uc800\uac00 \uc785\ub825\ud55c `price` \uac12\uc744 \ubc1b\uc544\uc11c \uc0dd\uc131\ud55c\ub2e4. \uc0c8\ub85c \uc0dd\uc131\ub418\ub294 \uc785\ucc30\uc758 \uc0c1\ud0dc\ub294 `ON_BIDDING`\uc758 id\uac12\uc744 \ub123\uc5b4\uc900\ub2e4.\\n\\n### GET /orders/bidding/{int:productsize_id}/{int:position_id} (\uc785\ucc30 \uc870\ud68c - \uc8fc\ubb38 \ud398\uc774\uc9c0\uc5d0\uc11c \uc989\uc2dc \uac70\ub798\uac00 \uc870\ud68c)\\n\\n```python\\n    @login_decorator\\n    def get(self, request, productsize_id, position_id):\\n        try:\\n            CheckId.check_product_size_id(productsize_id)\\n            CheckId.check_bidding_position_id(position_id)\\n\\n            user              = request.user\\n            sell_price_filter = (Q(bidding__bidding_position_id = BiddingPositionId.BUY.value) &\\n            Q(bidding__bidding_status_id = BiddingStatusId.ON_BIDDING.value))\\n            buy_price_filter  = (Q(bidding__bidding_position_id = BiddingPositionId.SELL.value) &\\n            Q(bidding__bidding_status_id = BiddingStatusId.ON_BIDDING.value))\\n            biddings          = Bidding.objects.filter(bidding_position_id = position_id, bidding_status_id =\\n            BiddingStatusId.ON_BIDDING.value).order_by(\'price\' if position_id == BiddingPositionId.SELL.value\\n            else \'-price\')\\n            product_size      = ProductSize.objects.annotate(sell_price = Max(\'bidding__price\', filter =\\n            sell_price_filter), buy_price = Min(\'bidding__price\', filter = buy_price_filter)).\\\\\\n                                select_related(\'size\', \'product\').prefetch_related(Prefetch(\'bidding_set\',\\n                                queryset = biddings)).get(id = productsize_id)\\n\\n            data = {\\n                \'product_image_url\'    : product_size.product.productimage_set.first().image_url\\n                \'product_name\'         : product_size.product.name,\\n                \'product_brand\'        : product_size.product.brand.name,\\n                \'product_model_number\' : product_size.product.model_number,\\n                \'size\'                 : product_size.size.size,\\n                \'sell_price\'           : product_size.sell_price,\\n                \'buy_price\'            : product_size.buy_price,\\n                \'user_point\'           : user.point,\\n                \'bidding_id\'           : product_size.bidding_set.first().id if product_size.bidding_set.first()\\n                else None,\\n                \'bidding_price\'        : product_size.bidding_set.first().price if\\n                product_size.bidding_set.first() else None\\n            }\\n\\n            return JsonResponse({\'data\' : data}, status = 200)\\n\\n        except ProductSize.DoesNotExist:\\n            return JsonResponse({\'message\' : \'PRODUCT_SIZE_DOES_NOT_EXIST\'}, status = 404)\\n\\n        except ProductSize.MultipleObjectsReturned:\\n            return JsonResponse({\'message\' : \'MULTIPLE_RETURN_ERROR\'}, status = 400)\\n\\n        except BiddingPosition.DoesNotExist:\\n            return JsonResponse({\'message\' : \'INVALID_BIDDING_POSITION\'}, status = 400)\\n```\\n\\n\uc8fc\ubb38 \ud398\uc774\uc9c0\uc5d0\uc11c \uad6c\ub9e4/\ud310\ub9e4\uc640 \uc0c1\uad00\uc5c6\uc774 \uc989\uc2dc\uad6c\ub9e4\uac00\uc640 \uc989\uc2dc\ud310\ub9e4\uac00\uc758 \uc815\ubcf4\ub97c \ubaa8\ub450 \ubcf4\uc5ec\uc900\ub2e4. path \ubcc0\uc218\ub85c `productsize_id`\ub97c \ubc1b\uc544\uc640\uc11c \ud574\ub2f9 \uc0c1\ud488\uc758 \uc815\ubcf4\uc640 \ud574\ub2f9 \uc0ac\uc774\uc988\uc5d0 \uc0dd\uc131\ub3fc\uc788\ub294 \uc785\ucc30\ub4e4\uc5d0 \uc811\uadfc\ud55c\ub2e4. \uad6c\ub9e4\uac00\uc640 \ud310\ub9e4\uac00 \ubcc4\ub85c `annotate()`\uc5d0\uc11c \uc0ac\uc6a9\ud560 filter \uc870\uac74\ub4e4\uc744 \ubbf8\ub9ac \ub9cc\ub4e4\uc5b4\uc8fc\uc5c8\ub2e4. \uad6c\ub9e4\uac00\ub97c \uad6c\ud560 \ub54c \ud574\ub2f9\ub418\ub294 \uc870\uac74\uc740 \uc544\uc9c1 \uacc4\uc57d \uc644\ub8cc\ub418\uc9c0 \uc54a\uc740 \uc785\ucc30\uc911\uc5d0 position\uc774 SELL\uc778 \uacbd\uc6b0\uc774\uace0 \ud310\ub9e4\uac00\ub294 position\uc774 BUY\uc778 \uacbd\uc6b0\uc774\ub2e4. \uad6c\ub9e4\uac00\ub294 filter \uc870\uac74\ub4e4\uc758 \uc785\ucc30\ub4e4\uc911\uc5d0\uc11c \uac00\uc7a5 \ub0ae\uc740 \uac00\uaca9\uc758 \uc785\ucc30\uac00\ub97c `Min()`\uc744 \ud1b5\ud574 \uac00\uc838\uc654\uace0 \ud310\ub9e4\uac00\ub294 \uac00\uc7a5 \ub192\uc740 \uac00\uaca9\uc758 \uc785\ucc30\uac00\ub97c `Max()`\ub97c \ud1b5\ud574 \uac00\uc838\uc654\ub2e4.\\n\\n`Prefetch()`\uc758 \ucffc\ub9ac\uc14b\uc73c\ub85c \uc0ac\uc6a9\ud560 biddings \ucffc\ub9ac\uc14b\uc744 \uc870\uac74\uc5d0 \ub9de\uac8c \ubbf8\ub9ac \uc9c0\uc815\ud574\uc8fc\uc5c8\ub2e4. \uc785\ucc30\uc0c1\ud0dc\uac00 \uc544\uc9c1 \uc785\ucc30\uc911\uc774\uace0, \uc694\uccad\uc5d0\uc11c \uc5bb\uc740 position\uc5d0 \ud574\ub2f9\ud558\ub294 \uc785\ucc30\ub4e4\uc911\uc5d0 position\uc5d0 \ub530\ub77c \ub0ae\uc740 \uac00\uaca9\uc21c, \ub192\uc740 \uac00\uaca9\uc21c\uc73c\ub85c \uc815\ub82c\ub418\uac8c \ud588\ub2e4. \ud574\ub2f9 \uc0c1\ud488 \uc0ac\uc774\uc988\uc5d0 position\uc5d0 \ub9de\ub294 \uc785\ucc30\uc774 \uc874\uc7ac\ud558\uc9c0 \uc54a\uc744 \uc218\ub3c4 \uc788\uae30 \ub54c\ubb38\uc5d0 `bidding_set.first()`\ub97c \uc0ac\uc6a9\ud560 \ub54c `first()`\uac00 None\uc774\uba74 None\uc774 \ubc18\ud658\ub418\uac8c \ud588\ub2e4. None\uc5d0 \ub300\ud55c \ucc98\ub9ac\ub97c \ud574\uc8fc\uc9c0 \uc54a\uc73c\uba74 `first()`\uac00 None\uc77c\ub54c `bidding_set.first().id` \ub098 `.price` \ucc98\ub7fc \ud544\ub4dc\uc5d0 \uc811\uadfc\ud558\uba74 AttributeError\uac00 \ubc1c\uc0dd\ud55c\ub2e4.\\n\\n\ub9cc\uc57d \uac70\ub798\ud558\ub824\ub294 \uc0c1\ud488\uc758 position\uc5d0 \ub9de\ub294 \uc785\ucc30\uc774 \uc874\uc7ac\ud558\uc9c0 \uc54a\uc73c\uba74 \uc989\uc2dc\uac70\ub798\ud560 \uc218 \uc5c6\uc73c\ubbc0\ub85c \uc989\uc2dc\uad6c\ub9e4/\ud310\ub9e4 \uc790\uccb4\uac00 \ubd88\uac00\ub2a5\ud558\uace0 \uc785\ucc30 \uc0dd\uc131\ub9cc \uac00\ub2a5\ud558\ub2e4.\\n\\n\uc774\ubc88\uc5d0 api\ub97c \ub9cc\ub4e4\uace0 \ud504\ub860\ud2b8 \ubd84\ub4e4\uacfc \uc18c\ud1b5\ud558\ub294 \uacfc\uc815\uc5d0\uc11c \uc11c\ub85c \uc790\uc8fc \ud5f7\uac08\ub838\ub358 \uc9c0\uc810\uc774 \uc720\uc800\uac00 \uad6c\ub9e4/\ud310\ub9e4\ud558\uae30 \uc704\ud574 \uac70\uae30\uc5d0 \ub9de\ub294 \uc785\ucc30\uc744 \uc870\ud68c\ud560 \ub54c\ub294 `position_id`\ub97c \ubc18\ub300\uc758 \uacbd\uc6b0\ub85c \uc694\uccad\ud574\uc57c\ud55c\ub2e4\ub294 \uc810\uc774\uc5c8\ub2e4. \ub9cc\uc57d \uad6c\ub9e4\uc790\uac00 \uc989\uc2dc\uad6c\ub9e4\ud560 \uc218 \uc788\ub294 \uc785\ucc30\uc774 \uc788\ub294\uc9c0 \uc870\ud68c\ud560 \ub54c\ub294 \ud310\ub9e4\uc785\ucc30\ub4e4\uc911\uc5d0\uc11c \uc870\ud68c\ud574\uc57c\ud558\uae30 \ub54c\ubb38\uc5d0 \uc694\uccad\ud574\uc57c\ud560 \uc785\ucc30\uc758 position\uc740 SELL\uc774 \ub41c\ub2e4. \ud558\uc9c0\ub9cc \uad6c\ub9e4\uc790\uac00 \uc989\uc2dc\uad6c\ub9e4\ud560 \uc218 \uc788\ub294 \uc785\ucc30\uc774 \uc874\uc7ac\ud558\uc9c0 \uc54a\uac70\ub098 \ud604\uc7ac \ud615\uc131\ub41c \uc989\uc2dc\uad6c\ub9e4\uac00\uac00 \ub9c8\uc74c\uc5d0 \ub4e4\uc9c0 \uc54a\uc544\uc11c \ub2e4\ub978 \uac00\uaca9\uc73c\ub85c \uc785\ucc30\uc744 \ud55c\ub2e4\uace0 \ud558\uba74 (\uc785\ucc30 \uc0dd\uc131\ud560 \ub54c\uc758) position\uc740 \uadf8\ub300\ub85c BUY\uac00 \ub41c\ub2e4.\\n\\n### POST /orders/{int:bidding_id} (\uc8fc\ubb38 \uc0dd\uc131)\\n\\n```python\\nclass OrderView(View):\\n    @login_decorator\\n    @transaction.atomic\\n    def post(self, request, bidding_id):\\n        try:\\n            CheckId.check_bidding_id(bidding_id)\\n\\n            user              = request.user\\n            bidding           = Bidding.objects.select_related(\'bidding_status\', \'bidding_position\',\\n            \'user\').get(id = bidding_id)\\n            bidding_status_id = bidding.bidding_status_id\\n            position          = bidding.bidding_position.position\\n\\n            CheckId.check_bidding_status_id(bidding_status_id)\\n            user_point_check(user, position,bidding)\\n\\n            Order.objects.create(\\n                order_status_id = OrderStatusId.INSPECTION.value,\\n                bidding         = bidding,\\n                buyer           = bidding.user if position == BiddingPositionId.BUY.name else user,\\n                seller          = bidding.user if position == BiddingPositionId.SELL.name else user\\n            )\\n\\n            bidding.bidding_status_id = BiddingStatusId.CONTRACTED.value\\n            bidding.save()\\n\\n            if position == BiddingPositionId.BUY.name:\\n                user.point = user.point + bidding.price\\n                user.save()\\n                bidding.user.point = bidding.user.point - bidding.price\\n                bidding.user.save()\\n\\n            if position == BiddingPositionId.SELL.name:\\n                user.point = user.point - bidding.price\\n                user.save()\\n                bidding.user.point = bidding.user.point + bidding.price\\n                bidding.user.save()\\n\\n            return JsonResponse({\'message\' : \'SUCCESS\'}, status = 201)\\n\\n        except Bidding.DoesNotExist:\\n            return JsonResponse({\'message\' : \'BIDDING_DOES_NOT_EXIST\'}, status = 404)\\n\\n        except Bidding.MultipleObjectsReturned:\\n            return JsonResponse({\'message\' : \'MULTIPLE_RETURN_ERROR\'}, status = 400)\\n\\n        except InvalidBiddingStatusError:\\n            return JsonResponse({\'message\' : \'INVALID_BIDDING_ID\'}, status = 400)\\n\\n        except InsufficientPointError:\\n            return JsonResponse({\'message\' : \'INSUFFICIENT_POINT\'}, status = 400)\\n```\\n\\n\uc8fc\ubb38\uc740 path \ubcc0\uc218\ub85c \uc785\ucc30 id\ub97c \ubc1b\uc544\uc11c \uc774\ub8e8\uc5b4\uc9c4\ub2e4. \uc8fc\ubb38\uc774 \uc81c\ub300\ub85c \uc0dd\uc131\ub418\uc9c0 \uc54a\uc558\ub2e4\uba74 \uc720\uc800\uc758 point \ubcc0\ud654\ub3c4 \uc5c6\uc5b4\uc57c \ud558\uae30 \ub54c\ubb38\uc5d0 \ud2b8\ub79c\uc7ad\uc158\uc744 \uc801\uc6a9\ud588\ub2e4.\\n\\n\uc774\ubc88 \ud504\ub85c\uc81d\ud2b8\uc5d0\uc11c\ub294 \uc720\uc800\uc758 point\ub97c \uc11c\ub85c \uc8fc\uace0 \ubc1b\ub294 \uac83\uc73c\ub85c \uacb0\uc81c\uac00 \ub418\ub3c4\ub85d \uae30\ud68d\ud588\uae30 \ub54c\ubb38\uc5d0 \uad6c\ub9e4 \uc720\uc800\uac00 \uacb0\uc81c\uae08\uc561\ub9cc\ud07c point\ub97c \ubcf4\uc720\ud558\uace0 \uc788\ub294\uc9c0 \ud655\uc778\ud558\uace0 \ubd80\uc871\ud558\uba74 \uc8fc\ubb38\uc774 \ubd88\uac00\ub2a5\ud558\uac8c \ud588\ub2e4.\\n\\n\uc8fc\ubb38\uc744 \uc0dd\uc131\ud560 \ub54c\ub294 \uc785\ucc30\uc5d0 \uc788\ub294 position \uc815\ubcf4\ub97c \ud1b5\ud574 buyer\uc640 seller\ub97c \uad6c\ubd84\ud558\uc5ec \uc720\uc800\ub97c \ub4f1\ub85d\ud574\uc8fc\uace0 \uc8fc\ubb38\uc774 \uc644\ub8cc\ub41c \ud574\ub2f9 \uc785\ucc30\uc758 \uc0c1\ud0dc\ub97c \uacc4\uc57d\uc644\ub8cc\ub85c \ubcc0\uacbd\ud574\uc8fc\uc5c8\ub2e4. \ub9c8\ucc2c\uac00\uc9c0\ub85c position\uc5d0 \ub530\ub77c \uc720\uc800\uc758 point\ub3c4 \uacb0\uc81c\uae08\uc561\ub9cc\ud07c \uc99d\ucc28\uac10 \uc2dc\ucf30\ub2e4.\\n\\n### GET /orders/size-price/{int:product_id}/{int:position_id} (\uc0c1\ud488\uc758 \uc0ac\uc774\uc988\ubcc4 \uc989\uc2dc \uac70\ub798\uac00 \uc870\ud68c)\\n\\n```python\\nclass SizePriceView(View):\\n    @login_decorator\\n    def get(self, request, product_id, position_id):\\n        try:\\n            CheckId.check_product_id(product_id)\\n            CheckId.check_bidding_position_id(position_id)\\n\\n            product = Product.objects.select_related(\'brand\').get(id = product_id)\\n            sizes   = ProductSize.objects.select_related(\'size\').filter(product_id =\\n            product_id).prefetch_related(\\n                      Prefetch(\'bidding_set\', queryset = Bidding.objects.filter(bidding_position_id =\\n                      position_id, bidding_status_id = BiddingStatusId.ON_BIDDING.value).\\\\\\n                      order_by(\'price\' if position_id == BiddingPositionId.SELL.value else \'-price\')))\\n\\n            product_info = {\\n                \'product_image_url\'    : product.productimage_set.first().image_url,\\n                \'product_name\'         : product.name,\\n                \'product_brand\'        : product.brand.name,\\n                \'product_model_number\' : product.model_number,\\n            }\\n\\n            size_price_list = [{\\n                \'productsize_id\' : size.id,\\n                \'size\'           : size.size.size,\\n                \'bidding_id\'     : size.bidding_set.first().id if size.bidding_set.first() else None,\\n                \'bidding_price\'  : size.bidding_set.first().price if size.bidding_set.first() else None,\\n            } for size in sizes]\\n\\n            return JsonResponse({\'product_info\' : product_info, \'size_price_list\' : size_price_list}, status =\\n            200)\\n\\n        except Product.DoesNotExist:\\n            return JsonResponse({\'message\' : \'PRODUCT_DOES_NOT_EXIST\'}, status = 404)\\n\\n        except Product.MultipleObjectsReturned:\\n            return JsonResponse({\'message\' :  \'MULTIPLE_RETURN_ERROR\'}, status = 400)\\n\\n        except BiddingPosition.DoesNotExist:\\n            return JsonResponse({\'message\' : \'INVALID_BIDDING_POSITION\'}, status = 400)\\n```\\n\\n\uc720\uc800\uac00 \uad6c\ub9e4/\ud310\ub9e4 \ud398\uc774\uc9c0\uc5d0 \ub4e4\uc5b4\uac14\uc744 \ub54c \ud574\ub2f9 \uc0c1\ud488\uc758 \uc815\ubcf4\uc640 \uc0c1\ud488\uc758 \uc0ac\uc774\uc988\ubcc4\ub85c \ud615\uc131\ub418\uc5b4\uc788\ub294 \uc989\uc2dc\uac70\ub798\uac00\uc758 \ub370\uc774\ud130\ub97c \ubcf4\ub0b4\uc8fc\ub294 api\uc774\ub2e4. \ub9cc\uc57d \uc989\uc2dc\uac70\ub798\uac00\uac00 \ud615\uc131\ub3fc\uc788\uc9c0 \uc54a\uc740 \uc0ac\uc774\uc988\ub77c\uba74 \ub2e4\uc74c \ud398\uc774\uc9c0\uc5d0\uc11c \uc8fc\ubb38\uc740 \ubd88\uac00\ub2a5\ud558\uace0 \uc785\ucc30 \uc0dd\uc131\uc694\uccad\ub9cc \uac00\ub2a5\ud558\ub2e4.\\n\\n![](https://user-images.githubusercontent.com/61782539/140075771-17bbd095-e526-4016-a6b5-29d704edd7e0.gif)\\n\\n### GET /orders/price/{int:product_id} (\uc0c1\ud488\uc758 \uc2dc\uc138 \uc870\ud68c)\\n\\n```python\\nclass PriceHistoryView(View):\\n    @query_debugger\\n    def get(self, request, product_id):\\n        try:\\n            CheckId.check_product_id(product_id)\\n            size   = request.GET.get(\'size\')\\n            period = request.GET.get(\'period\', \'1y\')\\n            sort   = request.GET.get(\'sort\')\\n            limit  = int(request.GET.get(\'limit\', 5))\\n            offset = int(request.GET.get(\'offset\', 0))\\n            limit  = offset + limit\\n\\n            sort_by = {\\n                \'low_price\'  : \'price\',\\n                \'high_price\' : \'-price\',\\n                \'low_size\'   : \'size\',\\n                \'high_size\'  : \'-size\',\\n                \'recent\'     : \'-created_at\'\\n            }\\n\\n            order_period = {\\n                \'1m\' : datetime.now() - relativedelta(months = 1),\\n                \'3m\' : datetime.now() - relativedelta(months = 3),\\n                \'6m\' : datetime.now() - relativedelta(months = 6),\\n                \'1y\' : datetime.now() - relativedelta(years = 1),\\n            }\\n\\n            order_grape_filter = (Q(bidding__product_size__product_id = product_id) & Q(created_at__range =   (order_period.get(period, \'1y\'), datetime.now())))\\n            order_filter       = Q(bidding__product_size__product_id = product_id)\\n            bidding_filter     = (Q(bidding_status_id = BiddingStatusId.ON_BIDDING.value) &\\n                                  Q(product_size__product_id = product_id))\\n\\n            if size:\\n                if not ProductSize.objects.filter(product_id = product_id, size__size = size).exists():\\n                    return JsonResponse({\'message\' : \'PRODUCT_SIZE_DOES_NOT_EXIST\'}, status = 404)\\n\\n                product_size = ProductSize.objects.get(product_id = product_id, size__size = size)\\n                order_grape_filter.add(Q(bidding__product_size = product_size), Q.AND)\\n                order_filter.add(Q(bidding__product_size = product_size), Q.AND)\\n                bidding_filter.add(Q(product_size = product_size), Q.AND)\\n\\n            order_graph   =\\n            Order.objects.select_related(\'bidding\').filter(order_grape_filter).order_by(\'created_at\')\\n            orders        = Order.objects.annotate(price = F(\'bidding__price\'), size = F(\'bidding__product_size__size__size\')).select_related(\'bidding__product_size__size\').\\\\\\n                            filter(order_filter).order_by(sort_by.get(sort, \'-created_at\'))\\n            sell_biddings = Bidding.objects.annotate(size = F(\'product_size__size__size\')).select_related(\'product_size__size\').\\\\\\n                            filter(bidding_filter, bidding_position_id =\\n                                   BiddingPositionId.SELL.value).order_by(sort_by.get(sort, \'price\'))\\n            buy_biddings  = Bidding.objects.annotate(size = F(\'product_size__size__size\')).select_related(\'product_size__size\').\\\\\\n                            filter(bidding_filter, bidding_position_id = BiddingPositionId.BUY.value).order_by(sort_by.get(sort, \'-price\'))\\n\\n            data = {\\n            \'order_graph_data\' : [{\\n                \'id\'         : order.id,\\n                \'price\'      : order.bidding.price,\\n                \'created_at\' : order.created_at.strftime(\'%Y-%m-%d\')\\n            }for order in order_graph],\\n\\n            \'order_list\' : [{\\n                \'id\'         : order.id,\\n                \'price\'      : order.bidding.price,\\n                \'size\'       : order.bidding.product_size.size.size,\\n                \'created_at\' : order.created_at.strftime(\'%Y-%m-%d\')\\n            }for order in orders[offset:limit]],\\n\\n            \'sell_bidding_list\' : [{\\n                \'price\' : sell_bidding[\'price\'],\\n                \'size\'  : sell_bidding[\'size\'],\\n                \'count\' : sell_bidding[\'price_count\']\\n            }for sell_bidding in sell_biddings.values(\'price\', \'size\').annotate(price_count = Count(\'price\')).distinct()[offset:limit]],\\n\\n            \'buy_bidding_list\' : [{\\n                \'price\' : buy_bidding[\'price\'],\\n                \'size\'  : buy_bidding[\'size\'],\\n                \'count\' : buy_bidding[\'price_count\']\\n            }for buy_bidding in buy_biddings.values(\'price\',\'size\').annotate(price_count = Count(\'price\')).distinct()[offset:limit]]\\n            }\\n\\n            return JsonResponse({\'data\' : data}, status = 200)\\n\\n        except Product.DoesNotExist:\\n            return JsonResponse({\'message\' : \'PRODUCT_DOES_NOT_EXIST\'}, status = 404)\\n\\n        except ProductSize.DoesNotExist:\\n            return JsonResponse({\'message\' : \'PRODUCT_SIZE_DOES_NOT_EXIST\'}, status = 404)\\n\\n        except ProductSize.MultipleObjectsReturned:\\n            return JsonResponse({\'message\' : \'MULTIPLE_RETURN_ERROR\'}, status = 400)\\n```\\n\\nkream \uc0ac\uc774\ud2b8\uc5d0\ub294 \uc0c1\ud488 \uc0c1\uc138\ud398\uc774\uc9c0\ub85c \ub4e4\uc5b4\uac14\uc744 \ub54c \ud574\ub2f9 \uc0c1\ud488\uc758 \uccb4\uacb0\uac70\ub798\uac00\ub97c \uadf8\ub798\ud504\ub85c \uc2dc\uac01\ud654\ud558\uc5ec \ubcf4\uc5ec\uc8fc\uace0 \ud310\ub9e4/\uad6c\ub9e4 \uc785\ucc30\ub0b4\uc5ed\ub4e4\ub3c4 \ubcf4\uc5ec\uc900\ub2e4. \uc774\ubc88 \ud504\ub85c\uc81d\ud2b8\uc5d0\uc11c \uc774 \ubd80\ubd84\ub3c4 \uad6c\ud604\ud574\ubcf4\uc558\ub2e4.\\n\\n\uba3c\uc800 \uc8fc\ubb38\ub0b4\uc5ed \uadf8\ub798\ud504 \ub370\uc774\ud130\ub294 \uae30\uac04\ubcc4, \uc0ac\uc774\uc988\ubcc4 \ud544\ud130\ub9c1\ub9cc \uc801\uc6a9\ub418\uace0 \uc194\ud305\uc740 \uc801\uc6a9\ub418\uc9c0 \uc54a\uae30 \ub54c\ubb38\uc5d0 \ud544\ud130 \uc870\uac74\uacfc \ucffc\ub9ac\uc14b\uc744 \ub530\ub85c \uad00\ub9ac\ud558\uc600\ub2e4. relativedelta \ubaa8\ub4c8\uc744 \uc0ac\uc6a9\ud574\uc11c \ub0a0\uc9dc \uc5f0\uc0b0\uc774 \uac00\ub2a5\ud588\uace0 \uc694\uccad\uc758 `period` \uac12\uc5d0 \ub530\ub77c `created_at__range` \ud0a4\uc6cc\ub4dc\ub97c \ud1b5\ud574 \ud574\ub2f9\ud558\ub294 \uae30\uac04\ub9cc\ud07c\ub9cc \uc8fc\ubb38\ub0b4\uc5ed \ub370\uc774\ud130\ub97c \ud544\ud130\ub9c1\ud560 \uc218 \uc788\uc5c8\ub2e4. \uc0ac\uc774\uc988\ub85c \ud544\ud130\ub9c1\ud588\uc744 \ub54c\ub294 \uadf8\ub798\ud504\ub97c \ud3ec\ud568\ud558\uc5ec \uc8fc\ubb38\ub0b4\uc5ed, \uc785\ucc30\ub0b4\uc5ed \ub370\uc774\ud130 \ubaa8\ub450 \ud544\ud130\ub9c1\uc774 \uc801\uc6a9\ub418\uace0, \uc194\ud305\uc740 \uc8fc\ubb38\ub0b4\uc5ed\uc740 \ucd5c\uc2e0\uc21c, \ud310\ub9e4 \uc785\ucc30 \ub0b4\uc5ed\uc740 \ub0ae\uc740 \uac00\uaca9\uc21c, \uad6c\ub9e4 \uc785\ucc30 \ub0b4\uc5ed\uc740 \ub192\uc740 \uac00\uaca9\uc21c\uc774 \uae30\ubcf8\uc774 \ub418\uac8c \ud588\uace0 \uc694\uccad\uc5d0 \ub530\ub77c \uac00\uaca9\uc21c, \uc0ac\uc774\uc988\uc21c, \ucd5c\uc2e0\uc21c\uc73c\ub85c \uc194\ud305\ub418\uac8c \ud558\uc600\ub2e4.\\n\\n![](https://user-images.githubusercontent.com/61782539/140075522-8afded39-ee1e-4f14-a4ed-ed0932fc73dd.gif)\\n\\n### GET /orders (\uc8fc\ubb38, \uc785\ucc30\uc911\uc778 \ub0b4\uc5ed \uc870\ud68c)\\n\\n```python\\nclass OrderListView(View):\\n    @login_decorator\\n    def get(self, request):\\n        user = request.user\\n\\n        buy_orders  = Order.objects.select_related(\'bidding__product_size__product__brand\',\\n                                                   \'bidding__product_size__size\', \'order_status\').\\\\\\n                    filter(buyer = user).prefetch_related(\'bidding__product_size__product__productimage_set\')\\n\\n        sell_orders = Order.objects.select_related(\'bidding__product_size__product__brand\',\\n                                                   \'bidding__product_size__size\', \'order_status\').\\\\\\n                    filter(seller = user).prefetch_related(\'bidding__product_size__product__productimage_set\')\\n\\n        biddings    = Bidding.objects.select_related(\'product_size__product__brand\', \'product_size__size\').\\\\\\n                    filter(user = user, bidding_status_id = BiddingStatusId.ON_BIDDING.value).prefetch_related(\'product_size__product__productimage_set\')\\n\\n        buy_order_list = [{\\n            \'product_id\'        : buy_order.bidding.product_size.product.id,\\n            \'product_image_url\' : buy_order.bidding.product_size.product.productimage_set.all()[0].image_url,\\n            \'product_name\'      : buy_order.bidding.product_size.product.name,\\n            \'product_brand\'     : buy_order.bidding.product_size.product.brand.name,\\n            \'size\'              : buy_order.bidding.product_size.size.size,\\n            \'order_status\'      : buy_order.order_status.status,\\n        }for buy_order in buy_orders]\\n\\n        sell_order_list = [{\\n            \'product_id\'        : sell_order.bidding.product_size.product.id,\\n            \'product_image_url\' : sell_order.bidding.product_size.product.productimage_set.all()[0].image_url,\\n            \'product_name\'      : sell_order.bidding.product_size.product.name,\\n            \'product_brand\'     : sell_order.bidding.product_size.product.brand.name,\\n            \'size\'              : sell_order.bidding.product_size.size.size,\\n            \'order_status\'      : sell_order.order_status.status,\\n        }for sell_order in sell_orders]\\n\\n        buy_bidding_list = [{\\n            \'product_id\'        : buy_bidding.product_size.product.id,\\n            \'product_image_url\' : buy_bidding.product_size.product.productimage_set.all()[0].image_url,\\n            \'product_name\'      : buy_bidding.product_size.product.name,\\n            \'product_brand\'     : buy_bidding.product_size.product.brand.name,\\n            \'size\'              : buy_bidding.product_size.size.size,\\n        } for buy_bidding in biddings.filter(bidding_position_id = BiddingPositionId.BUY.value)]\\n\\n        sell_bidding_list = [{\\n            \'product_id\'        : sell_bidding.product_size.product.id,\\n            \'product_image_url\' : sell_bidding.product_size.product.productimage_set.all()[0].image_url,\\n            \'product_name\'      : sell_bidding.product_size.product.name,\\n            \'product_brand\'     : sell_bidding.product_size.product.brand.name,\\n            \'size\'              : sell_bidding.product_size.size.size,\\n        } for sell_bidding in biddings.filter(bidding_position_id = BiddingPositionId.SELL.value)]\\n\\n        buy_order_count       = len(buy_order_list)\\n        sell_order_count      = len(sell_order_list)\\n        buy_on_bidding_count  = len(buy_bidding_list)\\n        sell_on_bidding_count = len(sell_bidding_list)\\n\\n        data = {\\n            \'user_name\'             : user.name,\\n            \'user_email\'            : user.email,\\n            \'user_point\'            : user.point,\\n            \'buy_order_count\'       : buy_order_count,\\n            \'buy_order_list\'        : buy_order_list,\\n            \\"sell_order_count\\"      : sell_order_count,\\n            \'sell_order_list\'       : sell_order_list,\\n            \'buy_on_bidding_count\'  : buy_on_bidding_count,\\n            \'buy_bidding_list\'      : buy_bidding_list,\\n            \'sell_on_bidding_count\' : sell_on_bidding_count,\\n            \'sell_bidding_list\'     : sell_bidding_list\\n        }\\n\\n        return JsonResponse({\'data\' : data}, status = 200)\\n```\\n\\n\ub9c8\uc774\ud398\uc774\uc9c0\uc5d0 \ub4e4\uc5b4\uac14\uc744 \ub54c \ud574\ub2f9 \uc720\uc800\uc758 \ud3ec\uc778\ud2b8\uc640 \uad6c\ub9e4/\ud310\ub9e4 \ub0b4\uc5ed\uacfc \uad6c\ub9e4/\ud310\ub9e4 \uc785\ucc30 \ub0b4\uc5ed\uc744 \ubcfc \uc218 \uc788\ub3c4\ub85d \ub370\uc774\ud130\ub97c \ubcf4\ub0b4\uc8fc\ub294 api\uc774\ub2e4. \uc785\ucc30\ub0b4\uc5ed\uc911\uc5d0 \uc785\ucc30 \uc0c1\ud0dc\uac00 \uac70\ub798\uc644\ub8cc\uc778 \uc785\ucc30\ub4e4\uc740 \uc8fc\ubb38\ub0b4\uc5ed\uc5d0 \uc774\ubbf8 \ud3ec\ud568\ub3fc\uc788\uae30 \ub54c\ubb38\uc5d0 \uc785\ucc30\ub0b4\uc5ed\uc740 \ud604\uc7ac \uc785\ucc30\uc911\uc778 \uc785\ucc30\ub4e4\ub9cc \ubcf4\uc5ec\uc8fc\ub3c4\ub85d \ud588\ub2e4. productimage \ud14c\uc774\ube14\uc5d0 \uc811\uadfc\ud574\uc11c \uccab\ubc88\uc9f8\uc758 \uc774\ubbf8\uc9c0\ub97c \uac00\uc838\uc624\ub294 \ubd80\ubd84\uc5d0\uc11c \ub9cc\uc57d `first()`\ub97c \uc0ac\uc6a9\ud55c\ub2e4\uba74 `prefetch_related()` \ub85c productimage \ud14c\uc774\ube14\uc744 \uc9c0\uc815\ud574\uc8fc\uc5b4\ub3c4 for \ubb38\uc744 \ub3cc \ub54c n+1 problem\uc774 \ud574\uacb0\ub418\uc9c0 \uc54a\ub294\ub2e4. `first()`\ub97c \uc0ac\uc6a9\ud588\uc744 \ub54c \ud2b9\ubcc4\ud788 order_by\ub97c \uc9c0\uc815\ud574\uc8fc\uc9c0 \uc54a\uc73c\uba74 id\uac12\uc73c\ub85c \uc815\ub82c\uc2dc\ud0a8 \ud6c4 \uccab\ubc88\uc9f8\ub97c \uac00\uc838\uc624\uae30 \ub54c\ubb38\uc5d0 for\ubb38\uc744 \ub3cc \ub54c\ub9c8\ub2e4 id\ub85c \uc815\ub82c\uc2dc\ud0a4\ub294 \ucffc\ub9ac\uac00 \ub0a0\ub77c\uac04\ub2e4. \uc774 \ubb38\uc81c\ub97c \ud574\uacb0\ud558\ub824\uba74 `productimage_set.all()[0].image_url` \ucc98\ub7fc \uc778\ub371\uc2a4\ub85c \uc811\uadfc\ud558\uba74 \ub41c\ub2e4.\\n\\n```python\\nsizes   = ProductSize.objects.select_related(\'size\').filter(product_id =\\n            product_id).prefetch_related(\\n                      Prefetch(\'bidding_set\', queryset = Bidding.objects.filter(bidding_position_id =\\n                      position_id, bidding_status_id = BiddingStatusId.ON_BIDDING.value).\\\\\\n                      order_by(\'price\' if position_id == BiddingPositionId.SELL.value else \'-price\')))\\n\\n\'bidding_id\'     : size.bidding_set.first().id if size.bidding_set.first() else None\\n```\\n\\n\uc704\uc758 \uc0ac\uc774\uc988\ubcc4 \uc989\uc2dc\uac70\ub798\uac00\ub97c \uc870\ud68c\ud558\ub294 api\uc5d0\uc11c\ub294 bidding \ud14c\uc774\ube14\uc5d0 \ub300\ud574 price\ub098 -price\ub85c order_by\ub97c \uc9c0\uc815\ud574\ub193\uc558\uae30 \ub54c\ubb38\uc5d0 `first()`\ub97c \uc0ac\uc6a9\ud558\uc5ec\ub3c4 \ubb38\uc81c\ub418\uc9c0 \uc54a\ub294\ub2e4.\\n\\n![](https://user-images.githubusercontent.com/61782539/140076298-19e102b9-69d6-4c52-a1d8-90043f5b867f.gif)\\n![](https://user-images.githubusercontent.com/61782539/140076515-c785cbf2-5322-4b46-ac6d-ab5622baff2c.gif)"},{"id":"/2021/11/10/backend/project/lush-clone","metadata":{"permalink":"/2021/11/10/backend/project/lush-clone","source":"@site/blog/backend/project/2021-11-10-lush-clone.md","title":"Lush Clone Project","description":"\uae30\uac04: 2021-10-10 ~ 2021-10-29","date":"2021-11-10T00:00:00.000Z","formattedDate":"November 10, 2021","tags":[{"label":"BackEnd","permalink":"/tags/back-end"},{"label":"Django","permalink":"/tags/django"}],"readingTime":13.135,"hasTruncateMarker":true,"authors":[{"name":"Chihun Park","url":"https://github.com/chihunmanse","email":"chihunmanse@gmail.com","imageURL":"https://p.ipic.vip/o1ih3g.png","key":"chihun"}],"frontMatter":{"title":"Lush Clone Project","tags":["BackEnd","Django"],"authors":"chihun"},"prevItem":{"title":"Kream Clone Project","permalink":"/2021/11/10/backend/project/kream-clone"}},"content":"**\uae30\uac04: 2021-10-10 ~ 2021-10-29**\\n\\n**Stack: Python, Django, MySQL, DjangoORM**\\n\\n**[Github \ub9c1\ud06c](https://github.com/chihunmanse/LUSH-motive-Project)**\\n\\n## End Point\\n\ud504\ub85c\uc81d\ud2b8\uc5d0\uc11c \uc0c1\ud488 \ubaa9\ub85d \uc870\ud68c API\uc640 \uc0c1\ud488 \uc0c1\uc138 \uc870\ud68c API, \uce74\ud14c\uace0\ub9ac \uc815\ubcf4 API, \uc7a5\ubc14\uad6c\ub2c8 \uc0c1\ud488 \ucd94\uac00, \uc218\uc815, \uc0ad\uc81c API\ub97c \ub9cc\ub4dc\ub294 \uc5ed\ud560\uc744 \ub2f4\ub2f9\ud588\ub2e4.\\n\\n- GET/products (\uc0c1\ud488 \ubaa9\ub85d/ \ud544\ud130\ub9c1, \uc194\ud305)\\n- GET/products/{int:product_id} (\uc0c1\ud488 \uc0c1\uc138)\\n- GET/navigator/{int:category_id} (\ub124\ube44\uac8c\uc774\ud130)\\n- GET/category (\uce74\ud14c\uace0\ub9ac \ub9ac\uc2a4\ud2b8)\\n- POST/carts (\uc7a5\ubc14\uad6c\ub2c8 \uc0dd\uc131)\\n- GET/carts (\uc7a5\ubc14\uad6c\ub2c8 \uc870\ud68c)\\n- DEL/carts/{int:cart_id} (\uc7a5\ubc14\uad6c\ub2c8 \uc0ad\uc81c)\\n- PATCH/carts/{int:cart_id} (\uc7a5\ubc14\uad6c\ub2c8 \uc218\uc815)\\n\\n\x3c!--truncate--\x3e\\n\\n## Code\\n\\n### GET/products (\uc0c1\ud488 \ubaa9\ub85d \uc870\ud68c)\\n\\n```python\\nclass ProductView(View) :\\n    #@query_debugger\\n    def get(self, request) :\\n        try :\\n            category_id = request.GET.get(\'category\')\\n            sort        = request.GET.get(\'sort\')\\n            search      = request.GET.get(\'search\')\\n            limit       = int(request.GET.get(\'limit\', 0))\\n            offset      = int(request.GET.get(\'offset\', 0))\\n\\n            sort_by = {\\n                \'low_price\'  : \'price\',\\n                \'high_price\' : \'-price\',\\n                \'recent\'     : \'-created_at\',\\n                \'old\'        : \'created_at\',\\n                \'review\'     : \'-review_count\',\\n            }\\n\\n            products_filter = Q(deleted_at = None)\\n            category_info   = {}\\n\\n            if category_id :\\n                category = Category.objects.select_related(\'main_category\').get(id = \\n                category_id)\\n                products_filter.add(Q(category = category) if category.main_category else \\n                Q(category__main_category = category), Q.AND)\\n\\n                category_info = {\\n                    \'id\'             : category.id,\\n                    \'name\'           : category.name,\\n                    \'category_image\' : category.image_url,\\n                    \'description\'    : category.description,\\n                }\\n\\n            if search :\\n                products_filter.add(Q(name__icontains = \\n                search)|Q(category__main_category__name = search)|Q(category__name = \\n                search), Q.AND)\\n        \\n            products = \\n            Product.objects.filter(products_filter).prefetch_related(\'tags\').annotate(price \\n            = Min(\'option__price\'), review_count = Count(\'review\'))\\\\\\n                       .order_by(sort_by.get(sort, \'id\'))\\n\\n            if limit :\\n                limit    = offset + limit\\n                products = products[offset : limit]\\n\\n            products_list = [{\\n                \'id\'            : product.id,\\n                \'name\'          : product.name,\\n                \'thumbnail_url\' : product.thumbnail_url,\\n                \'price\'         : product.price,\\n                \'tags\'          : [tag.name for tag in product.tags.all()]\\n            } for product in products]\\n\\n            products_count = len(products_list)\\n\\n            return JsonResponse({\'category_info\' : category_info, \'products_list\' : \\n            products_list, \'products_count\' : products_count}, status = 200)\\n        \\n        except Category.DoesNotExist :\\n            return JsonResponse({\'message\' : \'INVALID_CATEGORY_ID\'}, status = 404)\\n        \\n        except Category.MultipleObjectsReturned :\\n            return JsonResponse({\'message\' : \'MULTIPLE_CATEGORY_ERROR\'}, status = 400)\\n```\\n\\n\uc0c1\ud488 \ud544\ud130\ub9c1\uc740 `Q()`\ub97c \ud65c\uc6a9\ud574\uc11c \uad6c\ud604\ud588\uace0 \uce74\ud14c\uace0\ub9ac\uc640 \uac80\uc0c9\uc5b4\ub97c \ud1b5\ud574 \ud560 \uc218 \uc788\ub2e4. \\n\\n\uba3c\uc800 \uce74\ud14c\uace0\ub9ac\ub85c \ud544\ud130\ub9c1 \ud560 \ub54c\ub294 \uc694\uccad\uc5d0\uc11c \uc5bb\uc740 \uce74\ud14c\uace0\ub9ac\uac00 \uba54\uc778 \uce74\ud14c\uace0\ub9ac\uc778\uc9c0 \uc11c\ube0c\uce74\ud14c\uace0\ub9ac\uc778\uc9c0 \uad6c\ubd84\ud574\uc8fc\uc5b4\uc57c \ud588\uae30 \ub54c\ubb38\uc5d0 (Category \ud14c\uc774\ube14\uc5d0 \uc140\ud504 \ucc38\uc870\ud558\ub294 `main_category`\uce7c\ub7fc \uac12\uc774 null\uc774\uba74 \uba54\uc778\uce74\ud14c\uace0\ub9ac, \ucc38\uc870\ud558\ub294 \uce74\ud14c\uace0\ub9ac\uac00 \uc788\uc73c\uba74 \uc11c\ube0c\uce74\ud14c\uace0\ub9ac) \ud544\ud130 \uc870\uac74\uc744 \ucd94\uac00\ud560 \ub54c \uc0bc\ud56d\uc5f0\uc0b0\uc790\ub97c \uc0ac\uc6a9\ud588\ub2e4.\\n\\n\uac80\uc0c9\uc2dc\uc5d0\ub294 \uc0c1\ud488\uba85\uc5d0 \uac80\uc0c9\uc5b4\uac00 \ud3ec\ud568\ub418\uc5b4\uc788\uac70\ub098, \uac80\uc0c9\uc5b4\uac00 \uc11c\ube0c\uce74\ud14c\uace0\ub9ac\ub098 \uba54\uc778\uce74\ud14c\uace0\ub9ac\uc758 \uc774\ub984\uacfc \uc77c\uce58\ud588\uc744 \ub54c\ub97c \uc870\uac74\uc5d0 \ucd94\uac00\ud588\ub2e4. \\n\\n\uc0c1\ud488 \uc815\ub82c\uc740 \ub0ae\uc740 \uac00\uaca9\uc21c, \ub192\uc740 \uac00\uaca9\uc21c, \ucd5c\uc2e0\uc21c, \uc624\ub798\ub41c \uc21c, \ub9ac\ubdf0 \ub9ce\uc740 \uc21c\uc73c\ub85c \ud560 \uc218 \uc788\uace0 sort_by \ub515\uc154\ub108\ub9ac\ub97c \ub9cc\ub4e4\uc5b4 \ub193\uace0 \uc0c1\ud488 \ucffc\ub9ac\uc14b\uc744 \uc120\uc5b8\ud560 \ub54c \uc694\uccad\uc5d0\uc11c `sort` \uac12\uc774 \ub4e4\uc5b4\uc654\ub2e4\uba74 order_by\uc5d0 sort_by \ub515\uc154\ub108\ub9ac\uc758 \ud574\ub2f9 \ud0a4\uc758 \uac12\uc744 \ubd88\ub7ec\uc624\uace0 \uc694\uccad\uc5d0 sort\uac00 \uc5c6\uac70\ub098 \uc798\ubabb\ub41c \ud0a4\ub85c \ub4e4\uc5b4\uc654\uc744 \ub54c\ub294 \uae30\ubcf8\uc801\uc73c\ub85c \uc0c1\ud488id\ub85c \uc815\ub82c\ub418\ub3c4\ub85d \ud588\ub2e4. \uc0c1\ud488\uac00\uaca9\uc740 \uc635\uc158 \ud14c\uc774\ube14\uc5d0 \uc788\uae30 \ub54c\ubb38\uc5d0 `annotate()`\ub97c \ud65c\uc6a9\ud574\uc11c \uc635\uc158 \uc911\uc5d0 \uac00\uc7a5 \ub0ae\uc740 \uac00\uaca9 `Min(\'option__price\')`\ub4e4\uc744 `price`\ub77c\ub294 \uc774\ub984\uc73c\ub85c \ubd88\ub7ec\uc654\uace0 \ub9ac\ubdf0\ub3c4 \ub9c8\ucc2c\uac00\uc9c0\ub85c `annotate()`\ub97c \ud65c\uc6a9\ud574\uc11c `review_count`\ub77c\ub294 \uc774\ub984\uc73c\ub85c \ub9ac\ubdf0 \uc218\ub97c Count\ud558\uc5ec \ubd88\ub7ec\uc654\ub2e4.\\n\\n### GET/products/{int:product_id} (\uc0c1\ud488 \uc0c1\uc138)\\n\\n```python\\nclass ProductDetailView(View) :\\n    #@query_debugger\\n    def get(self, request, product_id) :\\n        try :\\n            if not Product.objects.filter(id = product_id).exists() :\\n                return JsonResponse({\'message\' : \'INVALID_PRODUCT_ID\'}, status = 404)\\n        \\n            product = Product.objects.prefetch_related(\\n                     \'option_set\', \'tags\', \'detailimage_set\', Prefetch(\'review_set\', \\n                     queryset = Review.objects.filter(product = product_id).order_by(\'-\\n                     created_at\')))\\n                     .select_related(\'category__main_category\').annotate(rating_average =\\n                      Avg(\'review__rating\')).get(id = product_id)\\n            \\n            product_info = {\\n                \'id\'                 : product.id,\\n                \'name\'               : product.name,\\n                \'thumbnail_url\'      : product.thumbnail_url,\\n                \'how_to\'             : product.how_to,\\n                \'ingredients\'        : product.ingredients,\\n                \'options\'            : [{\\n                    \'option_id\'      : option.id,\\n                    \'price\'          : option.price,\\n                    \'size\'           : option.size,\\n                } for option in product.option_set.all()],\\n                \'tags\'               : [tag.name for tag in product.tags.all()],\\n                \'main_category_name\' : product.category.main_category.name,\\n                \'sub_category_name\'  : product.category.name,\\n                \'detail_images\'      : [image.image_url for image in\\n                product.detailimage_set.all()],\\n                \'rating_average\'     : round(product.rating_average, 1) if \\n                product.rating_average else 0,\\n                \'review_count\'       : product.review_set.count(),\\n                \'photo_review_count\' : len([review.image_url for review in\\n                product.review_set.all() if review.image_url]),\\n                \'photo_reviews\'      : [{\'review_id\' : review.id, \'image_url\' : \\n                review.image_url} for review in product.review_set.all() if \\n                review.image_url][:4]\\n            }\\n\\n            return JsonResponse({\'product_info\' : product_info}, status = 200)\\n        \\n        except Product.DoesNotExist :\\n            return JsonResponse({\'message\' : \'INVALID_PRODUCT_ID\'}, status = 404)\\n        \\n        except Product.MultipleObjectsReturned :\\n            return JsonResponse({\'message\' : \'MULTIPLE_PRODUCT_ERROR\'}, status = 400)\\n```\\n\\n\uc0c1\ud488 \uc0c1\uc138 \uc815\ubcf4\uc5d0\ub294 \ub9ac\ubdf0 \ud3c9\uc810 \ud3c9\uade0\uac12\uacfc \ub9ac\ubdf0 \uc218, \ub9ac\ubdf0 \uc911\uc5d0 \uc774\ubbf8\uc9c0\uac00 \uc788\ub294 \ud3ec\ud1a0 \ub9ac\ubdf0 \uc218, \ucd5c\uc2e0\uc21c\uc73c\ub85c \uc815\ub82c\ub41c \ud3ec\ud1a0 \ub9ac\ubdf0\uc758 \uc774\ubbf8\uc9c0 \ucd5c\ub300 4\uac1c\uc758 \ub370\uc774\ud130\ub97c \ud568\uaed8 \ubcf4\ub0b4\uc8fc\uc5b4\uc57c \ud588\ub2e4. \ub9ac\ubdf0 \ud3c9\uc810\uc758 \ud3c9\uade0\uac12\uc740 `annotate()`\uc640 `Avg()`\ub97c \uc0ac\uc6a9\ud588\uace0 \uad6c\ud574\uc9c4 \ud3c9\uade0\uac12\uc744 \uc18c\uc218\uc810 1\uc790\ub9ac\uae4c\uc9c0 \ubc18\uc62c\ub9bc\ud558\uae30 \uc704\ud574 `round()`\ub97c \uc0ac\uc6a9\ud588\ub2e4. \ub9cc\uc57d \uc870\ud68c\ud558\ub824\ub294 \uc0c1\ud488\uc5d0 \ub9ac\ubdf0\uac00 \ud558\ub098\ub3c4 \ub2ec\ub9ac\uc9c0 \uc54a\uc558\ub2e4\uba74 `Avg(\'review__rating\')`\uc740 None\uc744 \ubc18\ud658\ud558\uace0 `round()`\uc5d0 None\uc774 \ub4e4\uc5b4\uac00\uba74 TypeError\ub97c \ubc1c\uc0dd\uc2dc\ud0a4\uae30 \ub54c\ubb38\uc5d0 `review_average`\uc5d0 \uac12\uc774 \uc788\uc744 \ub54c\ub9cc `round()`\uc5d0 \ub123\uace0 None\uc774\uba74 0\uc774 \ub418\ub3c4\ub85d \ud588\ub2e4.\\n\\n\uadf8\ub9ac\uace0 \ud3ec\ud1a0\ub9ac\ubdf0 \ub370\uc774\ud130\ub97c \ub2f4\uc744 \ub54c \ucd5c\uc2e0\uc21c\uc73c\ub85c \uc815\ub82c\uc2dc\ucf1c\uc11c \ub2f4\uc544\uc57c \ud588\ub294\ub370, \\n\\n```python\\nprefetch_related(\'option_set\', \'tags\', \'detailimage_set\', \'review_set\')\\n\\n\'photo_reviews\': [{\'review_id\' : review.id, \'image_url\' : review.image_url} for review in product.review_set.all().order_by(\'-created_at\') if review.image_url][:4]\\n```\\n\\n`prefetch_related` \ud568\uc218\uc5d0 `\'review_set\'`\uc73c\ub85c\ub9cc \uc9c0\uc815\ud558\uace0 \uc544\ub798\uc5d0\uc11c \ub2e4\uc2dc \uc815\ub82c\uc2dc\ud0a4\uba74 \\n\\n```sql\\n DEBUG (0.000) SELECT `reviews`.`id`, `reviews`.`user_id`, `reviews`.`product_id`, `reviews`.`content`, `reviews`.`rating`, `reviews`.`image_url`, `reviews`.`created_at`, `reviews`.`updated_at` FROM `reviews` WHERE `reviews`.`product_id` IN (19); args=(19,)\\n\\n DEBUG (0.001) SELECT `reviews`.`id`, `reviews`.`user_id`, `reviews`.`product_id`, `reviews`.`content`, `reviews`.`rating`, `reviews`.`image_url`, `reviews`.`created_at`, `reviews`.`updated_at` FROM `reviews` WHERE `reviews`.`product_id` = 19 ORDER BY `reviews`.`created_at` DESC; args=(19,)\\n```\\n\\nORDER BY\ud558\ub294 \ucffc\ub9ac\uac00 \ub2e4\uc2dc \ub0a0\uc544\uac04\ub2e4.\\n\\n```python\\nProduct.objects.prefetch_related(\\n                    \'option_set\', \'tags\', \'detailimage_set\', \\n                    Prefetch(\'review_set\',\\n                    queryset = Review.objects.filter(product = product_id).order_by\\n                             (\'-created_at\')))\\n```\\n\\n`Prefetch()`\ub97c \ud1b5\ud574\uc11c queryset\uc5d0 \ucd5c\uc2e0\uc21c\uc73c\ub85c \uc815\ub82c\ub41c \ub9ac\ubdf0 \ucffc\ub9ac\uc14b\uc73c\ub85c \uc9c1\uc811 \uc9c0\uc815\ud558\uace0 \uc0ac\uc6a9\ud558\uba74\\n\\n```sql\\n DEBUG (0.000) SELECT `reviews`.`id`, `reviews`.`user_id`, `reviews`.`product_id`, `reviews`.`content`, `reviews`.`rating`, `reviews`.`image_url`, `reviews`.`created_at`, `reviews`.`updated_at` FROM `reviews` WHERE (`reviews`.`product_id` = 19 AND `reviews`.`product_id` IN (19)) ORDER BY `reviews`.`created_at` DESC; args=(19, 19)\\n```\\n\\n\uc774\ub807\uac8c \ud558\ub098\uc758 \ucffc\ub9ac\ub85c \ud569\uce60 \uc218 \uc788\uc5c8\ub2e4.\\n\\n### GET/navigator/{int:category_id} (\ub124\ube44\uac8c\uc774\ud130)\\n\\n\ucc98\uc74c \ubaa8\ub378\uc5d0\ub294 \uc11c\ube0c\uce74\ud14c\uace0\ub9ac \ud14c\uc774\ube14\uc774 \ub530\ub85c \uc874\uc7ac\ud588\ub2e4. \uadf8\ub7f0\ub370 \ub7ec\uc26c \uc0ac\uc774\ud2b8\uc5d0\ub294 \uce74\ud14c\uace0\ub9ac\ub098 \uc11c\ube0c\uce74\ud14c\uace0\ub9ac\ub97c \ub204\ub97c \ub54c, \ubc30\ub108\uc774\ubbf8\uc9c0\uc640 \ud55c \uc904\uc758 \uc124\uba85 \ubb38\uad6c\uac00 \ub728\ub294\ub370 \uadf8\ub54c \uc0ac\uc6a9\ub418\ub294 \ub370\uc774\ud130\ub294 \uce74\ud14c\uace0\ub9ac\uc758 \uacc4\uce35\uacfc\ub294 \uc0c1\uad00\uc774 \uc5c6\uc5c8\ub2e4. \uadf8\ub7fc\uc5d0\ub3c4 \uce74\ud14c\uace0\ub9ac \uc815\ubcf4\ub97c \uc8fc\ub294 api\uc640 \uc11c\ube0c\uce74\ud14c\uace0\ub9ac \uc815\ubcf4\ub97c \uc8fc\ub294 api\ub97c \ub098\ub220\uc11c \ub9cc\ub4e4\uc5b4\uc57c \ud588\uace0 \uba58\ud1a0\ub2d8\uaed8\uc11c \ucc28\ub77c\ub9ac \uc11c\ube0c\uce74\ud14c\uace0\ub9ac \ud14c\uc774\ube14\uc744 \uc5c6\uc560\uace0 \uce74\ud14c\uace0\ub9ac \ud14c\uc774\ube14 \uc548\uc5d0\uc11c \uc140\ud504\ucc38\uc870\ud568\uc73c\ub85c\uc368 \uacc4\uce35\uc774 \uad6c\ubd84\ub418\ub3c4\ub85d \ud558\ub294\uac8c \uc5b4\ub5bb\ub0d0\ub294 \ud53c\ub4dc\ubc31\uc744 \uc8fc\uc154\uc11c \ubaa8\ub378\uc744 \uc218\uc815\ud588\ub2e4.\\n\\n\ub355\ubd84\uc5d0 \uce74\ud14c\uace0\ub9ac id\ub9cc \uc788\uc73c\uba74 \uba54\uc778\uacfc \uc11c\ube0c \uc0c1\uad00\uc5c6\uc774 \ud574\ub2f9 \uce74\ud14c\uace0\ub9ac \uc815\ubcf4\ub97c \uc904 \uc218 \uc788\uac8c \ub410\uc9c0\ub9cc \uce74\ud14c\uace0\ub9ac \uacc4\uce35\uacfc \uad00\ub828\ub41c \ub370\uc774\ud130\uc5d0 \uc811\uadfc\ud560 \ub54c\ub294 \uc694\uccad\uc5d0\uc11c \ub4e4\uc5b4\uc628 \uce74\ud14c\uace0\ub9ac\uac00 \uba54\uc778\uc778\uc9c0 \uc11c\ube0c\uc778\uc9c0 \uad6c\ubd84\ud558\ub294 \uc791\uc5c5\uc744 \ud574\uc918\uc57c\ud558\ub294 \ub2e8\uc810\uc774 \uc788\uc5c8\ub2e4.  \\n\\n```python\\nclass NavigatorView(View) :\\n    def get(self, request, category_id) :\\n        try :\\n            if not Category.objects.filter(id = category_id).exists() :\\n                return JsonResponse({\'message\' : \'INVALID_CATEGORY_ID\'}, status = 404)\\n         \\n            category = Category.objects.select_related(\'main_category\').get(id = \\n            category_id)\\n\\n            if category.main_category == None :      \\n                navigator_list = {\\n                    \'category_id\'                 : category.id,\\n                    \'category_name\'               : category.name,\\n                    \'category_products_count\'     : \\n                    Product.objects.filter(category__main_category = category).count(),\\n                    \'sub_categories\'              : [{\\n                    \'sub_category_id\'             : sub_category.id,\\n                    \'sub_category_name\'           : sub_category.name,\\n                    \'sub_category_products_count\' : sub_category.product_set.count()\\n                    } for sub_category in \\n                    category.sub_category.prefetch_related(\'product_set\').all()]\\n                }\\n\\n            else :\\n                navigator_list = {\\n                    \'category_id\'                 : category.main_category.id,\\n                    \'category_name\'               : category.main_category.name,\\n                    \'category_products_count\'     : \\n                    Product.objects.filter(category__main_category = \\n                    category.main_category).count(),\\n                    \'sub_categories\'              : [{\\n                    \'sub_category_id\'             : sub_category.id,\\n                    \'sub_category_name\'           : sub_category.name,\\n                    \'sub_category_products_count\' : sub_category.product_set.count()\\n                    } for sub_category in \\n                  category.main_category.sub_category.prefetch_related(\'product_set\').all()]\\n                }\\n            \\n            return JsonResponse({\'navigator_list\' : navigator_list}, status = 200)\\n        \\n        except Category.DoesNotExist :\\n            return JsonResponse({\'message\' : \'INVALID_CATEGORY_ID\'}, status = 404)\\n        \\n        except Category.MultipleObjectsReturned :\\n            return JsonResponse({\'message\' : \'MULTIPLE_CATEGORY_ERROR\'}, status = 400)\\n\\n```\\n\\n\ub611\uac19\uc740 \uad6c\uc870\ub97c \uac00\uc9c4 \ub370\uc774\ud130\ub97c \uc0dd\uc131\ud558\uc9c0\ub9cc \uc694\uccad\uc5d0\uc11c \ub4e4\uc5b4\uc628 \uce74\ud14c\uace0\ub9ac id\uac00 \uba54\uc778\uc778\uc9c0 \uc11c\ube0c\uc778\uc9c0\uc5d0 \ub530\ub77c \uc811\uadfc\ud558\ub294 \ubc29\uc2dd\uc774 \ub2ec\ub790\uae30 \ub54c\ubb38\uc5d0 if else\ubb38\uc744 \uc0ac\uc6a9\ud588\uace0 \uacb0\uacfc\uc801\uc73c\ub85c \ubc18\ubcf5\ub418\ub294 \ucf54\ub4dc\uac00 \ub9ce\uace0 \uac00\ub3c5\uc131\ub3c4 \uc88b\uc9c0 \uc54a\uc558\ub2e4.\\n\\n```python\\nclass Navigator :\\n    def __init__(self, category) :\\n        self.category = category\\n    \\n    def get_category(self) :\\n        category = self.category.main_category if self.category.main_category else \\n        self.category\\n        return category\\n    \\n    def gennerate_navigator_list(self) :\\n        navigator_list = {\\n            \'category_id\'                 : self.get_category().id,\\n            \'category_name\'               : self.get_category().name,\\n            \'category_products_count\'     : Product.objects.filter(category__main_category =\\n            self.get_category()).count(),\\n            \'sub_categories\'              : [{\\n            \'sub_category_id\'             : sub_category.id,\\n            \'sub_category_name\'           : sub_category.name,\\n            \'sub_category_products_count\' : sub_category.product_set.count()\\n            } for sub_category in \\n            self.get_category().sub_category.prefetch_related(\'product_set\').all()]\\n            }\\n\\n        return navigator_list\\n```\\n\\n\uba58\ud1a0\ub2d8\uaed8\uc11c \ud074\ub798\uc2a4\ub97c \ub530\ub85c \ub9cc\ub4e4\uc5b4\uc11c \ub9ac\ud329\ud1a0\ub9c1 \ud574\ubcf4\uba74 \uc88b\uc744\uac70 \uac19\ub2e4\ub294 \ud53c\ub4dc\ubc31\uc744 \uc8fc\uc168\uace0 \uc5b4\uc124\ud504\uac8c\ub098\ub9c8 \uc9c4\ud589\ud574\ubcf4\uc558\ub2e4. \uc77c\ub2e8 \uce74\ud14c\uace0\ub9ac\uac00 \uba54\uc778\uc778\uc9c0 \uc11c\ube0c\uc778\uc9c0\uc5d0 \ub530\ub77c \ucf54\ub4dc\uac00 \ub450 \uac08\ub798\ub85c \ub098\ub258\uc5c8\uae30 \ub54c\ubb38\uc5d0, \uce74\ud14c\uace0\ub9ac\ub97c \ud074\ub798\uc2a4\uc758 \uc18d\uc131\uc73c\ub85c \ub9cc\ub4e4\uace0 \uce74\ud14c\uace0\ub9ac\ub97c \uad6c\ubd84\ud574\uc8fc\ub294 \ud568\uc218\uc640 \uadf8 \ud568\uc218\ub97c \uc0ac\uc6a9\ud574\uc11c \ud544\uc694\ud588\ub358 \ub370\uc774\ud130\ub97c \uc0dd\uc131\ud574\uc8fc\ub294 \ud568\uc218\ub97c \ub9cc\ub4e4\uc5c8\ub2e4.\\n\\n```python\\nclass NavigatorView(View) :\\n    def get(self, request, category_id) :\\n        try :\\n            if not Category.objects.filter(id = category_id).exists() :\\n                return JsonResponse({\'message\' : \'INVALID_CATEGORY_ID\'}, status = 404)\\n         \\n            category       = Category.objects.select_related(\'main_category\').get(id = \\n            category_id)\\n            navigator      = Navigator(category)\\n            navigator_list = navigator.gennerate_navigator_list()\\n            \\n            return JsonResponse({\'navigator_list\' : navigator_list}, status = 200)\\n        \\n        except Category.DoesNotExist :\\n            return JsonResponse({\'message\' : \'INVALID_CATEGORY_ID\'}, status = 404)\\n        \\n        except Category.MultipleObjectsReturned :\\n            return JsonResponse({\'message\' : \'MULTIPLE_CATEGORY_ERROR\'}, status = 400)\\n```\\n\\n\uc2e4\uc81c \uc694\uccad\uc744 \ubc1b\ub294 \ud568\uc218\uc5d0\uc11c\ub294 \uce74\ud14c\uace0\ub9ac \uc815\ubcf4\ub9cc \uc5bb\uc5b4\uc11c \ub530\ub85c \ub9cc\ub4e0 \ud074\ub798\uc2a4\uc758 \uc778\uc2a4\ud134\uc2a4\ub97c \uc0dd\uc131\ud558\uace0 \ub370\uc774\ud130\ub97c \ub9cc\ub4e4\uc5b4\uc8fc\ub294 \ud074\ub798\uc2a4\uc758 \ud568\uc218\ub97c \uc2e4\ud589\ud558\uae30\ub9cc \ud558\uba74 \ub418\uc5c8\ub2e4. \uacb0\uacfc\uc801\uc73c\ub85c \ubc18\ubcf5\ub418\ub294 \ucf54\ub4dc\uac00 \uc904\uc5c8\uace0, \ub2e8\uc21c\ud558\uac8c \ub098\uc5f4\ub418\ub358 \ucf54\ub4dc\ub4e4\uc744 \ud544\uc694\ud55c \ub3d9\uc791\ub4e4\ub85c \ucabc\uac1c\uc5b4 \ubd80\ud488\ucc98\ub7fc \uc0ac\uc6a9\ud574\ubcfc \uc218 \uc788\ub358 \uacbd\ud5d8\uc774\uc5b4\uc11c \uae30\uc5b5\uc5d0 \ub0a8\ub294\ub2e4.\\n\\n### POST/carts (\uc7a5\ubc14\uad6c\ub2c8 \uc0dd\uc131)\\n\\n```python\\nclass CartView(View) :\\n    @signin_decorator\\n    def post(self, request):\\n        try :\\n            data      = json.loads(request.body)\\n            user      = request.user\\n            option_id = data[\'option_id\']\\n            quantity  = int(data[\'quantity\'])\\n\\n            if not Option.objects.filter(id = option_id).exists():\\n                return JsonResponse({\'message\' : \'INVALID_OPTION_ID\'}, status = 404)\\n               \\n            cart, created = Cart.objects.get_or_create(\\n                user = user,\\n                option_id = option_id\\n            )\\n\\n            cart.quantity += quantity\\n            cart.save()\\n\\n            return JsonResponse({\'message\' : \'SUCCESS\'}, status = 201)\\n       \\n        except JSONDecodeError:\\n            return JsonResponse({\'message\' : \'JSON_DECODE_ERROR\'}, status = 400)\\n        \\n        except KeyError:\\n            return JsonResponse({\'message\' : \\"KEY_ERROR\\"}, status = 400)\\n```\\n\\n\uc7a5\ubc14\uad6c\ub2c8\uc5d0 \uc0c1\ud488\uc744 \ucd94\uac00\ud560 \ub54c\ub294 `get_or_create()`\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc7a5\ubc14\uad6c\ub2c8\uc5d0 \uc774\ubbf8 \uac19\uc740 \uc0c1\ud488\uc774 \ub2f4\uaca8\uc788\ub2e4\uba74 \uc218\ub7c9\ub9cc \ubcc0\uacbd\ud558\uace0, \uc5c6\ub2e4\uba74 \uc0c8\ub85c \uc0dd\uc131\ud560 \uc218 \uc788\ub3c4\ub85d \ud588\ub2e4. Cart \ud14c\uc774\ube14\uc5d0\uc11c `quantity` \uce7c\ub7fc\uc5d0 default = 0 \uc73c\ub85c \uc9c0\uc815\ud574\uc92c\uae30 \ub54c\ubb38\uc5d0 \uc0dd\uc131\ud560 \ub54c `quantity`\ub294 0\uc73c\ub85c \uc0dd\uc131\ub418\uace0 \ud6c4\uc5d0 \uc694\uccad\uc5d0\uc11c \uc5bb\uc740 `quantity`\ub85c \ub370\uc774\ud130\ub97c \uc218\uc815\ud574\uc8fc\uc5c8\ub2e4. \\n\\n### GET/carts (\uc7a5\ubc14\uad6c\ub2c8 \uc870\ud68c)\\n\\n```python\\n    @signin_decorator\\n    def get(self, request):\\n        FREE_SHIPPING = 30000\\n        SHIPPING      = 2500\\n        carts         = Cart.objects.filter(user = \\n        request.user).select_related(\'option__product__category\')\\n\\n        cart_list = [{\\n            \'cart_id\'       : item.id,\\n            \'product_id\'    : item.option.product.id,\\n            \'product_name\'  : item.option.product.name,\\n            \'category_name\' : item.option.product.category.name,\\n            \'size\'          : item.option.size,\\n            \'quantity\'      : item.quantity,\\n            \'product_price\' : item.option.price,\\n            \'product_image\' : item.option.product.thumbnail_url,\\n            \'price\'         : int(item.option.price) * int(item.quantity)\\n        }for item in carts]\\n\\n        total_price    = int(carts.aggregate(total = Sum(F(\'quantity\')*F(\'option__price\')))\\n        [\'total\'] or 0)\\n        total_quantity = len(cart_list)\\n        shipping_price = 0 if total_price >= FREE_SHIPPING or total_price == 0 else SHIPPING\\n        order_price    = total_price + shipping_price\\n\\n        return JsonResponse({\\n            \'cart_list\'      : cart_list,\\n            \'total_price\'    : total_price,\\n            \'total_quantity\' : total_quantity,\\n            \'shipping\'       : shipping_price,\\n            \'order_price\'    : order_price,\\n        }, status = 200)\\n```\\n\\n\uc7a5\ubc14\uad6c\ub2c8 \uc870\ud68c\uc5d0\uc11c\ub294 `aggregate()`\ub97c \ud65c\uc6a9\ud574\uc11c \uc7a5\ubc14\uad6c\ub2c8\uc5d0 \ub2f4\uae34 \uc0c1\ud488\ub4e4\uc758 \ucd1d \uac00\uaca9\uc744 \uad6c\ud560 \uc218 \uc788\uc5c8\ub2e4. \ub9cc\uc57d \uc7a5\ubc14\uad6c\ub2c8\uac00 \ube44\uc5b4\uc788\ub2e4\uba74 `Sum()`\uc740 None\uc744 \ubc18\ud658\ud560 \uac83\uc774\uae30 \ub54c\ubb38\uc5d0, `[\'total\']`\uc758 \uac12\uc774 null\uc77c \uacbd\uc6b0 0\uc774 \ub418\ub3c4\ub85d \ud588\ub2e4. (`aggregate()`\uac00 \ubc18\ud658\ub418\ub294 \ud615\ud0dc\ub294 \ub515\uc154\ub108\ub9ac\uc774\ubbc0\ub85c) \\n\\n\ubc30\uc1a1\ube44\ub294 `total_price`\uac00 3\ub9cc\uc6d0 \uc774\uc0c1\uc774\uac70\ub098 0\uc6d0\uc77c \ub54c\ub294 0\uc6d0\uc774 \ub418\uace0 3\ub9cc\uc6d0 \ubbf8\ub9cc\uc77c \ub54c\ub294 2500\uc6d0\uc774 \ub418\ub3c4\ub85d \ud588\ub2e4."}]}')}}]);