---
layout: single
tags: 
 - django

toc: true
toc_sticky: true

title: "[project] LUSH 클론 모델링"
---

{% raw %}

## 모델링

1차 프로젝트로 Lush 사이트 클론을 하게 되었다. 

ERDcloud를 사용하여 작성했다. 

![](https://user-images.githubusercontent.com/61782539/136661786-85fd0e02-a1a8-4bc3-9bc6-41d81a9583a1.png)

팀원분과 상의하여 우리가 필수로 구현하기로 한 기능들을 우선적으로 생각하여 모델링을 진행했다.

리뷰에도 이미지를 여러장 넣을 수 있기 때문에 이미지 테이블을 따로 만들어줘야했지만 기획상 한장만 넣을 수 있는 걸로 해서 따로 만들지 않았다.

## models.py 작성

**products.models.py**

```python
class Category(models.Model) :
    name            = models.CharField(max_length = 50)
    image_url       = models.CharField(max_length = 1000)
    description     = models.CharField(max_length = 300)
    main_category   = models.ForeignKey('self', on_delete = models.CASCADE, null = True, related_name = 'sub_category')

    class Meta :
        db_table = 'categories'

class Product(models.Model) :
    category      = models.ForeignKey('Category', on_delete = CASCADE)
    tags          = models.ManyToManyField('Tag', through = 'ProductTag')
    name          = models.CharField(max_length = 50)
    thumbnail_url = models.CharField(max_length = 1000)
    created_at    = models.DateTimeField(auto_now_add = True)
    deleted_at    = models.DateTimeField(null = True, default = None)

    class Meta :
        db_table = 'products'

class Option(models.Model) :
    product = models.ForeignKey('Product', on_delete = models.CASCADE)
    price   = models.PositiveIntegerField()
    size    = models.PositiveIntegerField()

    class Meta :
        db_table = 'options'

class DetailImage(models.Model) :
    product   = models.ForeignKey('Product', on_delete = models.CASCADE)
    image_url = models.CharField(max_length = 1000)

    class Meta :
        db_table = 'detail_images'

class Tag(models.Model) :
    name = models.CharField(max_length = 50)

    class Meta :
        db_table = 'tags'

class ProductTag(models.Model):
    product = models.ForeignKey('Product', on_delete = models.CASCADE)
    tag     = models.ForeignKey('Tag', on_delete = models.CASCADE)

    class Meta:
        db_table = 'products_tags'
```

Lush 사이트에선 카테고리(샤워)나 서브카테고리(솝, 샤워오일)로 이동했을 때 카테고리, 서브카테고리에 대한 배너이미지와 한 줄의 정보가 함께 뜬다. 

처음엔 서브카테고리 테이블을 생성하고 카테고리와 서브카테고리에 각각의 배너이미지와 짧은 설명이 담기도록 칼럼을 주었다. 그러다보니 카테고리 정보를 보내주는 api와 서브카테고리 정보를 보내주는 api를 따로 만들게 됐다. 또 프론트 팀원분들께서 카테고리로 이동했을 때 카테고리 정보에 대한 api와 상품 목록에 대한 api를 나눠서 정보를 받는 것보다 하나의 api에서 받는 게 편하다고 하셨고 멘토님께서도 합치는게 좋을거 같다는 피드백을 주셨다. 그래서 원래 나눠두었던 뷰들을 수정하기로 했고 그 과정에서 멘토님께서 모델에서 서브카테고리를 없애고 카테고리 테이블에서 자신을 참조하는 칼럼을 추가해서 관리하는게 어떻냐는 피드백을 주셨다.

다행히 Westagram 과제를 할 때 대댓글 기능을 구현할 때와 같은 원리로 보였고 카테고리와 서브카레고리가 담고 있는 데이터들이 반복되는 구조였기 때문에 그렇게 하는게 더 효율적일 것 같아서 모델을 수정하게 됐다.

이렇게 수정하고 다시 뷰를 작성하면서 느낀 장점은 일단 카테고리id만 있으면 카테고리든 서브카테고리든 상관없이 하나의 테이블에서 바로 카테고리 정보에 접근할 수 있다는 것이고 단점은 서브카테고리가 아닌 메인카테고리일 때 거기에 속한 상품들에 접근하는게 기존 모델보다 헷갈린다는 것이다. 상품은 카테고리 테이블의 main_category 칼럼에서 자신을 참조하고 있는 카테고리(서브 카테고리)id에만 연결돼있기 때문에 request에서 얻은 카테고리 id로 상품에 접근 할 때 그 카테고리가 메인 카테고리인지 서브 카테고리인지 분리해서 접근하는 작업이 필요했다.

**users.models.py**

```python
class User(models.Model):
    email        = models.CharField(max_length = 200, unique = True)
    password     = models.CharField(max_length = 200)
    phone_number = models.CharField(max_length = 20, null = True)
    name         = models.CharField(max_length = 45, null = True)
    address      = models.CharField(max_length = 300, null = True)
    
    class Meta:
        db_table = 'users'
```

**carts.models.py**

```python
from products.models                import Product, Option
from users.models                   import User

class Cart(models.Model) :
    user     = models.ForeignKey('users.User', on_delete = models.CASCADE)
    product  = models.ForeignKey('products.Product', on_delete = models.CASCADE)
    option   = models.ForeignKey('products.Option', on_delete = models.CASCADE)
    quantity = models.PositiveIntegerField(default = 0)

    class Meta :
        db_table = 'carts'
```

**reviews.models.py**

```python
from users.models           import User
from products.models        import Product

class Review(models.Model):
    user       = models.ForeignKey('users.User', on_delete = models.CASCADE)
    product    = models.ForeignKey('products.Product', on_delete = models.CASCADE)
    content    = models.CharField(max_length = 400)
    rating     = models.PositiveIntegerField()
    image_url  = models.CharField(max_length = 1000, null = True)
    created_at = models.DateTimeField(auto_now_add = True)
    updated_at = models.DateTimeField(auto_now = True)
    
    class Meta:
        db_table = 'reviews'

class ReviewComment(models.Model):
    user       = models.ForeignKey('users.User', on_delete = models.CASCADE)
    review     = models.ForeignKey('Review', on_delete = models.CASCADE)
    content    = models.CharField(max_length = 200)
    created_at = models.DateTimeField(auto_now_add = True)
    updated_at = models.DateTimeField(auto_now = True)
    
    class Meta:
        db_table = 'review_comments'

class ReviewLike(models.Model):
    user   = models.ForeignKey('users.User', on_delete = models.CASCADE)
    review = models.ForeignKey('Review', on_delete = models.CASCADE)
    
    class Meta:
        db_table = 'review_likes'
```


{% endraw %}
