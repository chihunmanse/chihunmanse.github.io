---
layout: single
tags: 
 - REST

toc: true
toc_sticky: true

title: "[REST] REST_API"
---

{% raw %}


# REST API

REST는 Representational State Transfer라는 용어의 약자로서 2000년도에 로이 필딩 (Roy Fielding)의 박사학위 논문에서 최초로 소개되었습니다. 로이 필딩은 HTTP의 주요 저자 중 한 사람으로 그 당시 웹(HTTP) 설계의 우수성에 비해 제대로 사용되어지지 못하는 모습에 안타까워하며 웹의 장점을 최대한 활용할 수 있는 아키텍처로써 REST를 발표했다고 합니다.

**REST 구성**

- **자원(RESOURCE)** - URI
- **행위(Verb)** - HTTP METHOD
- **표현(Representations)**

REST API 설계 시 가장 중요한 항목은 다음의 2가지로 요약할 수 있습니다.

**첫 번째,** URI는 정보의 자원을 표현해야 한다.
**두 번째,** 자원에 대한 행위는 HTTP Method(GET, POST, PUT, DELETE)로 표현한다.

## REST API 중심 규칙

**URI는 정보의 자원을 표현해야 한다. (리소스명은 동사보다는 명사를 사용)**

```
    GET /members/delete/1
```

위와 같은 방식은 REST를 제대로 적용하지 않은 URI입니다. URI는 자원을 표현하는데 중점을 두어야 합니다. delete와 같은 행위에 대한 표현이 들어가서는 안됩니다.

**자원에 대한 행위는 HTTP Method(GET, POST, PUT, DELETE 등)로 표현**

위의 잘못 된 URI를 HTTP Method를 통해 수정해 보면

```
    DELETE /members/1
```

회원정보를 가져오는 URI

```
    GET /members/show/1     (x)
    GET /members/1          (o)
```

회원을 추가할 때

```
    GET /members/insert/2 (x)  - GET 메서드는 리소스 생성에 맞지 않습니다.
    POST /members/2       (o)
```

POST, GET, PUT, DELETE 이 4가지의 Method를 가지고 CRUD를 할 수 있습니다.

| METHOD |                             역할                             |
| :----: | :----------------------------------------------------------: |
|  POST  |     POST를 통해 해당 URI를 요청하면 리소스를 생성합니다.     |
|  GET   | GET를 통해 해당 리소스를 조회합니다. 리소스를 조회하고 해당 도큐먼트에 대한 자세한 정보를 가져온다. |
|  PUT   |             PUT를 통해 해당 리소스를 수정합니다.             |
| DELETE |              DELETE를 통해 리소스를 삭제합니다.              |

이 외에도 **PATCH** 라는 HTTP Method는 PUT이 해당 자원의 전체를 교체하는 의미를 지니는 대신, [PATCH](http://www.rfc-editor.org/rfc/rfc5789.txt)는 일부를 변경한다는 의미를 지니기 때문에 최근 update 이벤트에서 PUT보다 더 의미적으로 적합하다고 평가받고 있습니다.

다음과 같은 식으로 URI는 자원을 표현하는 데에 집중하고 행위에 대한 정의는 HTTP METHOD를 통해 하는 것이 REST한 API를 설계하는 중심 규칙입니다.

**마지막에 `/` 포함하지 않는다.**

Bad

```
http://api.test.com/users/
```

Good

```
http://api.test.com/users
```

**_(underbar) 대신 -(dash)를 사용한다.**

-(dash)의 사용도 최소한으로 설계한다. 정확한 의미나 표현을 위해 단어의 결합이 불가피한 경우 반드시 -(dash) 사용한다.

Bad

```
http://api.test.com/users/postCommnets
```

Good

```
http://api.test.com/users/post-commnets
```

**소문자를 사용한다.**

Bad

```
http://api.test.com/users/postCommnets
```

Good

```
http://api.test.com/users/post-commnets
```

**컨트롤 자원을 의미하는 URL 예외적으로 동사를 허용한다.**

함수처럼, 컨트롤 리소스를 나타내는 URL은 동작을 포함하는 이름을 짓는다.

Bad

```
http://api.test.com/posts/duplicating
```

Good

```
http://api.test.com/posts/duplicate
```

## 리소스 간의 관계를 표현하는 방법

REST 리소스 간에는 연관 관계가 있을 수 있고, 이런 경우 다음과 같은 표현방법으로 사용합니다.

```
    /리소스명/리소스 ID/관계가 있는 다른 리소스명

    ex)    GET : /users/{userid}/devices (일반적으로 소유 ‘has’의 관계를 표현할 때)
```

만약에 관계명이 복잡하다면 이를 서브 리소스에 명시적으로 표현하는 방법이 있습니다. 예를 들어 사용자가 ‘좋아하는’ 디바이스 목록을 표현해야 할 경우 다음과 같은 형태로 사용될 수 있습니다.

```
    GET : /users/{userid}/likes/devices (관계명이 애매하거나 구체적 표현이 필요할 때)
```

## 자원을 표현하는 Colllection과 Document

Collection과 Document에 대해 알면 URI 설계가 한 층 더 쉬워집니다. DOCUMENT는 단순히 문서로 이해해도 되고, 한 객체라고 이해하셔도 될 것 같습니다. 컬렉션은 문서들의 집합, 객체들의 집합이라고 생각하시면 이해하시는데 좀더 편하실 것 같습니다. 컬렉션과 도큐먼트는 모두 리소스라고 표현할 수 있으며 URI에 표현됩니다. 예를 살펴보도록 하겠습니다.

```
    http:// restapi.example.com/sports/soccer
```

위 URI를 보시면 sports라는 컬렉션과 soccer라는 도큐먼트로 표현되고 있다고 생각하면 됩니다. 좀 더 예를 들어보자면

```
    http:// restapi.example.com/sports/soccer/players/13
```

sports, players 컬렉션과 soccer, 13(13번인 선수)를 의미하는 도큐먼트로 URI가 이루어지게 됩니다. 여기서 중요한 점은 **컬렉션은 복수**로 사용하고 있다는 점입니다. 좀 더 직관적인 REST API를 위해서는 컬렉션과 도큐먼트를 사용할 때 단수 복수도 지켜준다면 좀 더 이해하기 쉬운 URI를 설계할 수 있습니다.

## HTTP 응답 상태 코드

| 상태코드 |                                                              |
| :------: | :----------------------------------------------------------: |
|   200    |            클라이언트의 요청을 정상적으로 수행함             |
|   201    | 클라이언트가 어떠한 리소스 생성을 요청, 해당 리소스가 성공적으로 생성됨(POST를 통한 리소스 생성 작업 시) |

| 상태코드 |                                                              |
| :------: | :----------------------------------------------------------: |
|   400    |    클라이언트의 요청이 부적절 할 경우 사용하는 응답 코드     |
|   401    | 클라이언트가 인증되지 않은 상태에서 보호된 리소스를 요청했을 때 사용하는 응답 코드 |
|          | (로그인 하지 않은 유저가 로그인 했을 때, 요청 가능한 리소스를 요청했을 때) |
|   403    | 유저 인증상태와 관계 없이 응답하고 싶지 않은 리소스를 클라이언트가 요청했을 때 사용하는 응답 코드 |
|          | (403 보다는 400이나 404를 사용할 것을 권고. 403 자체가 리소스가 존재한다는 뜻이기 때문에) |
|   405    | 클라이언트가 요청한 리소스에서는 사용 불가능한 Method를 이용했을 경우 사용하는 응답 코드 |

| 상태코드 |                                                              |
| :------: | :----------------------------------------------------------: |
|   301    | 클라이언트가 요청한 리소스에 대한 URI가 변경 되었을 때 사용하는 응답 코드 |
|          |  (응답 시 Location header에 변경된 URI를 적어 줘야 합니다.)  |
|   500    |          서버에 문제가 있을 경우 사용하는 응답 코드          |

- 200 : [OK] 클라이언트의 요청을 정상적으로 수행함

- 201 : [Created] 200과 달리 요청에 성공하고 새로운 리소스를 만든 경우에 응답한다. POST, PUT 에 사용한다.

- 202 : [Accepted] : 클라이언트 요청을 받은 후, 요청은 유효하나 서버가 아직 처리하지 않은 경우에 응답한다. 

  요청에 대한 응답이 일정 시간 후 완료되는 작업의 경우

  작업 완료 후 클라이언트에 알릴 수 있는 server push 작업을 하거나, 클라이언트가 해당 작업의 진행 상황을 조회할 수 있는 URL을 응답해야 한다.

- 204 : [No Content] 응답 body가 필요 없는 자원 삭제 요청(DELETE) 같은 경우 응답한다. HTTP body가 아예 없는 경우

- 400 : [Bad Request] 클라이언트 요청이 미리 정의된 파라미터 요구사항을 위반한 경우, 파라미터의 위치(`path`, `query`, `body`), 사용자 입력 값, 에러 이유 등을 알린다

  case 1

  ```
   {
   	"message" : "'name'(body) must be Number, input 'name': test123"
   }
  ```

  case 2

  ```
   {
   	"errors": [
   		{
   			"location": "body",
   			"param": "name",
   			"value": "test123",
   			"msg": "must be Number"
   		}
   	]
   }
  ```

- 401 : [Unauthorized] 클라이언트가 인증되지 않은 상태에서 보호된 리소스를 요청했을 때 사용하는 응답 코드

- 403 : [Forbidden] 해당 요청은 유효하나 서버 작업 중 접근이 허용되지 않은 자원을 조회하려는 경우, 접근 권한이 전체가 아닌 일부만 허용되어 요청자의 접근이 불가한 자원에 접근 시도한 경우 응답한다.

- 404 : [Not Found]

- 405 : [Method Not Allowed] 405 code는 404 code와 혼동될 수 있기 때문에 룰을 잘 정하고 시작한다.

  ```
  POST /users/1
  ```

  의 경우 404로 응답한다고 생각할 수 있지만, 경우에 따라 405로 응답할 수 있다. 

  ```
  /users/:id
  ```

  위의 URL은 GET, PATCH, DELETE method는 허용되고 POST는 불가한 URL이다.

  만약 id가 1인 사용자가 없는 경우엔 404로 응답하지만(GET, PATCH, DELETE의 경우), `POST /users/1`는 `/users/:id` URL이 POST method를 제공하지 않기 때문에 405로 응답하는 게 옳다.

  `Allow: GET, PATCH, DELETE` HTTP header에 허용 가능한 method를 표시한다.

참고 : https://library.gabia.com/contents/8339/ , https://meetup.toast.com/posts/92

{% endraw %}
