---
layout: single
tags: 
 - django

toc: true
toc_sticky: true

title: "[project] Preonboarding 디어 기업과제"
---

{% raw %}


# Deer 기업과제 회고

**[과제 안내]**

디어는 사용자의 요금을 계산하기 위해 다양한 상황을 고려합니다.

- 우선 지역별로 다양한 요금제를 적용하고 있습니다. 예를 들어 건대에서 이용하는 유저는 기본요금 790원에 분당요금 150원, 여수에서 이용하는 유저는 기본요금 300원에 분당요금 70원으로 적용됩니다.
- 할인 조건도 있습니다. 사용자가 파킹존에서 반납하는 경우 요금의 30%를 할인해주며, 사용자가 마지막 이용으로부터 30분 이내에 다시 이용하면 기본요금을 면제해줍니다.
- 벌금 조건도 있습니다. 사용자가 지역 바깥에 반납한 경우 얼마나 멀리 떨어져있는지 거리에 비례하는 벌금을 부과하며, 반납 금지로 지정된 구역에 반납하면 6,000원의 벌금을 요금에 추과로 부과합니다.
- 예외도 있는데, 킥보드가 고장나서 정상적인 이용을 못하는 경우의 유저들을 배려하여 1분 이내의 이용에는 요금을 청구하지 않고 있습니다.

최근에 다양한 할인과 벌금을 사용하여 지자체와 협력하는 경우가 점점 많아지고 있어 요금제에 새로운 할인/벌금 조건을 추가하는 일을 쉽게 만드려고 합니다. 어떻게 하면 앞으로 발생할 수 있는 다양한 할인과 벌금 조건을 기존의 요금제에 쉽게 추가할 수 있는 소프트웨어를 만들 수 있을까요?

우선은 사용자의 이용에 관한 정보를 알려주면 현재의 요금 정책에 따라 요금을 계산해주는 API를 만들어주세요. 그 다음은, 기능을 유지한 채로 새로운 할인이나 벌금 조건이 쉽게 추가될 수 있게 코드를 개선하여 최종 코드를 만들어주세요.

**다음과 같은 정보들이 도움이 될 것 같아요.**

------

- 요금제가 사용자 입장에서 합리적이고 이해가 쉬운 요금제라면 좋을 것 같아요.
- 앞으로도 할인과 벌금 조건은 새로운 조건이 굉장히 많이 추가되거나 변경될 것 같아요.
- 가장 최근의 할인/벌금 조건의 변경은 '특정 킥보드는 파킹존에 반납하면 무조건 무료' 였습니다.


## 할인 및 벌금 조건 구현과정

디어 과제를 진행하면서 polygon과 point 같은 새로운 데이터 타입을 사용해볼 수 있었다. 먼저 서비스 지역과 반납 금지 구역 및 파킹존을 설정해주기 위해 구글맵을 찾아 임의의 지역들을 설정했다. 

![](https://user-images.githubusercontent.com/61782539/142759410-9c8699d3-58f5-4132-b14f-a732ab1c0791.jpg)

![](https://user-images.githubusercontent.com/61782539/142759435-128d05d8-5e73-4269-9628-e8407e6c6ba3.jpg)

서울시 광진구 군자동과 부산시 동래구 온천동 두 지역을 서비스 지역으로 설정했다.



![](https://user-images.githubusercontent.com/61782539/142759800-1d442310-5438-49d3-8773-962f18d99c2b.png)

GDAL 라이브러리를 사용하여 django orm을 통해 Polygon 및 Point 데이터타입을 다룰 수 있었다.

![](https://user-images.githubusercontent.com/61782539/142760381-032ab5a2-9a85-49af-9d4f-02579e50631d.png)

처음엔 View 안에서 할인 및 벌금 조건들의 로직을 순서대로 나열하는 식으로 코드를 작성하였다. 기능에는 문제가 없었지만, 적용중인 할인과 벌금 조건을 추가,수정하거나 삭제한다고 했을 때 매우 비효율적인 구성이었다.

수정해야하는 조건의 로직을 찾기도 힘들었고, 조건을 추가하거나 삭제할 때 잘못하면 전체 로직에 영향을 주기도 쉬웠다. 또 어떤 조건은 정지됐다가 후에 다시 진행될 수도 있기 때문에 조건을 재사용하는 측면에서도 효율이 떨어졌다.

그래서 할인 및 벌금 정책들을 각각의 class로 만들어 개별적인 단위로 구성될 수 있도록 개선을 시도하였다.

조건은 크게 벌금과 할인으로 나누고 할인 안에서는 요율로 적용되는 할인과 쿠폰 할인으로 나누어 관리하기로 했다.

**penalty.py**

![](https://user-images.githubusercontent.com/61782539/142761041-d7fffe92-e1c1-4ec3-aadc-40ea4437f4e5.png)

penalty.py 파일에는 벌금 정책들이 각각의 class로 작성되어 관리된다.



**discount.py**

![](https://user-images.githubusercontent.com/61782539/142761130-36e5084d-7978-47d1-87a0-8da4270d6776.png)

discount.py 파일에는 요율로 적용되는 할인 정책들이 각각의 class로 작성되어 관리된다.



**coupon.py**

![](https://user-images.githubusercontent.com/61782539/142761226-c77fd07d-121c-4f75-868b-0e36482e3c9d.png)

coupon.py 파일에는 쿠폰 할인 정책들이 각각의 class로 작성되어 관리된다.



**calculator.py**

![](https://user-images.githubusercontent.com/61782539/142761343-8b762e75-f6da-4cb3-830b-34ae2aff7557.png)

calculator.py 파일에는 적용된 벌금, 할인, 쿠폰 조건들의 총 금액을 계산해주는 class들을 작성하였다.



**views.py**

![](https://user-images.githubusercontent.com/61782539/142761649-e21bf2bd-6d95-4f0f-a5be-007778f89965.png)

View에서는 요금을 계산할 때 적용할 조건들을 지정해주고 calcutaor.py에 있는 class들을 활용해 최종적인 할인율과 벌금, 쿠폰액을 구하여 최종 이용요금을 구할 수 있게 수정하였다.

이렇게 구성을 변경한 후에 실제로 새로운 할인, 쿠폰 조건들을 추가해보면서 전보다 요금정책을 관리하는 효율성이 크게 개선되었음을 느낄 수 있었다.

만약 반납금지구역에 반납했을 때 패널티가 6000원에서 7000원으로 변경되었다고 한다면 penalty.py에서 해당 class의 속성값만 변경해주면 되기 때문에 기존처럼 전체 로직에서 바꿔야하는 조건이 무엇인지 찾을 필요가 없고 수정할 때 다른 로직에 영향을 줄 위험도 훨씬 줄어들었다.

또 주말 21시 이후 10% 할인 정책을 잠시 중지한다고 하면 View의 discounts 리스트에서 해당 class를 빼주었다가 다시 정책을 적용한다고 했을 때 추가해주면 되기 때문에 재사용할 수 있는 효율도 크게 개선되었다.



{% endraw %}
